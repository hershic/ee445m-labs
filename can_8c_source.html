<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>EE445M Real Time Operating Systems: driverlib/can.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">EE445M Real Time Operating Systems
   
   </div>
   <div id="projectbrief">Taken at the University of Texas Spring 2015</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('can_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">driverlib/can.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="can_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//*****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">//</span>
<a name="l00003"></a>00003 <span class="comment">// can.c - Driver for the CAN module.</span>
<a name="l00004"></a>00004 <span class="comment">//</span>
<a name="l00005"></a>00005 <span class="comment">// Copyright (c) 2006-2014 Texas Instruments Incorporated.  All rights reserved.</span>
<a name="l00006"></a>00006 <span class="comment">// Software License Agreement</span>
<a name="l00007"></a>00007 <span class="comment">// </span>
<a name="l00008"></a>00008 <span class="comment">//   Redistribution and use in source and binary forms, with or without</span>
<a name="l00009"></a>00009 <span class="comment">//   modification, are permitted provided that the following conditions</span>
<a name="l00010"></a>00010 <span class="comment">//   are met:</span>
<a name="l00011"></a>00011 <span class="comment">// </span>
<a name="l00012"></a>00012 <span class="comment">//   Redistributions of source code must retain the above copyright</span>
<a name="l00013"></a>00013 <span class="comment">//   notice, this list of conditions and the following disclaimer.</span>
<a name="l00014"></a>00014 <span class="comment">// </span>
<a name="l00015"></a>00015 <span class="comment">//   Redistributions in binary form must reproduce the above copyright</span>
<a name="l00016"></a>00016 <span class="comment">//   notice, this list of conditions and the following disclaimer in the</span>
<a name="l00017"></a>00017 <span class="comment">//   documentation and/or other materials provided with the  </span>
<a name="l00018"></a>00018 <span class="comment">//   distribution.</span>
<a name="l00019"></a>00019 <span class="comment">// </span>
<a name="l00020"></a>00020 <span class="comment">//   Neither the name of Texas Instruments Incorporated nor the names of</span>
<a name="l00021"></a>00021 <span class="comment">//   its contributors may be used to endorse or promote products derived</span>
<a name="l00022"></a>00022 <span class="comment">//   from this software without specific prior written permission.</span>
<a name="l00023"></a>00023 <span class="comment">// </span>
<a name="l00024"></a>00024 <span class="comment">// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00025"></a>00025 <span class="comment">// &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00026"></a>00026 <span class="comment">// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="l00027"></a>00027 <span class="comment">// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<a name="l00028"></a>00028 <span class="comment">// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<a name="l00029"></a>00029 <span class="comment">// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<a name="l00030"></a>00030 <span class="comment">// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<a name="l00031"></a>00031 <span class="comment">// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<a name="l00032"></a>00032 <span class="comment">// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00033"></a>00033 <span class="comment">// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<a name="l00034"></a>00034 <span class="comment">// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00035"></a>00035 <span class="comment">// </span>
<a name="l00036"></a>00036 <span class="comment">// This is part of revision 2.1.0.12573 of the Tiva Peripheral Driver Library.</span>
<a name="l00037"></a>00037 <span class="comment">//</span>
<a name="l00038"></a>00038 <span class="comment">//*****************************************************************************</span>
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="comment">//*****************************************************************************</span>
<a name="l00041"></a>00041 <span class="comment">//</span>
<a name="l00044"></a>00044 <span class="comment"></span><span class="comment">//</span>
<a name="l00045"></a>00045 <span class="comment">//*****************************************************************************</span>
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;stdbool.h&gt;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &lt;stdint.h&gt;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="hw__can_8h.html">inc/hw_can.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="hw__ints_8h.html">inc/hw_ints.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="hw__nvic_8h.html">inc/hw_nvic.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="hw__memmap_8h.html">inc/hw_memmap.h</a>&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="hw__sysctl_8h.html">inc/hw_sysctl.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="hw__types_8h.html">inc/hw_types.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="can_8h.html">driverlib/can.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="debug_8h.html">driverlib/debug.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="interrupt_8h.html">driverlib/interrupt.h</a>&quot;</span>
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 <span class="comment">//*****************************************************************************</span>
<a name="l00060"></a>00060 <span class="comment">//</span>
<a name="l00061"></a>00061 <span class="comment">// This is the maximum number that can be stored as an 11bit Message</span>
<a name="l00062"></a>00062 <span class="comment">// identifier.</span>
<a name="l00063"></a>00063 <span class="comment">//</span>
<a name="l00064"></a>00064 <span class="comment">//*****************************************************************************</span>
<a name="l00065"></a><a class="code" href="group__can__api.html#gad1368e948556fa9ed4f74ecf8610845f">00065</a> <span class="preprocessor">#define CAN_MAX_11BIT_MSG_ID    0x7ff</span>
<a name="l00066"></a>00066 <span class="preprocessor"></span>
<a name="l00067"></a>00067 <span class="comment">//*****************************************************************************</span>
<a name="l00068"></a>00068 <span class="comment">//</span>
<a name="l00069"></a>00069 <span class="comment">// The maximum CAN bit timing divisor is 19.</span>
<a name="l00070"></a>00070 <span class="comment">//</span>
<a name="l00071"></a>00071 <span class="comment">//*****************************************************************************</span>
<a name="l00072"></a><a class="code" href="group__can__api.html#ga54aec90dc979d14c3e3aad10d3284af3">00072</a> <span class="preprocessor">#define CAN_MAX_BIT_DIVISOR     19</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span>
<a name="l00074"></a>00074 <span class="comment">//*****************************************************************************</span>
<a name="l00075"></a>00075 <span class="comment">//</span>
<a name="l00076"></a>00076 <span class="comment">// The minimum CAN bit timing divisor is 4.</span>
<a name="l00077"></a>00077 <span class="comment">//</span>
<a name="l00078"></a>00078 <span class="comment">//*****************************************************************************</span>
<a name="l00079"></a><a class="code" href="group__can__api.html#ga57e5366b1956052d659f06990193c4c6">00079</a> <span class="preprocessor">#define CAN_MIN_BIT_DIVISOR     4</span>
<a name="l00080"></a>00080 <span class="preprocessor"></span>
<a name="l00081"></a>00081 <span class="comment">//*****************************************************************************</span>
<a name="l00082"></a>00082 <span class="comment">//</span>
<a name="l00083"></a>00083 <span class="comment">// The maximum CAN pre-divisor is 1024.</span>
<a name="l00084"></a>00084 <span class="comment">//</span>
<a name="l00085"></a>00085 <span class="comment">//*****************************************************************************</span>
<a name="l00086"></a><a class="code" href="group__can__api.html#ga5e034f57dcda85405e2ed9b4f36389da">00086</a> <span class="preprocessor">#define CAN_MAX_PRE_DIVISOR     1024</span>
<a name="l00087"></a>00087 <span class="preprocessor"></span>
<a name="l00088"></a>00088 <span class="comment">//*****************************************************************************</span>
<a name="l00089"></a>00089 <span class="comment">//</span>
<a name="l00090"></a>00090 <span class="comment">// The minimum CAN pre-divisor is 1.</span>
<a name="l00091"></a>00091 <span class="comment">//</span>
<a name="l00092"></a>00092 <span class="comment">//*****************************************************************************</span>
<a name="l00093"></a><a class="code" href="group__can__api.html#ga723a76d507997b3f6aae0a7052b42b16">00093</a> <span class="preprocessor">#define CAN_MIN_PRE_DIVISOR     1</span>
<a name="l00094"></a>00094 <span class="preprocessor"></span>
<a name="l00095"></a>00095 <span class="comment">//*****************************************************************************</span>
<a name="l00096"></a>00096 <span class="comment">//</span>
<a name="l00097"></a>00097 <span class="comment">// Converts a set of CAN bit timing values into the value that needs to be</span>
<a name="l00098"></a>00098 <span class="comment">// programmed into the CAN_BIT register to achieve those timings.</span>
<a name="l00099"></a>00099 <span class="comment">//</span>
<a name="l00100"></a>00100 <span class="comment">//*****************************************************************************</span>
<a name="l00101"></a><a class="code" href="group__can__api.html#gaf25c77b64fe1d9f8edffa54e1a7c3e19">00101</a> <span class="preprocessor">#define CAN_BIT_VALUE(seg1, seg2, sjw)                                        \</span>
<a name="l00102"></a>00102 <span class="preprocessor">                                ((((seg1 - 1) &lt;&lt; CAN_BIT_TSEG1_S) &amp;           \</span>
<a name="l00103"></a>00103 <span class="preprocessor">                                  CAN_BIT_TSEG1_M) |                          \</span>
<a name="l00104"></a>00104 <span class="preprocessor">                                 (((seg2 - 1) &lt;&lt; CAN_BIT_TSEG2_S) &amp;           \</span>
<a name="l00105"></a>00105 <span class="preprocessor">                                  CAN_BIT_TSEG2_M) |                          \</span>
<a name="l00106"></a>00106 <span class="preprocessor">                                 (((sjw - 1) &lt;&lt; CAN_BIT_SJW_S) &amp;              \</span>
<a name="l00107"></a>00107 <span class="preprocessor">                                  CAN_BIT_SJW_M))</span>
<a name="l00108"></a>00108 <span class="preprocessor"></span>
<a name="l00109"></a>00109 <span class="comment">//*****************************************************************************</span>
<a name="l00110"></a>00110 <span class="comment">//</span>
<a name="l00111"></a>00111 <span class="comment">// This table is used by the CANBitRateSet() API as the register defaults for</span>
<a name="l00112"></a>00112 <span class="comment">// the bit timing values.</span>
<a name="l00113"></a>00113 <span class="comment">//</span>
<a name="l00114"></a>00114 <span class="comment">//*****************************************************************************</span>
<a name="l00115"></a><a class="code" href="group__can__api.html#gaf35e20b628219082bc6492ae33b22573">00115</a> <span class="keyword">static</span> <span class="keyword">const</span> uint16_t <a class="code" href="group__can__api.html#gaf35e20b628219082bc6492ae33b22573">g_ui16CANBitValues</a>[] =
<a name="l00116"></a>00116 {
<a name="l00117"></a>00117     <a class="code" href="group__can__api.html#gaf25c77b64fe1d9f8edffa54e1a7c3e19">CAN_BIT_VALUE</a>(2, 1, 1),     <span class="comment">// 4 clocks/bit</span>
<a name="l00118"></a>00118     <a class="code" href="group__can__api.html#gaf25c77b64fe1d9f8edffa54e1a7c3e19">CAN_BIT_VALUE</a>(3, 1, 1),     <span class="comment">// 5 clocks/bit</span>
<a name="l00119"></a>00119     <a class="code" href="group__can__api.html#gaf25c77b64fe1d9f8edffa54e1a7c3e19">CAN_BIT_VALUE</a>(3, 2, 2),     <span class="comment">// 6 clocks/bit</span>
<a name="l00120"></a>00120     <a class="code" href="group__can__api.html#gaf25c77b64fe1d9f8edffa54e1a7c3e19">CAN_BIT_VALUE</a>(4, 2, 2),     <span class="comment">// 7 clocks/bit</span>
<a name="l00121"></a>00121     <a class="code" href="group__can__api.html#gaf25c77b64fe1d9f8edffa54e1a7c3e19">CAN_BIT_VALUE</a>(4, 3, 3),     <span class="comment">// 8 clocks/bit</span>
<a name="l00122"></a>00122     <a class="code" href="group__can__api.html#gaf25c77b64fe1d9f8edffa54e1a7c3e19">CAN_BIT_VALUE</a>(5, 3, 3),     <span class="comment">// 9 clocks/bit</span>
<a name="l00123"></a>00123     <a class="code" href="group__can__api.html#gaf25c77b64fe1d9f8edffa54e1a7c3e19">CAN_BIT_VALUE</a>(5, 4, 4),     <span class="comment">// 10 clocks/bit</span>
<a name="l00124"></a>00124     <a class="code" href="group__can__api.html#gaf25c77b64fe1d9f8edffa54e1a7c3e19">CAN_BIT_VALUE</a>(6, 4, 4),     <span class="comment">// 11 clocks/bit</span>
<a name="l00125"></a>00125     <a class="code" href="group__can__api.html#gaf25c77b64fe1d9f8edffa54e1a7c3e19">CAN_BIT_VALUE</a>(6, 5, 4),     <span class="comment">// 12 clocks/bit</span>
<a name="l00126"></a>00126     <a class="code" href="group__can__api.html#gaf25c77b64fe1d9f8edffa54e1a7c3e19">CAN_BIT_VALUE</a>(7, 5, 4),     <span class="comment">// 13 clocks/bit</span>
<a name="l00127"></a>00127     <a class="code" href="group__can__api.html#gaf25c77b64fe1d9f8edffa54e1a7c3e19">CAN_BIT_VALUE</a>(7, 6, 4),     <span class="comment">// 14 clocks/bit</span>
<a name="l00128"></a>00128     <a class="code" href="group__can__api.html#gaf25c77b64fe1d9f8edffa54e1a7c3e19">CAN_BIT_VALUE</a>(8, 6, 4),     <span class="comment">// 15 clocks/bit</span>
<a name="l00129"></a>00129     <a class="code" href="group__can__api.html#gaf25c77b64fe1d9f8edffa54e1a7c3e19">CAN_BIT_VALUE</a>(8, 7, 4),     <span class="comment">// 16 clocks/bit</span>
<a name="l00130"></a>00130     <a class="code" href="group__can__api.html#gaf25c77b64fe1d9f8edffa54e1a7c3e19">CAN_BIT_VALUE</a>(9, 7, 4),     <span class="comment">// 17 clocks/bit</span>
<a name="l00131"></a>00131     <a class="code" href="group__can__api.html#gaf25c77b64fe1d9f8edffa54e1a7c3e19">CAN_BIT_VALUE</a>(9, 8, 4),     <span class="comment">// 18 clocks/bit</span>
<a name="l00132"></a>00132     <a class="code" href="group__can__api.html#gaf25c77b64fe1d9f8edffa54e1a7c3e19">CAN_BIT_VALUE</a>(10, 8, 4)     <span class="comment">// 19 clocks/bit</span>
<a name="l00133"></a>00133 };
<a name="l00134"></a>00134 
<a name="l00135"></a>00135 <span class="comment">//*****************************************************************************</span>
<a name="l00136"></a>00136 <span class="comment">//</span>
<a name="l00146"></a>00146 <span class="comment"></span><span class="comment">//</span>
<a name="l00147"></a>00147 <span class="comment">//*****************************************************************************</span>
<a name="l00148"></a>00148 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l00149"></a>00149 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">bool</span>
<a name="l00150"></a>00150 _CANBaseValid(uint32_t ui32Base)
<a name="l00151"></a>00151 {
<a name="l00152"></a>00152     <span class="keywordflow">return</span>((ui32Base == <a class="code" href="hw__memmap_8h.html#af28059909d16b304a2d26930aac760fd">CAN0_BASE</a>) || (ui32Base == <a class="code" href="hw__memmap_8h.html#ad8e45ea6c032d9fce1b0516fff9d8eaa">CAN1_BASE</a>));
<a name="l00153"></a>00153 }
<a name="l00154"></a>00154 <span class="preprocessor">#endif</span>
<a name="l00155"></a>00155 <span class="preprocessor"></span>
<a name="l00156"></a>00156 <span class="comment">//*****************************************************************************</span>
<a name="l00157"></a>00157 <span class="comment">//</span>
<a name="l00167"></a>00167 <span class="comment"></span><span class="comment">//</span>
<a name="l00168"></a>00168 <span class="comment">//*****************************************************************************</span>
<a name="l00169"></a>00169 <span class="keyword">static</span> uint_fast8_t
<a name="l00170"></a><a class="code" href="group__can__api.html#gabb59e45a511a4b040fc32f5e64e016f4">00170</a> <a class="code" href="group__can__api.html#gabb59e45a511a4b040fc32f5e64e016f4">_CANIntNumberGet</a>(uint32_t ui32Base)
<a name="l00171"></a>00171 {
<a name="l00172"></a>00172     uint_fast8_t ui8Int;
<a name="l00173"></a>00173 
<a name="l00174"></a>00174     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>((ui32Base == <a class="code" href="hw__memmap_8h.html#af28059909d16b304a2d26930aac760fd">CAN0_BASE</a>) || (ui32Base == <a class="code" href="hw__memmap_8h.html#ad8e45ea6c032d9fce1b0516fff9d8eaa">CAN1_BASE</a>));
<a name="l00175"></a>00175 
<a name="l00176"></a>00176     ui8Int = 0;
<a name="l00177"></a>00177 
<a name="l00178"></a>00178     <span class="comment">//</span>
<a name="l00179"></a>00179     <span class="comment">// Find the valid interrupt number for this CAN controller.</span>
<a name="l00180"></a>00180     <span class="comment">//</span>
<a name="l00181"></a>00181     <span class="keywordflow">if</span>(<a class="code" href="hw__types_8h.html#aed400510c15509bdc6296e5c233f6cd3">CLASS_IS_TM4C123</a>)
<a name="l00182"></a>00182     {
<a name="l00183"></a>00183         <span class="keywordflow">if</span>(ui32Base == <a class="code" href="hw__memmap_8h.html#af28059909d16b304a2d26930aac760fd">CAN0_BASE</a>)
<a name="l00184"></a>00184         {
<a name="l00185"></a>00185             ui8Int = <a class="code" href="hw__ints_8h.html#ae9a19c7893665d1b63b0890b0411765a">INT_CAN0_TM4C123</a>;
<a name="l00186"></a>00186         }
<a name="l00187"></a>00187         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ui32Base == <a class="code" href="hw__memmap_8h.html#ad8e45ea6c032d9fce1b0516fff9d8eaa">CAN1_BASE</a>)
<a name="l00188"></a>00188         {
<a name="l00189"></a>00189             ui8Int = <a class="code" href="hw__ints_8h.html#a33515b9eb9fcfaca342d243388c1b352">INT_CAN1_TM4C123</a>;
<a name="l00190"></a>00190         }
<a name="l00191"></a>00191     }
<a name="l00192"></a>00192     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="hw__types_8h.html#ad585839948168b2f3b39c3dbf2cbe200">CLASS_IS_TM4C129</a>)
<a name="l00193"></a>00193     {
<a name="l00194"></a>00194         <span class="keywordflow">if</span>(ui32Base == <a class="code" href="hw__memmap_8h.html#af28059909d16b304a2d26930aac760fd">CAN0_BASE</a>)
<a name="l00195"></a>00195         {
<a name="l00196"></a>00196             ui8Int = <a class="code" href="hw__ints_8h.html#abdc37dc4b2c43df90e6a0ae6580d13cd">INT_CAN0_TM4C129</a>;
<a name="l00197"></a>00197         }
<a name="l00198"></a>00198         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ui32Base == <a class="code" href="hw__memmap_8h.html#ad8e45ea6c032d9fce1b0516fff9d8eaa">CAN1_BASE</a>)
<a name="l00199"></a>00199         {
<a name="l00200"></a>00200             ui8Int = <a class="code" href="hw__ints_8h.html#a02324ddf6c72d9ac9977d9fbb9c65094">INT_CAN1_TM4C129</a>;
<a name="l00201"></a>00201         }
<a name="l00202"></a>00202     }
<a name="l00203"></a>00203 
<a name="l00204"></a>00204     <span class="keywordflow">return</span>(ui8Int);
<a name="l00205"></a>00205 }
<a name="l00206"></a>00206 
<a name="l00207"></a>00207 <span class="comment">//*****************************************************************************</span>
<a name="l00208"></a>00208 <span class="comment">//</span>
<a name="l00226"></a>00226 <span class="comment"></span><span class="comment">//</span>
<a name="l00227"></a>00227 <span class="comment">//*****************************************************************************</span>
<a name="l00228"></a>00228 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00229"></a><a class="code" href="group__can__api.html#ga3d8f21919db8e292ff037998ecf15709">00229</a> <a class="code" href="group__can__api.html#ga3d8f21919db8e292ff037998ecf15709">_CANDataRegWrite</a>(uint8_t *pui8Data, uint32_t *pui32Register, uint32_t ui32Size)
<a name="l00230"></a>00230 {
<a name="l00231"></a>00231     uint32_t ui32Idx, ui32Value;
<a name="l00232"></a>00232 
<a name="l00233"></a>00233     <span class="comment">//</span>
<a name="l00234"></a>00234     <span class="comment">// Loop always copies 1 or 2 bytes per iteration.</span>
<a name="l00235"></a>00235     <span class="comment">//</span>
<a name="l00236"></a>00236     <span class="keywordflow">for</span>(ui32Idx = 0; ui32Idx &lt; ui32Size; )
<a name="l00237"></a>00237     {
<a name="l00238"></a>00238         <span class="comment">//</span>
<a name="l00239"></a>00239         <span class="comment">// Write out the data 16 bits at a time since this is how the registers</span>
<a name="l00240"></a>00240         <span class="comment">// are aligned in memory.</span>
<a name="l00241"></a>00241         <span class="comment">//</span>
<a name="l00242"></a>00242         ui32Value = pui8Data[ui32Idx++];
<a name="l00243"></a>00243 
<a name="l00244"></a>00244         <span class="comment">//</span>
<a name="l00245"></a>00245         <span class="comment">// Only write the second byte if needed otherwise the value is zero.</span>
<a name="l00246"></a>00246         <span class="comment">//</span>
<a name="l00247"></a>00247         <span class="keywordflow">if</span>(ui32Idx &lt; ui32Size)
<a name="l00248"></a>00248         {
<a name="l00249"></a>00249             ui32Value |= (pui8Data[ui32Idx++] &lt;&lt; 8);
<a name="l00250"></a>00250         }
<a name="l00251"></a>00251 
<a name="l00252"></a>00252         <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(pui32Register++) = ui32Value;
<a name="l00253"></a>00253     }
<a name="l00254"></a>00254 }
<a name="l00255"></a>00255 
<a name="l00256"></a>00256 <span class="comment">//*****************************************************************************</span>
<a name="l00257"></a>00257 <span class="comment">//</span>
<a name="l00275"></a>00275 <span class="comment"></span><span class="comment">//</span>
<a name="l00276"></a>00276 <span class="comment">//*****************************************************************************</span>
<a name="l00277"></a>00277 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00278"></a><a class="code" href="group__can__api.html#ga315ed01dbcf5bb82cba6bb5cb3ea59c9">00278</a> <a class="code" href="group__can__api.html#ga315ed01dbcf5bb82cba6bb5cb3ea59c9">_CANDataRegRead</a>(uint8_t *pui8Data, uint32_t *pui32Register, uint32_t ui32Size)
<a name="l00279"></a>00279 {
<a name="l00280"></a>00280     uint32_t ui32Idx, ui32Value;
<a name="l00281"></a>00281 
<a name="l00282"></a>00282     <span class="comment">//</span>
<a name="l00283"></a>00283     <span class="comment">// Loop always copies 1 or 2 bytes per iteration.</span>
<a name="l00284"></a>00284     <span class="comment">//</span>
<a name="l00285"></a>00285     <span class="keywordflow">for</span>(ui32Idx = 0; ui32Idx &lt; ui32Size; )
<a name="l00286"></a>00286     {
<a name="l00287"></a>00287         <span class="comment">//</span>
<a name="l00288"></a>00288         <span class="comment">// Read out the data 16 bits at a time since this is how the registers</span>
<a name="l00289"></a>00289         <span class="comment">// are aligned in memory.</span>
<a name="l00290"></a>00290         <span class="comment">//</span>
<a name="l00291"></a>00291         ui32Value = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(pui32Register++);
<a name="l00292"></a>00292 
<a name="l00293"></a>00293         <span class="comment">//</span>
<a name="l00294"></a>00294         <span class="comment">// Store the first byte.</span>
<a name="l00295"></a>00295         <span class="comment">//</span>
<a name="l00296"></a>00296         pui8Data[ui32Idx++] = (uint8_t)ui32Value;
<a name="l00297"></a>00297 
<a name="l00298"></a>00298         <span class="comment">//</span>
<a name="l00299"></a>00299         <span class="comment">// Only read the second byte if needed.</span>
<a name="l00300"></a>00300         <span class="comment">//</span>
<a name="l00301"></a>00301         <span class="keywordflow">if</span>(ui32Idx &lt; ui32Size)
<a name="l00302"></a>00302         {
<a name="l00303"></a>00303             pui8Data[ui32Idx++] = (uint8_t)(ui32Value &gt;&gt; 8);
<a name="l00304"></a>00304         }
<a name="l00305"></a>00305     }
<a name="l00306"></a>00306 }
<a name="l00307"></a>00307 
<a name="l00308"></a>00308 <span class="comment">//*****************************************************************************</span>
<a name="l00309"></a>00309 <span class="comment">//</span>
<a name="l00322"></a>00322 <span class="comment"></span><span class="comment">//</span>
<a name="l00323"></a>00323 <span class="comment">//*****************************************************************************</span>
<a name="l00324"></a>00324 <span class="keywordtype">void</span>
<a name="l00325"></a><a class="code" href="group__can__api.html#ga9145d4c9eeb26d82c7380adaa2d36c7c">00325</a> <a class="code" href="group__can__api.html#ga9145d4c9eeb26d82c7380adaa2d36c7c">CANInit</a>(uint32_t ui32Base)
<a name="l00326"></a>00326 {
<a name="l00327"></a>00327     uint32_t ui32Msg;
<a name="l00328"></a>00328 
<a name="l00329"></a>00329     <span class="comment">//</span>
<a name="l00330"></a>00330     <span class="comment">// Check the arguments.</span>
<a name="l00331"></a>00331     <span class="comment">//</span>
<a name="l00332"></a>00332     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(_CANBaseValid(ui32Base));
<a name="l00333"></a>00333 
<a name="l00334"></a>00334     <span class="comment">//</span>
<a name="l00335"></a>00335     <span class="comment">// Place CAN controller in init state, regardless of previous state.  This</span>
<a name="l00336"></a>00336     <span class="comment">// puts controller in idle, and allow the message object RAM to be</span>
<a name="l00337"></a>00337     <span class="comment">// programmed.</span>
<a name="l00338"></a>00338     <span class="comment">//</span>
<a name="l00339"></a>00339     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a502bb899dc3499f1becf72e4bf7486f6">CAN_O_CTL</a>) = <a class="code" href="hw__can_8h.html#ab1ef01ed2b07ee875608c73a70e97c53">CAN_CTL_INIT</a>;
<a name="l00340"></a>00340 
<a name="l00341"></a>00341     <span class="comment">//</span>
<a name="l00342"></a>00342     <span class="comment">// Wait for busy bit to clear</span>
<a name="l00343"></a>00343     <span class="comment">//</span>
<a name="l00344"></a>00344     <span class="keywordflow">while</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a429984ce40dd20eb6966e1d365d90238">CAN_O_IF1CRQ</a>) &amp; <a class="code" href="hw__can_8h.html#acdefd7830a26bca16b676dba5598b66d">CAN_IF1CRQ_BUSY</a>)
<a name="l00345"></a>00345     {
<a name="l00346"></a>00346     }
<a name="l00347"></a>00347 
<a name="l00348"></a>00348     <span class="comment">//</span>
<a name="l00349"></a>00349     <span class="comment">// Clear the message value bit in the arbitration register.  This indicates</span>
<a name="l00350"></a>00350     <span class="comment">// the message is not valid and is a &quot;safe&quot; condition to leave the message</span>
<a name="l00351"></a>00351     <span class="comment">// object.  The same arb reg is used to program all the message objects.</span>
<a name="l00352"></a>00352     <span class="comment">//</span>
<a name="l00353"></a>00353     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#ab5120f8aeba67f0995a7c927319ee946">CAN_O_IF1CMSK</a>) = (<a class="code" href="hw__can_8h.html#af00e227e4d72a2b47cfd5a31bf3b261d">CAN_IF1CMSK_WRNRD</a> | <a class="code" href="hw__can_8h.html#a46ff14762fa3eecad699c4c0a2f71944">CAN_IF1CMSK_ARB</a> |
<a name="l00354"></a>00354                                        <a class="code" href="hw__can_8h.html#ae67ae84bd00fc509ed7a025f1608fc29">CAN_IF1CMSK_CONTROL</a>);
<a name="l00355"></a>00355     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a0d2f3fe713653778679b768f25248479">CAN_O_IF1ARB2</a>) = 0;
<a name="l00356"></a>00356     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a6185cdff241a27e6b569c0925081d85d">CAN_O_IF1MCTL</a>) = 0;
<a name="l00357"></a>00357 
<a name="l00358"></a>00358     <span class="comment">//</span>
<a name="l00359"></a>00359     <span class="comment">// Loop through to program all 32 message objects</span>
<a name="l00360"></a>00360     <span class="comment">//</span>
<a name="l00361"></a>00361     <span class="keywordflow">for</span>(ui32Msg = 1; ui32Msg &lt;= 32; ui32Msg++)
<a name="l00362"></a>00362     {
<a name="l00363"></a>00363         <span class="comment">//</span>
<a name="l00364"></a>00364         <span class="comment">// Wait for busy bit to clear</span>
<a name="l00365"></a>00365         <span class="comment">//</span>
<a name="l00366"></a>00366         <span class="keywordflow">while</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a429984ce40dd20eb6966e1d365d90238">CAN_O_IF1CRQ</a>) &amp; CAN_IF1CRQ_BUSY)
<a name="l00367"></a>00367         {
<a name="l00368"></a>00368         }
<a name="l00369"></a>00369 
<a name="l00370"></a>00370         <span class="comment">//</span>
<a name="l00371"></a>00371         <span class="comment">// Initiate programming the message object</span>
<a name="l00372"></a>00372         <span class="comment">//</span>
<a name="l00373"></a>00373         <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a429984ce40dd20eb6966e1d365d90238">CAN_O_IF1CRQ</a>) = ui32Msg;
<a name="l00374"></a>00374     }
<a name="l00375"></a>00375 
<a name="l00376"></a>00376     <span class="comment">//</span>
<a name="l00377"></a>00377     <span class="comment">// Make sure that the interrupt and new data flags are updated for the</span>
<a name="l00378"></a>00378     <span class="comment">// message objects.</span>
<a name="l00379"></a>00379     <span class="comment">//</span>
<a name="l00380"></a>00380     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#ab5120f8aeba67f0995a7c927319ee946">CAN_O_IF1CMSK</a>) = (<a class="code" href="hw__can_8h.html#a6ea0427c10c0b69d8da0cc5c8be449ea">CAN_IF1CMSK_NEWDAT</a> |
<a name="l00381"></a>00381                                        <a class="code" href="hw__can_8h.html#aa57248d35f2b29e2a2f8e9fe684e7677">CAN_IF1CMSK_CLRINTPND</a>);
<a name="l00382"></a>00382 
<a name="l00383"></a>00383     <span class="comment">//</span>
<a name="l00384"></a>00384     <span class="comment">// Loop through to program all 32 message objects</span>
<a name="l00385"></a>00385     <span class="comment">//</span>
<a name="l00386"></a>00386     <span class="keywordflow">for</span>(ui32Msg = 1; ui32Msg &lt;= 32; ui32Msg++)
<a name="l00387"></a>00387     {
<a name="l00388"></a>00388         <span class="comment">//</span>
<a name="l00389"></a>00389         <span class="comment">// Wait for busy bit to clear.</span>
<a name="l00390"></a>00390         <span class="comment">//</span>
<a name="l00391"></a>00391         <span class="keywordflow">while</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a429984ce40dd20eb6966e1d365d90238">CAN_O_IF1CRQ</a>) &amp; <a class="code" href="hw__can_8h.html#acdefd7830a26bca16b676dba5598b66d">CAN_IF1CRQ_BUSY</a>)
<a name="l00392"></a>00392         {
<a name="l00393"></a>00393         }
<a name="l00394"></a>00394 
<a name="l00395"></a>00395         <span class="comment">//</span>
<a name="l00396"></a>00396         <span class="comment">// Initiate programming the message object</span>
<a name="l00397"></a>00397         <span class="comment">//</span>
<a name="l00398"></a>00398         <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a429984ce40dd20eb6966e1d365d90238">CAN_O_IF1CRQ</a>) = ui32Msg;
<a name="l00399"></a>00399     }
<a name="l00400"></a>00400 
<a name="l00401"></a>00401     <span class="comment">//</span>
<a name="l00402"></a>00402     <span class="comment">// Acknowledge any pending status interrupts.</span>
<a name="l00403"></a>00403     <span class="comment">//</span>
<a name="l00404"></a>00404     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a77c8f8ad059402c8047a485db1645da8">CAN_O_STS</a>);
<a name="l00405"></a>00405 }
<a name="l00406"></a>00406 
<a name="l00407"></a>00407 <span class="comment">//*****************************************************************************</span>
<a name="l00408"></a>00408 <span class="comment">//</span>
<a name="l00421"></a>00421 <span class="comment"></span><span class="comment">//</span>
<a name="l00422"></a>00422 <span class="comment">//*****************************************************************************</span>
<a name="l00423"></a>00423 <span class="keywordtype">void</span>
<a name="l00424"></a><a class="code" href="group__can__api.html#gacae7f0dec4777da94a4cb5fd37d2f396">00424</a> <a class="code" href="group__can__api.html#gacae7f0dec4777da94a4cb5fd37d2f396">CANEnable</a>(uint32_t ui32Base)
<a name="l00425"></a>00425 {
<a name="l00426"></a>00426     <span class="comment">//</span>
<a name="l00427"></a>00427     <span class="comment">// Check the arguments.</span>
<a name="l00428"></a>00428     <span class="comment">//</span>
<a name="l00429"></a>00429     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(_CANBaseValid(ui32Base));
<a name="l00430"></a>00430 
<a name="l00431"></a>00431     <span class="comment">//</span>
<a name="l00432"></a>00432     <span class="comment">// Clear the init bit in the control register.</span>
<a name="l00433"></a>00433     <span class="comment">//</span>
<a name="l00434"></a>00434     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a502bb899dc3499f1becf72e4bf7486f6">CAN_O_CTL</a>) &amp;= ~<a class="code" href="hw__can_8h.html#ab1ef01ed2b07ee875608c73a70e97c53">CAN_CTL_INIT</a>;
<a name="l00435"></a>00435 }
<a name="l00436"></a>00436 
<a name="l00437"></a>00437 <span class="comment">//*****************************************************************************</span>
<a name="l00438"></a>00438 <span class="comment">//</span>
<a name="l00450"></a>00450 <span class="comment"></span><span class="comment">//</span>
<a name="l00451"></a>00451 <span class="comment">//*****************************************************************************</span>
<a name="l00452"></a>00452 <span class="keywordtype">void</span>
<a name="l00453"></a><a class="code" href="group__can__api.html#gaeaef3afaec247a8b70f0b40143fd88d6">00453</a> <a class="code" href="group__can__api.html#gaeaef3afaec247a8b70f0b40143fd88d6">CANDisable</a>(uint32_t ui32Base)
<a name="l00454"></a>00454 {
<a name="l00455"></a>00455     <span class="comment">//</span>
<a name="l00456"></a>00456     <span class="comment">// Check the arguments.</span>
<a name="l00457"></a>00457     <span class="comment">//</span>
<a name="l00458"></a>00458     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(_CANBaseValid(ui32Base));
<a name="l00459"></a>00459 
<a name="l00460"></a>00460     <span class="comment">//</span>
<a name="l00461"></a>00461     <span class="comment">// Set the init bit in the control register.</span>
<a name="l00462"></a>00462     <span class="comment">//</span>
<a name="l00463"></a>00463     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a502bb899dc3499f1becf72e4bf7486f6">CAN_O_CTL</a>) |= <a class="code" href="hw__can_8h.html#ab1ef01ed2b07ee875608c73a70e97c53">CAN_CTL_INIT</a>;
<a name="l00464"></a>00464 }
<a name="l00465"></a>00465 
<a name="l00466"></a>00466 <span class="comment">//*****************************************************************************</span>
<a name="l00467"></a>00467 <span class="comment">//</span>
<a name="l00480"></a>00480 <span class="comment"></span><span class="comment">//</span>
<a name="l00481"></a>00481 <span class="comment">//*****************************************************************************</span>
<a name="l00482"></a>00482 <span class="keywordtype">void</span>
<a name="l00483"></a><a class="code" href="group__can__api.html#ga6e3d8077b678c9b7a0c1377ab2b7251d">00483</a> <a class="code" href="group__can__api.html#ga6e3d8077b678c9b7a0c1377ab2b7251d">CANBitTimingGet</a>(uint32_t ui32Base, <a class="code" href="structt_c_a_n_bit_clk_parms.html">tCANBitClkParms</a> *psClkParms)
<a name="l00484"></a>00484 {
<a name="l00485"></a>00485     uint32_t ui32BitReg;
<a name="l00486"></a>00486 
<a name="l00487"></a>00487     <span class="comment">//</span>
<a name="l00488"></a>00488     <span class="comment">// Check the arguments.</span>
<a name="l00489"></a>00489     <span class="comment">//</span>
<a name="l00490"></a>00490     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(_CANBaseValid(ui32Base));
<a name="l00491"></a>00491     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(psClkParms);
<a name="l00492"></a>00492 
<a name="l00493"></a>00493     <span class="comment">//</span>
<a name="l00494"></a>00494     <span class="comment">// Read out all the bit timing values from the CAN controller registers.</span>
<a name="l00495"></a>00495     <span class="comment">//</span>
<a name="l00496"></a>00496     ui32BitReg = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a6d538c12d5e598918d3eb2001520723e">CAN_O_BIT</a>);
<a name="l00497"></a>00497 
<a name="l00498"></a>00498     <span class="comment">//</span>
<a name="l00499"></a>00499     <span class="comment">// Set the phase 2 segment.</span>
<a name="l00500"></a>00500     <span class="comment">//</span>
<a name="l00501"></a>00501     psClkParms-&gt;<a class="code" href="structt_c_a_n_bit_clk_parms.html#a96b0f1b88e10ce0094155f793990067a">ui32Phase2Seg</a> =
<a name="l00502"></a>00502         ((ui32BitReg &amp; <a class="code" href="hw__can_8h.html#a522ee1e9168abca71a6e9ead7f21df96">CAN_BIT_TSEG2_M</a>) &gt;&gt; <a class="code" href="hw__can_8h.html#aac0592d3b3c1babd034c433fa7578e0b">CAN_BIT_TSEG2_S</a>) + 1;
<a name="l00503"></a>00503 
<a name="l00504"></a>00504     <span class="comment">//</span>
<a name="l00505"></a>00505     <span class="comment">// Set the phase 1 segment.</span>
<a name="l00506"></a>00506     <span class="comment">//</span>
<a name="l00507"></a>00507     psClkParms-&gt;<a class="code" href="structt_c_a_n_bit_clk_parms.html#a883e98bff1da9402389f9fcd3be2c89e">ui32SyncPropPhase1Seg</a> =
<a name="l00508"></a>00508         ((ui32BitReg &amp; <a class="code" href="hw__can_8h.html#a1db83e803a101a703fbbd7af448dc8a1">CAN_BIT_TSEG1_M</a>) &gt;&gt; <a class="code" href="hw__can_8h.html#aae71cde62b984f8fcdeb4b7d16f2cba1">CAN_BIT_TSEG1_S</a>) + 1;
<a name="l00509"></a>00509 
<a name="l00510"></a>00510     <span class="comment">//</span>
<a name="l00511"></a>00511     <span class="comment">// Set the synchronous jump width.</span>
<a name="l00512"></a>00512     <span class="comment">//</span>
<a name="l00513"></a>00513     psClkParms-&gt;<a class="code" href="structt_c_a_n_bit_clk_parms.html#a0f39e259ea7f08df8079f67b177cbc39">ui32SJW</a> = ((ui32BitReg &amp; <a class="code" href="hw__can_8h.html#afa008702003847bab1850bfaf1cec012">CAN_BIT_SJW_M</a>) &gt;&gt; <a class="code" href="hw__can_8h.html#ae513439fe1397ac72711ff71307804f8">CAN_BIT_SJW_S</a>) + 1;
<a name="l00514"></a>00514 
<a name="l00515"></a>00515     <span class="comment">//</span>
<a name="l00516"></a>00516     <span class="comment">// Set the pre-divider for the CAN bus bit clock.</span>
<a name="l00517"></a>00517     <span class="comment">//</span>
<a name="l00518"></a>00518     psClkParms-&gt;<a class="code" href="structt_c_a_n_bit_clk_parms.html#ac92cfb9c4c199f4a86b5ffac321ebe06">ui32QuantumPrescaler</a> =
<a name="l00519"></a>00519         ((ui32BitReg &amp; <a class="code" href="hw__can_8h.html#a7558fc2c52cd9f63a99b884f12085848">CAN_BIT_BRP_M</a>) |
<a name="l00520"></a>00520          ((<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#afda18268caccc4b6fdab3cbbc647db45">CAN_O_BRPE</a>) &amp; <a class="code" href="hw__can_8h.html#a3da55e49eabef76186df07ee6993ae51">CAN_BRPE_BRPE_M</a>) &lt;&lt; 6)) + 1;
<a name="l00521"></a>00521 }
<a name="l00522"></a>00522 
<a name="l00523"></a>00523 <span class="comment">//*****************************************************************************</span>
<a name="l00524"></a>00524 <span class="comment">//</span>
<a name="l00552"></a>00552 <span class="comment"></span><span class="comment">//*****************************************************************************</span>
<a name="l00553"></a>00553 uint32_t
<a name="l00554"></a><a class="code" href="group__can__api.html#ga700471831cd6155d8d6526a187bc9cf3">00554</a> <a class="code" href="group__can__api.html#ga700471831cd6155d8d6526a187bc9cf3">CANBitRateSet</a>(uint32_t ui32Base, uint32_t ui32SourceClock,
<a name="l00555"></a>00555               uint32_t ui32BitRate)
<a name="l00556"></a>00556 {
<a name="l00557"></a>00557     uint32_t ui32DesiredRatio;
<a name="l00558"></a>00558     uint32_t ui32CANBits;
<a name="l00559"></a>00559     uint32_t ui32PreDivide;
<a name="l00560"></a>00560     uint32_t ui32RegValue;
<a name="l00561"></a>00561     uint16_t ui16CANCTL;
<a name="l00562"></a>00562 
<a name="l00563"></a>00563     <span class="comment">//</span>
<a name="l00564"></a>00564     <span class="comment">// Check the arguments.</span>
<a name="l00565"></a>00565     <span class="comment">//</span>
<a name="l00566"></a>00566     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(_CANBaseValid(ui32Base));
<a name="l00567"></a>00567     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32SourceClock);
<a name="l00568"></a>00568     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32BitRate);
<a name="l00569"></a>00569 
<a name="l00570"></a>00570     <span class="comment">//</span>
<a name="l00571"></a>00571     <span class="comment">// Calculate the desired clock rate.</span>
<a name="l00572"></a>00572     <span class="comment">//</span>
<a name="l00573"></a>00573     ui32DesiredRatio = ui32SourceClock / ui32BitRate;
<a name="l00574"></a>00574 
<a name="l00575"></a>00575     <span class="comment">//</span>
<a name="l00576"></a>00576     <span class="comment">// Make sure that the ratio of CAN bit rate to processor clock is not too</span>
<a name="l00577"></a>00577     <span class="comment">// small or too large.</span>
<a name="l00578"></a>00578     <span class="comment">//</span>
<a name="l00579"></a>00579     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32DesiredRatio &lt;= (<a class="code" href="group__can__api.html#ga5e034f57dcda85405e2ed9b4f36389da">CAN_MAX_PRE_DIVISOR</a> * <a class="code" href="group__can__api.html#ga54aec90dc979d14c3e3aad10d3284af3">CAN_MAX_BIT_DIVISOR</a>));
<a name="l00580"></a>00580     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32DesiredRatio &gt;= (<a class="code" href="group__can__api.html#ga723a76d507997b3f6aae0a7052b42b16">CAN_MIN_PRE_DIVISOR</a> * <a class="code" href="group__can__api.html#ga57e5366b1956052d659f06990193c4c6">CAN_MIN_BIT_DIVISOR</a>));
<a name="l00581"></a>00581 
<a name="l00582"></a>00582     <span class="comment">//</span>
<a name="l00583"></a>00583     <span class="comment">// Make sure that the Desired Ratio is not too large.  This enforces the</span>
<a name="l00584"></a>00584     <span class="comment">// requirement that the bit rate is larger than requested.</span>
<a name="l00585"></a>00585     <span class="comment">//</span>
<a name="l00586"></a>00586     <span class="keywordflow">if</span>((ui32SourceClock / ui32DesiredRatio) &gt; ui32BitRate)
<a name="l00587"></a>00587     {
<a name="l00588"></a>00588         ui32DesiredRatio += 1;
<a name="l00589"></a>00589     }
<a name="l00590"></a>00590 
<a name="l00591"></a>00591     <span class="comment">//</span>
<a name="l00592"></a>00592     <span class="comment">// Check all possible values to find a matching value.</span>
<a name="l00593"></a>00593     <span class="comment">//</span>
<a name="l00594"></a>00594     <span class="keywordflow">while</span>(ui32DesiredRatio &lt;= (<a class="code" href="group__can__api.html#ga5e034f57dcda85405e2ed9b4f36389da">CAN_MAX_PRE_DIVISOR</a> * CAN_MAX_BIT_DIVISOR))
<a name="l00595"></a>00595     {
<a name="l00596"></a>00596         <span class="comment">//</span>
<a name="l00597"></a>00597         <span class="comment">// Loop through all possible CAN bit divisors.</span>
<a name="l00598"></a>00598         <span class="comment">//</span>
<a name="l00599"></a>00599         <span class="keywordflow">for</span>(ui32CANBits = CAN_MAX_BIT_DIVISOR;
<a name="l00600"></a>00600             ui32CANBits &gt;= <a class="code" href="group__can__api.html#ga57e5366b1956052d659f06990193c4c6">CAN_MIN_BIT_DIVISOR</a>; ui32CANBits--)
<a name="l00601"></a>00601         {
<a name="l00602"></a>00602             <span class="comment">//</span>
<a name="l00603"></a>00603             <span class="comment">// For a given CAN bit divisor save the pre divisor.</span>
<a name="l00604"></a>00604             <span class="comment">//</span>
<a name="l00605"></a>00605             ui32PreDivide = ui32DesiredRatio / ui32CANBits;
<a name="l00606"></a>00606 
<a name="l00607"></a>00607             <span class="comment">//</span>
<a name="l00608"></a>00608             <span class="comment">// If the calculated divisors match the desired clock ratio then</span>
<a name="l00609"></a>00609             <span class="comment">// return these bit rate and set the CAN bit timing.</span>
<a name="l00610"></a>00610             <span class="comment">//</span>
<a name="l00611"></a>00611             <span class="keywordflow">if</span>((ui32PreDivide * ui32CANBits) == ui32DesiredRatio)
<a name="l00612"></a>00612             {
<a name="l00613"></a>00613                 <span class="comment">//</span>
<a name="l00614"></a>00614                 <span class="comment">// Start building the bit timing value by adding the bit timing</span>
<a name="l00615"></a>00615                 <span class="comment">// in time quanta.</span>
<a name="l00616"></a>00616                 <span class="comment">//</span>
<a name="l00617"></a>00617                 ui32RegValue = <a class="code" href="group__can__api.html#gaf35e20b628219082bc6492ae33b22573">g_ui16CANBitValues</a>[ui32CANBits -
<a name="l00618"></a>00618                                                   <a class="code" href="group__can__api.html#ga57e5366b1956052d659f06990193c4c6">CAN_MIN_BIT_DIVISOR</a>];
<a name="l00619"></a>00619 
<a name="l00620"></a>00620                 <span class="comment">//</span>
<a name="l00621"></a>00621                 <span class="comment">// To set the bit timing register, the controller must be</span>
<a name="l00622"></a>00622                 <span class="comment">// placed in init mode (if not already), and also configuration</span>
<a name="l00623"></a>00623                 <span class="comment">// change bit enabled.  The state of the register must be</span>
<a name="l00624"></a>00624                 <span class="comment">// saved so it can be restored.</span>
<a name="l00625"></a>00625                 <span class="comment">//</span>
<a name="l00626"></a>00626                 ui16CANCTL = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a502bb899dc3499f1becf72e4bf7486f6">CAN_O_CTL</a>);
<a name="l00627"></a>00627                 <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a502bb899dc3499f1becf72e4bf7486f6">CAN_O_CTL</a>) = ui16CANCTL | <a class="code" href="hw__can_8h.html#ab1ef01ed2b07ee875608c73a70e97c53">CAN_CTL_INIT</a> |
<a name="l00628"></a>00628                                               <a class="code" href="hw__can_8h.html#aea9262df6dc9fce95ea7b0817604e745">CAN_CTL_CCE</a>;
<a name="l00629"></a>00629 
<a name="l00630"></a>00630                 <span class="comment">//</span>
<a name="l00631"></a>00631                 <span class="comment">// Now add in the pre-scalar on the bit rate.</span>
<a name="l00632"></a>00632                 <span class="comment">//</span>
<a name="l00633"></a>00633                 ui32RegValue |= ((ui32PreDivide - 1) &amp; <a class="code" href="hw__can_8h.html#a7558fc2c52cd9f63a99b884f12085848">CAN_BIT_BRP_M</a>);
<a name="l00634"></a>00634 
<a name="l00635"></a>00635                 <span class="comment">//</span>
<a name="l00636"></a>00636                 <span class="comment">// Set the clock bits in the and the lower bits of the</span>
<a name="l00637"></a>00637                 <span class="comment">// pre-scalar.</span>
<a name="l00638"></a>00638                 <span class="comment">//</span>
<a name="l00639"></a>00639                 <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a6d538c12d5e598918d3eb2001520723e">CAN_O_BIT</a>) = ui32RegValue;
<a name="l00640"></a>00640 
<a name="l00641"></a>00641                 <span class="comment">//</span>
<a name="l00642"></a>00642                 <span class="comment">// Set the divider upper bits in the extension register.</span>
<a name="l00643"></a>00643                 <span class="comment">//</span>
<a name="l00644"></a>00644                 <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#afda18268caccc4b6fdab3cbbc647db45">CAN_O_BRPE</a>) = ((ui32PreDivide - 1) &gt;&gt; 6) &amp;
<a name="l00645"></a>00645                                                <a class="code" href="hw__can_8h.html#a3da55e49eabef76186df07ee6993ae51">CAN_BRPE_BRPE_M</a>;
<a name="l00646"></a>00646 
<a name="l00647"></a>00647                 <span class="comment">//</span>
<a name="l00648"></a>00648                 <span class="comment">// Restore the saved CAN Control register.</span>
<a name="l00649"></a>00649                 <span class="comment">//</span>
<a name="l00650"></a>00650                 <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a502bb899dc3499f1becf72e4bf7486f6">CAN_O_CTL</a>) = ui16CANCTL;
<a name="l00651"></a>00651 
<a name="l00652"></a>00652                 <span class="comment">//</span>
<a name="l00653"></a>00653                 <span class="comment">// Return the computed bit rate.</span>
<a name="l00654"></a>00654                 <span class="comment">//</span>
<a name="l00655"></a>00655                 <span class="keywordflow">return</span>(ui32SourceClock / (ui32PreDivide * ui32CANBits));
<a name="l00656"></a>00656             }
<a name="l00657"></a>00657         }
<a name="l00658"></a>00658 
<a name="l00659"></a>00659         <span class="comment">//</span>
<a name="l00660"></a>00660         <span class="comment">// Move the divisor up one and look again.  Only in rare cases are</span>
<a name="l00661"></a>00661         <span class="comment">// more than 2 loops required to find the value.</span>
<a name="l00662"></a>00662         <span class="comment">//</span>
<a name="l00663"></a>00663         ui32DesiredRatio++;
<a name="l00664"></a>00664     }
<a name="l00665"></a>00665 
<a name="l00666"></a>00666     <span class="comment">//</span>
<a name="l00667"></a>00667     <span class="comment">// A valid combination could not be found, so return 0 to indicate that the</span>
<a name="l00668"></a>00668     <span class="comment">// bit rate was not changed.</span>
<a name="l00669"></a>00669     <span class="comment">//</span>
<a name="l00670"></a>00670     <span class="keywordflow">return</span>(0);
<a name="l00671"></a>00671 }
<a name="l00672"></a>00672 
<a name="l00673"></a>00673 <span class="comment">//*****************************************************************************</span>
<a name="l00674"></a>00674 <span class="comment">//</span>
<a name="l00710"></a>00710 <span class="comment"></span><span class="comment">//</span>
<a name="l00711"></a>00711 <span class="comment">//*****************************************************************************</span>
<a name="l00712"></a>00712 <span class="keywordtype">void</span>
<a name="l00713"></a><a class="code" href="group__can__api.html#ga743ff924c5de77fdcf3ab0366dac4aa2">00713</a> <a class="code" href="group__can__api.html#ga743ff924c5de77fdcf3ab0366dac4aa2">CANBitTimingSet</a>(uint32_t ui32Base, <a class="code" href="structt_c_a_n_bit_clk_parms.html">tCANBitClkParms</a> *psClkParms)
<a name="l00714"></a>00714 {
<a name="l00715"></a>00715     uint32_t ui32BitReg, ui32SavedInit;
<a name="l00716"></a>00716 
<a name="l00717"></a>00717     <span class="comment">//</span>
<a name="l00718"></a>00718     <span class="comment">// Check the arguments.</span>
<a name="l00719"></a>00719     <span class="comment">//</span>
<a name="l00720"></a>00720     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(_CANBaseValid(ui32Base));
<a name="l00721"></a>00721     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(psClkParms);
<a name="l00722"></a>00722 
<a name="l00723"></a>00723     <span class="comment">//</span>
<a name="l00724"></a>00724     <span class="comment">// The phase 1 segment must be in the range from 2 to 16.</span>
<a name="l00725"></a>00725     <span class="comment">//</span>
<a name="l00726"></a>00726     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>((psClkParms-&gt;<a class="code" href="structt_c_a_n_bit_clk_parms.html#a883e98bff1da9402389f9fcd3be2c89e">ui32SyncPropPhase1Seg</a> &gt;= 2) &amp;&amp;
<a name="l00727"></a>00727            (psClkParms-&gt;<a class="code" href="structt_c_a_n_bit_clk_parms.html#a883e98bff1da9402389f9fcd3be2c89e">ui32SyncPropPhase1Seg</a> &lt;= 16));
<a name="l00728"></a>00728 
<a name="l00729"></a>00729     <span class="comment">//</span>
<a name="l00730"></a>00730     <span class="comment">// The phase 2 segment must be in the range from 1 to 8.</span>
<a name="l00731"></a>00731     <span class="comment">//</span>
<a name="l00732"></a>00732     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>((psClkParms-&gt;<a class="code" href="structt_c_a_n_bit_clk_parms.html#a96b0f1b88e10ce0094155f793990067a">ui32Phase2Seg</a> &gt;= 1) &amp;&amp;
<a name="l00733"></a>00733            (psClkParms-&gt;<a class="code" href="structt_c_a_n_bit_clk_parms.html#a96b0f1b88e10ce0094155f793990067a">ui32Phase2Seg</a> &lt;= 8));
<a name="l00734"></a>00734 
<a name="l00735"></a>00735     <span class="comment">//</span>
<a name="l00736"></a>00736     <span class="comment">// The synchronous jump windows must be in the range from 1 to 4.</span>
<a name="l00737"></a>00737     <span class="comment">//</span>
<a name="l00738"></a>00738     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>((psClkParms-&gt;<a class="code" href="structt_c_a_n_bit_clk_parms.html#a0f39e259ea7f08df8079f67b177cbc39">ui32SJW</a> &gt;= 1) &amp;&amp; (psClkParms-&gt;<a class="code" href="structt_c_a_n_bit_clk_parms.html#a0f39e259ea7f08df8079f67b177cbc39">ui32SJW</a> &lt;= 4));
<a name="l00739"></a>00739 
<a name="l00740"></a>00740     <span class="comment">//</span>
<a name="l00741"></a>00741     <span class="comment">// The CAN clock pre-divider must be in the range from 1 to 1024.</span>
<a name="l00742"></a>00742     <span class="comment">//</span>
<a name="l00743"></a>00743     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>((psClkParms-&gt;<a class="code" href="structt_c_a_n_bit_clk_parms.html#ac92cfb9c4c199f4a86b5ffac321ebe06">ui32QuantumPrescaler</a> &lt;= 1024) &amp;&amp;
<a name="l00744"></a>00744            (psClkParms-&gt;<a class="code" href="structt_c_a_n_bit_clk_parms.html#ac92cfb9c4c199f4a86b5ffac321ebe06">ui32QuantumPrescaler</a> &gt;= 1));
<a name="l00745"></a>00745 
<a name="l00746"></a>00746     <span class="comment">//</span>
<a name="l00747"></a>00747     <span class="comment">// To set the bit timing register, the controller must be placed in init</span>
<a name="l00748"></a>00748     <span class="comment">// mode (if not already), and also configuration change bit enabled.  State</span>
<a name="l00749"></a>00749     <span class="comment">// of the init bit must be saved so it can be restored at the end.</span>
<a name="l00750"></a>00750     <span class="comment">//</span>
<a name="l00751"></a>00751     ui32SavedInit = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a502bb899dc3499f1becf72e4bf7486f6">CAN_O_CTL</a>);
<a name="l00752"></a>00752     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a502bb899dc3499f1becf72e4bf7486f6">CAN_O_CTL</a>) = ui32SavedInit | <a class="code" href="hw__can_8h.html#ab1ef01ed2b07ee875608c73a70e97c53">CAN_CTL_INIT</a> | <a class="code" href="hw__can_8h.html#aea9262df6dc9fce95ea7b0817604e745">CAN_CTL_CCE</a>;
<a name="l00753"></a>00753 
<a name="l00754"></a>00754     <span class="comment">//</span>
<a name="l00755"></a>00755     <span class="comment">// Set the bit fields of the bit timing register according to the parms.</span>
<a name="l00756"></a>00756     <span class="comment">//</span>
<a name="l00757"></a>00757     ui32BitReg = (((psClkParms-&gt;<a class="code" href="structt_c_a_n_bit_clk_parms.html#a96b0f1b88e10ce0094155f793990067a">ui32Phase2Seg</a> - 1) &lt;&lt; <a class="code" href="hw__can_8h.html#aac0592d3b3c1babd034c433fa7578e0b">CAN_BIT_TSEG2_S</a>) &amp;
<a name="l00758"></a>00758                   <a class="code" href="hw__can_8h.html#a522ee1e9168abca71a6e9ead7f21df96">CAN_BIT_TSEG2_M</a>);
<a name="l00759"></a>00759     ui32BitReg |= (((psClkParms-&gt;<a class="code" href="structt_c_a_n_bit_clk_parms.html#a883e98bff1da9402389f9fcd3be2c89e">ui32SyncPropPhase1Seg</a> - 1) &lt;&lt;
<a name="l00760"></a>00760                     <a class="code" href="hw__can_8h.html#aae71cde62b984f8fcdeb4b7d16f2cba1">CAN_BIT_TSEG1_S</a>) &amp; <a class="code" href="hw__can_8h.html#a1db83e803a101a703fbbd7af448dc8a1">CAN_BIT_TSEG1_M</a>);
<a name="l00761"></a>00761     ui32BitReg |= ((psClkParms-&gt;<a class="code" href="structt_c_a_n_bit_clk_parms.html#a0f39e259ea7f08df8079f67b177cbc39">ui32SJW</a> - 1) &lt;&lt; <a class="code" href="hw__can_8h.html#ae513439fe1397ac72711ff71307804f8">CAN_BIT_SJW_S</a>) &amp; <a class="code" href="hw__can_8h.html#afa008702003847bab1850bfaf1cec012">CAN_BIT_SJW_M</a>;
<a name="l00762"></a>00762     ui32BitReg |= (psClkParms-&gt;<a class="code" href="structt_c_a_n_bit_clk_parms.html#ac92cfb9c4c199f4a86b5ffac321ebe06">ui32QuantumPrescaler</a> - 1) &amp; <a class="code" href="hw__can_8h.html#a7558fc2c52cd9f63a99b884f12085848">CAN_BIT_BRP_M</a>;
<a name="l00763"></a>00763     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a6d538c12d5e598918d3eb2001520723e">CAN_O_BIT</a>) = ui32BitReg;
<a name="l00764"></a>00764 
<a name="l00765"></a>00765     <span class="comment">//</span>
<a name="l00766"></a>00766     <span class="comment">// Set the divider upper bits in the extension register.</span>
<a name="l00767"></a>00767     <span class="comment">//</span>
<a name="l00768"></a>00768     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#afda18268caccc4b6fdab3cbbc647db45">CAN_O_BRPE</a>) =
<a name="l00769"></a>00769         ((psClkParms-&gt;<a class="code" href="structt_c_a_n_bit_clk_parms.html#ac92cfb9c4c199f4a86b5ffac321ebe06">ui32QuantumPrescaler</a> - 1) &gt;&gt; 6) &amp; <a class="code" href="hw__can_8h.html#a3da55e49eabef76186df07ee6993ae51">CAN_BRPE_BRPE_M</a>;
<a name="l00770"></a>00770 
<a name="l00771"></a>00771     <span class="comment">//</span>
<a name="l00772"></a>00772     <span class="comment">// Clear the config change bit, and restore the init bit.</span>
<a name="l00773"></a>00773     <span class="comment">//</span>
<a name="l00774"></a>00774     ui32SavedInit &amp;= ~<a class="code" href="hw__can_8h.html#aea9262df6dc9fce95ea7b0817604e745">CAN_CTL_CCE</a>;
<a name="l00775"></a>00775 
<a name="l00776"></a>00776     <span class="comment">//</span>
<a name="l00777"></a>00777     <span class="comment">// If Init was not set before, then clear it.</span>
<a name="l00778"></a>00778     <span class="comment">//</span>
<a name="l00779"></a>00779     <span class="keywordflow">if</span>(ui32SavedInit &amp; <a class="code" href="hw__can_8h.html#ab1ef01ed2b07ee875608c73a70e97c53">CAN_CTL_INIT</a>)
<a name="l00780"></a>00780     {
<a name="l00781"></a>00781         ui32SavedInit &amp;= ~CAN_CTL_INIT;
<a name="l00782"></a>00782     }
<a name="l00783"></a>00783 
<a name="l00784"></a>00784     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a502bb899dc3499f1becf72e4bf7486f6">CAN_O_CTL</a>) = ui32SavedInit;
<a name="l00785"></a>00785 }
<a name="l00786"></a>00786 
<a name="l00787"></a>00787 <span class="comment">//*****************************************************************************</span>
<a name="l00788"></a>00788 <span class="comment">//</span>
<a name="l00810"></a>00810 <span class="comment"></span><span class="comment">//</span>
<a name="l00811"></a>00811 <span class="comment">//*****************************************************************************</span>
<a name="l00812"></a>00812 <span class="keywordtype">void</span>
<a name="l00813"></a><a class="code" href="group__can__api.html#ga922cb343caeba31e3fff78a0e4d19d9b">00813</a> <a class="code" href="group__can__api.html#ga922cb343caeba31e3fff78a0e4d19d9b">CANIntRegister</a>(uint32_t ui32Base, <span class="keywordtype">void</span> (*pfnHandler)(<span class="keywordtype">void</span>))
<a name="l00814"></a>00814 {
<a name="l00815"></a>00815     uint_fast8_t ui8IntNumber;
<a name="l00816"></a>00816 
<a name="l00817"></a>00817     <span class="comment">//</span>
<a name="l00818"></a>00818     <span class="comment">// Check the arguments.</span>
<a name="l00819"></a>00819     <span class="comment">//</span>
<a name="l00820"></a>00820     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(_CANBaseValid(ui32Base));
<a name="l00821"></a>00821 
<a name="l00822"></a>00822     <span class="comment">//</span>
<a name="l00823"></a>00823     <span class="comment">// Get the actual interrupt number for this CAN controller.</span>
<a name="l00824"></a>00824     <span class="comment">//</span>
<a name="l00825"></a>00825     ui8IntNumber = <a class="code" href="group__can__api.html#gabb59e45a511a4b040fc32f5e64e016f4">_CANIntNumberGet</a>(ui32Base);
<a name="l00826"></a>00826     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui8IntNumber != 0);
<a name="l00827"></a>00827 
<a name="l00828"></a>00828     <span class="comment">//</span>
<a name="l00829"></a>00829     <span class="comment">// Register the interrupt handler.</span>
<a name="l00830"></a>00830     <span class="comment">//</span>
<a name="l00831"></a>00831     <a class="code" href="group__interrupt__api.html#ga0a32aafea7f4904d2a64ee18b45f96c9">IntRegister</a>(ui8IntNumber, pfnHandler);
<a name="l00832"></a>00832 
<a name="l00833"></a>00833     <span class="comment">//</span>
<a name="l00834"></a>00834     <span class="comment">// Enable the Ethernet interrupt.</span>
<a name="l00835"></a>00835     <span class="comment">//</span>
<a name="l00836"></a>00836     <a class="code" href="group__interrupt__api.html#ga49fc9c3d1a0f8c42a20249f8c5d360ce">IntEnable</a>(ui8IntNumber);
<a name="l00837"></a>00837 }
<a name="l00838"></a>00838 
<a name="l00839"></a>00839 <span class="comment">//*****************************************************************************</span>
<a name="l00840"></a>00840 <span class="comment">//</span>
<a name="l00852"></a>00852 <span class="comment"></span><span class="comment">//</span>
<a name="l00853"></a>00853 <span class="comment">//*****************************************************************************</span>
<a name="l00854"></a>00854 <span class="keywordtype">void</span>
<a name="l00855"></a><a class="code" href="group__can__api.html#ga1e71364bd82cea6019dce65f0d4e8ff4">00855</a> <a class="code" href="group__can__api.html#ga1e71364bd82cea6019dce65f0d4e8ff4">CANIntUnregister</a>(uint32_t ui32Base)
<a name="l00856"></a>00856 {
<a name="l00857"></a>00857     uint_fast8_t ui8IntNumber;
<a name="l00858"></a>00858 
<a name="l00859"></a>00859     <span class="comment">//</span>
<a name="l00860"></a>00860     <span class="comment">// Check the arguments.</span>
<a name="l00861"></a>00861     <span class="comment">//</span>
<a name="l00862"></a>00862     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(_CANBaseValid(ui32Base));
<a name="l00863"></a>00863 
<a name="l00864"></a>00864     <span class="comment">//</span>
<a name="l00865"></a>00865     <span class="comment">// Get the actual interrupt number for this CAN controller.</span>
<a name="l00866"></a>00866     <span class="comment">//</span>
<a name="l00867"></a>00867     ui8IntNumber = <a class="code" href="group__can__api.html#gabb59e45a511a4b040fc32f5e64e016f4">_CANIntNumberGet</a>(ui32Base);
<a name="l00868"></a>00868     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui8IntNumber != 0);
<a name="l00869"></a>00869 
<a name="l00870"></a>00870     <span class="comment">//</span>
<a name="l00871"></a>00871     <span class="comment">// Disable the CAN interrupt.</span>
<a name="l00872"></a>00872     <span class="comment">//</span>
<a name="l00873"></a>00873     <a class="code" href="group__interrupt__api.html#ga9af6b00884dc44e92b3d05ff821b5334">IntDisable</a>(ui8IntNumber);
<a name="l00874"></a>00874 
<a name="l00875"></a>00875     <span class="comment">//</span>
<a name="l00876"></a>00876     <span class="comment">// Register the interrupt handler.</span>
<a name="l00877"></a>00877     <span class="comment">//</span>
<a name="l00878"></a>00878     <a class="code" href="group__interrupt__api.html#ga5dffc81c27c005f83e9bfc30f775982a">IntUnregister</a>(ui8IntNumber);
<a name="l00879"></a>00879 }
<a name="l00880"></a>00880 
<a name="l00881"></a>00881 <span class="comment">//*****************************************************************************</span>
<a name="l00882"></a>00882 <span class="comment">//</span>
<a name="l00909"></a>00909 <span class="comment"></span><span class="comment">//</span>
<a name="l00910"></a>00910 <span class="comment">//*****************************************************************************</span>
<a name="l00911"></a>00911 <span class="keywordtype">void</span>
<a name="l00912"></a><a class="code" href="group__can__api.html#gadcd40ec4c70f330ae37ebaa6f9db4e3b">00912</a> <a class="code" href="group__can__api.html#gadcd40ec4c70f330ae37ebaa6f9db4e3b">CANIntEnable</a>(uint32_t ui32Base, uint32_t ui32IntFlags)
<a name="l00913"></a>00913 {
<a name="l00914"></a>00914     <span class="comment">//</span>
<a name="l00915"></a>00915     <span class="comment">// Check the arguments.</span>
<a name="l00916"></a>00916     <span class="comment">//</span>
<a name="l00917"></a>00917     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(_CANBaseValid(ui32Base));
<a name="l00918"></a>00918     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>((ui32IntFlags &amp; ~(<a class="code" href="hw__can_8h.html#adcd830f70200e2133ca49243f98ce512">CAN_CTL_EIE</a> | <a class="code" href="hw__can_8h.html#a6611fbeb800d02e41f23be24cb3c5e8a">CAN_CTL_SIE</a> | <a class="code" href="hw__can_8h.html#abdc2dc4ed20896716d77d16049d7e3ab">CAN_CTL_IE</a>)) == 0);
<a name="l00919"></a>00919 
<a name="l00920"></a>00920     <span class="comment">//</span>
<a name="l00921"></a>00921     <span class="comment">// Enable the specified interrupts.</span>
<a name="l00922"></a>00922     <span class="comment">//</span>
<a name="l00923"></a>00923     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a502bb899dc3499f1becf72e4bf7486f6">CAN_O_CTL</a>) |= ui32IntFlags;
<a name="l00924"></a>00924 }
<a name="l00925"></a>00925 
<a name="l00926"></a>00926 <span class="comment">//*****************************************************************************</span>
<a name="l00927"></a>00927 <span class="comment">//</span>
<a name="l00941"></a>00941 <span class="comment"></span><span class="comment">//</span>
<a name="l00942"></a>00942 <span class="comment">//*****************************************************************************</span>
<a name="l00943"></a>00943 <span class="keywordtype">void</span>
<a name="l00944"></a><a class="code" href="group__can__api.html#ga3c2ea0c4692882c05aee64671e78fef9">00944</a> <a class="code" href="group__can__api.html#ga3c2ea0c4692882c05aee64671e78fef9">CANIntDisable</a>(uint32_t ui32Base, uint32_t ui32IntFlags)
<a name="l00945"></a>00945 {
<a name="l00946"></a>00946     <span class="comment">//</span>
<a name="l00947"></a>00947     <span class="comment">// Check the arguments.</span>
<a name="l00948"></a>00948     <span class="comment">//</span>
<a name="l00949"></a>00949     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(_CANBaseValid(ui32Base));
<a name="l00950"></a>00950     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>((ui32IntFlags &amp; ~(<a class="code" href="hw__can_8h.html#adcd830f70200e2133ca49243f98ce512">CAN_CTL_EIE</a> | <a class="code" href="hw__can_8h.html#a6611fbeb800d02e41f23be24cb3c5e8a">CAN_CTL_SIE</a> | <a class="code" href="hw__can_8h.html#abdc2dc4ed20896716d77d16049d7e3ab">CAN_CTL_IE</a>)) == 0);
<a name="l00951"></a>00951 
<a name="l00952"></a>00952     <span class="comment">//</span>
<a name="l00953"></a>00953     <span class="comment">// Disable the specified interrupts.</span>
<a name="l00954"></a>00954     <span class="comment">//</span>
<a name="l00955"></a>00955     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a502bb899dc3499f1becf72e4bf7486f6">CAN_O_CTL</a>) &amp;= ~ui32IntFlags;
<a name="l00956"></a>00956 }
<a name="l00957"></a>00957 
<a name="l00958"></a>00958 <span class="comment">//*****************************************************************************</span>
<a name="l00959"></a>00959 <span class="comment">//</span>
<a name="l00992"></a>00992 <span class="comment"></span><span class="comment">//</span>
<a name="l00993"></a>00993 <span class="comment">//*****************************************************************************</span>
<a name="l00994"></a>00994 uint32_t
<a name="l00995"></a><a class="code" href="group__can__api.html#ga012ae41a1edb2e3daabcfb72a1944791">00995</a> <a class="code" href="group__can__api.html#ga012ae41a1edb2e3daabcfb72a1944791">CANIntStatus</a>(uint32_t ui32Base, <a class="code" href="group__can__api.html#ga73584383f566e98bf822b371a03becfc">tCANIntStsReg</a> eIntStsReg)
<a name="l00996"></a>00996 {
<a name="l00997"></a>00997     uint32_t ui32Status;
<a name="l00998"></a>00998 
<a name="l00999"></a>00999     <span class="comment">//</span>
<a name="l01000"></a>01000     <span class="comment">// Check the arguments.</span>
<a name="l01001"></a>01001     <span class="comment">//</span>
<a name="l01002"></a>01002     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(_CANBaseValid(ui32Base));
<a name="l01003"></a>01003 
<a name="l01004"></a>01004     <span class="comment">//</span>
<a name="l01005"></a>01005     <span class="comment">// See which status the caller is looking for.</span>
<a name="l01006"></a>01006     <span class="comment">//</span>
<a name="l01007"></a>01007     <span class="keywordflow">switch</span>(eIntStsReg)
<a name="l01008"></a>01008     {
<a name="l01009"></a>01009         <span class="comment">//</span>
<a name="l01010"></a>01010         <span class="comment">// The caller wants the global interrupt status for the CAN controller</span>
<a name="l01011"></a>01011         <span class="comment">// specified by ui32Base.</span>
<a name="l01012"></a>01012         <span class="comment">//</span>
<a name="l01013"></a>01013         <span class="keywordflow">case</span> <a class="code" href="group__can__api.html#gga73584383f566e98bf822b371a03becfcaaab739e796c1216de72acf16410795a5" title="Read the CAN interrupt status information.">CAN_INT_STS_CAUSE</a>:
<a name="l01014"></a>01014         {
<a name="l01015"></a>01015             ui32Status = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a907e36290beb71b0677ab1112e480b6d">CAN_O_INT</a>);
<a name="l01016"></a>01016             <span class="keywordflow">break</span>;
<a name="l01017"></a>01017         }
<a name="l01018"></a>01018 
<a name="l01019"></a>01019         <span class="comment">//</span>
<a name="l01020"></a>01020         <span class="comment">// The caller wants the current message status interrupt for all</span>
<a name="l01021"></a>01021         <span class="comment">// messages.</span>
<a name="l01022"></a>01022         <span class="comment">//</span>
<a name="l01023"></a>01023         <span class="keywordflow">case</span> <a class="code" href="group__can__api.html#gga73584383f566e98bf822b371a03becfca8cb85391f55d762fcff16bb285903304" title="Read a message object&#39;s interrupt status.">CAN_INT_STS_OBJECT</a>:
<a name="l01024"></a>01024         {
<a name="l01025"></a>01025             <span class="comment">//</span>
<a name="l01026"></a>01026             <span class="comment">// Read and combine both 16 bit values into one 32bit status.</span>
<a name="l01027"></a>01027             <span class="comment">//</span>
<a name="l01028"></a>01028             ui32Status = (<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a0b31563ed71e9d420e62447d3bcc3ccd">CAN_O_MSG1INT</a>) &amp;
<a name="l01029"></a>01029                           <a class="code" href="hw__can_8h.html#a111532a4ae7ccf9578a731cafe9c6068">CAN_MSG1INT_INTPND_M</a>);
<a name="l01030"></a>01030             ui32Status |= (<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#ad602a5847ef5cd592e89f5766b266cf1">CAN_O_MSG2INT</a>) &lt;&lt; 16);
<a name="l01031"></a>01031             <span class="keywordflow">break</span>;
<a name="l01032"></a>01032         }
<a name="l01033"></a>01033 
<a name="l01034"></a>01034         <span class="comment">//</span>
<a name="l01035"></a>01035         <span class="comment">// Request was for unknown status so just return 0.</span>
<a name="l01036"></a>01036         <span class="comment">//</span>
<a name="l01037"></a>01037         <span class="keywordflow">default</span>:
<a name="l01038"></a>01038         {
<a name="l01039"></a>01039             ui32Status = 0;
<a name="l01040"></a>01040             <span class="keywordflow">break</span>;
<a name="l01041"></a>01041         }
<a name="l01042"></a>01042     }
<a name="l01043"></a>01043 
<a name="l01044"></a>01044     <span class="comment">//</span>
<a name="l01045"></a>01045     <span class="comment">// Return the interrupt status value</span>
<a name="l01046"></a>01046     <span class="comment">//</span>
<a name="l01047"></a>01047     <span class="keywordflow">return</span>(ui32Status);
<a name="l01048"></a>01048 }
<a name="l01049"></a>01049 
<a name="l01050"></a>01050 <span class="comment">//*****************************************************************************</span>
<a name="l01051"></a>01051 <span class="comment">//</span>
<a name="l01081"></a>01081 <span class="comment"></span><span class="comment">//</span>
<a name="l01082"></a>01082 <span class="comment">//*****************************************************************************</span>
<a name="l01083"></a>01083 <span class="keywordtype">void</span>
<a name="l01084"></a><a class="code" href="group__can__api.html#gaba19b088c06e1a7384e956447bf00925">01084</a> <a class="code" href="group__can__api.html#gaba19b088c06e1a7384e956447bf00925">CANIntClear</a>(uint32_t ui32Base, uint32_t ui32IntClr)
<a name="l01085"></a>01085 {
<a name="l01086"></a>01086     <span class="comment">//</span>
<a name="l01087"></a>01087     <span class="comment">// Check the arguments.</span>
<a name="l01088"></a>01088     <span class="comment">//</span>
<a name="l01089"></a>01089     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(_CANBaseValid(ui32Base));
<a name="l01090"></a>01090     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>((ui32IntClr == <a class="code" href="hw__can_8h.html#a20f8cb17967fc1b1c22a066fa359bd2e">CAN_INT_INTID_STATUS</a>) ||
<a name="l01091"></a>01091            ((ui32IntClr &gt;= 1) &amp;&amp; (ui32IntClr &lt;= 32)));
<a name="l01092"></a>01092 
<a name="l01093"></a>01093     <span class="keywordflow">if</span>(ui32IntClr == <a class="code" href="hw__can_8h.html#a20f8cb17967fc1b1c22a066fa359bd2e">CAN_INT_INTID_STATUS</a>)
<a name="l01094"></a>01094     {
<a name="l01095"></a>01095         <span class="comment">//</span>
<a name="l01096"></a>01096         <span class="comment">// Simply read and discard the status to clear the interrupt.</span>
<a name="l01097"></a>01097         <span class="comment">//</span>
<a name="l01098"></a>01098         <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a77c8f8ad059402c8047a485db1645da8">CAN_O_STS</a>);
<a name="l01099"></a>01099     }
<a name="l01100"></a>01100     <span class="keywordflow">else</span>
<a name="l01101"></a>01101     {
<a name="l01102"></a>01102         <span class="comment">//</span>
<a name="l01103"></a>01103         <span class="comment">// Wait to be sure that this interface is not busy.</span>
<a name="l01104"></a>01104         <span class="comment">//</span>
<a name="l01105"></a>01105         <span class="keywordflow">while</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a429984ce40dd20eb6966e1d365d90238">CAN_O_IF1CRQ</a>) &amp; <a class="code" href="hw__can_8h.html#acdefd7830a26bca16b676dba5598b66d">CAN_IF1CRQ_BUSY</a>)
<a name="l01106"></a>01106         {
<a name="l01107"></a>01107         }
<a name="l01108"></a>01108 
<a name="l01109"></a>01109         <span class="comment">//</span>
<a name="l01110"></a>01110         <span class="comment">// Only change the interrupt pending state by setting only the</span>
<a name="l01111"></a>01111         <span class="comment">// CAN_IF1CMSK_CLRINTPND bit.</span>
<a name="l01112"></a>01112         <span class="comment">//</span>
<a name="l01113"></a>01113         <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#ab5120f8aeba67f0995a7c927319ee946">CAN_O_IF1CMSK</a>) = <a class="code" href="hw__can_8h.html#aa57248d35f2b29e2a2f8e9fe684e7677">CAN_IF1CMSK_CLRINTPND</a>;
<a name="l01114"></a>01114 
<a name="l01115"></a>01115         <span class="comment">//</span>
<a name="l01116"></a>01116         <span class="comment">// Send the clear pending interrupt command to the CAN controller.</span>
<a name="l01117"></a>01117         <span class="comment">//</span>
<a name="l01118"></a>01118         <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a429984ce40dd20eb6966e1d365d90238">CAN_O_IF1CRQ</a>) = ui32IntClr &amp; <a class="code" href="hw__can_8h.html#ab55e3e802b91a63c8adec7b5b70a989b">CAN_IF1CRQ_MNUM_M</a>;
<a name="l01119"></a>01119 
<a name="l01120"></a>01120         <span class="comment">//</span>
<a name="l01121"></a>01121         <span class="comment">// Wait to be sure that this interface is not busy.</span>
<a name="l01122"></a>01122         <span class="comment">//</span>
<a name="l01123"></a>01123         <span class="keywordflow">while</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a429984ce40dd20eb6966e1d365d90238">CAN_O_IF1CRQ</a>) &amp; CAN_IF1CRQ_BUSY)
<a name="l01124"></a>01124         {
<a name="l01125"></a>01125         }
<a name="l01126"></a>01126     }
<a name="l01127"></a>01127 }
<a name="l01128"></a>01128 
<a name="l01129"></a>01129 <span class="comment">//*****************************************************************************</span>
<a name="l01130"></a>01130 <span class="comment">//</span>
<a name="l01141"></a>01141 <span class="comment"></span><span class="comment">//</span>
<a name="l01142"></a>01142 <span class="comment">//*****************************************************************************</span>
<a name="l01143"></a>01143 <span class="keywordtype">void</span>
<a name="l01144"></a><a class="code" href="group__can__api.html#ga051e3e7b5e2749b9698e8ebe36257d22">01144</a> <a class="code" href="group__can__api.html#ga051e3e7b5e2749b9698e8ebe36257d22">CANRetrySet</a>(uint32_t ui32Base, <span class="keywordtype">bool</span> bAutoRetry)
<a name="l01145"></a>01145 {
<a name="l01146"></a>01146     uint32_t ui32CtlReg;
<a name="l01147"></a>01147 
<a name="l01148"></a>01148     <span class="comment">//</span>
<a name="l01149"></a>01149     <span class="comment">// Check the arguments.</span>
<a name="l01150"></a>01150     <span class="comment">//</span>
<a name="l01151"></a>01151     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(_CANBaseValid(ui32Base));
<a name="l01152"></a>01152 
<a name="l01153"></a>01153     ui32CtlReg = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a502bb899dc3499f1becf72e4bf7486f6">CAN_O_CTL</a>);
<a name="l01154"></a>01154 
<a name="l01155"></a>01155     <span class="comment">//</span>
<a name="l01156"></a>01156     <span class="comment">// Conditionally set the DAR bit to enable/disable auto-retry.</span>
<a name="l01157"></a>01157     <span class="comment">//</span>
<a name="l01158"></a>01158     <span class="keywordflow">if</span>(bAutoRetry)
<a name="l01159"></a>01159     {
<a name="l01160"></a>01160         <span class="comment">//</span>
<a name="l01161"></a>01161         <span class="comment">// Clearing the DAR bit tells the controller to not disable the</span>
<a name="l01162"></a>01162         <span class="comment">// auto-retry of messages which were not transmitted or received</span>
<a name="l01163"></a>01163         <span class="comment">// correctly.</span>
<a name="l01164"></a>01164         <span class="comment">//</span>
<a name="l01165"></a>01165         ui32CtlReg &amp;= ~<a class="code" href="hw__can_8h.html#a18993295b55d8d847bad3f7443f39077">CAN_CTL_DAR</a>;
<a name="l01166"></a>01166     }
<a name="l01167"></a>01167     <span class="keywordflow">else</span>
<a name="l01168"></a>01168     {
<a name="l01169"></a>01169         <span class="comment">//</span>
<a name="l01170"></a>01170         <span class="comment">// Setting the DAR bit tells the controller to disable the auto-retry</span>
<a name="l01171"></a>01171         <span class="comment">// of messages which were not transmitted or received correctly.</span>
<a name="l01172"></a>01172         <span class="comment">//</span>
<a name="l01173"></a>01173         ui32CtlReg |= <a class="code" href="hw__can_8h.html#a18993295b55d8d847bad3f7443f39077">CAN_CTL_DAR</a>;
<a name="l01174"></a>01174     }
<a name="l01175"></a>01175 
<a name="l01176"></a>01176     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a502bb899dc3499f1becf72e4bf7486f6">CAN_O_CTL</a>) = ui32CtlReg;
<a name="l01177"></a>01177 }
<a name="l01178"></a>01178 
<a name="l01179"></a>01179 <span class="comment">//*****************************************************************************</span>
<a name="l01180"></a>01180 <span class="comment">//</span>
<a name="l01190"></a>01190 <span class="comment"></span><span class="comment">//</span>
<a name="l01191"></a>01191 <span class="comment">//*****************************************************************************</span>
<a name="l01192"></a>01192 <span class="keywordtype">bool</span>
<a name="l01193"></a><a class="code" href="group__can__api.html#ga62c6ae2255afa872ef19b49d40f59d5f">01193</a> <a class="code" href="group__can__api.html#ga62c6ae2255afa872ef19b49d40f59d5f">CANRetryGet</a>(uint32_t ui32Base)
<a name="l01194"></a>01194 {
<a name="l01195"></a>01195     <span class="comment">//</span>
<a name="l01196"></a>01196     <span class="comment">// Check the arguments.</span>
<a name="l01197"></a>01197     <span class="comment">//</span>
<a name="l01198"></a>01198     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(_CANBaseValid(ui32Base));
<a name="l01199"></a>01199 
<a name="l01200"></a>01200     <span class="comment">//</span>
<a name="l01201"></a>01201     <span class="comment">// Read the disable automatic retry setting from the CAN controller.</span>
<a name="l01202"></a>01202     <span class="comment">//</span>
<a name="l01203"></a>01203     <span class="keywordflow">if</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a502bb899dc3499f1becf72e4bf7486f6">CAN_O_CTL</a>) &amp; <a class="code" href="hw__can_8h.html#a18993295b55d8d847bad3f7443f39077">CAN_CTL_DAR</a>)
<a name="l01204"></a>01204     {
<a name="l01205"></a>01205         <span class="comment">//</span>
<a name="l01206"></a>01206         <span class="comment">// Automatic data retransmission is not enabled.</span>
<a name="l01207"></a>01207         <span class="comment">//</span>
<a name="l01208"></a>01208         <span class="keywordflow">return</span>(<span class="keyword">false</span>);
<a name="l01209"></a>01209     }
<a name="l01210"></a>01210 
<a name="l01211"></a>01211     <span class="comment">//</span>
<a name="l01212"></a>01212     <span class="comment">// Automatic data retransmission is enabled.</span>
<a name="l01213"></a>01213     <span class="comment">//</span>
<a name="l01214"></a>01214     <span class="keywordflow">return</span>(<span class="keyword">true</span>);
<a name="l01215"></a>01215 }
<a name="l01216"></a>01216 
<a name="l01217"></a>01217 <span class="comment">//*****************************************************************************</span>
<a name="l01218"></a>01218 <span class="comment">//</span>
<a name="l01273"></a>01273 <span class="comment"></span><span class="comment">//</span>
<a name="l01274"></a>01274 <span class="comment">//*****************************************************************************</span>
<a name="l01275"></a>01275 uint32_t
<a name="l01276"></a><a class="code" href="group__can__api.html#ga690d72cb5ea790f9bd0ab6abd7caa68a">01276</a> <a class="code" href="group__can__api.html#ga690d72cb5ea790f9bd0ab6abd7caa68a">CANStatusGet</a>(uint32_t ui32Base, <a class="code" href="group__can__api.html#gad898b7c10eb4d9282bd4c25fc935b3d2">tCANStsReg</a> eStatusReg)
<a name="l01277"></a>01277 {
<a name="l01278"></a>01278     uint32_t ui32Status;
<a name="l01279"></a>01279 
<a name="l01280"></a>01280     <span class="comment">//</span>
<a name="l01281"></a>01281     <span class="comment">// Check the arguments.</span>
<a name="l01282"></a>01282     <span class="comment">//</span>
<a name="l01283"></a>01283     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(_CANBaseValid(ui32Base));
<a name="l01284"></a>01284 
<a name="l01285"></a>01285     <span class="keywordflow">switch</span>(eStatusReg)
<a name="l01286"></a>01286     {
<a name="l01287"></a>01287         <span class="comment">//</span>
<a name="l01288"></a>01288         <span class="comment">// Just return the global CAN status register since that is what was</span>
<a name="l01289"></a>01289         <span class="comment">// requested.</span>
<a name="l01290"></a>01290         <span class="comment">//</span>
<a name="l01291"></a>01291         <span class="keywordflow">case</span> <a class="code" href="group__can__api.html#ggad898b7c10eb4d9282bd4c25fc935b3d2aac2ece80a767774a99d1fb1e463aa932" title="Read the full CAN controller status.">CAN_STS_CONTROL</a>:
<a name="l01292"></a>01292         {
<a name="l01293"></a>01293             ui32Status = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a77c8f8ad059402c8047a485db1645da8">CAN_O_STS</a>);
<a name="l01294"></a>01294             <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a77c8f8ad059402c8047a485db1645da8">CAN_O_STS</a>) = ~(<a class="code" href="hw__can_8h.html#a06cd908b190e3bf6de6af5d607d2859b">CAN_STS_RXOK</a> | <a class="code" href="hw__can_8h.html#afa6e8abbaf4b70e50cb5c9ab8d8c8d1a">CAN_STS_TXOK</a> |
<a name="l01295"></a>01295                                             <a class="code" href="hw__can_8h.html#ae10cf6e0db5b8d432f9857b1ac37fbbe">CAN_STS_LEC_M</a>);
<a name="l01296"></a>01296             <span class="keywordflow">break</span>;
<a name="l01297"></a>01297         }
<a name="l01298"></a>01298 
<a name="l01299"></a>01299         <span class="comment">//</span>
<a name="l01300"></a>01300         <span class="comment">// Combine the Transmit status bits into one 32bit value.</span>
<a name="l01301"></a>01301         <span class="comment">//</span>
<a name="l01302"></a>01302         <span class="keywordflow">case</span> <a class="code" href="group__can__api.html#ggad898b7c10eb4d9282bd4c25fc935b3d2afffa0c96b01a03aff5a5dd32c5aa77c7">CAN_STS_TXREQUEST</a>:
<a name="l01303"></a>01303         {
<a name="l01304"></a>01304             ui32Status = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#aa6027f3965f0db1cadbfacc6f88b427b">CAN_O_TXRQ1</a>);
<a name="l01305"></a>01305             ui32Status |= <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a3f24e91ebfb606070d723e23a1dfe9d8">CAN_O_TXRQ2</a>) &lt;&lt; 16;
<a name="l01306"></a>01306             <span class="keywordflow">break</span>;
<a name="l01307"></a>01307         }
<a name="l01308"></a>01308 
<a name="l01309"></a>01309         <span class="comment">//</span>
<a name="l01310"></a>01310         <span class="comment">// Combine the New Data status bits into one 32bit value.</span>
<a name="l01311"></a>01311         <span class="comment">//</span>
<a name="l01312"></a>01312         <span class="keywordflow">case</span> <a class="code" href="group__can__api.html#ggad898b7c10eb4d9282bd4c25fc935b3d2afa63f81ede60a5209bc32c6eb94e7512" title="Read the full 32-bit mask of message objects with new data available.">CAN_STS_NEWDAT</a>:
<a name="l01313"></a>01313         {
<a name="l01314"></a>01314             ui32Status = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#acc4e152e6be000ac2aa719db4b2202bd">CAN_O_NWDA1</a>);
<a name="l01315"></a>01315             ui32Status |= <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#aa70346dac1448d910bdb441426505591">CAN_O_NWDA2</a>) &lt;&lt; 16;
<a name="l01316"></a>01316             <span class="keywordflow">break</span>;
<a name="l01317"></a>01317         }
<a name="l01318"></a>01318 
<a name="l01319"></a>01319         <span class="comment">//</span>
<a name="l01320"></a>01320         <span class="comment">// Combine the Message valid status bits into one 32bit value.</span>
<a name="l01321"></a>01321         <span class="comment">//</span>
<a name="l01322"></a>01322         <span class="keywordflow">case</span> <a class="code" href="group__can__api.html#ggad898b7c10eb4d9282bd4c25fc935b3d2a3fe016f4c8154bf2ef524621edfb293d" title="Read the full 32-bit mask of message objects that are enabled.">CAN_STS_MSGVAL</a>:
<a name="l01323"></a>01323         {
<a name="l01324"></a>01324             ui32Status = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#aca38ccb7b3815cefb9f8c5763696ac04">CAN_O_MSG1VAL</a>);
<a name="l01325"></a>01325             ui32Status |= <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#af53ae014af8386b53112807efe20aab3">CAN_O_MSG2VAL</a>) &lt;&lt; 16;
<a name="l01326"></a>01326             <span class="keywordflow">break</span>;
<a name="l01327"></a>01327         }
<a name="l01328"></a>01328 
<a name="l01329"></a>01329         <span class="comment">//</span>
<a name="l01330"></a>01330         <span class="comment">// Unknown CAN status requested so return 0.</span>
<a name="l01331"></a>01331         <span class="comment">//</span>
<a name="l01332"></a>01332         <span class="keywordflow">default</span>:
<a name="l01333"></a>01333         {
<a name="l01334"></a>01334             ui32Status = 0;
<a name="l01335"></a>01335             <span class="keywordflow">break</span>;
<a name="l01336"></a>01336         }
<a name="l01337"></a>01337     }
<a name="l01338"></a>01338     <span class="keywordflow">return</span>(ui32Status);
<a name="l01339"></a>01339 }
<a name="l01340"></a>01340 
<a name="l01341"></a>01341 <span class="comment">//*****************************************************************************</span>
<a name="l01342"></a>01342 <span class="comment">//</span>
<a name="l01361"></a>01361 <span class="comment"></span><span class="comment">//</span>
<a name="l01362"></a>01362 <span class="comment">//*****************************************************************************</span>
<a name="l01363"></a>01363 <span class="keywordtype">bool</span>
<a name="l01364"></a><a class="code" href="group__can__api.html#gac1b3551968b82b460dcc65f90ac3e2c5">01364</a> <a class="code" href="group__can__api.html#gac1b3551968b82b460dcc65f90ac3e2c5">CANErrCntrGet</a>(uint32_t ui32Base, uint32_t *pui32RxCount,
<a name="l01365"></a>01365               uint32_t *pui32TxCount)
<a name="l01366"></a>01366 {
<a name="l01367"></a>01367     uint32_t ui32CANError;
<a name="l01368"></a>01368 
<a name="l01369"></a>01369     <span class="comment">//</span>
<a name="l01370"></a>01370     <span class="comment">// Check the arguments.</span>
<a name="l01371"></a>01371     <span class="comment">//</span>
<a name="l01372"></a>01372     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(_CANBaseValid(ui32Base));
<a name="l01373"></a>01373 
<a name="l01374"></a>01374     <span class="comment">//</span>
<a name="l01375"></a>01375     <span class="comment">// Read the current count of transmit/receive errors.</span>
<a name="l01376"></a>01376     <span class="comment">//</span>
<a name="l01377"></a>01377     ui32CANError = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#acdc8bd67e0d2d080aa7809af18386d93">CAN_O_ERR</a>);
<a name="l01378"></a>01378 
<a name="l01379"></a>01379     <span class="comment">//</span>
<a name="l01380"></a>01380     <span class="comment">// Extract the error numbers from the register value.</span>
<a name="l01381"></a>01381     <span class="comment">//</span>
<a name="l01382"></a>01382     *pui32RxCount = (ui32CANError &amp; <a class="code" href="hw__can_8h.html#a5af768a06dd21f82408b653340bc764a">CAN_ERR_REC_M</a>) &gt;&gt; <a class="code" href="hw__can_8h.html#acb7bb617fe25c6e02e2d7db893bdfaf6">CAN_ERR_REC_S</a>;
<a name="l01383"></a>01383     *pui32TxCount = (ui32CANError &amp; <a class="code" href="hw__can_8h.html#af15ba8042d32b329f469aff8a0febe4e">CAN_ERR_TEC_M</a>) &gt;&gt; <a class="code" href="hw__can_8h.html#af7c06af0d6d0b12946780a5a6acaf13c">CAN_ERR_TEC_S</a>;
<a name="l01384"></a>01384 
<a name="l01385"></a>01385     <span class="keywordflow">if</span>(ui32CANError &amp; <a class="code" href="hw__can_8h.html#a6a6f949029c21725e65fbacc5604db87">CAN_ERR_RP</a>)
<a name="l01386"></a>01386     {
<a name="l01387"></a>01387         <span class="keywordflow">return</span>(<span class="keyword">true</span>);
<a name="l01388"></a>01388     }
<a name="l01389"></a>01389     <span class="keywordflow">return</span>(<span class="keyword">false</span>);
<a name="l01390"></a>01390 }
<a name="l01391"></a>01391 
<a name="l01392"></a>01392 <span class="comment">//*****************************************************************************</span>
<a name="l01393"></a>01393 <span class="comment">//</span>
<a name="l01474"></a>01474 <span class="comment"></span><span class="comment">//</span>
<a name="l01475"></a>01475 <span class="comment">//*****************************************************************************</span>
<a name="l01476"></a>01476 <span class="keywordtype">void</span>
<a name="l01477"></a><a class="code" href="group__can__api.html#ga7ea9b17d0737c0bc3f07862436f27cc5">01477</a> <a class="code" href="group__can__api.html#ga7ea9b17d0737c0bc3f07862436f27cc5">CANMessageSet</a>(uint32_t ui32Base, uint32_t ui32ObjID,
<a name="l01478"></a>01478               <a class="code" href="structt_c_a_n_msg_object.html">tCANMsgObject</a> *psMsgObject, <a class="code" href="group__can__api.html#gad3fa840d5e84a9366ba2a8c958c069a2">tMsgObjType</a> eMsgType)
<a name="l01479"></a>01479 {
<a name="l01480"></a>01480     uint16_t ui16CmdMaskReg;
<a name="l01481"></a>01481     uint16_t ui16MaskReg0, ui16MaskReg1;
<a name="l01482"></a>01482     uint16_t ui16ArbReg0, ui16ArbReg1;
<a name="l01483"></a>01483     uint16_t ui16MsgCtrl;
<a name="l01484"></a>01484     <span class="keywordtype">bool</span> bTransferData;
<a name="l01485"></a>01485     <span class="keywordtype">bool</span> bUseExtendedID;
<a name="l01486"></a>01486 
<a name="l01487"></a>01487     bTransferData = 0;
<a name="l01488"></a>01488 
<a name="l01489"></a>01489     <span class="comment">//</span>
<a name="l01490"></a>01490     <span class="comment">// Check the arguments.</span>
<a name="l01491"></a>01491     <span class="comment">//</span>
<a name="l01492"></a>01492     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(_CANBaseValid(ui32Base));
<a name="l01493"></a>01493     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>((ui32ObjID &lt;= 32) &amp;&amp; (ui32ObjID != 0));
<a name="l01494"></a>01494     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>((eMsgType == <a class="code" href="group__can__api.html#ggad3fa840d5e84a9366ba2a8c958c069a2aa13483d5640bff99d693d271c2238230" title="Transmit message object.">MSG_OBJ_TYPE_TX</a>) ||
<a name="l01495"></a>01495            (eMsgType == <a class="code" href="group__can__api.html#ggad3fa840d5e84a9366ba2a8c958c069a2a01289338e40c4573d4a78e6d40cab433" title="Transmit remote request message object.">MSG_OBJ_TYPE_TX_REMOTE</a>) ||
<a name="l01496"></a>01496            (eMsgType == <a class="code" href="group__can__api.html#ggad3fa840d5e84a9366ba2a8c958c069a2a19480934236e65a7090acd45caecb0a3" title="Receive message object.">MSG_OBJ_TYPE_RX</a>) ||
<a name="l01497"></a>01497            (eMsgType == <a class="code" href="group__can__api.html#ggad3fa840d5e84a9366ba2a8c958c069a2ae268696d7605c98094e4136eb646a251" title="Receive remote request message object.">MSG_OBJ_TYPE_RX_REMOTE</a>) ||
<a name="l01498"></a>01498            (eMsgType == <a class="code" href="group__can__api.html#ggad3fa840d5e84a9366ba2a8c958c069a2a01289338e40c4573d4a78e6d40cab433" title="Transmit remote request message object.">MSG_OBJ_TYPE_TX_REMOTE</a>) ||
<a name="l01499"></a>01499            (eMsgType == <a class="code" href="group__can__api.html#ggad3fa840d5e84a9366ba2a8c958c069a2a8aed86e235facdf4ab0ce8cb53de65c1" title="Remote frame receive remote, with auto-transmit message object.">MSG_OBJ_TYPE_RXTX_REMOTE</a>));
<a name="l01500"></a>01500 
<a name="l01501"></a>01501     <span class="comment">//</span>
<a name="l01502"></a>01502     <span class="comment">// Wait for busy bit to clear</span>
<a name="l01503"></a>01503     <span class="comment">//</span>
<a name="l01504"></a>01504     <span class="keywordflow">while</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a429984ce40dd20eb6966e1d365d90238">CAN_O_IF1CRQ</a>) &amp; <a class="code" href="hw__can_8h.html#acdefd7830a26bca16b676dba5598b66d">CAN_IF1CRQ_BUSY</a>)
<a name="l01505"></a>01505     {
<a name="l01506"></a>01506     }
<a name="l01507"></a>01507 
<a name="l01508"></a>01508     <span class="comment">//</span>
<a name="l01509"></a>01509     <span class="comment">// See if we need to use an extended identifier or not.</span>
<a name="l01510"></a>01510     <span class="comment">//</span>
<a name="l01511"></a>01511     <span class="keywordflow">if</span>((psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#a12434ad39602e05b786c4481f756479e" title="The CAN message identifier used for 11 or 29 bit identifiers.">ui32MsgID</a> &gt; <a class="code" href="group__can__api.html#gad1368e948556fa9ed4f74ecf8610845f">CAN_MAX_11BIT_MSG_ID</a>) ||
<a name="l01512"></a>01512        (psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#ae86eceeafd1fa9ed8bfa64e2fe7a96af">ui32Flags</a> &amp; <a class="code" href="group__can__api.html#ga9387d98cd6262e0be419aceab45295e4" title="This indicates that a message object is using an extended identifier.">MSG_OBJ_EXTENDED_ID</a>))
<a name="l01513"></a>01513     {
<a name="l01514"></a>01514         bUseExtendedID = 1;
<a name="l01515"></a>01515     }
<a name="l01516"></a>01516     <span class="keywordflow">else</span>
<a name="l01517"></a>01517     {
<a name="l01518"></a>01518         bUseExtendedID = 0;
<a name="l01519"></a>01519     }
<a name="l01520"></a>01520 
<a name="l01521"></a>01521     <span class="comment">//</span>
<a name="l01522"></a>01522     <span class="comment">// This is always a write to the Message object as this call is setting a</span>
<a name="l01523"></a>01523     <span class="comment">// message object.  This call always sets all size bits so it sets</span>
<a name="l01524"></a>01524     <span class="comment">// both data bits.  The call uses the CONTROL register to set control</span>
<a name="l01525"></a>01525     <span class="comment">// bits so this bit needs to be set as well.</span>
<a name="l01526"></a>01526     <span class="comment">//</span>
<a name="l01527"></a>01527     ui16CmdMaskReg = (<a class="code" href="hw__can_8h.html#af00e227e4d72a2b47cfd5a31bf3b261d">CAN_IF1CMSK_WRNRD</a> | <a class="code" href="hw__can_8h.html#a9acd5e5e84d4ec86afcf8b8c2c884248">CAN_IF1CMSK_DATAA</a> |
<a name="l01528"></a>01528                       <a class="code" href="hw__can_8h.html#ae0a8df1a3d309780888bb9019de5994a">CAN_IF1CMSK_DATAB</a> | <a class="code" href="hw__can_8h.html#ae67ae84bd00fc509ed7a025f1608fc29">CAN_IF1CMSK_CONTROL</a>);
<a name="l01529"></a>01529 
<a name="l01530"></a>01530     <span class="comment">//</span>
<a name="l01531"></a>01531     <span class="comment">// Initialize the values to a known state before filling them in based on</span>
<a name="l01532"></a>01532     <span class="comment">// the type of message object that is being configured.</span>
<a name="l01533"></a>01533     <span class="comment">//</span>
<a name="l01534"></a>01534     ui16ArbReg0 = 0;
<a name="l01535"></a>01535     ui16ArbReg1 = 0;
<a name="l01536"></a>01536     ui16MsgCtrl = 0;
<a name="l01537"></a>01537     ui16MaskReg0 = 0;
<a name="l01538"></a>01538     ui16MaskReg1 = 0;
<a name="l01539"></a>01539 
<a name="l01540"></a>01540     <span class="keywordflow">switch</span>(eMsgType)
<a name="l01541"></a>01541     {
<a name="l01542"></a>01542         <span class="comment">//</span>
<a name="l01543"></a>01543         <span class="comment">// Transmit message object.</span>
<a name="l01544"></a>01544         <span class="comment">//</span>
<a name="l01545"></a>01545         <span class="keywordflow">case</span> <a class="code" href="group__can__api.html#ggad3fa840d5e84a9366ba2a8c958c069a2aa13483d5640bff99d693d271c2238230" title="Transmit message object.">MSG_OBJ_TYPE_TX</a>:
<a name="l01546"></a>01546         {
<a name="l01547"></a>01547             <span class="comment">//</span>
<a name="l01548"></a>01548             <span class="comment">// Set the TXRQST bit and the reset the rest of the register.</span>
<a name="l01549"></a>01549             <span class="comment">//</span>
<a name="l01550"></a>01550             ui16MsgCtrl |= <a class="code" href="hw__can_8h.html#a6ea1b9778334e424cf2bb31dff9eef84">CAN_IF1MCTL_TXRQST</a>;
<a name="l01551"></a>01551             ui16ArbReg1 = <a class="code" href="hw__can_8h.html#aa1cfc44f626d46436b70bf5c6ab4b477">CAN_IF1ARB2_DIR</a>;
<a name="l01552"></a>01552             bTransferData = 1;
<a name="l01553"></a>01553             <span class="keywordflow">break</span>;
<a name="l01554"></a>01554         }
<a name="l01555"></a>01555 
<a name="l01556"></a>01556         <span class="comment">//</span>
<a name="l01557"></a>01557         <span class="comment">// Transmit remote request message object</span>
<a name="l01558"></a>01558         <span class="comment">//</span>
<a name="l01559"></a>01559         <span class="keywordflow">case</span> <a class="code" href="group__can__api.html#ggad3fa840d5e84a9366ba2a8c958c069a2a01289338e40c4573d4a78e6d40cab433" title="Transmit remote request message object.">MSG_OBJ_TYPE_TX_REMOTE</a>:
<a name="l01560"></a>01560         {
<a name="l01561"></a>01561             <span class="comment">//</span>
<a name="l01562"></a>01562             <span class="comment">// Set the TXRQST bit and the reset the rest of the register.</span>
<a name="l01563"></a>01563             <span class="comment">//</span>
<a name="l01564"></a>01564             ui16MsgCtrl |= <a class="code" href="hw__can_8h.html#a6ea1b9778334e424cf2bb31dff9eef84">CAN_IF1MCTL_TXRQST</a>;
<a name="l01565"></a>01565             ui16ArbReg1 = 0;
<a name="l01566"></a>01566             <span class="keywordflow">break</span>;
<a name="l01567"></a>01567         }
<a name="l01568"></a>01568 
<a name="l01569"></a>01569         <span class="comment">//</span>
<a name="l01570"></a>01570         <span class="comment">// Receive message object.</span>
<a name="l01571"></a>01571         <span class="comment">//</span>
<a name="l01572"></a>01572         <span class="keywordflow">case</span> <a class="code" href="group__can__api.html#ggad3fa840d5e84a9366ba2a8c958c069a2a19480934236e65a7090acd45caecb0a3" title="Receive message object.">MSG_OBJ_TYPE_RX</a>:
<a name="l01573"></a>01573         {
<a name="l01574"></a>01574             <span class="comment">//</span>
<a name="l01575"></a>01575             <span class="comment">// This clears the DIR bit along with everything else.  The TXRQST</span>
<a name="l01576"></a>01576             <span class="comment">// bit was cleared by defaulting ui16MsgCtrl to 0.</span>
<a name="l01577"></a>01577             <span class="comment">//</span>
<a name="l01578"></a>01578             ui16ArbReg1 = 0;
<a name="l01579"></a>01579             <span class="keywordflow">break</span>;
<a name="l01580"></a>01580         }
<a name="l01581"></a>01581 
<a name="l01582"></a>01582         <span class="comment">//</span>
<a name="l01583"></a>01583         <span class="comment">// Receive remote request message object.</span>
<a name="l01584"></a>01584         <span class="comment">//</span>
<a name="l01585"></a>01585         <span class="keywordflow">case</span> <a class="code" href="group__can__api.html#ggad3fa840d5e84a9366ba2a8c958c069a2ae268696d7605c98094e4136eb646a251" title="Receive remote request message object.">MSG_OBJ_TYPE_RX_REMOTE</a>:
<a name="l01586"></a>01586         {
<a name="l01587"></a>01587             <span class="comment">//</span>
<a name="l01588"></a>01588             <span class="comment">// The DIR bit is set to one for remote receivers.  The TXRQST bit</span>
<a name="l01589"></a>01589             <span class="comment">// was cleared by defaulting ui16MsgCtrl to 0.</span>
<a name="l01590"></a>01590             <span class="comment">//</span>
<a name="l01591"></a>01591             ui16ArbReg1 = <a class="code" href="hw__can_8h.html#aa1cfc44f626d46436b70bf5c6ab4b477">CAN_IF1ARB2_DIR</a>;
<a name="l01592"></a>01592 
<a name="l01593"></a>01593             <span class="comment">//</span>
<a name="l01594"></a>01594             <span class="comment">// Set this object so that it only indicates that a remote frame</span>
<a name="l01595"></a>01595             <span class="comment">// was received and allow for software to handle it by sending back</span>
<a name="l01596"></a>01596             <span class="comment">// a data frame.</span>
<a name="l01597"></a>01597             <span class="comment">//</span>
<a name="l01598"></a>01598             ui16MsgCtrl = <a class="code" href="hw__can_8h.html#a0e911f69ad77d25bf51ef1181de6880b">CAN_IF1MCTL_UMASK</a>;
<a name="l01599"></a>01599 
<a name="l01600"></a>01600             <span class="comment">//</span>
<a name="l01601"></a>01601             <span class="comment">// Use the full Identifier by default.</span>
<a name="l01602"></a>01602             <span class="comment">//</span>
<a name="l01603"></a>01603             ui16MaskReg0 = 0xffff;
<a name="l01604"></a>01604             ui16MaskReg1 = 0x1fff;
<a name="l01605"></a>01605 
<a name="l01606"></a>01606             <span class="comment">//</span>
<a name="l01607"></a>01607             <span class="comment">// Make sure to send the mask to the message object.</span>
<a name="l01608"></a>01608             <span class="comment">//</span>
<a name="l01609"></a>01609             ui16CmdMaskReg |= <a class="code" href="hw__can_8h.html#a3da272cd5f07203740b6d98d527b8b96">CAN_IF1CMSK_MASK</a>;
<a name="l01610"></a>01610             <span class="keywordflow">break</span>;
<a name="l01611"></a>01611         }
<a name="l01612"></a>01612 
<a name="l01613"></a>01613         <span class="comment">//</span>
<a name="l01614"></a>01614         <span class="comment">// Remote frame receive remote, with auto-transmit message object.</span>
<a name="l01615"></a>01615         <span class="comment">//</span>
<a name="l01616"></a>01616         <span class="keywordflow">case</span> <a class="code" href="group__can__api.html#ggad3fa840d5e84a9366ba2a8c958c069a2a8aed86e235facdf4ab0ce8cb53de65c1" title="Remote frame receive remote, with auto-transmit message object.">MSG_OBJ_TYPE_RXTX_REMOTE</a>:
<a name="l01617"></a>01617         {
<a name="l01618"></a>01618             <span class="comment">//</span>
<a name="l01619"></a>01619             <span class="comment">// Oddly the DIR bit is set to one for remote receivers.</span>
<a name="l01620"></a>01620             <span class="comment">//</span>
<a name="l01621"></a>01621             ui16ArbReg1 = <a class="code" href="hw__can_8h.html#aa1cfc44f626d46436b70bf5c6ab4b477">CAN_IF1ARB2_DIR</a>;
<a name="l01622"></a>01622 
<a name="l01623"></a>01623             <span class="comment">//</span>
<a name="l01624"></a>01624             <span class="comment">// Set this object to auto answer if a matching identifier is seen.</span>
<a name="l01625"></a>01625             <span class="comment">//</span>
<a name="l01626"></a>01626             ui16MsgCtrl = <a class="code" href="hw__can_8h.html#a1ce05e9b987ef87c70c797b0280b94fb">CAN_IF1MCTL_RMTEN</a> | <a class="code" href="hw__can_8h.html#a0e911f69ad77d25bf51ef1181de6880b">CAN_IF1MCTL_UMASK</a>;
<a name="l01627"></a>01627 
<a name="l01628"></a>01628             <span class="comment">//</span>
<a name="l01629"></a>01629             <span class="comment">// The data to be returned needs to be filled in.</span>
<a name="l01630"></a>01630             <span class="comment">//</span>
<a name="l01631"></a>01631             bTransferData = 1;
<a name="l01632"></a>01632             <span class="keywordflow">break</span>;
<a name="l01633"></a>01633         }
<a name="l01634"></a>01634 
<a name="l01635"></a>01635         <span class="comment">//</span>
<a name="l01636"></a>01636         <span class="comment">// This case never happens due to the ASSERT statement at the</span>
<a name="l01637"></a>01637         <span class="comment">// beginning of this function.</span>
<a name="l01638"></a>01638         <span class="comment">//</span>
<a name="l01639"></a>01639         <span class="keywordflow">default</span>:
<a name="l01640"></a>01640         {
<a name="l01641"></a>01641             <span class="keywordflow">return</span>;
<a name="l01642"></a>01642         }
<a name="l01643"></a>01643     }
<a name="l01644"></a>01644 
<a name="l01645"></a>01645     <span class="comment">//</span>
<a name="l01646"></a>01646     <span class="comment">// Configure the Mask Registers.</span>
<a name="l01647"></a>01647     <span class="comment">//</span>
<a name="l01648"></a>01648     <span class="keywordflow">if</span>(psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#ae86eceeafd1fa9ed8bfa64e2fe7a96af">ui32Flags</a> &amp; <a class="code" href="group__can__api.html#gac8b622ceb867ab7de6f285ae630c534a">MSG_OBJ_USE_ID_FILTER</a>)
<a name="l01649"></a>01649     {
<a name="l01650"></a>01650         <span class="keywordflow">if</span>(bUseExtendedID)
<a name="l01651"></a>01651         {
<a name="l01652"></a>01652             <span class="comment">//</span>
<a name="l01653"></a>01653             <span class="comment">// Set the 29 bits of Identifier mask that were requested.</span>
<a name="l01654"></a>01654             <span class="comment">//</span>
<a name="l01655"></a>01655             ui16MaskReg0 = psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#ac7eddb3056c07ae2a23a9326d756a255" title="The message identifier mask used when identifier filtering is enabled.">ui32MsgIDMask</a> &amp; <a class="code" href="hw__can_8h.html#aea08a0d7b0443f01fb9d8aba6dddc49e">CAN_IF1MSK1_IDMSK_M</a>;
<a name="l01656"></a>01656             ui16MaskReg1 = ((psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#ac7eddb3056c07ae2a23a9326d756a255" title="The message identifier mask used when identifier filtering is enabled.">ui32MsgIDMask</a> &gt;&gt; 16) &amp;
<a name="l01657"></a>01657                             <a class="code" href="hw__can_8h.html#a3a1ff4f3f8e143c4812610bda59d110f">CAN_IF1MSK2_IDMSK_M</a>);
<a name="l01658"></a>01658         }
<a name="l01659"></a>01659         <span class="keywordflow">else</span>
<a name="l01660"></a>01660         {
<a name="l01661"></a>01661             <span class="comment">//</span>
<a name="l01662"></a>01662             <span class="comment">// Lower 16 bit are unused so set them to zero.</span>
<a name="l01663"></a>01663             <span class="comment">//</span>
<a name="l01664"></a>01664             ui16MaskReg0 = 0;
<a name="l01665"></a>01665 
<a name="l01666"></a>01666             <span class="comment">//</span>
<a name="l01667"></a>01667             <span class="comment">// Put the 11 bit Mask Identifier into the upper bits of the field</span>
<a name="l01668"></a>01668             <span class="comment">// in the register.</span>
<a name="l01669"></a>01669             <span class="comment">//</span>
<a name="l01670"></a>01670             ui16MaskReg1 = ((psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#ac7eddb3056c07ae2a23a9326d756a255" title="The message identifier mask used when identifier filtering is enabled.">ui32MsgIDMask</a> &lt;&lt; 2) &amp;
<a name="l01671"></a>01671                             <a class="code" href="hw__can_8h.html#a3a1ff4f3f8e143c4812610bda59d110f">CAN_IF1MSK2_IDMSK_M</a>);
<a name="l01672"></a>01672         }
<a name="l01673"></a>01673     }
<a name="l01674"></a>01674 
<a name="l01675"></a>01675     <span class="comment">//</span>
<a name="l01676"></a>01676     <span class="comment">// If the caller wants to filter on the extended ID bit then set it.</span>
<a name="l01677"></a>01677     <span class="comment">//</span>
<a name="l01678"></a>01678     <span class="keywordflow">if</span>((psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#ae86eceeafd1fa9ed8bfa64e2fe7a96af">ui32Flags</a> &amp; <a class="code" href="group__can__api.html#gacead63b8e758f947f7aecf11d928e490">MSG_OBJ_USE_EXT_FILTER</a>) ==
<a name="l01679"></a>01679        <a class="code" href="group__can__api.html#gacead63b8e758f947f7aecf11d928e490">MSG_OBJ_USE_EXT_FILTER</a>)
<a name="l01680"></a>01680     {
<a name="l01681"></a>01681         ui16MaskReg1 |= <a class="code" href="hw__can_8h.html#a3b0a0eb1094a504a0d8cf4b2aa10340f">CAN_IF1MSK2_MXTD</a>;
<a name="l01682"></a>01682     }
<a name="l01683"></a>01683 
<a name="l01684"></a>01684     <span class="comment">//</span>
<a name="l01685"></a>01685     <span class="comment">// The caller wants to filter on the message direction field.</span>
<a name="l01686"></a>01686     <span class="comment">//</span>
<a name="l01687"></a>01687     <span class="keywordflow">if</span>((psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#ae86eceeafd1fa9ed8bfa64e2fe7a96af">ui32Flags</a> &amp; <a class="code" href="group__can__api.html#gabd8bebbc78a6f49c3c3088c5c7d53ca9">MSG_OBJ_USE_DIR_FILTER</a>) ==
<a name="l01688"></a>01688        <a class="code" href="group__can__api.html#gabd8bebbc78a6f49c3c3088c5c7d53ca9">MSG_OBJ_USE_DIR_FILTER</a>)
<a name="l01689"></a>01689     {
<a name="l01690"></a>01690         ui16MaskReg1 |= <a class="code" href="hw__can_8h.html#ae9fff4ea5089e7bef8455237fcce5d0d">CAN_IF1MSK2_MDIR</a>;
<a name="l01691"></a>01691     }
<a name="l01692"></a>01692 
<a name="l01693"></a>01693     <span class="keywordflow">if</span>(psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#ae86eceeafd1fa9ed8bfa64e2fe7a96af">ui32Flags</a> &amp;
<a name="l01694"></a>01694        (<a class="code" href="group__can__api.html#gac8b622ceb867ab7de6f285ae630c534a">MSG_OBJ_USE_ID_FILTER</a> | <a class="code" href="group__can__api.html#gabd8bebbc78a6f49c3c3088c5c7d53ca9">MSG_OBJ_USE_DIR_FILTER</a> |
<a name="l01695"></a>01695         <a class="code" href="group__can__api.html#gacead63b8e758f947f7aecf11d928e490">MSG_OBJ_USE_EXT_FILTER</a>))
<a name="l01696"></a>01696     {
<a name="l01697"></a>01697         <span class="comment">//</span>
<a name="l01698"></a>01698         <span class="comment">// Set the UMASK bit to enable using the mask register.</span>
<a name="l01699"></a>01699         <span class="comment">//</span>
<a name="l01700"></a>01700         ui16MsgCtrl |= <a class="code" href="hw__can_8h.html#a0e911f69ad77d25bf51ef1181de6880b">CAN_IF1MCTL_UMASK</a>;
<a name="l01701"></a>01701 
<a name="l01702"></a>01702         <span class="comment">//</span>
<a name="l01703"></a>01703         <span class="comment">// Set the MASK bit so that this gets transferred to the Message</span>
<a name="l01704"></a>01704         <span class="comment">// Object.</span>
<a name="l01705"></a>01705         <span class="comment">//</span>
<a name="l01706"></a>01706         ui16CmdMaskReg |= <a class="code" href="hw__can_8h.html#a3da272cd5f07203740b6d98d527b8b96">CAN_IF1CMSK_MASK</a>;
<a name="l01707"></a>01707     }
<a name="l01708"></a>01708 
<a name="l01709"></a>01709     <span class="comment">//</span>
<a name="l01710"></a>01710     <span class="comment">// Set the Arb bit so that this gets transferred to the Message object.</span>
<a name="l01711"></a>01711     <span class="comment">//</span>
<a name="l01712"></a>01712     ui16CmdMaskReg |= <a class="code" href="hw__can_8h.html#a46ff14762fa3eecad699c4c0a2f71944">CAN_IF1CMSK_ARB</a>;
<a name="l01713"></a>01713 
<a name="l01714"></a>01714     <span class="comment">//</span>
<a name="l01715"></a>01715     <span class="comment">// Configure the Arbitration registers.</span>
<a name="l01716"></a>01716     <span class="comment">//</span>
<a name="l01717"></a>01717     <span class="keywordflow">if</span>(bUseExtendedID)
<a name="l01718"></a>01718     {
<a name="l01719"></a>01719         <span class="comment">//</span>
<a name="l01720"></a>01720         <span class="comment">// Set the 29 bit version of the Identifier for this message object.</span>
<a name="l01721"></a>01721         <span class="comment">//</span>
<a name="l01722"></a>01722         ui16ArbReg0 |= psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#a12434ad39602e05b786c4481f756479e" title="The CAN message identifier used for 11 or 29 bit identifiers.">ui32MsgID</a> &amp; <a class="code" href="hw__can_8h.html#a3127889a0fb8304f4139d9a021419b2d">CAN_IF1ARB1_ID_M</a>;
<a name="l01723"></a>01723         ui16ArbReg1 |= (psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#a12434ad39602e05b786c4481f756479e" title="The CAN message identifier used for 11 or 29 bit identifiers.">ui32MsgID</a> &gt;&gt; 16) &amp; <a class="code" href="hw__can_8h.html#ae9d9fa5fda4f0e0f07fd1286f315bf51">CAN_IF1ARB2_ID_M</a>;
<a name="l01724"></a>01724 
<a name="l01725"></a>01725         <span class="comment">//</span>
<a name="l01726"></a>01726         <span class="comment">// Mark the message as valid and set the extended ID bit.</span>
<a name="l01727"></a>01727         <span class="comment">//</span>
<a name="l01728"></a>01728         ui16ArbReg1 |= <a class="code" href="hw__can_8h.html#ad41d0ad96c595704f772601b59e4d1a6">CAN_IF1ARB2_MSGVAL</a> | <a class="code" href="hw__can_8h.html#a97435ac5ad7528954c4587a5f63d520b">CAN_IF1ARB2_XTD</a>;
<a name="l01729"></a>01729     }
<a name="l01730"></a>01730     <span class="keywordflow">else</span>
<a name="l01731"></a>01731     {
<a name="l01732"></a>01732         <span class="comment">//</span>
<a name="l01733"></a>01733         <span class="comment">// Set the 11 bit version of the Identifier for this message object.</span>
<a name="l01734"></a>01734         <span class="comment">// The lower 18 bits are set to zero.</span>
<a name="l01735"></a>01735         <span class="comment">//</span>
<a name="l01736"></a>01736         ui16ArbReg1 |= (psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#a12434ad39602e05b786c4481f756479e" title="The CAN message identifier used for 11 or 29 bit identifiers.">ui32MsgID</a> &lt;&lt; 2) &amp; <a class="code" href="hw__can_8h.html#ae9d9fa5fda4f0e0f07fd1286f315bf51">CAN_IF1ARB2_ID_M</a>;
<a name="l01737"></a>01737 
<a name="l01738"></a>01738         <span class="comment">//</span>
<a name="l01739"></a>01739         <span class="comment">// Mark the message as valid.</span>
<a name="l01740"></a>01740         <span class="comment">//</span>
<a name="l01741"></a>01741         ui16ArbReg1 |= <a class="code" href="hw__can_8h.html#ad41d0ad96c595704f772601b59e4d1a6">CAN_IF1ARB2_MSGVAL</a>;
<a name="l01742"></a>01742     }
<a name="l01743"></a>01743 
<a name="l01744"></a>01744     <span class="comment">//</span>
<a name="l01745"></a>01745     <span class="comment">// Set the data length since this is set for all transfers.  This is also a</span>
<a name="l01746"></a>01746     <span class="comment">// single transfer and not a FIFO transfer so set EOB bit.</span>
<a name="l01747"></a>01747     <span class="comment">//</span>
<a name="l01748"></a>01748     ui16MsgCtrl |= (psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#a91908872e366b6ec24f4845aae9a488f" title="This value is the number of bytes of data in the message object.">ui32MsgLen</a> &amp; <a class="code" href="hw__can_8h.html#ac35986ffbbc66e48a14dca6b41bd2ac4">CAN_IF1MCTL_DLC_M</a>);
<a name="l01749"></a>01749 
<a name="l01750"></a>01750     <span class="comment">//</span>
<a name="l01751"></a>01751     <span class="comment">// Mark this as the last entry if this is not the last entry in a FIFO.</span>
<a name="l01752"></a>01752     <span class="comment">//</span>
<a name="l01753"></a>01753     <span class="keywordflow">if</span>((psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#ae86eceeafd1fa9ed8bfa64e2fe7a96af">ui32Flags</a> &amp; <a class="code" href="group__can__api.html#ga5e3141ec2c5c1130f5c8c0601ce9e614">MSG_OBJ_FIFO</a>) == 0)
<a name="l01754"></a>01754     {
<a name="l01755"></a>01755         ui16MsgCtrl |= <a class="code" href="hw__can_8h.html#acaf249bdfbec88c5dadb8bee297249aa">CAN_IF1MCTL_EOB</a>;
<a name="l01756"></a>01756     }
<a name="l01757"></a>01757 
<a name="l01758"></a>01758     <span class="comment">//</span>
<a name="l01759"></a>01759     <span class="comment">// Enable transmit interrupts if they should be enabled.</span>
<a name="l01760"></a>01760     <span class="comment">//</span>
<a name="l01761"></a>01761     <span class="keywordflow">if</span>(psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#ae86eceeafd1fa9ed8bfa64e2fe7a96af">ui32Flags</a> &amp; <a class="code" href="group__can__api.html#ga72160bfa35ab86bf0e68c1e2c2dd67a2" title="This indicates that transmit interrupts are enabled.">MSG_OBJ_TX_INT_ENABLE</a>)
<a name="l01762"></a>01762     {
<a name="l01763"></a>01763         ui16MsgCtrl |= <a class="code" href="hw__can_8h.html#a8ecb8e7b5de7eecb2c3081618c7b4732">CAN_IF1MCTL_TXIE</a>;
<a name="l01764"></a>01764     }
<a name="l01765"></a>01765 
<a name="l01766"></a>01766     <span class="comment">//</span>
<a name="l01767"></a>01767     <span class="comment">// Enable receive interrupts if they should be enabled.</span>
<a name="l01768"></a>01768     <span class="comment">//</span>
<a name="l01769"></a>01769     <span class="keywordflow">if</span>(psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#ae86eceeafd1fa9ed8bfa64e2fe7a96af">ui32Flags</a> &amp; <a class="code" href="group__can__api.html#ga8e611898e5a16c95b1e9ed517d84b463" title="This indicates that receive interrupts are enabled.">MSG_OBJ_RX_INT_ENABLE</a>)
<a name="l01770"></a>01770     {
<a name="l01771"></a>01771         ui16MsgCtrl |= <a class="code" href="hw__can_8h.html#aacf3956de09eb53abad09494b93ea303">CAN_IF1MCTL_RXIE</a>;
<a name="l01772"></a>01772     }
<a name="l01773"></a>01773 
<a name="l01774"></a>01774     <span class="comment">//</span>
<a name="l01775"></a>01775     <span class="comment">// Write the data out to the CAN Data registers if needed.</span>
<a name="l01776"></a>01776     <span class="comment">//</span>
<a name="l01777"></a>01777     <span class="keywordflow">if</span>(bTransferData)
<a name="l01778"></a>01778     {
<a name="l01779"></a>01779         <a class="code" href="group__can__api.html#ga3d8f21919db8e292ff037998ecf15709">_CANDataRegWrite</a>(psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#af7a37948b3b1a02549e2d303e1a9e6b5" title="This is a pointer to the message object&#39;s data.">pui8MsgData</a>,
<a name="l01780"></a>01780                          (uint32_t *)(ui32Base + <a class="code" href="hw__can_8h.html#a3d517a687906ff5c43d956400ef43cb4">CAN_O_IF1DA1</a>),
<a name="l01781"></a>01781                          psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#a91908872e366b6ec24f4845aae9a488f" title="This value is the number of bytes of data in the message object.">ui32MsgLen</a>);
<a name="l01782"></a>01782     }
<a name="l01783"></a>01783 
<a name="l01784"></a>01784     <span class="comment">//</span>
<a name="l01785"></a>01785     <span class="comment">// Write out the registers to program the message object.</span>
<a name="l01786"></a>01786     <span class="comment">//</span>
<a name="l01787"></a>01787     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#ab5120f8aeba67f0995a7c927319ee946">CAN_O_IF1CMSK</a>) = ui16CmdMaskReg;
<a name="l01788"></a>01788     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a5d1ac383cc1125c32d59d63c005613bc">CAN_O_IF1MSK1</a>) = ui16MaskReg0;
<a name="l01789"></a>01789     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a6aaaaa7ab722fc351296ce2223aaedd3">CAN_O_IF1MSK2</a>) = ui16MaskReg1;
<a name="l01790"></a>01790     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a68176ba0dc933965675f6b98a284b700">CAN_O_IF1ARB1</a>) = ui16ArbReg0;
<a name="l01791"></a>01791     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a0d2f3fe713653778679b768f25248479">CAN_O_IF1ARB2</a>) = ui16ArbReg1;
<a name="l01792"></a>01792     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a6185cdff241a27e6b569c0925081d85d">CAN_O_IF1MCTL</a>) = ui16MsgCtrl;
<a name="l01793"></a>01793 
<a name="l01794"></a>01794     <span class="comment">//</span>
<a name="l01795"></a>01795     <span class="comment">// Transfer the message object to the message object specified by</span>
<a name="l01796"></a>01796     <span class="comment">// ui32ObjID.</span>
<a name="l01797"></a>01797     <span class="comment">//</span>
<a name="l01798"></a>01798     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a429984ce40dd20eb6966e1d365d90238">CAN_O_IF1CRQ</a>) = ui32ObjID &amp; <a class="code" href="hw__can_8h.html#ab55e3e802b91a63c8adec7b5b70a989b">CAN_IF1CRQ_MNUM_M</a>;
<a name="l01799"></a>01799 }
<a name="l01800"></a>01800 
<a name="l01801"></a>01801 <span class="comment">//*****************************************************************************</span>
<a name="l01802"></a>01802 <span class="comment">//</span>
<a name="l01835"></a>01835 <span class="comment"></span><span class="comment">//</span>
<a name="l01836"></a>01836 <span class="comment">//*****************************************************************************</span>
<a name="l01837"></a>01837 <span class="keywordtype">void</span>
<a name="l01838"></a><a class="code" href="group__can__api.html#ga6507fad88a2123ac26c04411143be191">01838</a> <a class="code" href="group__can__api.html#ga6507fad88a2123ac26c04411143be191">CANMessageGet</a>(uint32_t ui32Base, uint32_t ui32ObjID,
<a name="l01839"></a>01839               <a class="code" href="structt_c_a_n_msg_object.html">tCANMsgObject</a> *psMsgObject, <span class="keywordtype">bool</span> bClrPendingInt)
<a name="l01840"></a>01840 {
<a name="l01841"></a>01841     uint16_t ui16CmdMaskReg;
<a name="l01842"></a>01842     uint16_t ui16MaskReg0, ui16MaskReg1;
<a name="l01843"></a>01843     uint16_t ui16ArbReg0, ui16ArbReg1;
<a name="l01844"></a>01844     uint16_t ui16MsgCtrl;
<a name="l01845"></a>01845 
<a name="l01846"></a>01846     <span class="comment">//</span>
<a name="l01847"></a>01847     <span class="comment">// Check the arguments.</span>
<a name="l01848"></a>01848     <span class="comment">//</span>
<a name="l01849"></a>01849     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(_CANBaseValid(ui32Base));
<a name="l01850"></a>01850     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>((ui32ObjID &lt;= 32) &amp;&amp; (ui32ObjID != 0));
<a name="l01851"></a>01851 
<a name="l01852"></a>01852     <span class="comment">//</span>
<a name="l01853"></a>01853     <span class="comment">// This is always a read to the Message object as this call is setting a</span>
<a name="l01854"></a>01854     <span class="comment">// message object.</span>
<a name="l01855"></a>01855     <span class="comment">//</span>
<a name="l01856"></a>01856     ui16CmdMaskReg = (<a class="code" href="hw__can_8h.html#a9acd5e5e84d4ec86afcf8b8c2c884248">CAN_IF1CMSK_DATAA</a> | <a class="code" href="hw__can_8h.html#ae0a8df1a3d309780888bb9019de5994a">CAN_IF1CMSK_DATAB</a> |
<a name="l01857"></a>01857                       <a class="code" href="hw__can_8h.html#ae67ae84bd00fc509ed7a025f1608fc29">CAN_IF1CMSK_CONTROL</a> | <a class="code" href="hw__can_8h.html#a3da272cd5f07203740b6d98d527b8b96">CAN_IF1CMSK_MASK</a> |
<a name="l01858"></a>01858                       <a class="code" href="hw__can_8h.html#a46ff14762fa3eecad699c4c0a2f71944">CAN_IF1CMSK_ARB</a>);
<a name="l01859"></a>01859 
<a name="l01860"></a>01860     <span class="comment">//</span>
<a name="l01861"></a>01861     <span class="comment">// Clear a pending interrupt and new data in a message object.</span>
<a name="l01862"></a>01862     <span class="comment">//</span>
<a name="l01863"></a>01863     <span class="keywordflow">if</span>(bClrPendingInt)
<a name="l01864"></a>01864     {
<a name="l01865"></a>01865         ui16CmdMaskReg |= <a class="code" href="hw__can_8h.html#aa57248d35f2b29e2a2f8e9fe684e7677">CAN_IF1CMSK_CLRINTPND</a>;
<a name="l01866"></a>01866     }
<a name="l01867"></a>01867 
<a name="l01868"></a>01868     <span class="comment">//</span>
<a name="l01869"></a>01869     <span class="comment">// Set up the request for data from the message object.</span>
<a name="l01870"></a>01870     <span class="comment">//</span>
<a name="l01871"></a>01871     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a4f7da1a0490cf7df133acbf8ec6207a9">CAN_O_IF2CMSK</a>) = ui16CmdMaskReg;
<a name="l01872"></a>01872 
<a name="l01873"></a>01873     <span class="comment">//</span>
<a name="l01874"></a>01874     <span class="comment">// Transfer the message object to the message object specified by</span>
<a name="l01875"></a>01875     <span class="comment">// ui32ObjID.</span>
<a name="l01876"></a>01876     <span class="comment">//</span>
<a name="l01877"></a>01877     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#aad380f0222a46d5a5e4221a05f430eee">CAN_O_IF2CRQ</a>) = ui32ObjID &amp; <a class="code" href="hw__can_8h.html#ab55e3e802b91a63c8adec7b5b70a989b">CAN_IF1CRQ_MNUM_M</a>;
<a name="l01878"></a>01878 
<a name="l01879"></a>01879     <span class="comment">//</span>
<a name="l01880"></a>01880     <span class="comment">// Wait for busy bit to clear</span>
<a name="l01881"></a>01881     <span class="comment">//</span>
<a name="l01882"></a>01882     <span class="keywordflow">while</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#aad380f0222a46d5a5e4221a05f430eee">CAN_O_IF2CRQ</a>) &amp; <a class="code" href="hw__can_8h.html#acdefd7830a26bca16b676dba5598b66d">CAN_IF1CRQ_BUSY</a>)
<a name="l01883"></a>01883     {
<a name="l01884"></a>01884     }
<a name="l01885"></a>01885 
<a name="l01886"></a>01886     <span class="comment">//</span>
<a name="l01887"></a>01887     <span class="comment">// Read out the IF Registers.</span>
<a name="l01888"></a>01888     <span class="comment">//</span>
<a name="l01889"></a>01889     ui16MaskReg0 = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a05185eff2449d2828a425125a5b148ac">CAN_O_IF2MSK1</a>);
<a name="l01890"></a>01890     ui16MaskReg1 = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a0d30c01397e796023a3e624810b87a5a">CAN_O_IF2MSK2</a>);
<a name="l01891"></a>01891     ui16ArbReg0 = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a26af0e3cc07026ebc4e80daf01ecd1b9">CAN_O_IF2ARB1</a>);
<a name="l01892"></a>01892     ui16ArbReg1 = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a84446b7bc5a73af3e17f9c8fdd21094e">CAN_O_IF2ARB2</a>);
<a name="l01893"></a>01893     ui16MsgCtrl = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#ac1980991018e4f4d090c6bfc374612d6">CAN_O_IF2MCTL</a>);
<a name="l01894"></a>01894 
<a name="l01895"></a>01895     psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#ae86eceeafd1fa9ed8bfa64e2fe7a96af">ui32Flags</a> = <a class="code" href="group__can__api.html#gac72c7dc1fe5ae5e73682f9602e9c92c7" title="This indicates that a message object has no flags set.">MSG_OBJ_NO_FLAGS</a>;
<a name="l01896"></a>01896 
<a name="l01897"></a>01897     <span class="comment">//</span>
<a name="l01898"></a>01898     <span class="comment">// Determine if this is a remote frame by checking the TXRQST and DIR bits.</span>
<a name="l01899"></a>01899     <span class="comment">//</span>
<a name="l01900"></a>01900     <span class="keywordflow">if</span>((!(ui16MsgCtrl &amp; <a class="code" href="hw__can_8h.html#a6ea1b9778334e424cf2bb31dff9eef84">CAN_IF1MCTL_TXRQST</a>) &amp;&amp;
<a name="l01901"></a>01901         (ui16ArbReg1 &amp; <a class="code" href="hw__can_8h.html#aa1cfc44f626d46436b70bf5c6ab4b477">CAN_IF1ARB2_DIR</a>)) ||
<a name="l01902"></a>01902        ((ui16MsgCtrl &amp; CAN_IF1MCTL_TXRQST) &amp;&amp;
<a name="l01903"></a>01903         (!(ui16ArbReg1 &amp; CAN_IF1ARB2_DIR))))
<a name="l01904"></a>01904     {
<a name="l01905"></a>01905         psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#ae86eceeafd1fa9ed8bfa64e2fe7a96af">ui32Flags</a> |= <a class="code" href="group__can__api.html#gaba15117b85b019f6e907fcadd0333a8f" title="This indicates that a message object is a remote frame.">MSG_OBJ_REMOTE_FRAME</a>;
<a name="l01906"></a>01906     }
<a name="l01907"></a>01907 
<a name="l01908"></a>01908     <span class="comment">//</span>
<a name="l01909"></a>01909     <span class="comment">// Get the identifier out of the register, the format depends on size of</span>
<a name="l01910"></a>01910     <span class="comment">// the mask.</span>
<a name="l01911"></a>01911     <span class="comment">//</span>
<a name="l01912"></a>01912     <span class="keywordflow">if</span>(ui16ArbReg1 &amp; <a class="code" href="hw__can_8h.html#a97435ac5ad7528954c4587a5f63d520b">CAN_IF1ARB2_XTD</a>)
<a name="l01913"></a>01913     {
<a name="l01914"></a>01914         <span class="comment">//</span>
<a name="l01915"></a>01915         <span class="comment">// Set the 29 bit version of the Identifier for this message object.</span>
<a name="l01916"></a>01916         <span class="comment">//</span>
<a name="l01917"></a>01917         psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#a12434ad39602e05b786c4481f756479e" title="The CAN message identifier used for 11 or 29 bit identifiers.">ui32MsgID</a> = (((ui16ArbReg1 &amp; <a class="code" href="hw__can_8h.html#ae9d9fa5fda4f0e0f07fd1286f315bf51">CAN_IF1ARB2_ID_M</a>) &lt;&lt; 16) |
<a name="l01918"></a>01918                                   ui16ArbReg0);
<a name="l01919"></a>01919 
<a name="l01920"></a>01920         psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#ae86eceeafd1fa9ed8bfa64e2fe7a96af">ui32Flags</a> |= <a class="code" href="group__can__api.html#ga9387d98cd6262e0be419aceab45295e4" title="This indicates that a message object is using an extended identifier.">MSG_OBJ_EXTENDED_ID</a>;
<a name="l01921"></a>01921     }
<a name="l01922"></a>01922     <span class="keywordflow">else</span>
<a name="l01923"></a>01923     {
<a name="l01924"></a>01924         <span class="comment">//</span>
<a name="l01925"></a>01925         <span class="comment">// The Identifier is an 11 bit value.</span>
<a name="l01926"></a>01926         <span class="comment">//</span>
<a name="l01927"></a>01927         psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#a12434ad39602e05b786c4481f756479e" title="The CAN message identifier used for 11 or 29 bit identifiers.">ui32MsgID</a> = (ui16ArbReg1 &amp; <a class="code" href="hw__can_8h.html#ae9d9fa5fda4f0e0f07fd1286f315bf51">CAN_IF1ARB2_ID_M</a>) &gt;&gt; 2;
<a name="l01928"></a>01928     }
<a name="l01929"></a>01929 
<a name="l01930"></a>01930     <span class="comment">//</span>
<a name="l01931"></a>01931     <span class="comment">// Indicate that we lost some data.</span>
<a name="l01932"></a>01932     <span class="comment">//</span>
<a name="l01933"></a>01933     <span class="keywordflow">if</span>(ui16MsgCtrl &amp; <a class="code" href="hw__can_8h.html#a7813ecbdd30247499d4339a4344d4102">CAN_IF1MCTL_MSGLST</a>)
<a name="l01934"></a>01934     {
<a name="l01935"></a>01935         psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#ae86eceeafd1fa9ed8bfa64e2fe7a96af">ui32Flags</a> |= <a class="code" href="group__can__api.html#ga6405afc8e3cc146889ea8bc32bd0f0ca">MSG_OBJ_DATA_LOST</a>;
<a name="l01936"></a>01936     }
<a name="l01937"></a>01937 
<a name="l01938"></a>01938     <span class="comment">//</span>
<a name="l01939"></a>01939     <span class="comment">// Set the flag to indicate if ID masking was used.</span>
<a name="l01940"></a>01940     <span class="comment">//</span>
<a name="l01941"></a>01941     <span class="keywordflow">if</span>(ui16MsgCtrl &amp; <a class="code" href="hw__can_8h.html#a0e911f69ad77d25bf51ef1181de6880b">CAN_IF1MCTL_UMASK</a>)
<a name="l01942"></a>01942     {
<a name="l01943"></a>01943         <span class="keywordflow">if</span>(ui16ArbReg1 &amp; CAN_IF1ARB2_XTD)
<a name="l01944"></a>01944         {
<a name="l01945"></a>01945             <span class="comment">//</span>
<a name="l01946"></a>01946             <span class="comment">// The Identifier Mask is assumed to also be a 29 bit value.</span>
<a name="l01947"></a>01947             <span class="comment">//</span>
<a name="l01948"></a>01948             psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#ac7eddb3056c07ae2a23a9326d756a255" title="The message identifier mask used when identifier filtering is enabled.">ui32MsgIDMask</a> =
<a name="l01949"></a>01949                 ((ui16MaskReg1 &amp; <a class="code" href="hw__can_8h.html#a3a1ff4f3f8e143c4812610bda59d110f">CAN_IF1MSK2_IDMSK_M</a>) &lt;&lt; 16) | ui16MaskReg0;
<a name="l01950"></a>01950 
<a name="l01951"></a>01951             <span class="comment">//</span>
<a name="l01952"></a>01952             <span class="comment">// If this is a fully specified Mask and a remote frame then don&#39;t</span>
<a name="l01953"></a>01953             <span class="comment">// set the MSG_OBJ_USE_ID_FILTER because the ID was not really</span>
<a name="l01954"></a>01954             <span class="comment">// filtered.</span>
<a name="l01955"></a>01955             <span class="comment">//</span>
<a name="l01956"></a>01956             <span class="keywordflow">if</span>((psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#ac7eddb3056c07ae2a23a9326d756a255" title="The message identifier mask used when identifier filtering is enabled.">ui32MsgIDMask</a> != 0x1fffffff) ||
<a name="l01957"></a>01957                ((psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#ae86eceeafd1fa9ed8bfa64e2fe7a96af">ui32Flags</a> &amp; <a class="code" href="group__can__api.html#gaba15117b85b019f6e907fcadd0333a8f" title="This indicates that a message object is a remote frame.">MSG_OBJ_REMOTE_FRAME</a>) == 0))
<a name="l01958"></a>01958             {
<a name="l01959"></a>01959                 psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#ae86eceeafd1fa9ed8bfa64e2fe7a96af">ui32Flags</a> |= <a class="code" href="group__can__api.html#gac8b622ceb867ab7de6f285ae630c534a">MSG_OBJ_USE_ID_FILTER</a>;
<a name="l01960"></a>01960             }
<a name="l01961"></a>01961         }
<a name="l01962"></a>01962         <span class="keywordflow">else</span>
<a name="l01963"></a>01963         {
<a name="l01964"></a>01964             <span class="comment">//</span>
<a name="l01965"></a>01965             <span class="comment">// The Identifier Mask is assumed to also be an 11 bit value.</span>
<a name="l01966"></a>01966             <span class="comment">//</span>
<a name="l01967"></a>01967             psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#ac7eddb3056c07ae2a23a9326d756a255" title="The message identifier mask used when identifier filtering is enabled.">ui32MsgIDMask</a> =
<a name="l01968"></a>01968                 (ui16MaskReg1 &amp; <a class="code" href="hw__can_8h.html#a3a1ff4f3f8e143c4812610bda59d110f">CAN_IF1MSK2_IDMSK_M</a>) &gt;&gt; 2;
<a name="l01969"></a>01969 
<a name="l01970"></a>01970             <span class="comment">//</span>
<a name="l01971"></a>01971             <span class="comment">// If this is a fully specified Mask and a remote frame then don&#39;t</span>
<a name="l01972"></a>01972             <span class="comment">// set the MSG_OBJ_USE_ID_FILTER because the ID was not really</span>
<a name="l01973"></a>01973             <span class="comment">// filtered.</span>
<a name="l01974"></a>01974             <span class="comment">//</span>
<a name="l01975"></a>01975             <span class="keywordflow">if</span>((psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#ac7eddb3056c07ae2a23a9326d756a255" title="The message identifier mask used when identifier filtering is enabled.">ui32MsgIDMask</a> != 0x7ff) ||
<a name="l01976"></a>01976                ((psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#ae86eceeafd1fa9ed8bfa64e2fe7a96af">ui32Flags</a> &amp; <a class="code" href="group__can__api.html#gaba15117b85b019f6e907fcadd0333a8f" title="This indicates that a message object is a remote frame.">MSG_OBJ_REMOTE_FRAME</a>) == 0))
<a name="l01977"></a>01977             {
<a name="l01978"></a>01978                 psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#ae86eceeafd1fa9ed8bfa64e2fe7a96af">ui32Flags</a> |= <a class="code" href="group__can__api.html#gac8b622ceb867ab7de6f285ae630c534a">MSG_OBJ_USE_ID_FILTER</a>;
<a name="l01979"></a>01979             }
<a name="l01980"></a>01980         }
<a name="l01981"></a>01981 
<a name="l01982"></a>01982         <span class="comment">//</span>
<a name="l01983"></a>01983         <span class="comment">// Indicate if the extended bit was used in filtering.</span>
<a name="l01984"></a>01984         <span class="comment">//</span>
<a name="l01985"></a>01985         <span class="keywordflow">if</span>(ui16MaskReg1 &amp; <a class="code" href="hw__can_8h.html#a3b0a0eb1094a504a0d8cf4b2aa10340f">CAN_IF1MSK2_MXTD</a>)
<a name="l01986"></a>01986         {
<a name="l01987"></a>01987             psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#ae86eceeafd1fa9ed8bfa64e2fe7a96af">ui32Flags</a> |= <a class="code" href="group__can__api.html#gacead63b8e758f947f7aecf11d928e490">MSG_OBJ_USE_EXT_FILTER</a>;
<a name="l01988"></a>01988         }
<a name="l01989"></a>01989 
<a name="l01990"></a>01990         <span class="comment">//</span>
<a name="l01991"></a>01991         <span class="comment">// Indicate if direction filtering was enabled.</span>
<a name="l01992"></a>01992         <span class="comment">//</span>
<a name="l01993"></a>01993         <span class="keywordflow">if</span>(ui16MaskReg1 &amp; <a class="code" href="hw__can_8h.html#ae9fff4ea5089e7bef8455237fcce5d0d">CAN_IF1MSK2_MDIR</a>)
<a name="l01994"></a>01994         {
<a name="l01995"></a>01995             psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#ae86eceeafd1fa9ed8bfa64e2fe7a96af">ui32Flags</a> |= <a class="code" href="group__can__api.html#gabd8bebbc78a6f49c3c3088c5c7d53ca9">MSG_OBJ_USE_DIR_FILTER</a>;
<a name="l01996"></a>01996         }
<a name="l01997"></a>01997     }
<a name="l01998"></a>01998 
<a name="l01999"></a>01999     <span class="comment">//</span>
<a name="l02000"></a>02000     <span class="comment">// Set the interrupt flags.</span>
<a name="l02001"></a>02001     <span class="comment">//</span>
<a name="l02002"></a>02002     <span class="keywordflow">if</span>(ui16MsgCtrl &amp; <a class="code" href="hw__can_8h.html#a8ecb8e7b5de7eecb2c3081618c7b4732">CAN_IF1MCTL_TXIE</a>)
<a name="l02003"></a>02003     {
<a name="l02004"></a>02004         psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#ae86eceeafd1fa9ed8bfa64e2fe7a96af">ui32Flags</a> |= <a class="code" href="group__can__api.html#ga72160bfa35ab86bf0e68c1e2c2dd67a2" title="This indicates that transmit interrupts are enabled.">MSG_OBJ_TX_INT_ENABLE</a>;
<a name="l02005"></a>02005     }
<a name="l02006"></a>02006     <span class="keywordflow">if</span>(ui16MsgCtrl &amp; <a class="code" href="hw__can_8h.html#aacf3956de09eb53abad09494b93ea303">CAN_IF1MCTL_RXIE</a>)
<a name="l02007"></a>02007     {
<a name="l02008"></a>02008         psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#ae86eceeafd1fa9ed8bfa64e2fe7a96af">ui32Flags</a> |= <a class="code" href="group__can__api.html#ga8e611898e5a16c95b1e9ed517d84b463" title="This indicates that receive interrupts are enabled.">MSG_OBJ_RX_INT_ENABLE</a>;
<a name="l02009"></a>02009     }
<a name="l02010"></a>02010 
<a name="l02011"></a>02011     <span class="comment">//</span>
<a name="l02012"></a>02012     <span class="comment">// See if there is new data available.</span>
<a name="l02013"></a>02013     <span class="comment">//</span>
<a name="l02014"></a>02014     <span class="keywordflow">if</span>(ui16MsgCtrl &amp; <a class="code" href="hw__can_8h.html#aee0a1ed309d4e8d2685762f6cd147265">CAN_IF1MCTL_NEWDAT</a>)
<a name="l02015"></a>02015     {
<a name="l02016"></a>02016         <span class="comment">//</span>
<a name="l02017"></a>02017         <span class="comment">// Get the amount of data needed to be read.</span>
<a name="l02018"></a>02018         <span class="comment">//</span>
<a name="l02019"></a>02019         psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#a91908872e366b6ec24f4845aae9a488f" title="This value is the number of bytes of data in the message object.">ui32MsgLen</a> = (ui16MsgCtrl &amp; <a class="code" href="hw__can_8h.html#ac35986ffbbc66e48a14dca6b41bd2ac4">CAN_IF1MCTL_DLC_M</a>);
<a name="l02020"></a>02020 
<a name="l02021"></a>02021         <span class="comment">//</span>
<a name="l02022"></a>02022         <span class="comment">// Don&#39;t read any data for a remote frame, there is nothing valid in</span>
<a name="l02023"></a>02023         <span class="comment">// that buffer anyway.</span>
<a name="l02024"></a>02024         <span class="comment">//</span>
<a name="l02025"></a>02025         <span class="keywordflow">if</span>((psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#ae86eceeafd1fa9ed8bfa64e2fe7a96af">ui32Flags</a> &amp; <a class="code" href="group__can__api.html#gaba15117b85b019f6e907fcadd0333a8f" title="This indicates that a message object is a remote frame.">MSG_OBJ_REMOTE_FRAME</a>) == 0)
<a name="l02026"></a>02026         {
<a name="l02027"></a>02027             <span class="comment">//</span>
<a name="l02028"></a>02028             <span class="comment">// Read out the data from the CAN registers.</span>
<a name="l02029"></a>02029             <span class="comment">//</span>
<a name="l02030"></a>02030             <a class="code" href="group__can__api.html#ga315ed01dbcf5bb82cba6bb5cb3ea59c9">_CANDataRegRead</a>(psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#af7a37948b3b1a02549e2d303e1a9e6b5" title="This is a pointer to the message object&#39;s data.">pui8MsgData</a>,
<a name="l02031"></a>02031                             (uint32_t *)(ui32Base + <a class="code" href="hw__can_8h.html#aca77f49a63c4ddd4d2d4a84f9e0128b2">CAN_O_IF2DA1</a>),
<a name="l02032"></a>02032                             psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#a91908872e366b6ec24f4845aae9a488f" title="This value is the number of bytes of data in the message object.">ui32MsgLen</a>);
<a name="l02033"></a>02033         }
<a name="l02034"></a>02034 
<a name="l02035"></a>02035         <span class="comment">//</span>
<a name="l02036"></a>02036         <span class="comment">// Now clear out the new data flag.</span>
<a name="l02037"></a>02037         <span class="comment">//</span>
<a name="l02038"></a>02038         <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a4f7da1a0490cf7df133acbf8ec6207a9">CAN_O_IF2CMSK</a>) = <a class="code" href="hw__can_8h.html#a6ea0427c10c0b69d8da0cc5c8be449ea">CAN_IF1CMSK_NEWDAT</a>;
<a name="l02039"></a>02039 
<a name="l02040"></a>02040         <span class="comment">//</span>
<a name="l02041"></a>02041         <span class="comment">// Transfer the message object to the message object specified by</span>
<a name="l02042"></a>02042         <span class="comment">// ui32ObjID.</span>
<a name="l02043"></a>02043         <span class="comment">//</span>
<a name="l02044"></a>02044         <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#aad380f0222a46d5a5e4221a05f430eee">CAN_O_IF2CRQ</a>) = ui32ObjID &amp; <a class="code" href="hw__can_8h.html#ab55e3e802b91a63c8adec7b5b70a989b">CAN_IF1CRQ_MNUM_M</a>;
<a name="l02045"></a>02045 
<a name="l02046"></a>02046         <span class="comment">//</span>
<a name="l02047"></a>02047         <span class="comment">// Wait for busy bit to clear</span>
<a name="l02048"></a>02048         <span class="comment">//</span>
<a name="l02049"></a>02049         <span class="keywordflow">while</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#aad380f0222a46d5a5e4221a05f430eee">CAN_O_IF2CRQ</a>) &amp; CAN_IF1CRQ_BUSY)
<a name="l02050"></a>02050         {
<a name="l02051"></a>02051         }
<a name="l02052"></a>02052 
<a name="l02053"></a>02053         <span class="comment">//</span>
<a name="l02054"></a>02054         <span class="comment">// Indicate that there is new data in this message.</span>
<a name="l02055"></a>02055         <span class="comment">//</span>
<a name="l02056"></a>02056         psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#ae86eceeafd1fa9ed8bfa64e2fe7a96af">ui32Flags</a> |= <a class="code" href="group__can__api.html#ga3c0e245fe4dcf8cb1d987c6a4ff3fc0a" title="This indicates that new data was available in the message object.">MSG_OBJ_NEW_DATA</a>;
<a name="l02057"></a>02057     }
<a name="l02058"></a>02058     <span class="keywordflow">else</span>
<a name="l02059"></a>02059     {
<a name="l02060"></a>02060         <span class="comment">//</span>
<a name="l02061"></a>02061         <span class="comment">// Along with the MSG_OBJ_NEW_DATA not being set the amount of data</span>
<a name="l02062"></a>02062         <span class="comment">// needs to be set to zero if none was available.</span>
<a name="l02063"></a>02063         <span class="comment">//</span>
<a name="l02064"></a>02064         psMsgObject-&gt;<a class="code" href="structt_c_a_n_msg_object.html#a91908872e366b6ec24f4845aae9a488f" title="This value is the number of bytes of data in the message object.">ui32MsgLen</a> = 0;
<a name="l02065"></a>02065     }
<a name="l02066"></a>02066 }
<a name="l02067"></a>02067 
<a name="l02068"></a>02068 <span class="comment">//*****************************************************************************</span>
<a name="l02069"></a>02069 <span class="comment">//</span>
<a name="l02080"></a>02080 <span class="comment"></span><span class="comment">//</span>
<a name="l02081"></a>02081 <span class="comment">//*****************************************************************************</span>
<a name="l02082"></a>02082 <span class="keywordtype">void</span>
<a name="l02083"></a><a class="code" href="group__can__api.html#ga70fdd8a4584e71e353ffce33c76c2a8f">02083</a> <a class="code" href="group__can__api.html#ga70fdd8a4584e71e353ffce33c76c2a8f">CANMessageClear</a>(uint32_t ui32Base, uint32_t ui32ObjID)
<a name="l02084"></a>02084 {
<a name="l02085"></a>02085     <span class="comment">//</span>
<a name="l02086"></a>02086     <span class="comment">// Check the arguments.</span>
<a name="l02087"></a>02087     <span class="comment">//</span>
<a name="l02088"></a>02088     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(_CANBaseValid(ui32Base));
<a name="l02089"></a>02089     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>((ui32ObjID &gt;= 1) &amp;&amp; (ui32ObjID &lt;= 32));
<a name="l02090"></a>02090 
<a name="l02091"></a>02091     <span class="comment">//</span>
<a name="l02092"></a>02092     <span class="comment">// Wait for busy bit to clear</span>
<a name="l02093"></a>02093     <span class="comment">//</span>
<a name="l02094"></a>02094     <span class="keywordflow">while</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a429984ce40dd20eb6966e1d365d90238">CAN_O_IF1CRQ</a>) &amp; <a class="code" href="hw__can_8h.html#acdefd7830a26bca16b676dba5598b66d">CAN_IF1CRQ_BUSY</a>)
<a name="l02095"></a>02095     {
<a name="l02096"></a>02096     }
<a name="l02097"></a>02097 
<a name="l02098"></a>02098     <span class="comment">//</span>
<a name="l02099"></a>02099     <span class="comment">// Clear the message value bit in the arbitration register.  This indicates</span>
<a name="l02100"></a>02100     <span class="comment">// the message is not valid.</span>
<a name="l02101"></a>02101     <span class="comment">//</span>
<a name="l02102"></a>02102     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#ab5120f8aeba67f0995a7c927319ee946">CAN_O_IF1CMSK</a>) = <a class="code" href="hw__can_8h.html#af00e227e4d72a2b47cfd5a31bf3b261d">CAN_IF1CMSK_WRNRD</a> | <a class="code" href="hw__can_8h.html#a46ff14762fa3eecad699c4c0a2f71944">CAN_IF1CMSK_ARB</a>;
<a name="l02103"></a>02103     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a68176ba0dc933965675f6b98a284b700">CAN_O_IF1ARB1</a>) = 0;
<a name="l02104"></a>02104     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a0d2f3fe713653778679b768f25248479">CAN_O_IF1ARB2</a>) = 0;
<a name="l02105"></a>02105 
<a name="l02106"></a>02106     <span class="comment">//</span>
<a name="l02107"></a>02107     <span class="comment">// Initiate programming the message object</span>
<a name="l02108"></a>02108     <span class="comment">//</span>
<a name="l02109"></a>02109     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__can_8h.html#a429984ce40dd20eb6966e1d365d90238">CAN_O_IF1CRQ</a>) = ui32ObjID &amp; <a class="code" href="hw__can_8h.html#ab55e3e802b91a63c8adec7b5b70a989b">CAN_IF1CRQ_MNUM_M</a>;
<a name="l02110"></a>02110 }
<a name="l02111"></a>02111 
<a name="l02112"></a>02112 <span class="comment">//*****************************************************************************</span>
<a name="l02113"></a>02113 <span class="comment">//</span>
<a name="l02114"></a>02114 <span class="comment">// Close the Doxygen group.</span>
<a name="l02116"></a>02116 <span class="comment"></span><span class="comment">//</span>
<a name="l02117"></a>02117 <span class="comment">//*****************************************************************************</span>
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="can_8c.html">can.c</a>      </li>

    <li class="footer">Generated on Tue Jan 27 2015 22:34:52 for EE445M Real Time Operating Systems by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
