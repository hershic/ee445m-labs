<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>EE 445M: driverlib/emac.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">EE 445M
   
   </div>
   <div id="projectbrief">Real Time Operating Systems taken at University of Texas Spring 2015</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('emac_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">driverlib/emac.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="emac_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//*****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">//</span>
<a name="l00003"></a>00003 <span class="comment">// emac.c - Driver for the Integrated Ethernet Controller on Snowflake-class</span>
<a name="l00004"></a>00004 <span class="comment">//          Tiva devices.</span>
<a name="l00005"></a>00005 <span class="comment">//</span>
<a name="l00006"></a>00006 <span class="comment">// Copyright (c) 2013-2014 Texas Instruments Incorporated.  All rights reserved.</span>
<a name="l00007"></a>00007 <span class="comment">// Software License Agreement</span>
<a name="l00008"></a>00008 <span class="comment">// </span>
<a name="l00009"></a>00009 <span class="comment">//   Redistribution and use in source and binary forms, with or without</span>
<a name="l00010"></a>00010 <span class="comment">//   modification, are permitted provided that the following conditions</span>
<a name="l00011"></a>00011 <span class="comment">//   are met:</span>
<a name="l00012"></a>00012 <span class="comment">// </span>
<a name="l00013"></a>00013 <span class="comment">//   Redistributions of source code must retain the above copyright</span>
<a name="l00014"></a>00014 <span class="comment">//   notice, this list of conditions and the following disclaimer.</span>
<a name="l00015"></a>00015 <span class="comment">// </span>
<a name="l00016"></a>00016 <span class="comment">//   Redistributions in binary form must reproduce the above copyright</span>
<a name="l00017"></a>00017 <span class="comment">//   notice, this list of conditions and the following disclaimer in the</span>
<a name="l00018"></a>00018 <span class="comment">//   documentation and/or other materials provided with the  </span>
<a name="l00019"></a>00019 <span class="comment">//   distribution.</span>
<a name="l00020"></a>00020 <span class="comment">// </span>
<a name="l00021"></a>00021 <span class="comment">//   Neither the name of Texas Instruments Incorporated nor the names of</span>
<a name="l00022"></a>00022 <span class="comment">//   its contributors may be used to endorse or promote products derived</span>
<a name="l00023"></a>00023 <span class="comment">//   from this software without specific prior written permission.</span>
<a name="l00024"></a>00024 <span class="comment">// </span>
<a name="l00025"></a>00025 <span class="comment">// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00026"></a>00026 <span class="comment">// &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00027"></a>00027 <span class="comment">// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="l00028"></a>00028 <span class="comment">// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<a name="l00029"></a>00029 <span class="comment">// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<a name="l00030"></a>00030 <span class="comment">// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<a name="l00031"></a>00031 <span class="comment">// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<a name="l00032"></a>00032 <span class="comment">// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<a name="l00033"></a>00033 <span class="comment">// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00034"></a>00034 <span class="comment">// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<a name="l00035"></a>00035 <span class="comment">// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00036"></a>00036 <span class="comment">// </span>
<a name="l00037"></a>00037 <span class="comment">// This is part of revision 2.1.0.12573 of the Tiva Peripheral Driver Library.</span>
<a name="l00038"></a>00038 <span class="comment">//</span>
<a name="l00039"></a>00039 <span class="comment">//*****************************************************************************</span>
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <span class="comment">//*****************************************************************************</span>
<a name="l00042"></a>00042 <span class="comment">//</span>
<a name="l00045"></a>00045 <span class="comment"></span><span class="comment">//</span>
<a name="l00046"></a>00046 <span class="comment">//*****************************************************************************</span>
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 <span class="preprocessor">#include &lt;stdbool.h&gt;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &lt;stdint.h&gt;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="hw__ints_8h.html">inc/hw_ints.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="hw__memmap_8h.html">inc/hw_memmap.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="hw__types_8h.html">inc/hw_types.h</a>&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="hw__emac_8h.html">inc/hw_emac.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="debug_8h.html">driverlib/debug.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="emac_8h.html">driverlib/emac.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="sysctl_8h.html">driverlib/sysctl.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="interrupt_8h.html">driverlib/interrupt.h</a>&quot;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="sw__crc_8h.html">driverlib/sw_crc.h</a>&quot;</span>
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="comment">//*****************************************************************************</span>
<a name="l00061"></a>00061 <span class="comment">//</span>
<a name="l00062"></a>00062 <span class="comment">// Combined defines used in parameter validity checks.</span>
<a name="l00063"></a>00063 <span class="comment">//</span>
<a name="l00064"></a>00064 <span class="comment">//*****************************************************************************</span>
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 <span class="comment">//*****************************************************************************</span>
<a name="l00067"></a>00067 <span class="comment">//</span>
<a name="l00068"></a>00068 <span class="comment">// Combined valid configuration flags.</span>
<a name="l00069"></a>00069 <span class="comment">//</span>
<a name="l00070"></a>00070 <span class="comment">//*****************************************************************************</span>
<a name="l00071"></a><a class="code" href="group__emac__api.html#ga63d330eb3924733a3d22483719f133f2">00071</a> <span class="preprocessor">#define VALID_CONFIG_FLAGS      (EMAC_CONFIG_USE_MACADDR1 |                   \</span>
<a name="l00072"></a>00072 <span class="preprocessor">                                 EMAC_CONFIG_SA_INSERT |                      \</span>
<a name="l00073"></a>00073 <span class="preprocessor">                                 EMAC_CONFIG_SA_REPLACE |                     \</span>
<a name="l00074"></a>00074 <span class="preprocessor">                                 EMAC_CONFIG_2K_PACKETS |                     \</span>
<a name="l00075"></a>00075 <span class="preprocessor">                                 EMAC_CONFIG_STRIP_CRC |                      \</span>
<a name="l00076"></a>00076 <span class="preprocessor">                                 EMAC_CONFIG_JABBER_DISABLE |                 \</span>
<a name="l00077"></a>00077 <span class="preprocessor">                                 EMAC_CONFIG_JUMBO_ENABLE |                   \</span>
<a name="l00078"></a>00078 <span class="preprocessor">                                 EMAC_CONFIG_IF_GAP_MASK |                    \</span>
<a name="l00079"></a>00079 <span class="preprocessor">                                 EMAC_CONFIG_CS_DISABLE |                     \</span>
<a name="l00080"></a>00080 <span class="preprocessor">                                 EMAC_CONFIG_100MBPS |                        \</span>
<a name="l00081"></a>00081 <span class="preprocessor">                                 EMAC_CONFIG_RX_OWN_DISABLE |                 \</span>
<a name="l00082"></a>00082 <span class="preprocessor">                                 EMAC_CONFIG_LOOPBACK |                       \</span>
<a name="l00083"></a>00083 <span class="preprocessor">                                 EMAC_CONFIG_FULL_DUPLEX |                    \</span>
<a name="l00084"></a>00084 <span class="preprocessor">                                 EMAC_CONFIG_CHECKSUM_OFFLOAD |               \</span>
<a name="l00085"></a>00085 <span class="preprocessor">                                 EMAC_CONFIG_RETRY_DISABLE |                  \</span>
<a name="l00086"></a>00086 <span class="preprocessor">                                 EMAC_CONFIG_AUTO_CRC_STRIPPING |             \</span>
<a name="l00087"></a>00087 <span class="preprocessor">                                 EMAC_CONFIG_BO_MASK |                        \</span>
<a name="l00088"></a>00088 <span class="preprocessor">                                 EMAC_CONFIG_DEFERRAL_CHK_ENABLE |            \</span>
<a name="l00089"></a>00089 <span class="preprocessor">                                 EMAC_CONFIG_PREAMBLE_MASK)</span>
<a name="l00090"></a>00090 <span class="preprocessor"></span>
<a name="l00091"></a>00091 <span class="comment">//*****************************************************************************</span>
<a name="l00092"></a>00092 <span class="comment">//</span>
<a name="l00093"></a>00093 <span class="comment">// Combined valid frame filter flags.</span>
<a name="l00094"></a>00094 <span class="comment">//</span>
<a name="l00095"></a>00095 <span class="comment">//*****************************************************************************</span>
<a name="l00096"></a><a class="code" href="group__emac__api.html#gadf376a0c14f0ca42bff7073899309783">00096</a> <span class="preprocessor">#define VALID_FRMFILTER_FLAGS   (EMAC_FRMFILTER_RX_ALL |                      \</span>
<a name="l00097"></a>00097 <span class="preprocessor">                                 EMAC_FRMFILTER_VLAN |                        \</span>
<a name="l00098"></a>00098 <span class="preprocessor">                                 EMAC_FRMFILTER_HASH_AND_PERFECT |            \</span>
<a name="l00099"></a>00099 <span class="preprocessor">                                 EMAC_FRMFILTER_SADDR |                       \</span>
<a name="l00100"></a>00100 <span class="preprocessor">                                 EMAC_FRMFILTER_INV_SADDR |                   \</span>
<a name="l00101"></a>00101 <span class="preprocessor">                                 EMAC_FRMFILTER_PASS_NO_PAUSE |               \</span>
<a name="l00102"></a>00102 <span class="preprocessor">                                 EMAC_FRMFILTER_PASS_ALL_CTRL |               \</span>
<a name="l00103"></a>00103 <span class="preprocessor">                                 EMAC_FRMFILTER_PASS_ADDR_CTRL |              \</span>
<a name="l00104"></a>00104 <span class="preprocessor">                                 EMAC_FRMFILTER_BROADCAST |                   \</span>
<a name="l00105"></a>00105 <span class="preprocessor">                                 EMAC_FRMFILTER_PASS_MULTICAST |              \</span>
<a name="l00106"></a>00106 <span class="preprocessor">                                 EMAC_FRMFILTER_INV_DADDR |                   \</span>
<a name="l00107"></a>00107 <span class="preprocessor">                                 EMAC_FRMFILTER_HASH_MULTICAST |              \</span>
<a name="l00108"></a>00108 <span class="preprocessor">                                 EMAC_FRMFILTER_HASH_UNICAST |                \</span>
<a name="l00109"></a>00109 <span class="preprocessor">                                 EMAC_FRMFILTER_PROMISCUOUS)</span>
<a name="l00110"></a>00110 <span class="preprocessor"></span>
<a name="l00111"></a>00111 <span class="comment">//*****************************************************************************</span>
<a name="l00112"></a>00112 <span class="comment">//</span>
<a name="l00113"></a>00113 <span class="comment">// Combined valid maskable interrupts.</span>
<a name="l00114"></a>00114 <span class="comment">//</span>
<a name="l00115"></a>00115 <span class="comment">//*****************************************************************************</span>
<a name="l00116"></a><a class="code" href="group__emac__api.html#ga75a041a656a9b2815db8f04fc8616540">00116</a> <span class="preprocessor">#define EMAC_MASKABLE_INTS      (EMAC_INT_EARLY_RECEIVE |                     \</span>
<a name="l00117"></a>00117 <span class="preprocessor">                                 EMAC_INT_BUS_ERROR |                         \</span>
<a name="l00118"></a>00118 <span class="preprocessor">                                 EMAC_INT_EARLY_TRANSMIT |                    \</span>
<a name="l00119"></a>00119 <span class="preprocessor">                                 EMAC_INT_RX_WATCHDOG |                       \</span>
<a name="l00120"></a>00120 <span class="preprocessor">                                 EMAC_INT_RX_STOPPED |                        \</span>
<a name="l00121"></a>00121 <span class="preprocessor">                                 EMAC_INT_RX_NO_BUFFER |                      \</span>
<a name="l00122"></a>00122 <span class="preprocessor">                                 EMAC_INT_RECEIVE |                           \</span>
<a name="l00123"></a>00123 <span class="preprocessor">                                 EMAC_INT_TX_UNDERFLOW |                      \</span>
<a name="l00124"></a>00124 <span class="preprocessor">                                 EMAC_INT_RX_OVERFLOW |                       \</span>
<a name="l00125"></a>00125 <span class="preprocessor">                                 EMAC_INT_TX_JABBER |                         \</span>
<a name="l00126"></a>00126 <span class="preprocessor">                                 EMAC_INT_TX_NO_BUFFER |                      \</span>
<a name="l00127"></a>00127 <span class="preprocessor">                                 EMAC_INT_TX_STOPPED |                        \</span>
<a name="l00128"></a>00128 <span class="preprocessor">                                 EMAC_INT_TRANSMIT |                          \</span>
<a name="l00129"></a>00129 <span class="preprocessor">                                 EMAC_INT_NORMAL_INT |                        \</span>
<a name="l00130"></a>00130 <span class="preprocessor">                                 EMAC_INT_ABNORMAL_INT |                      \</span>
<a name="l00131"></a>00131 <span class="preprocessor">                                 EMAC_INT_PHY)</span>
<a name="l00132"></a>00132 <span class="preprocessor"></span>
<a name="l00133"></a>00133 <span class="comment">//*****************************************************************************</span>
<a name="l00134"></a>00134 <span class="comment">//</span>
<a name="l00135"></a>00135 <span class="comment">// Combined valid normal interrupts.</span>
<a name="l00136"></a>00136 <span class="comment">//</span>
<a name="l00137"></a>00137 <span class="comment">//*****************************************************************************</span>
<a name="l00138"></a><a class="code" href="group__emac__api.html#ga5d67d3809999859a3fde9779ce0593e6">00138</a> <span class="preprocessor">#define EMAC_NORMAL_INTS        (EMAC_INT_TRANSMIT |                          \</span>
<a name="l00139"></a>00139 <span class="preprocessor">                                 EMAC_INT_RECEIVE |                           \</span>
<a name="l00140"></a>00140 <span class="preprocessor">                                 EMAC_INT_EARLY_RECEIVE |                     \</span>
<a name="l00141"></a>00141 <span class="preprocessor">                                 EMAC_INT_TX_NO_BUFFER)</span>
<a name="l00142"></a>00142 <span class="preprocessor"></span>
<a name="l00143"></a>00143 <span class="comment">//*****************************************************************************</span>
<a name="l00144"></a>00144 <span class="comment">//</span>
<a name="l00145"></a>00145 <span class="comment">// Combined valid abnormal interrupts.</span>
<a name="l00146"></a>00146 <span class="comment">//</span>
<a name="l00147"></a>00147 <span class="comment">//*****************************************************************************</span>
<a name="l00148"></a><a class="code" href="group__emac__api.html#gaaed04dbd9620d9f5c4e06fdc8d691330">00148</a> <span class="preprocessor">#define EMAC_ABNORMAL_INTS      (EMAC_INT_TX_STOPPED |                        \</span>
<a name="l00149"></a>00149 <span class="preprocessor">                                 EMAC_INT_TX_JABBER |                         \</span>
<a name="l00150"></a>00150 <span class="preprocessor">                                 EMAC_INT_RX_OVERFLOW |                       \</span>
<a name="l00151"></a>00151 <span class="preprocessor">                                 EMAC_INT_TX_UNDERFLOW |                      \</span>
<a name="l00152"></a>00152 <span class="preprocessor">                                 EMAC_INT_RX_NO_BUFFER |                      \</span>
<a name="l00153"></a>00153 <span class="preprocessor">                                 EMAC_INT_RX_STOPPED |                        \</span>
<a name="l00154"></a>00154 <span class="preprocessor">                                 EMAC_INT_RX_WATCHDOG |                       \</span>
<a name="l00155"></a>00155 <span class="preprocessor">                                 EMAC_INT_EARLY_TRANSMIT |                    \</span>
<a name="l00156"></a>00156 <span class="preprocessor">                                 EMAC_INT_BUS_ERROR)</span>
<a name="l00157"></a>00157 <span class="preprocessor"></span>
<a name="l00158"></a>00158 <span class="comment">//*****************************************************************************</span>
<a name="l00159"></a>00159 <span class="comment">//</span>
<a name="l00160"></a>00160 <span class="comment">// Interrupt sources reported via the DMARIS register but which are not</span>
<a name="l00161"></a>00161 <span class="comment">// masked (or enabled) via the DMAIM register.</span>
<a name="l00162"></a>00162 <span class="comment">//</span>
<a name="l00163"></a>00163 <span class="comment">//*****************************************************************************</span>
<a name="l00164"></a><a class="code" href="group__emac__api.html#ga7579fe28e6650a69917e210fc074eb3f">00164</a> <span class="preprocessor">#define EMAC_NON_MASKED_INTS    (EMAC_DMARIS_TT |                             \</span>
<a name="l00165"></a>00165 <span class="preprocessor">                                 EMAC_DMARIS_PMT |                            \</span>
<a name="l00166"></a>00166 <span class="preprocessor">                                 EMAC_DMARIS_MMC)</span>
<a name="l00167"></a>00167 <span class="preprocessor"></span>
<a name="l00168"></a>00168 <span class="comment">//*****************************************************************************</span>
<a name="l00169"></a>00169 <span class="comment">//</span>
<a name="l00170"></a>00170 <span class="comment">// The number of MAC addresses the module can store for filtering purposes.</span>
<a name="l00171"></a>00171 <span class="comment">//</span>
<a name="l00172"></a>00172 <span class="comment">//*****************************************************************************</span>
<a name="l00173"></a><a class="code" href="group__emac__api.html#ga8bd32e32ff3c0fb60b08f0ff4f80e16f">00173</a> <span class="preprocessor">#define NUM_MAC_ADDR            4</span>
<a name="l00174"></a>00174 <span class="preprocessor"></span>
<a name="l00175"></a>00175 <span class="comment">//*****************************************************************************</span>
<a name="l00176"></a>00176 <span class="comment">//</span>
<a name="l00177"></a>00177 <span class="comment">// Macros aiding access to the MAC address registers.</span>
<a name="l00178"></a>00178 <span class="comment">//</span>
<a name="l00179"></a>00179 <span class="comment">//*****************************************************************************</span>
<a name="l00180"></a><a class="code" href="group__emac__api.html#ga41a8df12498a982bf9c89b72e5a70bf7">00180</a> <span class="preprocessor">#define MAC_ADDR_OFFSET         (EMAC_O_ADDR1L - EMAC_O_ADDR0L)</span>
<a name="l00181"></a><a class="code" href="group__emac__api.html#ga9b0fae51315bfa58016cfb9a512067cc">00181</a> <span class="preprocessor"></span><span class="preprocessor">#define EMAC_O_ADDRL(n)         (EMAC_O_ADDR0L + (MAC_ADDR_OFFSET * (n)))</span>
<a name="l00182"></a><a class="code" href="group__emac__api.html#gaae42f1529861aad7033a373008004747">00182</a> <span class="preprocessor"></span><span class="preprocessor">#define EMAC_O_ADDRH(n)         (EMAC_O_ADDR0H + (MAC_ADDR_OFFSET * (n)))</span>
<a name="l00183"></a>00183 <span class="preprocessor"></span>
<a name="l00184"></a>00184 <span class="comment">//*****************************************************************************</span>
<a name="l00185"></a>00185 <span class="comment">//</span>
<a name="l00186"></a>00186 <span class="comment">// A structure used to help in choosing the correct clock divisor for the MII</span>
<a name="l00187"></a>00187 <span class="comment">// based on the current system clock rate.</span>
<a name="l00188"></a>00188 <span class="comment">//</span>
<a name="l00189"></a>00189 <span class="comment">//*****************************************************************************</span>
<a name="l00190"></a>00190 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct</span>
<a name="l00191"></a>00191 {
<a name="l00192"></a><a class="code" href="emac_8c.html#a80d9155deb711f8b70465ff589bcc297">00192</a>     uint32_t <a class="code" href="emac_8c.html#a80d9155deb711f8b70465ff589bcc297">ui32SysClockMax</a>;
<a name="l00193"></a><a class="code" href="emac_8c.html#ababbd974e1de0119ff9e1c0b08700d8a">00193</a>     uint32_t <a class="code" href="emac_8c.html#ababbd974e1de0119ff9e1c0b08700d8a">ui32Divisor</a>;
<a name="l00194"></a>00194 }
<a name="l00195"></a>00195 <a class="code" href="group__emac__api.html#gae3394ac3ae3f1ea5983740a796f5d4da">g_pi16MIIClockDiv</a>[] =
<a name="l00196"></a>00196 {
<a name="l00197"></a>00197     { 64000000, <a class="code" href="hw__emac_8h.html#af8c8ddea3c6793d9cec4d52f297ca260">EMAC_MIIADDR_CR_35_60</a> },
<a name="l00198"></a>00198     { 104000000, <a class="code" href="hw__emac_8h.html#ad77a9664ce2115c1540df1a3d8fc4441">EMAC_MIIADDR_CR_60_100</a> },
<a name="l00199"></a>00199     { 150000000, <a class="code" href="hw__emac_8h.html#a7d9dc68a5f879e0437bdbbb89ac1a82a">EMAC_MIIADDR_CR_100_150</a> }
<a name="l00200"></a>00200 };
<a name="l00201"></a>00201 
<a name="l00202"></a>00202 <span class="comment">//*****************************************************************************</span>
<a name="l00203"></a>00203 <span class="comment">//</span>
<a name="l00204"></a>00204 <span class="comment">// The number of clock divisors in the above table.</span>
<a name="l00205"></a>00205 <span class="comment">//</span>
<a name="l00206"></a>00206 <span class="comment">//*****************************************************************************</span>
<a name="l00207"></a><a class="code" href="group__emac__api.html#ga194f63b35faa559dacac124db12a36bc">00207</a> <span class="preprocessor">#define NUM_CLOCK_DIVISORS      (sizeof(g_pi16MIIClockDiv) /                  \</span>
<a name="l00208"></a>00208 <span class="preprocessor">                                 sizeof(g_pi16MIIClockDiv[0]))</span>
<a name="l00209"></a>00209 <span class="preprocessor"></span>
<a name="l00210"></a>00210 <span class="comment">//*****************************************************************************</span>
<a name="l00211"></a>00211 <span class="comment">//</span>
<a name="l00302"></a>00302 <span class="comment"></span><span class="comment">//</span>
<a name="l00303"></a>00303 <span class="comment">//*****************************************************************************</span>
<a name="l00304"></a>00304 <span class="keywordtype">void</span>
<a name="l00305"></a><a class="code" href="group__emac__api.html#ga453520ef2871a0eaef9068288c5cf9a1">00305</a> <a class="code" href="group__emac__api.html#ga453520ef2871a0eaef9068288c5cf9a1">EMACInit</a>(uint32_t ui32Base, uint32_t ui32SysClk, uint32_t ui32BusConfig,
<a name="l00306"></a>00306          uint32_t ui32RxBurst, uint32_t ui32TxBurst, uint32_t ui32DescSkipSize)
<a name="l00307"></a>00307 {
<a name="l00308"></a>00308     uint32_t ui32Val, ui32Div;
<a name="l00309"></a>00309 
<a name="l00310"></a>00310     <span class="comment">//</span>
<a name="l00311"></a>00311     <span class="comment">// Parameter sanity checks.</span>
<a name="l00312"></a>00312     <span class="comment">//</span>
<a name="l00313"></a>00313     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32DescSkipSize &lt; 32);
<a name="l00314"></a>00314     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32TxBurst &lt; (32 * 8));
<a name="l00315"></a>00315     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32RxBurst &lt; (32 * 8));
<a name="l00316"></a>00316 
<a name="l00317"></a>00317     <span class="comment">//</span>
<a name="l00318"></a>00318     <span class="comment">// Make sure that the DMA software reset is clear before continuing.</span>
<a name="l00319"></a>00319     <span class="comment">//</span>
<a name="l00320"></a>00320     <span class="keywordflow">while</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(<a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a> + <a class="code" href="hw__emac_8h.html#a47c18b030acfaa121cbc15977230e0ab">EMAC_O_DMABUSMOD</a>) &amp; <a class="code" href="hw__emac_8h.html#a975ec1590cb22d242952f5dc622510a0">EMAC_DMABUSMOD_SWR</a>)
<a name="l00321"></a>00321     {
<a name="l00322"></a>00322     }
<a name="l00323"></a>00323 
<a name="l00324"></a>00324     <span class="comment">//</span>
<a name="l00325"></a>00325     <span class="comment">// Set common flags.  Note that this driver assumes we are always using</span>
<a name="l00326"></a>00326     <span class="comment">// 8 word descriptors so we need to OR in EMAC_DMABUSMOD_ATDS here.</span>
<a name="l00327"></a>00327     <span class="comment">//</span>
<a name="l00328"></a>00328     ui32Val = (ui32BusConfig | (ui32DescSkipSize &lt;&lt; <a class="code" href="hw__emac_8h.html#ad4276d865f9bc41720999967950752dd">EMAC_DMABUSMOD_DSL_S</a>) |
<a name="l00329"></a>00329                <a class="code" href="hw__emac_8h.html#a2102e2b903a54aff8904e1a6d8fda4c2">EMAC_DMABUSMOD_ATDS</a>);
<a name="l00330"></a>00330 
<a name="l00331"></a>00331     <span class="comment">//</span>
<a name="l00332"></a>00332     <span class="comment">// Do we need to use the 8X burst length multiplier?</span>
<a name="l00333"></a>00333     <span class="comment">//</span>
<a name="l00334"></a>00334     <span class="keywordflow">if</span>((ui32TxBurst &gt; 32) || (ui32RxBurst &gt; 32))
<a name="l00335"></a>00335     {
<a name="l00336"></a>00336         <span class="comment">//</span>
<a name="l00337"></a>00337         <span class="comment">// Divide both burst lengths by 8 and set the 8X burst length</span>
<a name="l00338"></a>00338         <span class="comment">// multiplier.</span>
<a name="l00339"></a>00339         <span class="comment">//</span>
<a name="l00340"></a>00340         ui32Val |= <a class="code" href="hw__emac_8h.html#a972fa00cb7d177883447f81d15e5e173">EMAC_DMABUSMOD_8XPBL</a>;
<a name="l00341"></a>00341         ui32TxBurst &gt;&gt;= 3;
<a name="l00342"></a>00342         ui32RxBurst &gt;&gt;= 3;
<a name="l00343"></a>00343 
<a name="l00344"></a>00344         <span class="comment">//</span>
<a name="l00345"></a>00345         <span class="comment">// Sanity check - neither burst length should have become zero.  If</span>
<a name="l00346"></a>00346         <span class="comment">// they did, this indicates that the values passed are invalid.</span>
<a name="l00347"></a>00347         <span class="comment">//</span>
<a name="l00348"></a>00348         <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32RxBurst);
<a name="l00349"></a>00349         <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32TxBurst);
<a name="l00350"></a>00350     }
<a name="l00351"></a>00351 
<a name="l00352"></a>00352     <span class="comment">//</span>
<a name="l00353"></a>00353     <span class="comment">// Are the receive and transmit burst lengths the same?</span>
<a name="l00354"></a>00354     <span class="comment">//</span>
<a name="l00355"></a>00355     <span class="keywordflow">if</span>(ui32RxBurst == ui32TxBurst)
<a name="l00356"></a>00356     {
<a name="l00357"></a>00357         <span class="comment">//</span>
<a name="l00358"></a>00358         <span class="comment">// Yes - set up to use a single burst length.</span>
<a name="l00359"></a>00359         <span class="comment">//</span>
<a name="l00360"></a>00360         ui32Val |= (ui32TxBurst &lt;&lt; <a class="code" href="hw__emac_8h.html#a422d136dc10c1d532cfeb4355b109701">EMAC_DMABUSMOD_PBL_S</a>);
<a name="l00361"></a>00361     }
<a name="l00362"></a>00362     <span class="keywordflow">else</span>
<a name="l00363"></a>00363     {
<a name="l00364"></a>00364         <span class="comment">//</span>
<a name="l00365"></a>00365         <span class="comment">// No - we need to use separate burst lengths for each.</span>
<a name="l00366"></a>00366         <span class="comment">//</span>
<a name="l00367"></a>00367         ui32Val |= (<a class="code" href="hw__emac_8h.html#a0877c122adb324d0bfe667f066ca53c7">EMAC_DMABUSMOD_USP</a> |
<a name="l00368"></a>00368                     (ui32TxBurst &lt;&lt; <a class="code" href="hw__emac_8h.html#a422d136dc10c1d532cfeb4355b109701">EMAC_DMABUSMOD_PBL_S</a>) |
<a name="l00369"></a>00369                     (ui32RxBurst &lt;&lt; <a class="code" href="hw__emac_8h.html#adaff9e9ded7bdabcb111f815e7c4e5b1">EMAC_DMABUSMOD_RPBL_S</a>));
<a name="l00370"></a>00370     }
<a name="l00371"></a>00371 
<a name="l00372"></a>00372     <span class="comment">//</span>
<a name="l00373"></a>00373     <span class="comment">// Finally, write the bus mode register.</span>
<a name="l00374"></a>00374     <span class="comment">//</span>
<a name="l00375"></a>00375     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a47c18b030acfaa121cbc15977230e0ab">EMAC_O_DMABUSMOD</a>) = ui32Val;
<a name="l00376"></a>00376 
<a name="l00377"></a>00377     <span class="comment">//</span>
<a name="l00378"></a>00378     <span class="comment">// Default the MII CSR clock divider based on the fastest system clock.</span>
<a name="l00379"></a>00379     <span class="comment">//</span>
<a name="l00380"></a>00380     ui32Div = <a class="code" href="group__emac__api.html#gae3394ac3ae3f1ea5983740a796f5d4da">g_pi16MIIClockDiv</a>[<a class="code" href="group__emac__api.html#ga194f63b35faa559dacac124db12a36bc">NUM_CLOCK_DIVISORS</a> - 1].ui32Divisor;
<a name="l00381"></a>00381 
<a name="l00382"></a>00382     <span class="comment">//</span>
<a name="l00383"></a>00383     <span class="comment">// Find the MII CSR clock divider to use based on the current system clock.</span>
<a name="l00384"></a>00384     <span class="comment">//</span>
<a name="l00385"></a>00385     <span class="keywordflow">for</span>(ui32Val = 0; ui32Val &lt; <a class="code" href="group__emac__api.html#ga194f63b35faa559dacac124db12a36bc">NUM_CLOCK_DIVISORS</a>; ui32Val++)
<a name="l00386"></a>00386     {
<a name="l00387"></a>00387         <span class="keywordflow">if</span>(ui32SysClk &lt;= <a class="code" href="group__emac__api.html#gae3394ac3ae3f1ea5983740a796f5d4da">g_pi16MIIClockDiv</a>[ui32Val].<a class="code" href="emac_8c.html#a80d9155deb711f8b70465ff589bcc297">ui32SysClockMax</a>)
<a name="l00388"></a>00388         {
<a name="l00389"></a>00389             ui32Div = <a class="code" href="group__emac__api.html#gae3394ac3ae3f1ea5983740a796f5d4da">g_pi16MIIClockDiv</a>[ui32Val].ui32Divisor;
<a name="l00390"></a>00390             <span class="keywordflow">break</span>;
<a name="l00391"></a>00391         }
<a name="l00392"></a>00392     }
<a name="l00393"></a>00393 
<a name="l00394"></a>00394     <span class="comment">//</span>
<a name="l00395"></a>00395     <span class="comment">// Set the MII CSR clock speed.</span>
<a name="l00396"></a>00396     <span class="comment">//</span>
<a name="l00397"></a>00397     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a1cc6799662f573687ed4a46c978f9eaa">EMAC_O_MIIADDR</a>) = ((<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a1cc6799662f573687ed4a46c978f9eaa">EMAC_O_MIIADDR</a>) &amp;
<a name="l00398"></a>00398                                          ~<a class="code" href="hw__emac_8h.html#a27f41a621a6fe1618624cf6084d43bec">EMAC_MIIADDR_CR_M</a>) | ui32Div);
<a name="l00399"></a>00399 
<a name="l00400"></a>00400     <span class="comment">//</span>
<a name="l00401"></a>00401     <span class="comment">// Disable all the MMC interrupts as these are enabled by default at reset.</span>
<a name="l00402"></a>00402     <span class="comment">//</span>
<a name="l00403"></a>00403     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#abd4fb49a963c31bb34455f366c04398a">EMAC_O_MMCRXIM</a>) = 0xFFFFFFFF;
<a name="l00404"></a>00404     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a18f0aede85ae0bc778bce2874d04ab53">EMAC_O_MMCTXIM</a>) = 0xFFFFFFFF;
<a name="l00405"></a>00405 }
<a name="l00406"></a>00406 
<a name="l00407"></a>00407 <span class="comment">//*****************************************************************************</span>
<a name="l00408"></a>00408 <span class="comment">//</span>
<a name="l00422"></a>00422 <span class="comment"></span><span class="comment">//</span>
<a name="l00423"></a>00423 <span class="comment">//*****************************************************************************</span>
<a name="l00424"></a>00424 <span class="keywordtype">void</span>
<a name="l00425"></a><a class="code" href="group__emac__api.html#gac6bdbf26467dc58bbe45f19ba992d027">00425</a> <a class="code" href="group__emac__api.html#gac6bdbf26467dc58bbe45f19ba992d027">EMACReset</a>(uint32_t ui32Base)
<a name="l00426"></a>00426 {
<a name="l00427"></a>00427     <span class="comment">//</span>
<a name="l00428"></a>00428     <span class="comment">// Reset the Ethernet MAC.</span>
<a name="l00429"></a>00429     <span class="comment">//</span>
<a name="l00430"></a>00430     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a47c18b030acfaa121cbc15977230e0ab">EMAC_O_DMABUSMOD</a>) |= <a class="code" href="hw__emac_8h.html#a975ec1590cb22d242952f5dc622510a0">EMAC_DMABUSMOD_SWR</a>;
<a name="l00431"></a>00431 
<a name="l00432"></a>00432     <span class="comment">//</span>
<a name="l00433"></a>00433     <span class="comment">// Wait for the reset to complete.</span>
<a name="l00434"></a>00434     <span class="comment">//</span>
<a name="l00435"></a>00435     <span class="keywordflow">while</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a47c18b030acfaa121cbc15977230e0ab">EMAC_O_DMABUSMOD</a>) &amp; <a class="code" href="hw__emac_8h.html#a975ec1590cb22d242952f5dc622510a0">EMAC_DMABUSMOD_SWR</a>)
<a name="l00436"></a>00436     {
<a name="l00437"></a>00437     }
<a name="l00438"></a>00438 }
<a name="l00439"></a>00439 
<a name="l00440"></a>00440 <span class="comment">//*****************************************************************************</span>
<a name="l00441"></a>00441 <span class="comment">//</span>
<a name="l00575"></a>00575 <span class="comment"></span><span class="comment">//</span>
<a name="l00576"></a>00576 <span class="comment">//*****************************************************************************</span>
<a name="l00577"></a>00577 <span class="keywordtype">void</span>
<a name="l00578"></a><a class="code" href="group__emac__api.html#ga6f369bdbe2e8ea108ef1398242030198">00578</a> <a class="code" href="group__emac__api.html#ga6f369bdbe2e8ea108ef1398242030198">EMACPHYConfigSet</a>(uint32_t ui32Base, uint32_t ui32Config)
<a name="l00579"></a>00579 {
<a name="l00580"></a>00580     <span class="comment">//</span>
<a name="l00581"></a>00581     <span class="comment">// Write the Ethernet PHY configuration to the peripheral configuration</span>
<a name="l00582"></a>00582     <span class="comment">// register.</span>
<a name="l00583"></a>00583     <span class="comment">//</span>
<a name="l00584"></a>00584     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a49d32209426d10ec4ccc030564458120">EMAC_O_PC</a>) = ui32Config;
<a name="l00585"></a>00585 
<a name="l00586"></a>00586     <span class="comment">//</span>
<a name="l00587"></a>00587     <span class="comment">// If using the internal PHY, reset it to ensure that new configuration is</span>
<a name="l00588"></a>00588     <span class="comment">// latched there.</span>
<a name="l00589"></a>00589     <span class="comment">//</span>
<a name="l00590"></a>00590     <span class="keywordflow">if</span>((ui32Config &amp; <a class="code" href="group__emac__api.html#gaf314a767901d4d1f93ea7c7f61bf24d6">EMAC_PHY_TYPE_MASK</a>) == <a class="code" href="group__emac__api.html#ga84e85b9a767a2c77338def18aca16bd3">EMAC_PHY_TYPE_INTERNAL</a>)
<a name="l00591"></a>00591     {
<a name="l00592"></a>00592         <a class="code" href="group__sysctl__api.html#gab8c537abe40caacd5dfa7ffdedefb6b9">SysCtlPeripheralReset</a>(<a class="code" href="sysctl_8h.html#a45e830302340fd4709dbdbc57a9303de">SYSCTL_PERIPH_EPHY0</a>);
<a name="l00593"></a>00593         <span class="keywordflow">while</span>(!<a class="code" href="group__sysctl__api.html#ga7ddf1f06376894c31e5596f562c299ac">SysCtlPeripheralReady</a>(<a class="code" href="sysctl_8h.html#a45e830302340fd4709dbdbc57a9303de">SYSCTL_PERIPH_EPHY0</a>))
<a name="l00594"></a>00594         {
<a name="l00595"></a>00595             <span class="comment">//</span>
<a name="l00596"></a>00596             <span class="comment">// Wait for the PHY reset to complete.</span>
<a name="l00597"></a>00597             <span class="comment">//</span>
<a name="l00598"></a>00598         }
<a name="l00599"></a>00599 
<a name="l00600"></a>00600         <span class="comment">//</span>
<a name="l00601"></a>00601         <span class="comment">// Delay a bit longer to ensure that the PHY reset has completed.</span>
<a name="l00602"></a>00602         <span class="comment">//</span>
<a name="l00603"></a>00603         <a class="code" href="sysctl_8h.html#a992a7493f587384e949178cdc4063042">SysCtlDelay</a>(10000);
<a name="l00604"></a>00604     }
<a name="l00605"></a>00605 
<a name="l00606"></a>00606     <span class="comment">//</span>
<a name="l00607"></a>00607     <span class="comment">// If using an external RMII PHY, we must set 2 bits in the Ethernet MAC</span>
<a name="l00608"></a>00608     <span class="comment">// Clock Configuration Register.</span>
<a name="l00609"></a>00609     <span class="comment">//</span>
<a name="l00610"></a>00610     <span class="keywordflow">if</span>((ui32Config &amp; EMAC_PHY_TYPE_MASK) == <a class="code" href="group__emac__api.html#gafe53bc2f2bff4ebd97f5fdd048e707d8">EMAC_PHY_TYPE_EXTERNAL_RMII</a>)
<a name="l00611"></a>00611     {
<a name="l00612"></a>00612         <span class="comment">//</span>
<a name="l00613"></a>00613         <span class="comment">// Select and enable the external clock from the RMII PHY.</span>
<a name="l00614"></a>00614         <span class="comment">//</span>
<a name="l00615"></a>00615         <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(<a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a> + <a class="code" href="hw__emac_8h.html#a14453f1eb729cc538aeceb94156a38a0">EMAC_O_CC</a>) |= <a class="code" href="hw__emac_8h.html#a506f07e204d003c5d5de9b88d2c1a2e6">EMAC_CC_CLKEN</a>;
<a name="l00616"></a>00616     }
<a name="l00617"></a>00617     <span class="keywordflow">else</span>
<a name="l00618"></a>00618     {
<a name="l00619"></a>00619         <span class="comment">//</span>
<a name="l00620"></a>00620         <span class="comment">// Disable the external clock.</span>
<a name="l00621"></a>00621         <span class="comment">//</span>
<a name="l00622"></a>00622         <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(<a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a> + <a class="code" href="hw__emac_8h.html#a14453f1eb729cc538aeceb94156a38a0">EMAC_O_CC</a>) &amp;= ~<a class="code" href="hw__emac_8h.html#a506f07e204d003c5d5de9b88d2c1a2e6">EMAC_CC_CLKEN</a>;
<a name="l00623"></a>00623     }
<a name="l00624"></a>00624 
<a name="l00625"></a>00625     <span class="comment">//</span>
<a name="l00626"></a>00626     <span class="comment">// Reset the MAC regardless of whether the PHY connection changed or not.</span>
<a name="l00627"></a>00627     <span class="comment">//</span>
<a name="l00628"></a>00628     <a class="code" href="group__emac__api.html#gac6bdbf26467dc58bbe45f19ba992d027">EMACReset</a>(<a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l00629"></a>00629 
<a name="l00630"></a>00630     <a class="code" href="sysctl_8h.html#a992a7493f587384e949178cdc4063042">SysCtlDelay</a>(1000);
<a name="l00631"></a>00631 }
<a name="l00632"></a>00632 
<a name="l00633"></a>00633 <span class="comment">//*****************************************************************************</span>
<a name="l00634"></a>00634 <span class="comment">//</span>
<a name="l00816"></a>00816 <span class="comment"></span><span class="comment">//</span>
<a name="l00817"></a>00817 <span class="comment">//*****************************************************************************</span>
<a name="l00818"></a>00818 <span class="keywordtype">void</span>
<a name="l00819"></a><a class="code" href="group__emac__api.html#gac5f841841defc3ca16794ca95508dcea">00819</a> <a class="code" href="group__emac__api.html#gac5f841841defc3ca16794ca95508dcea">EMACConfigSet</a>(uint32_t ui32Base, uint32_t ui32Config, uint32_t ui32ModeFlags,
<a name="l00820"></a>00820               uint32_t ui32RxMaxFrameSize)
<a name="l00821"></a>00821 {
<a name="l00822"></a>00822     <span class="comment">//</span>
<a name="l00823"></a>00823     <span class="comment">// Parameter sanity check.  Note that we allow TX_ENABLED and RX_ENABLED</span>
<a name="l00824"></a>00824     <span class="comment">// here because we&#39;ll mask them off before writing the value and this</span>
<a name="l00825"></a>00825     <span class="comment">// makes back-to-back EMACConfigGet/EMACConfigSet calls work without the</span>
<a name="l00826"></a>00826     <span class="comment">// caller needing to explicitly remove these bits from the parameter.</span>
<a name="l00827"></a>00827     <span class="comment">//</span>
<a name="l00828"></a>00828     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>((ui32Config &amp; ~(<a class="code" href="group__emac__api.html#ga63d330eb3924733a3d22483719f133f2">VALID_CONFIG_FLAGS</a> |  <a class="code" href="group__emac__api.html#ga3902889cb03adb0e7244a9c6f1ce5d7c">EMAC_CONFIG_TX_ENABLED</a> |
<a name="l00829"></a>00829                            <a class="code" href="group__emac__api.html#gaad2c016f5865fbead3f484a3d0e263f8">EMAC_CONFIG_RX_ENABLED</a>)) == 0);
<a name="l00830"></a>00830     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(!ui32RxMaxFrameSize || ((ui32RxMaxFrameSize &lt; 0x4000) &amp;&amp;
<a name="l00831"></a>00831                                    (ui32RxMaxFrameSize &gt; 1522)));
<a name="l00832"></a>00832 
<a name="l00833"></a>00833     <span class="comment">//</span>
<a name="l00834"></a>00834     <span class="comment">// Set the configuration flags as specified.  Note that we unconditionally</span>
<a name="l00835"></a>00835     <span class="comment">// OR in the EMAC_CFG_PS bit here since this implementation supports only</span>
<a name="l00836"></a>00836     <span class="comment">// MII and RMII interfaces to the PHYs.</span>
<a name="l00837"></a>00837     <span class="comment">//</span>
<a name="l00838"></a>00838     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#ad21c8729a348aa5340f52b03f74f9fc7">EMAC_O_CFG</a>) =
<a name="l00839"></a>00839         ((<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#ad21c8729a348aa5340f52b03f74f9fc7">EMAC_O_CFG</a>) &amp; ~<a class="code" href="group__emac__api.html#ga63d330eb3924733a3d22483719f133f2">VALID_CONFIG_FLAGS</a>) | ui32Config |
<a name="l00840"></a>00840          <a class="code" href="hw__emac_8h.html#a6ff1733a3af5dcda2031d4e9e9d49466">EMAC_CFG_PS</a>);
<a name="l00841"></a>00841 
<a name="l00842"></a>00842     <span class="comment">//</span>
<a name="l00843"></a>00843     <span class="comment">// Set the maximum receive frame size.  If 0 is passed, this implies</span>
<a name="l00844"></a>00844     <span class="comment">// that the default maximum frame size should be used so just turn off</span>
<a name="l00845"></a>00845     <span class="comment">// the override.</span>
<a name="l00846"></a>00846     <span class="comment">//</span>
<a name="l00847"></a>00847     <span class="keywordflow">if</span>(ui32RxMaxFrameSize)
<a name="l00848"></a>00848     {
<a name="l00849"></a>00849         <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a0dfd206dcebcc52a40df452ed78bacfb">EMAC_O_WDOGTO</a>) = ui32RxMaxFrameSize | <a class="code" href="hw__emac_8h.html#a2a948c70ce64d9d16589aefc2db6ade4">EMAC_WDOGTO_PWE</a>;
<a name="l00850"></a>00850     }
<a name="l00851"></a>00851     <span class="keywordflow">else</span>
<a name="l00852"></a>00852     {
<a name="l00853"></a>00853         <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a0dfd206dcebcc52a40df452ed78bacfb">EMAC_O_WDOGTO</a>) &amp;= ~<a class="code" href="hw__emac_8h.html#a2a948c70ce64d9d16589aefc2db6ade4">EMAC_WDOGTO_PWE</a>;
<a name="l00854"></a>00854     }
<a name="l00855"></a>00855 
<a name="l00856"></a>00856     <span class="comment">//</span>
<a name="l00857"></a>00857     <span class="comment">// Set the operating mode register.</span>
<a name="l00858"></a>00858     <span class="comment">//</span>
<a name="l00859"></a>00859     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#aee3189d6cfaa8e8435cf387bb3067de2">EMAC_O_DMAOPMODE</a>) = ui32ModeFlags;
<a name="l00860"></a>00860 }
<a name="l00861"></a>00861 
<a name="l00862"></a>00862 <span class="comment">//*****************************************************************************</span>
<a name="l00863"></a>00863 <span class="comment">//</span>
<a name="l01051"></a>01051 <span class="comment"></span><span class="comment">//</span>
<a name="l01052"></a>01052 <span class="comment">//*****************************************************************************</span>
<a name="l01053"></a>01053 <span class="keywordtype">void</span>
<a name="l01054"></a><a class="code" href="group__emac__api.html#ga8ea1b279581199ef36b57397f5cf04b0">01054</a> <a class="code" href="group__emac__api.html#ga8ea1b279581199ef36b57397f5cf04b0">EMACConfigGet</a>(uint32_t ui32Base, uint32_t *pui32Config, uint32_t *pui32Mode,
<a name="l01055"></a>01055               uint32_t *pui32RxMaxFrameSize)
<a name="l01056"></a>01056 {
<a name="l01057"></a>01057     uint32_t ui32Value;
<a name="l01058"></a>01058 
<a name="l01059"></a>01059     <span class="comment">//</span>
<a name="l01060"></a>01060     <span class="comment">// Parameter sanity check.</span>
<a name="l01061"></a>01061     <span class="comment">//</span>
<a name="l01062"></a>01062     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(pui32Mode);
<a name="l01063"></a>01063     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(pui32Config);
<a name="l01064"></a>01064     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(pui32RxMaxFrameSize);
<a name="l01065"></a>01065 
<a name="l01066"></a>01066     <span class="comment">//</span>
<a name="l01067"></a>01067     <span class="comment">// Return the mode information from the operation mode register.</span>
<a name="l01068"></a>01068     <span class="comment">//</span>
<a name="l01069"></a>01069     *pui32Mode = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#aee3189d6cfaa8e8435cf387bb3067de2">EMAC_O_DMAOPMODE</a>);
<a name="l01070"></a>01070 
<a name="l01071"></a>01071     <span class="comment">//</span>
<a name="l01072"></a>01072     <span class="comment">// Return the current configuration flags from the EMAC_O_CFG register.</span>
<a name="l01073"></a>01073     <span class="comment">//</span>
<a name="l01074"></a>01074     *pui32Config = (<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#ad21c8729a348aa5340f52b03f74f9fc7">EMAC_O_CFG</a>) &amp;
<a name="l01075"></a>01075                     (<a class="code" href="group__emac__api.html#ga63d330eb3924733a3d22483719f133f2">VALID_CONFIG_FLAGS</a> | <a class="code" href="group__emac__api.html#ga3902889cb03adb0e7244a9c6f1ce5d7c">EMAC_CONFIG_TX_ENABLED</a> |
<a name="l01076"></a>01076                      <a class="code" href="group__emac__api.html#gaad2c016f5865fbead3f484a3d0e263f8">EMAC_CONFIG_RX_ENABLED</a>));
<a name="l01077"></a>01077 
<a name="l01078"></a>01078     <span class="comment">//</span>
<a name="l01079"></a>01079     <span class="comment">// Get the receive packet size watchdog value.</span>
<a name="l01080"></a>01080     <span class="comment">//</span>
<a name="l01081"></a>01081     ui32Value = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a0dfd206dcebcc52a40df452ed78bacfb">EMAC_O_WDOGTO</a>);
<a name="l01082"></a>01082     <span class="keywordflow">if</span>(ui32Value &amp; <a class="code" href="hw__emac_8h.html#a2a948c70ce64d9d16589aefc2db6ade4">EMAC_WDOGTO_PWE</a>)
<a name="l01083"></a>01083     {
<a name="l01084"></a>01084         <span class="comment">//</span>
<a name="l01085"></a>01085         <span class="comment">// The watchdog is enables so the maximum packet length can be read</span>
<a name="l01086"></a>01086         <span class="comment">// from the watchdog timeout register.</span>
<a name="l01087"></a>01087         <span class="comment">//</span>
<a name="l01088"></a>01088         *pui32RxMaxFrameSize = ui32Value &amp; <a class="code" href="hw__emac_8h.html#a8943ec9d8495514811624bd57d325399">EMAC_WDOGTO_WTO_M</a>;
<a name="l01089"></a>01089     }
<a name="l01090"></a>01090     <span class="keywordflow">else</span>
<a name="l01091"></a>01091     {
<a name="l01092"></a>01092         <span class="comment">//</span>
<a name="l01093"></a>01093         <span class="comment">// The maximum packet size override found in the watchdog timer</span>
<a name="l01094"></a>01094         <span class="comment">// register is not enabled so the maximum packet size is determined</span>
<a name="l01095"></a>01095         <span class="comment">// by whether or not jumbo frame mode is enabled.</span>
<a name="l01096"></a>01096         <span class="comment">//</span>
<a name="l01097"></a>01097         <span class="keywordflow">if</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#ad21c8729a348aa5340f52b03f74f9fc7">EMAC_O_CFG</a>) &amp; <a class="code" href="hw__emac_8h.html#ab592790537b347091f12b6229ce18747">EMAC_CFG_JFEN</a>)
<a name="l01098"></a>01098         {
<a name="l01099"></a>01099             <span class="comment">//</span>
<a name="l01100"></a>01100             <span class="comment">// Jumbo frames are enabled so the watchdog kicks in at 10240</span>
<a name="l01101"></a>01101             <span class="comment">// bytes.</span>
<a name="l01102"></a>01102             <span class="comment">//</span>
<a name="l01103"></a>01103             *pui32RxMaxFrameSize = 10240;
<a name="l01104"></a>01104         }
<a name="l01105"></a>01105         <span class="keywordflow">else</span>
<a name="l01106"></a>01106         {
<a name="l01107"></a>01107             <span class="comment">//</span>
<a name="l01108"></a>01108             <span class="comment">// Jumbo frames are not enabled so the watchdog kicks in at</span>
<a name="l01109"></a>01109             <span class="comment">// 2048 bytes.</span>
<a name="l01110"></a>01110             <span class="comment">//</span>
<a name="l01111"></a>01111             *pui32RxMaxFrameSize = 2048;
<a name="l01112"></a>01112         }
<a name="l01113"></a>01113     }
<a name="l01114"></a>01114 }
<a name="l01115"></a>01115 
<a name="l01116"></a>01116 <span class="comment">//*****************************************************************************</span>
<a name="l01117"></a>01117 <span class="comment">//</span>
<a name="l01168"></a>01168 <span class="comment"></span><span class="comment">//</span>
<a name="l01169"></a>01169 <span class="comment">//*****************************************************************************</span>
<a name="l01170"></a>01170 <span class="keywordtype">void</span>
<a name="l01171"></a><a class="code" href="group__emac__api.html#ga40aad549556a636d8357446823da2f28">01171</a> <a class="code" href="group__emac__api.html#ga40aad549556a636d8357446823da2f28">EMACAddrSet</a>(uint32_t ui32Base, uint32_t ui32Index, <span class="keyword">const</span> uint8_t *pui8MACAddr)
<a name="l01172"></a>01172 {
<a name="l01173"></a>01173     <span class="comment">//</span>
<a name="l01174"></a>01174     <span class="comment">// Parameter sanity check.</span>
<a name="l01175"></a>01175     <span class="comment">//</span>
<a name="l01176"></a>01176     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Index &lt; <a class="code" href="group__emac__api.html#ga8bd32e32ff3c0fb60b08f0ff4f80e16f">NUM_MAC_ADDR</a>);
<a name="l01177"></a>01177     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(pui8MACAddr);
<a name="l01178"></a>01178 
<a name="l01179"></a>01179     <span class="comment">//</span>
<a name="l01180"></a>01180     <span class="comment">// Set the high 2 bytes of the MAC address.  Note that we must set the</span>
<a name="l01181"></a>01181     <span class="comment">// registers in this order since the address is latched internally</span>
<a name="l01182"></a>01182     <span class="comment">// on the write to EMAC_O_ADDRL.</span>
<a name="l01183"></a>01183     <span class="comment">//</span>
<a name="l01184"></a>01184     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="group__emac__api.html#gaae42f1529861aad7033a373008004747">EMAC_O_ADDRH</a>(ui32Index)) =
<a name="l01185"></a>01185         ((<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="group__emac__api.html#gaae42f1529861aad7033a373008004747">EMAC_O_ADDRH</a>(ui32Index)) &amp; 0xFFFF0000) |
<a name="l01186"></a>01186          pui8MACAddr[4] | (pui8MACAddr[5] &lt;&lt; 8));
<a name="l01187"></a>01187 
<a name="l01188"></a>01188     <span class="comment">//</span>
<a name="l01189"></a>01189     <span class="comment">// Set the first 4 bytes of the MAC address</span>
<a name="l01190"></a>01190     <span class="comment">//</span>
<a name="l01191"></a>01191     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="group__emac__api.html#ga9b0fae51315bfa58016cfb9a512067cc">EMAC_O_ADDRL</a>(ui32Index)) =
<a name="l01192"></a>01192         (pui8MACAddr[0] | (pui8MACAddr[1] &lt;&lt; 8) | (pui8MACAddr[2] &lt;&lt; 16) |
<a name="l01193"></a>01193          (pui8MACAddr[3] &lt;&lt; 24));
<a name="l01194"></a>01194 }
<a name="l01195"></a>01195 
<a name="l01196"></a>01196 <span class="comment">//*****************************************************************************</span>
<a name="l01197"></a>01197 <span class="comment">//</span>
<a name="l01223"></a>01223 <span class="comment"></span><span class="comment">//</span>
<a name="l01224"></a>01224 <span class="comment">//*****************************************************************************</span>
<a name="l01225"></a>01225 <span class="keywordtype">void</span>
<a name="l01226"></a><a class="code" href="group__emac__api.html#gaf765810fcca3c99a4628b12f55ec50b3">01226</a> <a class="code" href="group__emac__api.html#gaf765810fcca3c99a4628b12f55ec50b3">EMACAddrGet</a>(uint32_t ui32Base, uint32_t ui32Index, uint8_t *pui8MACAddr)
<a name="l01227"></a>01227 {
<a name="l01228"></a>01228     uint32_t ui32Val;
<a name="l01229"></a>01229 
<a name="l01230"></a>01230     <span class="comment">//</span>
<a name="l01231"></a>01231     <span class="comment">// Parameter sanity check.</span>
<a name="l01232"></a>01232     <span class="comment">//</span>
<a name="l01233"></a>01233     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Index &lt; <a class="code" href="group__emac__api.html#ga8bd32e32ff3c0fb60b08f0ff4f80e16f">NUM_MAC_ADDR</a>);
<a name="l01234"></a>01234     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(pui8MACAddr);
<a name="l01235"></a>01235 
<a name="l01236"></a>01236     <span class="comment">//</span>
<a name="l01237"></a>01237     <span class="comment">// Get the first 4 bytes of the MAC address.</span>
<a name="l01238"></a>01238     <span class="comment">//</span>
<a name="l01239"></a>01239     ui32Val = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="group__emac__api.html#ga9b0fae51315bfa58016cfb9a512067cc">EMAC_O_ADDRL</a>(ui32Index));
<a name="l01240"></a>01240     pui8MACAddr[0] = ui32Val &amp; 0xFF;
<a name="l01241"></a>01241     pui8MACAddr[1] = (ui32Val &gt;&gt; 8) &amp; 0xFF;
<a name="l01242"></a>01242     pui8MACAddr[2] = (ui32Val &gt;&gt; 16) &amp; 0xFF;
<a name="l01243"></a>01243     pui8MACAddr[3] = (ui32Val &gt;&gt; 24) &amp; 0xFF;
<a name="l01244"></a>01244 
<a name="l01245"></a>01245     <span class="comment">//</span>
<a name="l01246"></a>01246     <span class="comment">// Get the last 2 bytes of the MAC address.</span>
<a name="l01247"></a>01247     <span class="comment">//</span>
<a name="l01248"></a>01248     ui32Val = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="group__emac__api.html#gaae42f1529861aad7033a373008004747">EMAC_O_ADDRH</a>(ui32Index));
<a name="l01249"></a>01249     pui8MACAddr[4] = ui32Val &amp; 0xFF;
<a name="l01250"></a>01250     pui8MACAddr[5] = (ui32Val &gt;&gt; 8) &amp; 0xFF;
<a name="l01251"></a>01251 }
<a name="l01252"></a>01252 
<a name="l01253"></a>01253 <span class="comment">//*****************************************************************************</span>
<a name="l01254"></a>01254 <span class="comment">//</span>
<a name="l01264"></a>01264 <span class="comment"></span><span class="comment">//</span>
<a name="l01265"></a>01265 <span class="comment">//*****************************************************************************</span>
<a name="l01266"></a>01266 uint32_t
<a name="l01267"></a><a class="code" href="group__emac__api.html#ga06aa7ee17a6c9cd21ab327167a74158e">01267</a> <a class="code" href="group__emac__api.html#ga06aa7ee17a6c9cd21ab327167a74158e">EMACNumAddrGet</a>(uint32_t ui32Base)
<a name="l01268"></a>01268 {
<a name="l01269"></a>01269     <span class="comment">//</span>
<a name="l01270"></a>01270     <span class="comment">// The only Ethernet controller on Snowflake supports 4 MAC addresses.</span>
<a name="l01271"></a>01271     <span class="comment">//</span>
<a name="l01272"></a>01272     <span class="keywordflow">return</span>(<a class="code" href="group__emac__api.html#ga8bd32e32ff3c0fb60b08f0ff4f80e16f">NUM_MAC_ADDR</a>);
<a name="l01273"></a>01273 }
<a name="l01274"></a>01274 
<a name="l01275"></a>01275 <span class="comment">//*****************************************************************************</span>
<a name="l01276"></a>01276 <span class="comment">//</span>
<a name="l01320"></a>01320 <span class="comment"></span><span class="comment">//</span>
<a name="l01321"></a>01321 <span class="comment">//*****************************************************************************</span>
<a name="l01322"></a>01322 <span class="keywordtype">void</span>
<a name="l01323"></a><a class="code" href="group__emac__api.html#ga1d697d3dfb786cbbd2653c4f534d26f9">01323</a> <a class="code" href="group__emac__api.html#ga1d697d3dfb786cbbd2653c4f534d26f9">EMACAddrFilterSet</a>(uint32_t ui32Base, uint32_t ui32Index, uint32_t ui32Config)
<a name="l01324"></a>01324 {
<a name="l01325"></a>01325     uint32_t ui32Val;
<a name="l01326"></a>01326 
<a name="l01327"></a>01327     <span class="comment">//</span>
<a name="l01328"></a>01328     <span class="comment">// Parameter sanity check.</span>
<a name="l01329"></a>01329     <span class="comment">//</span>
<a name="l01330"></a>01330     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Index &lt; <a class="code" href="group__emac__api.html#ga8bd32e32ff3c0fb60b08f0ff4f80e16f">NUM_MAC_ADDR</a>);
<a name="l01331"></a>01331     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>((ui32Config &amp; ~(<a class="code" href="group__emac__api.html#gafe434fdf7ba9f60e7f3e50ad40fc2c81">EMAC_FILTER_BYTE_MASK_M</a> |
<a name="l01332"></a>01332                            <a class="code" href="group__emac__api.html#gae13a13c478cc8b5c3550254fcc524111">EMAC_FILTER_ADDR_ENABLE</a> |
<a name="l01333"></a>01333                            <a class="code" href="group__emac__api.html#ga837ef964f972a26276337b8264859843">EMAC_FILTER_SOURCE_ADDR</a>)) == 0);
<a name="l01334"></a>01334     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Index);
<a name="l01335"></a>01335 
<a name="l01336"></a>01336     <span class="comment">//</span>
<a name="l01337"></a>01337     <span class="comment">// Set the filter configuration for a particular MAC address.</span>
<a name="l01338"></a>01338     <span class="comment">//</span>
<a name="l01339"></a>01339     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="group__emac__api.html#gaae42f1529861aad7033a373008004747">EMAC_O_ADDRH</a>(ui32Index)) =
<a name="l01340"></a>01340         (<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="group__emac__api.html#gaae42f1529861aad7033a373008004747">EMAC_O_ADDRH</a>(ui32Index)) &amp; 0xFFFF) | ui32Config;
<a name="l01341"></a>01341 
<a name="l01342"></a>01342     <span class="comment">//</span>
<a name="l01343"></a>01343     <span class="comment">// Read and rewrite the low half of the MAC address register to ensure</span>
<a name="l01344"></a>01344     <span class="comment">// that the upper half&#39;s data is latched.</span>
<a name="l01345"></a>01345     <span class="comment">//</span>
<a name="l01346"></a>01346     ui32Val = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="group__emac__api.html#ga9b0fae51315bfa58016cfb9a512067cc">EMAC_O_ADDRL</a>(ui32Index));
<a name="l01347"></a>01347     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="group__emac__api.html#ga9b0fae51315bfa58016cfb9a512067cc">EMAC_O_ADDRL</a>(ui32Index)) = ui32Val;
<a name="l01348"></a>01348 }
<a name="l01349"></a>01349 
<a name="l01350"></a>01350 <span class="comment">//*****************************************************************************</span>
<a name="l01351"></a>01351 <span class="comment">//</span>
<a name="l01391"></a>01391 <span class="comment"></span><span class="comment">//</span>
<a name="l01392"></a>01392 <span class="comment">//*****************************************************************************</span>
<a name="l01393"></a>01393 uint32_t
<a name="l01394"></a><a class="code" href="group__emac__api.html#ga8c6146307cd57b110ec319f0a6968bcf">01394</a> <a class="code" href="group__emac__api.html#ga8c6146307cd57b110ec319f0a6968bcf">EMACAddrFilterGet</a>(uint32_t ui32Base, uint32_t ui32Index)
<a name="l01395"></a>01395 {
<a name="l01396"></a>01396     <span class="comment">//</span>
<a name="l01397"></a>01397     <span class="comment">// Parameter sanity check.</span>
<a name="l01398"></a>01398     <span class="comment">//</span>
<a name="l01399"></a>01399     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Index &lt; <a class="code" href="group__emac__api.html#ga8bd32e32ff3c0fb60b08f0ff4f80e16f">NUM_MAC_ADDR</a>);
<a name="l01400"></a>01400     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Index);
<a name="l01401"></a>01401 
<a name="l01402"></a>01402     <span class="comment">//</span>
<a name="l01403"></a>01403     <span class="comment">// Read and return the filter settings for the requested MAC address slot.</span>
<a name="l01404"></a>01404     <span class="comment">//</span>
<a name="l01405"></a>01405     <span class="keywordflow">return</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="group__emac__api.html#gaae42f1529861aad7033a373008004747">EMAC_O_ADDRH</a>(ui32Index)) &amp;
<a name="l01406"></a>01406            (<a class="code" href="group__emac__api.html#gafe434fdf7ba9f60e7f3e50ad40fc2c81">EMAC_FILTER_BYTE_MASK_M</a> | <a class="code" href="group__emac__api.html#gae13a13c478cc8b5c3550254fcc524111">EMAC_FILTER_ADDR_ENABLE</a> |
<a name="l01407"></a>01407             <a class="code" href="group__emac__api.html#ga837ef964f972a26276337b8264859843">EMAC_FILTER_SOURCE_ADDR</a>));
<a name="l01408"></a>01408 }
<a name="l01409"></a>01409 
<a name="l01410"></a>01410 <span class="comment">//*****************************************************************************</span>
<a name="l01411"></a>01411 <span class="comment">//</span>
<a name="l01481"></a>01481 <span class="comment"></span><span class="comment">//</span>
<a name="l01482"></a>01482 <span class="comment">//*****************************************************************************</span>
<a name="l01483"></a>01483 <span class="keywordtype">void</span>
<a name="l01484"></a><a class="code" href="group__emac__api.html#gae3375d0773f4fd267119de1dcdc6e703">01484</a> <a class="code" href="group__emac__api.html#gae3375d0773f4fd267119de1dcdc6e703">EMACFrameFilterSet</a>(uint32_t ui32Base, uint32_t ui32FilterOpts)
<a name="l01485"></a>01485 {
<a name="l01486"></a>01486     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>((ui32FilterOpts &amp; ~<a class="code" href="group__emac__api.html#gadf376a0c14f0ca42bff7073899309783">VALID_FRMFILTER_FLAGS</a>) == 0);
<a name="l01487"></a>01487 
<a name="l01488"></a>01488     <span class="comment">//</span>
<a name="l01489"></a>01489     <span class="comment">// Set the Ethernet MAC frame filter according to the flags passed.</span>
<a name="l01490"></a>01490     <span class="comment">//</span>
<a name="l01491"></a>01491     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#aea8bee10fe0a2e49ed546c8e28323fb8">EMAC_O_FRAMEFLTR</a>) =
<a name="l01492"></a>01492         ((<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#aea8bee10fe0a2e49ed546c8e28323fb8">EMAC_O_FRAMEFLTR</a>) &amp; ~<a class="code" href="group__emac__api.html#gadf376a0c14f0ca42bff7073899309783">VALID_FRMFILTER_FLAGS</a>) |
<a name="l01493"></a>01493          ui32FilterOpts);
<a name="l01494"></a>01494 }
<a name="l01495"></a>01495 
<a name="l01496"></a>01496 <span class="comment">//*****************************************************************************</span>
<a name="l01497"></a>01497 <span class="comment">//</span>
<a name="l01561"></a>01561 <span class="comment"></span><span class="comment">//</span>
<a name="l01562"></a>01562 <span class="comment">//*****************************************************************************</span>
<a name="l01563"></a>01563 uint32_t
<a name="l01564"></a><a class="code" href="group__emac__api.html#ga42fddd6374aadeecbb713f67feca1df0">01564</a> <a class="code" href="group__emac__api.html#ga42fddd6374aadeecbb713f67feca1df0">EMACFrameFilterGet</a>(uint32_t ui32Base)
<a name="l01565"></a>01565 {
<a name="l01566"></a>01566     <span class="comment">//</span>
<a name="l01567"></a>01567     <span class="comment">// Return the current MAC frame filter setting.</span>
<a name="l01568"></a>01568     <span class="comment">//</span>
<a name="l01569"></a>01569     <span class="keywordflow">return</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#aea8bee10fe0a2e49ed546c8e28323fb8">EMAC_O_FRAMEFLTR</a>) &amp; <a class="code" href="group__emac__api.html#gadf376a0c14f0ca42bff7073899309783">VALID_FRMFILTER_FLAGS</a>);
<a name="l01570"></a>01570 }
<a name="l01571"></a>01571 
<a name="l01572"></a>01572 <span class="comment">//*****************************************************************************</span>
<a name="l01573"></a>01573 <span class="comment">//</span>
<a name="l01600"></a>01600 <span class="comment"></span><span class="comment">//</span>
<a name="l01601"></a>01601 <span class="comment">//*****************************************************************************</span>
<a name="l01602"></a>01602 <span class="keywordtype">void</span>
<a name="l01603"></a><a class="code" href="group__emac__api.html#gae9962073274d2713495ac6faf44f8947">01603</a> <a class="code" href="group__emac__api.html#gae9962073274d2713495ac6faf44f8947">EMACHashFilterSet</a>(uint32_t ui32Base, uint32_t ui32HashHi, uint32_t ui32HashLo)
<a name="l01604"></a>01604 {
<a name="l01605"></a>01605     <span class="comment">// Set the hash table with the values provided.</span>
<a name="l01606"></a>01606     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a346ffebe3068b77693b27bcf36b0d64b">EMAC_O_HASHTBLL</a>) = ui32HashLo;
<a name="l01607"></a>01607     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#aed97283bc521d4690f89cb55ad3d9352">EMAC_O_HASHTBLH</a>) = ui32HashHi;
<a name="l01608"></a>01608 }
<a name="l01609"></a>01609 
<a name="l01610"></a>01610 <span class="comment">//*****************************************************************************</span>
<a name="l01611"></a>01611 <span class="comment">//</span>
<a name="l01635"></a>01635 <span class="comment"></span><span class="comment">//</span>
<a name="l01636"></a>01636 <span class="comment">//*****************************************************************************</span>
<a name="l01637"></a>01637 <span class="keywordtype">void</span>
<a name="l01638"></a><a class="code" href="group__emac__api.html#gab44716c352dd002494d1577857c399ca">01638</a> <a class="code" href="group__emac__api.html#gab44716c352dd002494d1577857c399ca">EMACHashFilterGet</a>(uint32_t ui32Base, uint32_t *pui32HashHi,
<a name="l01639"></a>01639                   uint32_t *pui32HashLo)
<a name="l01640"></a>01640 {
<a name="l01641"></a>01641     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(pui32HashHi);
<a name="l01642"></a>01642     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(pui32HashLo);
<a name="l01643"></a>01643 
<a name="l01644"></a>01644     <span class="comment">//</span>
<a name="l01645"></a>01645     <span class="comment">// Get the current hash table values.</span>
<a name="l01646"></a>01646     <span class="comment">//</span>
<a name="l01647"></a>01647     *pui32HashLo = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a346ffebe3068b77693b27bcf36b0d64b">EMAC_O_HASHTBLL</a>);
<a name="l01648"></a>01648     *pui32HashHi = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#aed97283bc521d4690f89cb55ad3d9352">EMAC_O_HASHTBLH</a>);
<a name="l01649"></a>01649 }
<a name="l01650"></a>01650 
<a name="l01651"></a>01651 <span class="comment">//*****************************************************************************</span>
<a name="l01652"></a>01652 <span class="comment">//</span>
<a name="l01669"></a>01669 <span class="comment"></span><span class="comment">//</span>
<a name="l01670"></a>01670 <span class="comment">//*****************************************************************************</span>
<a name="l01671"></a>01671 uint32_t
<a name="l01672"></a><a class="code" href="group__emac__api.html#gaaefd8278587fdb5bd194914536a5f755">01672</a> <a class="code" href="group__emac__api.html#gaaefd8278587fdb5bd194914536a5f755">EMACHashFilterBitCalculate</a>(uint8_t *pui8MACAddr)
<a name="l01673"></a>01673 {
<a name="l01674"></a>01674     uint32_t ui32CRC, ui32Mask, ui32Loop;
<a name="l01675"></a>01675 
<a name="l01676"></a>01676     <span class="comment">//</span>
<a name="l01677"></a>01677     <span class="comment">// Parameter sanity check.</span>
<a name="l01678"></a>01678     <span class="comment">//</span>
<a name="l01679"></a>01679     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(pui8MACAddr);
<a name="l01680"></a>01680 
<a name="l01681"></a>01681     <span class="comment">//</span>
<a name="l01682"></a>01682     <span class="comment">// Calculate the CRC for the MAC address.</span>
<a name="l01683"></a>01683     <span class="comment">//</span>
<a name="l01684"></a>01684     ui32CRC = <a class="code" href="group__sw__crc__api.html#ga22bfc22485731f3448ff369784b86574">Crc32</a>(0xFFFFFFFF, pui8MACAddr, 6);
<a name="l01685"></a>01685     ui32CRC ^= 0xFFFFFFFF;
<a name="l01686"></a>01686 
<a name="l01687"></a>01687     <span class="comment">//</span>
<a name="l01688"></a>01688     <span class="comment">// Determine the hash bit to use from the calculated CRC.  This is the</span>
<a name="l01689"></a>01689     <span class="comment">// top 6 bits of the reversed CRC (or the bottom 6 bits of the calculated</span>
<a name="l01690"></a>01690     <span class="comment">// CRC with the bit order of those 6 bits reversed).</span>
<a name="l01691"></a>01691     <span class="comment">//</span>
<a name="l01692"></a>01692     ui32Mask = 0;
<a name="l01693"></a>01693 
<a name="l01694"></a>01694     <span class="comment">//</span>
<a name="l01695"></a>01695     <span class="comment">// Reverse the order of the bottom 6 bits of the calculated CRC.</span>
<a name="l01696"></a>01696     <span class="comment">//</span>
<a name="l01697"></a>01697     <span class="keywordflow">for</span>(ui32Loop = 0; ui32Loop &lt; 6; ui32Loop++)
<a name="l01698"></a>01698     {
<a name="l01699"></a>01699         ui32Mask &lt;&lt;= 1;
<a name="l01700"></a>01700         ui32Mask |= (ui32CRC &amp; 1);
<a name="l01701"></a>01701         ui32CRC &gt;&gt;= 1;
<a name="l01702"></a>01702     }
<a name="l01703"></a>01703 
<a name="l01704"></a>01704     <span class="comment">//</span>
<a name="l01705"></a>01705     <span class="comment">// Return the final hash table bit index.</span>
<a name="l01706"></a>01706     <span class="comment">//</span>
<a name="l01707"></a>01707     <span class="keywordflow">return</span>(ui32Mask);
<a name="l01708"></a>01708 }
<a name="l01709"></a>01709 
<a name="l01710"></a>01710 <span class="comment">//*****************************************************************************</span>
<a name="l01711"></a>01711 <span class="comment">//</span>
<a name="l01730"></a>01730 <span class="comment"></span><span class="comment">//</span>
<a name="l01731"></a>01731 <span class="comment">//*****************************************************************************</span>
<a name="l01732"></a>01732 <span class="keywordtype">void</span>
<a name="l01733"></a><a class="code" href="group__emac__api.html#ga331acb5baee336547917d6666df2690e">01733</a> <a class="code" href="group__emac__api.html#ga331acb5baee336547917d6666df2690e">EMACRxWatchdogTimerSet</a>(uint32_t ui32Base, uint8_t ui8Timeout)
<a name="l01734"></a>01734 {
<a name="l01735"></a>01735     <span class="comment">//</span>
<a name="l01736"></a>01736     <span class="comment">// Set the receive interrupt watchdog timeout period.</span>
<a name="l01737"></a>01737     <span class="comment">//</span>
<a name="l01738"></a>01738     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#aa2f39f6db21cfca4bb349249d802f0d8">EMAC_O_RXINTWDT</a>) = (uint32_t)ui8Timeout;
<a name="l01739"></a>01739 }
<a name="l01740"></a>01740 
<a name="l01741"></a>01741 <span class="comment">//*****************************************************************************</span>
<a name="l01742"></a>01742 <span class="comment">//</span>
<a name="l01797"></a>01797 <span class="comment"></span><span class="comment">//</span>
<a name="l01798"></a>01798 <span class="comment">//*****************************************************************************</span>
<a name="l01799"></a>01799 uint32_t
<a name="l01800"></a><a class="code" href="group__emac__api.html#ga859d06d5361b527f1e1407bce4ebcbbb">01800</a> <a class="code" href="group__emac__api.html#ga859d06d5361b527f1e1407bce4ebcbbb">EMACStatusGet</a>(uint32_t ui32Base)
<a name="l01801"></a>01801 {
<a name="l01802"></a>01802     <span class="comment">//</span>
<a name="l01803"></a>01803     <span class="comment">// Read and return the MAC status register content.</span>
<a name="l01804"></a>01804     <span class="comment">//</span>
<a name="l01805"></a>01805     <span class="keywordflow">return</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a704a8e5b5d03200f6263f1e039fc2675">EMAC_O_STATUS</a>));
<a name="l01806"></a>01806 }
<a name="l01807"></a>01807 
<a name="l01808"></a>01808 <span class="comment">//*****************************************************************************</span>
<a name="l01809"></a>01809 <span class="comment">//</span>
<a name="l01823"></a>01823 <span class="comment"></span><span class="comment">//</span>
<a name="l01824"></a>01824 <span class="comment">//*****************************************************************************</span>
<a name="l01825"></a>01825 <span class="keywordtype">void</span>
<a name="l01826"></a><a class="code" href="group__emac__api.html#ga3cafbfbc7de989bec229f26765094dd5">01826</a> <a class="code" href="group__emac__api.html#ga3cafbfbc7de989bec229f26765094dd5">EMACTxDMAPollDemand</a>(uint32_t ui32Base)
<a name="l01827"></a>01827 {
<a name="l01828"></a>01828     <span class="comment">//</span>
<a name="l01829"></a>01829     <span class="comment">// Any write to the MACTXPOLLD register causes the transmit DMA to attempt</span>
<a name="l01830"></a>01830     <span class="comment">// to resume.</span>
<a name="l01831"></a>01831     <span class="comment">//</span>
<a name="l01832"></a>01832     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#af9a6225c53d036b9233209110b24fbf0">EMAC_O_TXPOLLD</a>) = 0;
<a name="l01833"></a>01833 }
<a name="l01834"></a>01834 
<a name="l01835"></a>01835 <span class="comment">//*****************************************************************************</span>
<a name="l01836"></a>01836 <span class="comment">//</span>
<a name="l01850"></a>01850 <span class="comment"></span><span class="comment">//</span>
<a name="l01851"></a>01851 <span class="comment">//*****************************************************************************</span>
<a name="l01852"></a>01852 <span class="keywordtype">void</span>
<a name="l01853"></a><a class="code" href="group__emac__api.html#ga473bdac3a4d64d1b975785811d5ca38d">01853</a> <a class="code" href="group__emac__api.html#ga473bdac3a4d64d1b975785811d5ca38d">EMACRxDMAPollDemand</a>(uint32_t ui32Base)
<a name="l01854"></a>01854 {
<a name="l01855"></a>01855     <span class="comment">//</span>
<a name="l01856"></a>01856     <span class="comment">// Any write to the MACRXPOLLD register causes the receive DMA to attempt</span>
<a name="l01857"></a>01857     <span class="comment">// to resume.</span>
<a name="l01858"></a>01858     <span class="comment">//</span>
<a name="l01859"></a>01859     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#aad3d8bb409878254f7fb2ad1d798b0a3">EMAC_O_RXPOLLD</a>) = 0;
<a name="l01860"></a>01860 }
<a name="l01861"></a>01861 
<a name="l01862"></a>01862 <span class="comment">//*****************************************************************************</span>
<a name="l01863"></a>01863 <span class="comment">//</span>
<a name="l01899"></a>01899 <span class="comment"></span><span class="comment">//</span>
<a name="l01900"></a>01900 <span class="comment">//*****************************************************************************</span>
<a name="l01901"></a>01901 <span class="keywordtype">void</span>
<a name="l01902"></a><a class="code" href="group__emac__api.html#ga5e6f25424033425b90e0701ae1c69c1f">01902</a> <a class="code" href="group__emac__api.html#ga5e6f25424033425b90e0701ae1c69c1f">EMACRxDMADescriptorListSet</a>(uint32_t ui32Base, <a class="code" href="structt_e_m_a_c_d_m_a_descriptor.html" title="A structure defining a single Ethernet DMA buffer descriptor.">tEMACDMADescriptor</a> *pDescriptor)
<a name="l01903"></a>01903 {
<a name="l01904"></a>01904     <span class="comment">//</span>
<a name="l01905"></a>01905     <span class="comment">// Parameter sanity check.</span>
<a name="l01906"></a>01906     <span class="comment">//</span>
<a name="l01907"></a>01907     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(pDescriptor);
<a name="l01908"></a>01908     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(((uint32_t)pDescriptor &amp; 3) == 0);
<a name="l01909"></a>01909 
<a name="l01910"></a>01910     <span class="comment">//</span>
<a name="l01911"></a>01911     <span class="comment">// Write the supplied address to the MACRXDLADDR register.</span>
<a name="l01912"></a>01912     <span class="comment">//</span>
<a name="l01913"></a>01913     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#aa1aff62844a662a41bdfbb9012c3ac45">EMAC_O_RXDLADDR</a>) = (uint32_t)pDescriptor;
<a name="l01914"></a>01914 }
<a name="l01915"></a>01915 
<a name="l01916"></a>01916 <span class="comment">//*****************************************************************************</span>
<a name="l01917"></a>01917 <span class="comment">//</span>
<a name="l01927"></a>01927 <span class="comment"></span><span class="comment">//</span>
<a name="l01928"></a>01928 <span class="comment">//*****************************************************************************</span>
<a name="l01929"></a>01929 <a class="code" href="structt_e_m_a_c_d_m_a_descriptor.html" title="A structure defining a single Ethernet DMA buffer descriptor.">tEMACDMADescriptor</a> *
<a name="l01930"></a><a class="code" href="group__emac__api.html#gab02399c313264d7e3a1f0042fe75a8f0">01930</a> <a class="code" href="group__emac__api.html#gab02399c313264d7e3a1f0042fe75a8f0">EMACRxDMADescriptorListGet</a>(uint32_t ui32Base)
<a name="l01931"></a>01931 {
<a name="l01932"></a>01932     <span class="comment">//</span>
<a name="l01933"></a>01933     <span class="comment">// Return the current receive DMA descriptor list pointer.</span>
<a name="l01934"></a>01934     <span class="comment">//</span>
<a name="l01935"></a>01935     <span class="keywordflow">return</span>((<a class="code" href="structt_e_m_a_c_d_m_a_descriptor.html" title="A structure defining a single Ethernet DMA buffer descriptor.">tEMACDMADescriptor</a> *)<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#aa1aff62844a662a41bdfbb9012c3ac45">EMAC_O_RXDLADDR</a>));
<a name="l01936"></a>01936 }
<a name="l01937"></a>01937 
<a name="l01938"></a>01938 <span class="comment">//*****************************************************************************</span>
<a name="l01939"></a>01939 <span class="comment">//</span>
<a name="l01949"></a>01949 <span class="comment"></span><span class="comment">//</span>
<a name="l01950"></a>01950 <span class="comment">//*****************************************************************************</span>
<a name="l01951"></a>01951 <a class="code" href="structt_e_m_a_c_d_m_a_descriptor.html" title="A structure defining a single Ethernet DMA buffer descriptor.">tEMACDMADescriptor</a> *
<a name="l01952"></a><a class="code" href="group__emac__api.html#ga04da9c4e7816d6335a272aeb338a27fa">01952</a> <a class="code" href="group__emac__api.html#ga04da9c4e7816d6335a272aeb338a27fa">EMACRxDMACurrentDescriptorGet</a>(uint32_t ui32Base)
<a name="l01953"></a>01953 {
<a name="l01954"></a>01954     <span class="comment">//</span>
<a name="l01955"></a>01955     <span class="comment">// Return the address of the current receive descriptor written by the DMA.</span>
<a name="l01956"></a>01956     <span class="comment">//</span>
<a name="l01957"></a>01957     <span class="keywordflow">return</span>((<a class="code" href="structt_e_m_a_c_d_m_a_descriptor.html" title="A structure defining a single Ethernet DMA buffer descriptor.">tEMACDMADescriptor</a> *)<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#ab0e234fc8180dc0031b24e9eecc370e5">EMAC_O_HOSRXDESC</a>));
<a name="l01958"></a>01958 }
<a name="l01959"></a>01959 
<a name="l01960"></a>01960 <span class="comment">//*****************************************************************************</span>
<a name="l01961"></a>01961 <span class="comment">//</span>
<a name="l01971"></a>01971 <span class="comment"></span><span class="comment">//</span>
<a name="l01972"></a>01972 <span class="comment">//*****************************************************************************</span>
<a name="l01973"></a>01973 uint8_t *
<a name="l01974"></a><a class="code" href="group__emac__api.html#ga6683e2b2aee97cba80c6f6475ca68d3a">01974</a> <a class="code" href="group__emac__api.html#ga6683e2b2aee97cba80c6f6475ca68d3a">EMACRxDMACurrentBufferGet</a>(uint32_t ui32Base)
<a name="l01975"></a>01975 {
<a name="l01976"></a>01976     <span class="comment">//</span>
<a name="l01977"></a>01977     <span class="comment">// Return the receive buffer address currently being written by the DMA.</span>
<a name="l01978"></a>01978     <span class="comment">//</span>
<a name="l01979"></a>01979     <span class="keywordflow">return</span>((uint8_t *)<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a3447452a897cb985fb1a1a42cd5ecc67">EMAC_O_HOSRXBA</a>));
<a name="l01980"></a>01980 }
<a name="l01981"></a>01981 
<a name="l01982"></a>01982 <span class="comment">//*****************************************************************************</span>
<a name="l01983"></a>01983 <span class="comment">//</span>
<a name="l02019"></a>02019 <span class="comment"></span><span class="comment">//</span>
<a name="l02020"></a>02020 <span class="comment">//*****************************************************************************</span>
<a name="l02021"></a>02021 <span class="keywordtype">void</span>
<a name="l02022"></a><a class="code" href="group__emac__api.html#gafcafa29a185f206deb1911bc4e9c121e">02022</a> <a class="code" href="group__emac__api.html#gafcafa29a185f206deb1911bc4e9c121e">EMACTxDMADescriptorListSet</a>(uint32_t ui32Base, <a class="code" href="structt_e_m_a_c_d_m_a_descriptor.html" title="A structure defining a single Ethernet DMA buffer descriptor.">tEMACDMADescriptor</a> *pDescriptor)
<a name="l02023"></a>02023 {
<a name="l02024"></a>02024     <span class="comment">//</span>
<a name="l02025"></a>02025     <span class="comment">// Parameter sanity check.</span>
<a name="l02026"></a>02026     <span class="comment">//</span>
<a name="l02027"></a>02027     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(pDescriptor);
<a name="l02028"></a>02028     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(((uint32_t)pDescriptor &amp; 3) == 0);
<a name="l02029"></a>02029 
<a name="l02030"></a>02030     <span class="comment">//</span>
<a name="l02031"></a>02031     <span class="comment">// Write the supplied address to the MACTXDLADDR register.</span>
<a name="l02032"></a>02032     <span class="comment">//</span>
<a name="l02033"></a>02033     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#aca73bbf0cf7795a0e92c7bffabfd816b">EMAC_O_TXDLADDR</a>) = (uint32_t)pDescriptor;
<a name="l02034"></a>02034 }
<a name="l02035"></a>02035 
<a name="l02036"></a>02036 <span class="comment">//*****************************************************************************</span>
<a name="l02037"></a>02037 <span class="comment">//</span>
<a name="l02047"></a>02047 <span class="comment"></span><span class="comment">//</span>
<a name="l02048"></a>02048 <span class="comment">//*****************************************************************************</span>
<a name="l02049"></a>02049 <a class="code" href="structt_e_m_a_c_d_m_a_descriptor.html" title="A structure defining a single Ethernet DMA buffer descriptor.">tEMACDMADescriptor</a> *
<a name="l02050"></a><a class="code" href="group__emac__api.html#ga770482501c4eeb425a95483a48da8027">02050</a> <a class="code" href="group__emac__api.html#ga770482501c4eeb425a95483a48da8027">EMACTxDMADescriptorListGet</a>(uint32_t ui32Base)
<a name="l02051"></a>02051 {
<a name="l02052"></a>02052     <span class="comment">//</span>
<a name="l02053"></a>02053     <span class="comment">// Return the current transmit DMA descriptor list pointer.</span>
<a name="l02054"></a>02054     <span class="comment">//</span>
<a name="l02055"></a>02055     <span class="keywordflow">return</span>((<a class="code" href="structt_e_m_a_c_d_m_a_descriptor.html" title="A structure defining a single Ethernet DMA buffer descriptor.">tEMACDMADescriptor</a> *)<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#aca73bbf0cf7795a0e92c7bffabfd816b">EMAC_O_TXDLADDR</a>));
<a name="l02056"></a>02056 }
<a name="l02057"></a>02057 
<a name="l02058"></a>02058 <span class="comment">//*****************************************************************************</span>
<a name="l02059"></a>02059 <span class="comment">//</span>
<a name="l02069"></a>02069 <span class="comment"></span><span class="comment">//</span>
<a name="l02070"></a>02070 <span class="comment">//*****************************************************************************</span>
<a name="l02071"></a>02071 <a class="code" href="structt_e_m_a_c_d_m_a_descriptor.html" title="A structure defining a single Ethernet DMA buffer descriptor.">tEMACDMADescriptor</a> *
<a name="l02072"></a><a class="code" href="group__emac__api.html#ga396bbd766bccef7c2edee6f893e1a9bf">02072</a> <a class="code" href="group__emac__api.html#ga396bbd766bccef7c2edee6f893e1a9bf">EMACTxDMACurrentDescriptorGet</a>(uint32_t ui32Base)
<a name="l02073"></a>02073 {
<a name="l02074"></a>02074     <span class="comment">//</span>
<a name="l02075"></a>02075     <span class="comment">// Return the address of the current transmit descriptor read by the DMA.</span>
<a name="l02076"></a>02076     <span class="comment">//</span>
<a name="l02077"></a>02077     <span class="keywordflow">return</span>((<a class="code" href="structt_e_m_a_c_d_m_a_descriptor.html" title="A structure defining a single Ethernet DMA buffer descriptor.">tEMACDMADescriptor</a> *)<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#ace26a6e2cce12bb39986d3f8bbf040c6">EMAC_O_HOSTXDESC</a>));
<a name="l02078"></a>02078 }
<a name="l02079"></a>02079 
<a name="l02080"></a>02080 <span class="comment">//*****************************************************************************</span>
<a name="l02081"></a>02081 <span class="comment">//</span>
<a name="l02091"></a>02091 <span class="comment"></span><span class="comment">//</span>
<a name="l02092"></a>02092 <span class="comment">//*****************************************************************************</span>
<a name="l02093"></a>02093 uint8_t *
<a name="l02094"></a><a class="code" href="group__emac__api.html#gac0c88e88afb12fa26b96a4080a41dab9">02094</a> <a class="code" href="group__emac__api.html#gac0c88e88afb12fa26b96a4080a41dab9">EMACTxDMACurrentBufferGet</a>(uint32_t ui32Base)
<a name="l02095"></a>02095 {
<a name="l02096"></a>02096     <span class="comment">//</span>
<a name="l02097"></a>02097     <span class="comment">// Return the transmit buffer address currently being read by the DMA.</span>
<a name="l02098"></a>02098     <span class="comment">//</span>
<a name="l02099"></a>02099     <span class="keywordflow">return</span>((uint8_t *)<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a64fb406b0b85c2b33d1d84007b3c3c35">EMAC_O_HOSTXBA</a>));
<a name="l02100"></a>02100 }
<a name="l02101"></a>02101 
<a name="l02102"></a>02102 <span class="comment">//*****************************************************************************</span>
<a name="l02103"></a>02103 <span class="comment">//</span>
<a name="l02170"></a>02170 <span class="comment"></span><span class="comment">//</span>
<a name="l02171"></a>02171 <span class="comment">//*****************************************************************************</span>
<a name="l02172"></a>02172 uint32_t
<a name="l02173"></a><a class="code" href="group__emac__api.html#gada95d93a0772edd5a0e439739b630cec">02173</a> <a class="code" href="group__emac__api.html#gada95d93a0772edd5a0e439739b630cec">EMACDMAStateGet</a>(uint32_t ui32Base)
<a name="l02174"></a>02174 {
<a name="l02175"></a>02175     <span class="comment">//</span>
<a name="l02176"></a>02176     <span class="comment">// Return the status of the DMA channels.</span>
<a name="l02177"></a>02177     <span class="comment">//</span>
<a name="l02178"></a>02178     <span class="keywordflow">return</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a4325baf434a6eb4802f9290bc81c8fa4">EMAC_O_DMARIS</a>) &amp;
<a name="l02179"></a>02179            (<a class="code" href="hw__emac_8h.html#a4229f492a7dcc85ddfe7093e67c041ac">EMAC_DMARIS_FBI</a> | <a class="code" href="hw__emac_8h.html#aa4b84fac99e1ab63b1308d23ef202a2a">EMAC_DMARIS_AE_M</a> | <a class="code" href="hw__emac_8h.html#a145297a3c27a945717c017e638963d24">EMAC_DMARIS_RS_M</a> |
<a name="l02180"></a>02180             <a class="code" href="hw__emac_8h.html#a9a88859bd53556597f7424ecbdef2821">EMAC_DMARIS_TS_M</a>));
<a name="l02181"></a>02181 }
<a name="l02182"></a>02182 
<a name="l02183"></a>02183 <span class="comment">//*****************************************************************************</span>
<a name="l02184"></a>02184 <span class="comment">//</span>
<a name="l02195"></a>02195 <span class="comment"></span><span class="comment">//</span>
<a name="l02196"></a>02196 <span class="comment">//*****************************************************************************</span>
<a name="l02197"></a>02197 <span class="keywordtype">void</span>
<a name="l02198"></a><a class="code" href="group__emac__api.html#ga2417c9ffd6fc8e71a5956c9181d8a409">02198</a> <a class="code" href="group__emac__api.html#ga2417c9ffd6fc8e71a5956c9181d8a409">EMACTxFlush</a>(uint32_t ui32Base)
<a name="l02199"></a>02199 {
<a name="l02200"></a>02200     <span class="comment">//</span>
<a name="l02201"></a>02201     <span class="comment">// Check to make sure that the FIFO is not already empty.</span>
<a name="l02202"></a>02202     <span class="comment">//</span>
<a name="l02203"></a>02203     <span class="keywordflow">if</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a704a8e5b5d03200f6263f1e039fc2675">EMAC_O_STATUS</a>) &amp; <a class="code" href="hw__emac_8h.html#a9f566dca338690dc269697e20fbf5539">EMAC_STATUS_TXFE</a>)
<a name="l02204"></a>02204     {
<a name="l02205"></a>02205         <span class="comment">//</span>
<a name="l02206"></a>02206         <span class="comment">// Flush the transmit FIFO since it is not currently empty.</span>
<a name="l02207"></a>02207         <span class="comment">//</span>
<a name="l02208"></a>02208         <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#aee3189d6cfaa8e8435cf387bb3067de2">EMAC_O_DMAOPMODE</a>) |= <a class="code" href="hw__emac_8h.html#a503c625f060408759931820da88afd1f">EMAC_DMAOPMODE_FTF</a>;
<a name="l02209"></a>02209 
<a name="l02210"></a>02210         <span class="comment">//</span>
<a name="l02211"></a>02211         <span class="comment">// Wait for the flush to complete.</span>
<a name="l02212"></a>02212         <span class="comment">//</span>
<a name="l02213"></a>02213         <span class="keywordflow">while</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#aee3189d6cfaa8e8435cf387bb3067de2">EMAC_O_DMAOPMODE</a>) &amp; <a class="code" href="hw__emac_8h.html#a503c625f060408759931820da88afd1f">EMAC_DMAOPMODE_FTF</a>)
<a name="l02214"></a>02214         {
<a name="l02215"></a>02215         }
<a name="l02216"></a>02216     }
<a name="l02217"></a>02217 }
<a name="l02218"></a>02218 
<a name="l02219"></a>02219 <span class="comment">//*****************************************************************************</span>
<a name="l02220"></a>02220 <span class="comment">//</span>
<a name="l02230"></a>02230 <span class="comment"></span><span class="comment">//</span>
<a name="l02231"></a>02231 <span class="comment">//*****************************************************************************</span>
<a name="l02232"></a>02232 <span class="keywordtype">void</span>
<a name="l02233"></a><a class="code" href="group__emac__api.html#gaa099f53e5fb158465f739cacef98a8d0">02233</a> <a class="code" href="group__emac__api.html#gaa099f53e5fb158465f739cacef98a8d0">EMACTxEnable</a>(uint32_t ui32Base)
<a name="l02234"></a>02234 {
<a name="l02235"></a>02235     <span class="comment">//</span>
<a name="l02236"></a>02236     <span class="comment">// Enable the MAC transmit path in the opmode register.</span>
<a name="l02237"></a>02237     <span class="comment">//</span>
<a name="l02238"></a>02238     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#aee3189d6cfaa8e8435cf387bb3067de2">EMAC_O_DMAOPMODE</a>) |= <a class="code" href="hw__emac_8h.html#a155bca9d29c764f8fb66283142e185a0">EMAC_DMAOPMODE_ST</a>;
<a name="l02239"></a>02239 
<a name="l02240"></a>02240     <span class="comment">//</span>
<a name="l02241"></a>02241     <span class="comment">// Enable transmission in the MAC configuration register.</span>
<a name="l02242"></a>02242     <span class="comment">//</span>
<a name="l02243"></a>02243     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#ad21c8729a348aa5340f52b03f74f9fc7">EMAC_O_CFG</a>) |= <a class="code" href="hw__emac_8h.html#ad43cb51de523752753a4d4b6473816a5">EMAC_CFG_TE</a>;
<a name="l02244"></a>02244 }
<a name="l02245"></a>02245 
<a name="l02246"></a>02246 <span class="comment">//*****************************************************************************</span>
<a name="l02247"></a>02247 <span class="comment">//</span>
<a name="l02256"></a>02256 <span class="comment"></span><span class="comment">//</span>
<a name="l02257"></a>02257 <span class="comment">//*****************************************************************************</span>
<a name="l02258"></a>02258 <span class="keywordtype">void</span>
<a name="l02259"></a><a class="code" href="group__emac__api.html#ga20e05ae702cd5a5c209b12f4584ae950">02259</a> <a class="code" href="group__emac__api.html#ga20e05ae702cd5a5c209b12f4584ae950">EMACTxDisable</a>(uint32_t ui32Base)
<a name="l02260"></a>02260 {
<a name="l02261"></a>02261     <span class="comment">//</span>
<a name="l02262"></a>02262     <span class="comment">// Disable transmission in the MAC configuration register.</span>
<a name="l02263"></a>02263     <span class="comment">//</span>
<a name="l02264"></a>02264     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#ad21c8729a348aa5340f52b03f74f9fc7">EMAC_O_CFG</a>) &amp;= ~<a class="code" href="hw__emac_8h.html#ad43cb51de523752753a4d4b6473816a5">EMAC_CFG_TE</a>;
<a name="l02265"></a>02265 
<a name="l02266"></a>02266     <span class="comment">//</span>
<a name="l02267"></a>02267     <span class="comment">// Disable the MAC transmit path in the opmode register.</span>
<a name="l02268"></a>02268     <span class="comment">//</span>
<a name="l02269"></a>02269     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#aee3189d6cfaa8e8435cf387bb3067de2">EMAC_O_DMAOPMODE</a>) &amp;= ~<a class="code" href="hw__emac_8h.html#a155bca9d29c764f8fb66283142e185a0">EMAC_DMAOPMODE_ST</a>;
<a name="l02270"></a>02270 }
<a name="l02271"></a>02271 
<a name="l02272"></a>02272 <span class="comment">//*****************************************************************************</span>
<a name="l02273"></a>02273 <span class="comment">//</span>
<a name="l02283"></a>02283 <span class="comment"></span><span class="comment">//</span>
<a name="l02284"></a>02284 <span class="comment">//*****************************************************************************</span>
<a name="l02285"></a>02285 <span class="keywordtype">void</span>
<a name="l02286"></a><a class="code" href="group__emac__api.html#ga3cf71b1750544b3c34b37766e72232b8">02286</a> <a class="code" href="group__emac__api.html#ga3cf71b1750544b3c34b37766e72232b8">EMACRxEnable</a>(uint32_t ui32Base)
<a name="l02287"></a>02287 {
<a name="l02288"></a>02288     <span class="comment">//</span>
<a name="l02289"></a>02289     <span class="comment">// Enable the MAC receive path.</span>
<a name="l02290"></a>02290     <span class="comment">//</span>
<a name="l02291"></a>02291     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#aee3189d6cfaa8e8435cf387bb3067de2">EMAC_O_DMAOPMODE</a>) |= <a class="code" href="hw__emac_8h.html#a6ac86a96b8a0d82237a3631c2c06e0d5">EMAC_DMAOPMODE_SR</a>;
<a name="l02292"></a>02292 
<a name="l02293"></a>02293     <span class="comment">//</span>
<a name="l02294"></a>02294     <span class="comment">// Enable receive in the MAC configuration register.</span>
<a name="l02295"></a>02295     <span class="comment">//</span>
<a name="l02296"></a>02296     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#ad21c8729a348aa5340f52b03f74f9fc7">EMAC_O_CFG</a>) |= <a class="code" href="hw__emac_8h.html#a5f5931f1864e289f169bcfe2c4574c57">EMAC_CFG_RE</a>;
<a name="l02297"></a>02297 }
<a name="l02298"></a>02298 
<a name="l02299"></a>02299 <span class="comment">//*****************************************************************************</span>
<a name="l02300"></a>02300 <span class="comment">//</span>
<a name="l02309"></a>02309 <span class="comment"></span><span class="comment">//</span>
<a name="l02310"></a>02310 <span class="comment">//*****************************************************************************</span>
<a name="l02311"></a>02311 <span class="keywordtype">void</span>
<a name="l02312"></a><a class="code" href="group__emac__api.html#ga53c294e11c1fe14d1d4e5db323172fc3">02312</a> <a class="code" href="group__emac__api.html#ga53c294e11c1fe14d1d4e5db323172fc3">EMACRxDisable</a>(uint32_t ui32Base)
<a name="l02313"></a>02313 {
<a name="l02314"></a>02314     <span class="comment">//</span>
<a name="l02315"></a>02315     <span class="comment">// Disable reception in the MAC configuration register.</span>
<a name="l02316"></a>02316     <span class="comment">//</span>
<a name="l02317"></a>02317     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#ad21c8729a348aa5340f52b03f74f9fc7">EMAC_O_CFG</a>) &amp;= ~<a class="code" href="hw__emac_8h.html#a5f5931f1864e289f169bcfe2c4574c57">EMAC_CFG_RE</a>;
<a name="l02318"></a>02318 
<a name="l02319"></a>02319     <span class="comment">//</span>
<a name="l02320"></a>02320     <span class="comment">// Disable the MAC receive path.</span>
<a name="l02321"></a>02321     <span class="comment">//</span>
<a name="l02322"></a>02322     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#aee3189d6cfaa8e8435cf387bb3067de2">EMAC_O_DMAOPMODE</a>) &amp;= ~<a class="code" href="hw__emac_8h.html#a6ac86a96b8a0d82237a3631c2c06e0d5">EMAC_DMAOPMODE_SR</a>;
<a name="l02323"></a>02323 }
<a name="l02324"></a>02324 
<a name="l02325"></a>02325 <span class="comment">//*****************************************************************************</span>
<a name="l02326"></a>02326 <span class="comment">//</span>
<a name="l02343"></a>02343 <span class="comment"></span><span class="comment">//</span>
<a name="l02344"></a>02344 <span class="comment">//*****************************************************************************</span>
<a name="l02345"></a>02345 <span class="keywordtype">void</span>
<a name="l02346"></a><a class="code" href="group__emac__api.html#gac81628900772eda30e2865a84e09cdf6">02346</a> <a class="code" href="group__emac__api.html#gac81628900772eda30e2865a84e09cdf6">EMACIntRegister</a>(uint32_t ui32Base, <span class="keywordtype">void</span> (*pfnHandler)(<span class="keywordtype">void</span>))
<a name="l02347"></a>02347 {
<a name="l02348"></a>02348     <span class="comment">//</span>
<a name="l02349"></a>02349     <span class="comment">// Check the arguments.</span>
<a name="l02350"></a>02350     <span class="comment">//</span>
<a name="l02351"></a>02351     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(pfnHandler != 0);
<a name="l02352"></a>02352 
<a name="l02353"></a>02353     <span class="comment">//</span>
<a name="l02354"></a>02354     <span class="comment">// Register the interrupt handler.</span>
<a name="l02355"></a>02355     <span class="comment">//</span>
<a name="l02356"></a>02356     <a class="code" href="group__interrupt__api.html#ga0a32aafea7f4904d2a64ee18b45f96c9">IntRegister</a>(<a class="code" href="hw__ints_8h.html#ad2868606dc1c39e3ae9a81c7c02b4bac">INT_EMAC0_TM4C129</a>, pfnHandler);
<a name="l02357"></a>02357 
<a name="l02358"></a>02358     <span class="comment">//</span>
<a name="l02359"></a>02359     <span class="comment">// Enable the Ethernet interrupt.</span>
<a name="l02360"></a>02360     <span class="comment">//</span>
<a name="l02361"></a>02361     <a class="code" href="group__interrupt__api.html#ga49fc9c3d1a0f8c42a20249f8c5d360ce">IntEnable</a>(<a class="code" href="hw__ints_8h.html#ad2868606dc1c39e3ae9a81c7c02b4bac">INT_EMAC0_TM4C129</a>);
<a name="l02362"></a>02362 }
<a name="l02363"></a>02363 
<a name="l02364"></a>02364 <span class="comment">//*****************************************************************************</span>
<a name="l02365"></a>02365 <span class="comment">//</span>
<a name="l02378"></a>02378 <span class="comment"></span><span class="comment">//</span>
<a name="l02379"></a>02379 <span class="comment">//*****************************************************************************</span>
<a name="l02380"></a>02380 <span class="keywordtype">void</span>
<a name="l02381"></a><a class="code" href="group__emac__api.html#ga9d5cb58f12b3cb787e6d796f47bb6f30">02381</a> <a class="code" href="group__emac__api.html#ga9d5cb58f12b3cb787e6d796f47bb6f30">EMACIntUnregister</a>(uint32_t ui32Base)
<a name="l02382"></a>02382 {
<a name="l02383"></a>02383     <span class="comment">//</span>
<a name="l02384"></a>02384     <span class="comment">// Disable the interrupt.</span>
<a name="l02385"></a>02385     <span class="comment">//</span>
<a name="l02386"></a>02386     <a class="code" href="group__interrupt__api.html#ga9af6b00884dc44e92b3d05ff821b5334">IntDisable</a>(<a class="code" href="hw__ints_8h.html#ad2868606dc1c39e3ae9a81c7c02b4bac">INT_EMAC0_TM4C129</a>);
<a name="l02387"></a>02387 
<a name="l02388"></a>02388     <span class="comment">//</span>
<a name="l02389"></a>02389     <span class="comment">// Unregister the interrupt handler.</span>
<a name="l02390"></a>02390     <span class="comment">//</span>
<a name="l02391"></a>02391     <a class="code" href="group__interrupt__api.html#ga5dffc81c27c005f83e9bfc30f775982a">IntUnregister</a>(<a class="code" href="hw__ints_8h.html#ad2868606dc1c39e3ae9a81c7c02b4bac">INT_EMAC0_TM4C129</a>);
<a name="l02392"></a>02392 }
<a name="l02393"></a>02393 
<a name="l02394"></a>02394 <span class="comment">//*****************************************************************************</span>
<a name="l02395"></a>02395 <span class="comment">//</span>
<a name="l02452"></a>02452 <span class="comment"></span><span class="comment">//</span>
<a name="l02453"></a>02453 <span class="comment">//*****************************************************************************</span>
<a name="l02454"></a>02454 <span class="keywordtype">void</span>
<a name="l02455"></a><a class="code" href="group__emac__api.html#ga00e291f3d7162936f3d0317a1546db51">02455</a> <a class="code" href="group__emac__api.html#ga00e291f3d7162936f3d0317a1546db51">EMACIntEnable</a>(uint32_t ui32Base, uint32_t ui32IntFlags)
<a name="l02456"></a>02456 {
<a name="l02457"></a>02457     <span class="comment">//</span>
<a name="l02458"></a>02458     <span class="comment">// Parameter sanity check.</span>
<a name="l02459"></a>02459     <span class="comment">//</span>
<a name="l02460"></a>02460     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>((ui32IntFlags &amp; ~<a class="code" href="group__emac__api.html#ga75a041a656a9b2815db8f04fc8616540">EMAC_MASKABLE_INTS</a>) == 0);
<a name="l02461"></a>02461 
<a name="l02462"></a>02462     <span class="comment">//</span>
<a name="l02463"></a>02463     <span class="comment">// Enable the normal interrupt if any of its individual sources are</span>
<a name="l02464"></a>02464     <span class="comment">// enabled.</span>
<a name="l02465"></a>02465     <span class="comment">//</span>
<a name="l02466"></a>02466     <span class="keywordflow">if</span>(ui32IntFlags &amp; <a class="code" href="group__emac__api.html#ga5d67d3809999859a3fde9779ce0593e6">EMAC_NORMAL_INTS</a>)
<a name="l02467"></a>02467     {
<a name="l02468"></a>02468         ui32IntFlags |= <a class="code" href="group__emac__api.html#gaae9950141a6acb01b3cca52056940634">EMAC_INT_NORMAL_INT</a>;
<a name="l02469"></a>02469     }
<a name="l02470"></a>02470 
<a name="l02471"></a>02471     <span class="comment">//</span>
<a name="l02472"></a>02472     <span class="comment">// Similarly, enable the abnormal interrupt if any of its individual</span>
<a name="l02473"></a>02473     <span class="comment">// sources are enabled.</span>
<a name="l02474"></a>02474     <span class="comment">//</span>
<a name="l02475"></a>02475     <span class="keywordflow">if</span>(ui32IntFlags &amp; <a class="code" href="group__emac__api.html#gaaed04dbd9620d9f5c4e06fdc8d691330">EMAC_ABNORMAL_INTS</a>)
<a name="l02476"></a>02476     {
<a name="l02477"></a>02477         ui32IntFlags |= <a class="code" href="group__emac__api.html#ga666b5356f2498632a2e3b72e239276f4">EMAC_INT_ABNORMAL_INT</a>;
<a name="l02478"></a>02478     }
<a name="l02479"></a>02479 
<a name="l02480"></a>02480     <span class="comment">//</span>
<a name="l02481"></a>02481     <span class="comment">// Set the MAC DMA interrupt mask appropriately if any of the sources</span>
<a name="l02482"></a>02482     <span class="comment">// we&#39;ve been asked to enable are found in that register.</span>
<a name="l02483"></a>02483     <span class="comment">//</span>
<a name="l02484"></a>02484     <span class="keywordflow">if</span>(ui32IntFlags &amp; ~<a class="code" href="group__emac__api.html#ga02fee84d871b0f6e180bffda3bd0d3ed">EMAC_INT_PHY</a>)
<a name="l02485"></a>02485     {
<a name="l02486"></a>02486         <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a1daa016d9570cb773772c49cc284ebbf">EMAC_O_DMAIM</a>) |= ui32IntFlags &amp; ~<a class="code" href="group__emac__api.html#ga02fee84d871b0f6e180bffda3bd0d3ed">EMAC_INT_PHY</a>;
<a name="l02487"></a>02487     }
<a name="l02488"></a>02488 
<a name="l02489"></a>02489     <span class="comment">//</span>
<a name="l02490"></a>02490     <span class="comment">// Enable the PHY interrupt if we&#39;ve been asked to do this.</span>
<a name="l02491"></a>02491     <span class="comment">//</span>
<a name="l02492"></a>02492     <span class="keywordflow">if</span>(ui32IntFlags &amp; <a class="code" href="group__emac__api.html#ga02fee84d871b0f6e180bffda3bd0d3ed">EMAC_INT_PHY</a>)
<a name="l02493"></a>02493     {
<a name="l02494"></a>02494         <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#aae868e2f088c7e56e858dc8449810aec">EMAC_O_EPHYIM</a>) |= <a class="code" href="hw__emac_8h.html#a1759296a4d5a59cc95d14a8aea815516">EMAC_EPHYIM_INT</a>;
<a name="l02495"></a>02495     }
<a name="l02496"></a>02496 }
<a name="l02497"></a>02497 
<a name="l02498"></a>02498 <span class="comment">//*****************************************************************************</span>
<a name="l02499"></a>02499 <span class="comment">//</span>
<a name="l02558"></a>02558 <span class="comment"></span><span class="comment">//</span>
<a name="l02559"></a>02559 <span class="comment">//*****************************************************************************</span>
<a name="l02560"></a>02560 <span class="keywordtype">void</span>
<a name="l02561"></a><a class="code" href="group__emac__api.html#ga3cd70572561d8348b6fd4da688cd9f98">02561</a> <a class="code" href="group__emac__api.html#ga3cd70572561d8348b6fd4da688cd9f98">EMACIntDisable</a>(uint32_t ui32Base, uint32_t ui32IntFlags)
<a name="l02562"></a>02562 {
<a name="l02563"></a>02563     uint32_t ui32Mask;
<a name="l02564"></a>02564 
<a name="l02565"></a>02565     <span class="comment">//</span>
<a name="l02566"></a>02566     <span class="comment">// Parameter sanity check.</span>
<a name="l02567"></a>02567     <span class="comment">//</span>
<a name="l02568"></a>02568     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l02569"></a>02569     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>((ui32IntFlags &amp; ~<a class="code" href="group__emac__api.html#ga75a041a656a9b2815db8f04fc8616540">EMAC_MASKABLE_INTS</a>) == 0);
<a name="l02570"></a>02570 
<a name="l02571"></a>02571     <span class="comment">//</span>
<a name="l02572"></a>02572     <span class="comment">// Get the current interrupt mask.</span>
<a name="l02573"></a>02573     <span class="comment">//</span>
<a name="l02574"></a>02574     ui32Mask = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a1daa016d9570cb773772c49cc284ebbf">EMAC_O_DMAIM</a>);
<a name="l02575"></a>02575 
<a name="l02576"></a>02576     <span class="comment">//</span>
<a name="l02577"></a>02577     <span class="comment">// Clear the requested bits.</span>
<a name="l02578"></a>02578     <span class="comment">//</span>
<a name="l02579"></a>02579     ui32Mask &amp;= ~(ui32IntFlags &amp; ~<a class="code" href="group__emac__api.html#ga02fee84d871b0f6e180bffda3bd0d3ed">EMAC_INT_PHY</a>);
<a name="l02580"></a>02580 
<a name="l02581"></a>02581     <span class="comment">//</span>
<a name="l02582"></a>02582     <span class="comment">// If none of the normal interrupt sources are enabled, disable the</span>
<a name="l02583"></a>02583     <span class="comment">// normal interrupt.</span>
<a name="l02584"></a>02584     <span class="comment">//</span>
<a name="l02585"></a>02585     <span class="keywordflow">if</span>(!(ui32Mask &amp; <a class="code" href="group__emac__api.html#ga5d67d3809999859a3fde9779ce0593e6">EMAC_NORMAL_INTS</a>))
<a name="l02586"></a>02586     {
<a name="l02587"></a>02587         ui32Mask &amp;= ~<a class="code" href="group__emac__api.html#gaae9950141a6acb01b3cca52056940634">EMAC_INT_NORMAL_INT</a>;
<a name="l02588"></a>02588     }
<a name="l02589"></a>02589 
<a name="l02590"></a>02590     <span class="comment">//</span>
<a name="l02591"></a>02591     <span class="comment">// Similarly, if none of the abnormal interrupt sources are enabled,</span>
<a name="l02592"></a>02592     <span class="comment">// disable the abnormal interrupt.</span>
<a name="l02593"></a>02593     <span class="comment">//</span>
<a name="l02594"></a>02594     <span class="keywordflow">if</span>(!(ui32Mask &amp; <a class="code" href="group__emac__api.html#gaaed04dbd9620d9f5c4e06fdc8d691330">EMAC_ABNORMAL_INTS</a>))
<a name="l02595"></a>02595     {
<a name="l02596"></a>02596         ui32Mask &amp;= ~<a class="code" href="group__emac__api.html#ga666b5356f2498632a2e3b72e239276f4">EMAC_INT_ABNORMAL_INT</a>;
<a name="l02597"></a>02597     }
<a name="l02598"></a>02598 
<a name="l02599"></a>02599     <span class="comment">//</span>
<a name="l02600"></a>02600     <span class="comment">// Write the new mask back to the hardware.</span>
<a name="l02601"></a>02601     <span class="comment">//</span>
<a name="l02602"></a>02602     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a1daa016d9570cb773772c49cc284ebbf">EMAC_O_DMAIM</a>) = ui32Mask;
<a name="l02603"></a>02603 
<a name="l02604"></a>02604     <span class="comment">//</span>
<a name="l02605"></a>02605     <span class="comment">// Disable the PHY interrupt if we&#39;ve been asked to do this.</span>
<a name="l02606"></a>02606     <span class="comment">//</span>
<a name="l02607"></a>02607     <span class="keywordflow">if</span>(ui32IntFlags &amp; <a class="code" href="group__emac__api.html#ga02fee84d871b0f6e180bffda3bd0d3ed">EMAC_INT_PHY</a>)
<a name="l02608"></a>02608     {
<a name="l02609"></a>02609         <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#aae868e2f088c7e56e858dc8449810aec">EMAC_O_EPHYIM</a>) &amp;= ~<a class="code" href="hw__emac_8h.html#a1759296a4d5a59cc95d14a8aea815516">EMAC_EPHYIM_INT</a>;
<a name="l02610"></a>02610     }
<a name="l02611"></a>02611 }
<a name="l02612"></a>02612 
<a name="l02613"></a>02613 <span class="comment">//*****************************************************************************</span>
<a name="l02614"></a>02614 <span class="comment">//</span>
<a name="l02673"></a>02673 <span class="comment"></span><span class="comment">//</span>
<a name="l02674"></a>02674 <span class="comment">//*****************************************************************************</span>
<a name="l02675"></a>02675 uint32_t
<a name="l02676"></a><a class="code" href="group__emac__api.html#ga500e332f5be1c1351a53c13383d311d6">02676</a> <a class="code" href="group__emac__api.html#ga500e332f5be1c1351a53c13383d311d6">EMACIntStatus</a>(uint32_t ui32Base, <span class="keywordtype">bool</span> bMasked)
<a name="l02677"></a>02677 {
<a name="l02678"></a>02678     uint32_t ui32Val, ui32PHYStat;
<a name="l02679"></a>02679 
<a name="l02680"></a>02680     <span class="comment">//</span>
<a name="l02681"></a>02681     <span class="comment">// Parameter sanity check.</span>
<a name="l02682"></a>02682     <span class="comment">//</span>
<a name="l02683"></a>02683     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l02684"></a>02684 
<a name="l02685"></a>02685     <span class="comment">//</span>
<a name="l02686"></a>02686     <span class="comment">// Get the unmasked interrupt status and clear any unwanted status fields.</span>
<a name="l02687"></a>02687     <span class="comment">//</span>
<a name="l02688"></a>02688     ui32Val = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a4325baf434a6eb4802f9290bc81c8fa4">EMAC_O_DMARIS</a>);
<a name="l02689"></a>02689     ui32Val &amp;= ~(<a class="code" href="hw__emac_8h.html#aa4b84fac99e1ab63b1308d23ef202a2a">EMAC_DMARIS_AE_M</a> | <a class="code" href="hw__emac_8h.html#a9a88859bd53556597f7424ecbdef2821">EMAC_DMARIS_TS_M</a> | <a class="code" href="hw__emac_8h.html#a145297a3c27a945717c017e638963d24">EMAC_DMARIS_RS_M</a>);
<a name="l02690"></a>02690 
<a name="l02691"></a>02691     <span class="comment">//</span>
<a name="l02692"></a>02692     <span class="comment">// This peripheral doesn&#39;t have a masked interrupt status register</span>
<a name="l02693"></a>02693     <span class="comment">// so perform the masking manually.  Note that only the bottom 16 bits</span>
<a name="l02694"></a>02694     <span class="comment">// of the register can be masked so make sure we take this into account.</span>
<a name="l02695"></a>02695     <span class="comment">//</span>
<a name="l02696"></a>02696     <span class="keywordflow">if</span>(bMasked)
<a name="l02697"></a>02697     {
<a name="l02698"></a>02698         ui32Val &amp;= (<a class="code" href="group__emac__api.html#ga7579fe28e6650a69917e210fc074eb3f">EMAC_NON_MASKED_INTS</a> | <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a1daa016d9570cb773772c49cc284ebbf">EMAC_O_DMAIM</a>));
<a name="l02699"></a>02699     }
<a name="l02700"></a>02700 
<a name="l02701"></a>02701     <span class="comment">//</span>
<a name="l02702"></a>02702     <span class="comment">// Read the PHY interrupt status.</span>
<a name="l02703"></a>02703     <span class="comment">//</span>
<a name="l02704"></a>02704     <span class="keywordflow">if</span>(bMasked)
<a name="l02705"></a>02705     {
<a name="l02706"></a>02706         ui32PHYStat = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a8c7cdd171b3317553d93e7e9ccb8c864">EMAC_O_EPHYMISC</a>);
<a name="l02707"></a>02707     }
<a name="l02708"></a>02708     <span class="keywordflow">else</span>
<a name="l02709"></a>02709     {
<a name="l02710"></a>02710         ui32PHYStat = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a831434012e62c3327d5f76295437052d">EMAC_O_EPHYRIS</a>);
<a name="l02711"></a>02711     }
<a name="l02712"></a>02712 
<a name="l02713"></a>02713     <span class="comment">//</span>
<a name="l02714"></a>02714     <span class="comment">// If the PHY interrupt is reported, add the appropriate flag to the</span>
<a name="l02715"></a>02715     <span class="comment">// return value.</span>
<a name="l02716"></a>02716     <span class="comment">//</span>
<a name="l02717"></a>02717     <span class="keywordflow">if</span>(ui32PHYStat &amp; <a class="code" href="hw__emac_8h.html#a28889887723ed52d50b6bce9a7638556">EMAC_EPHYMISC_INT</a>)
<a name="l02718"></a>02718     {
<a name="l02719"></a>02719         ui32Val |= <a class="code" href="group__emac__api.html#ga02fee84d871b0f6e180bffda3bd0d3ed">EMAC_INT_PHY</a>;
<a name="l02720"></a>02720     }
<a name="l02721"></a>02721 
<a name="l02722"></a>02722     <span class="keywordflow">return</span>(ui32Val);
<a name="l02723"></a>02723 }
<a name="l02724"></a>02724 
<a name="l02725"></a>02725 <span class="comment">//*****************************************************************************</span>
<a name="l02726"></a>02726 <span class="comment">//</span>
<a name="l02778"></a>02778 <span class="comment"></span><span class="comment">//</span>
<a name="l02779"></a>02779 <span class="comment">//*****************************************************************************</span>
<a name="l02780"></a>02780 <span class="keywordtype">void</span>
<a name="l02781"></a><a class="code" href="group__emac__api.html#ga98a90c7fc24bcfd366f2e776d6192085">02781</a> <a class="code" href="group__emac__api.html#ga98a90c7fc24bcfd366f2e776d6192085">EMACIntClear</a>(uint32_t ui32Base, uint32_t ui32IntFlags)
<a name="l02782"></a>02782 {
<a name="l02783"></a>02783     <span class="comment">//</span>
<a name="l02784"></a>02784     <span class="comment">// Parameter sanity check.</span>
<a name="l02785"></a>02785     <span class="comment">//</span>
<a name="l02786"></a>02786     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l02787"></a>02787 
<a name="l02788"></a>02788     <span class="comment">//</span>
<a name="l02789"></a>02789     <span class="comment">// Mask in the normal interrupt if one of the sources it relates to is</span>
<a name="l02790"></a>02790     <span class="comment">// specified.</span>
<a name="l02791"></a>02791     <span class="comment">//</span>
<a name="l02792"></a>02792     <span class="keywordflow">if</span>(ui32IntFlags &amp; <a class="code" href="group__emac__api.html#ga5d67d3809999859a3fde9779ce0593e6">EMAC_NORMAL_INTS</a>)
<a name="l02793"></a>02793     {
<a name="l02794"></a>02794         ui32IntFlags |= <a class="code" href="group__emac__api.html#gaae9950141a6acb01b3cca52056940634">EMAC_INT_NORMAL_INT</a>;
<a name="l02795"></a>02795     }
<a name="l02796"></a>02796 
<a name="l02797"></a>02797     <span class="comment">//</span>
<a name="l02798"></a>02798     <span class="comment">// Similarly, mask in the abnormal interrupt if one of the sources it</span>
<a name="l02799"></a>02799     <span class="comment">// relates to is specified.</span>
<a name="l02800"></a>02800     <span class="comment">//</span>
<a name="l02801"></a>02801     <span class="keywordflow">if</span>(ui32IntFlags &amp; <a class="code" href="group__emac__api.html#gaaed04dbd9620d9f5c4e06fdc8d691330">EMAC_ABNORMAL_INTS</a>)
<a name="l02802"></a>02802     {
<a name="l02803"></a>02803         ui32IntFlags |= <a class="code" href="group__emac__api.html#ga666b5356f2498632a2e3b72e239276f4">EMAC_INT_ABNORMAL_INT</a>;
<a name="l02804"></a>02804     }
<a name="l02805"></a>02805 
<a name="l02806"></a>02806     <span class="comment">//</span>
<a name="l02807"></a>02807     <span class="comment">// Clear the maskable interrupt sources.  We write exactly the value passed</span>
<a name="l02808"></a>02808     <span class="comment">// (with the summary sources added if necessary) but remember that only</span>
<a name="l02809"></a>02809     <span class="comment">// the bottom 17 bits of the register are actually clearable.  Only do</span>
<a name="l02810"></a>02810     <span class="comment">// this if some bits are actually set that refer to the DMA interrupt</span>
<a name="l02811"></a>02811     <span class="comment">// sources.</span>
<a name="l02812"></a>02812     <span class="comment">//</span>
<a name="l02813"></a>02813     <span class="keywordflow">if</span>(ui32IntFlags &amp; ~<a class="code" href="group__emac__api.html#ga02fee84d871b0f6e180bffda3bd0d3ed">EMAC_INT_PHY</a>)
<a name="l02814"></a>02814     {
<a name="l02815"></a>02815         <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a4325baf434a6eb4802f9290bc81c8fa4">EMAC_O_DMARIS</a>) = (ui32IntFlags &amp; ~<a class="code" href="group__emac__api.html#ga02fee84d871b0f6e180bffda3bd0d3ed">EMAC_INT_PHY</a>);
<a name="l02816"></a>02816     }
<a name="l02817"></a>02817 
<a name="l02818"></a>02818     <span class="comment">//</span>
<a name="l02819"></a>02819     <span class="comment">// Clear the PHY interrupt if we&#39;ve been asked to do this.</span>
<a name="l02820"></a>02820     <span class="comment">//</span>
<a name="l02821"></a>02821     <span class="keywordflow">if</span>(ui32IntFlags &amp; <a class="code" href="group__emac__api.html#ga02fee84d871b0f6e180bffda3bd0d3ed">EMAC_INT_PHY</a>)
<a name="l02822"></a>02822     {
<a name="l02823"></a>02823         <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a8c7cdd171b3317553d93e7e9ccb8c864">EMAC_O_EPHYMISC</a>) |= <a class="code" href="hw__emac_8h.html#a28889887723ed52d50b6bce9a7638556">EMAC_EPHYMISC_INT</a>;
<a name="l02824"></a>02824     }
<a name="l02825"></a>02825 }
<a name="l02826"></a>02826 
<a name="l02827"></a>02827 <span class="comment">//*****************************************************************************</span>
<a name="l02828"></a>02828 <span class="comment">//</span>
<a name="l02840"></a>02840 <span class="comment"></span><span class="comment">//</span>
<a name="l02841"></a>02841 <span class="comment">//*****************************************************************************</span>
<a name="l02842"></a>02842 <span class="keywordtype">void</span>
<a name="l02843"></a><a class="code" href="group__emac__api.html#gaf5e2ab72bce5f10762100469dea4fd10">02843</a> <a class="code" href="group__emac__api.html#gaf5e2ab72bce5f10762100469dea4fd10">EMACPHYWrite</a>(uint32_t ui32Base, uint8_t ui8PhyAddr, uint8_t ui8RegAddr,
<a name="l02844"></a>02844              uint16_t ui16Data)
<a name="l02845"></a>02845 {
<a name="l02846"></a>02846     <span class="comment">//</span>
<a name="l02847"></a>02847     <span class="comment">// Parameter sanity check.</span>
<a name="l02848"></a>02848     <span class="comment">//</span>
<a name="l02849"></a>02849     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l02850"></a>02850 
<a name="l02851"></a>02851     <span class="comment">//</span>
<a name="l02852"></a>02852     <span class="comment">// Parameter sanity check.</span>
<a name="l02853"></a>02853     <span class="comment">//</span>
<a name="l02854"></a>02854     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui8PhyAddr &lt; 32);
<a name="l02855"></a>02855 
<a name="l02856"></a>02856     <span class="comment">//</span>
<a name="l02857"></a>02857     <span class="comment">// Make sure the MII is idle.</span>
<a name="l02858"></a>02858     <span class="comment">//</span>
<a name="l02859"></a>02859     <span class="keywordflow">while</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a1cc6799662f573687ed4a46c978f9eaa">EMAC_O_MIIADDR</a>) &amp; <a class="code" href="hw__emac_8h.html#ab9f4725bb7c47f80af2216824966050d">EMAC_MIIADDR_MIIB</a>)
<a name="l02860"></a>02860     {
<a name="l02861"></a>02861     }
<a name="l02862"></a>02862 
<a name="l02863"></a>02863     <span class="comment">//</span>
<a name="l02864"></a>02864     <span class="comment">// Write the value provided.</span>
<a name="l02865"></a>02865     <span class="comment">//</span>
<a name="l02866"></a>02866     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#af66cf31de2e4be9b8cebce0f3f9524f4">EMAC_O_MIIDATA</a>) = ui16Data;
<a name="l02867"></a>02867 
<a name="l02868"></a>02868     <span class="comment">//</span>
<a name="l02869"></a>02869     <span class="comment">// Tell the MAC to write the given PHY register.</span>
<a name="l02870"></a>02870     <span class="comment">//</span>
<a name="l02871"></a>02871     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a1cc6799662f573687ed4a46c978f9eaa">EMAC_O_MIIADDR</a>) =
<a name="l02872"></a>02872         ((<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a1cc6799662f573687ed4a46c978f9eaa">EMAC_O_MIIADDR</a>) &amp;
<a name="l02873"></a>02873           <a class="code" href="hw__emac_8h.html#a27f41a621a6fe1618624cf6084d43bec">EMAC_MIIADDR_CR_M</a>) | (ui8RegAddr &lt;&lt; <a class="code" href="hw__emac_8h.html#a93b6744e5dda2b53621e64af27ad95b9">EMAC_MIIADDR_MII_S</a>) |
<a name="l02874"></a>02874          (ui8PhyAddr &lt;&lt; <a class="code" href="hw__emac_8h.html#af71e8304fd8898ae1f495c260437f4ff">EMAC_MIIADDR_PLA_S</a>) | <a class="code" href="hw__emac_8h.html#af532f238631b1e32e7c4a178c5c6cebe">EMAC_MIIADDR_MIIW</a> |
<a name="l02875"></a>02875          EMAC_MIIADDR_MIIB);
<a name="l02876"></a>02876 
<a name="l02877"></a>02877     <span class="comment">//</span>
<a name="l02878"></a>02878     <span class="comment">// Wait for the write to complete.</span>
<a name="l02879"></a>02879     <span class="comment">//</span>
<a name="l02880"></a>02880     <span class="keywordflow">while</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a1cc6799662f573687ed4a46c978f9eaa">EMAC_O_MIIADDR</a>) &amp; <a class="code" href="hw__emac_8h.html#ab9f4725bb7c47f80af2216824966050d">EMAC_MIIADDR_MIIB</a>)
<a name="l02881"></a>02881     {
<a name="l02882"></a>02882     }
<a name="l02883"></a>02883 }
<a name="l02884"></a>02884 
<a name="l02885"></a>02885 <span class="comment">//*****************************************************************************</span>
<a name="l02886"></a>02886 <span class="comment">//</span>
<a name="l02897"></a>02897 <span class="comment"></span><span class="comment">//</span>
<a name="l02898"></a>02898 <span class="comment">//*****************************************************************************</span>
<a name="l02899"></a>02899 uint16_t
<a name="l02900"></a><a class="code" href="group__emac__api.html#ga759015cbf031b85118cd20775e5b7746">02900</a> <a class="code" href="group__emac__api.html#ga759015cbf031b85118cd20775e5b7746">EMACPHYRead</a>(uint32_t ui32Base, uint8_t ui8PhyAddr, uint8_t ui8RegAddr)
<a name="l02901"></a>02901 {
<a name="l02902"></a>02902     <span class="comment">//</span>
<a name="l02903"></a>02903     <span class="comment">// Parameter sanity check.</span>
<a name="l02904"></a>02904     <span class="comment">//</span>
<a name="l02905"></a>02905     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui8PhyAddr &lt; 32);
<a name="l02906"></a>02906     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l02907"></a>02907 
<a name="l02908"></a>02908     <span class="comment">//</span>
<a name="l02909"></a>02909     <span class="comment">// Make sure the MII is idle.</span>
<a name="l02910"></a>02910     <span class="comment">//</span>
<a name="l02911"></a>02911     <span class="keywordflow">while</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a1cc6799662f573687ed4a46c978f9eaa">EMAC_O_MIIADDR</a>) &amp; <a class="code" href="hw__emac_8h.html#ab9f4725bb7c47f80af2216824966050d">EMAC_MIIADDR_MIIB</a>)
<a name="l02912"></a>02912     {
<a name="l02913"></a>02913     }
<a name="l02914"></a>02914 
<a name="l02915"></a>02915     <span class="comment">//</span>
<a name="l02916"></a>02916     <span class="comment">// Tell the MAC to read the given PHY register.</span>
<a name="l02917"></a>02917     <span class="comment">//</span>
<a name="l02918"></a>02918     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a1cc6799662f573687ed4a46c978f9eaa">EMAC_O_MIIADDR</a>) =
<a name="l02919"></a>02919         ((<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a1cc6799662f573687ed4a46c978f9eaa">EMAC_O_MIIADDR</a>) &amp; <a class="code" href="hw__emac_8h.html#a27f41a621a6fe1618624cf6084d43bec">EMAC_MIIADDR_CR_M</a>) |
<a name="l02920"></a>02920          (ui8RegAddr &lt;&lt; <a class="code" href="hw__emac_8h.html#a93b6744e5dda2b53621e64af27ad95b9">EMAC_MIIADDR_MII_S</a>) |
<a name="l02921"></a>02921          (ui8PhyAddr &lt;&lt; <a class="code" href="hw__emac_8h.html#af71e8304fd8898ae1f495c260437f4ff">EMAC_MIIADDR_PLA_S</a>) | EMAC_MIIADDR_MIIB);
<a name="l02922"></a>02922 
<a name="l02923"></a>02923     <span class="comment">//</span>
<a name="l02924"></a>02924     <span class="comment">// Wait for the read to complete.</span>
<a name="l02925"></a>02925     <span class="comment">//</span>
<a name="l02926"></a>02926     <span class="keywordflow">while</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a1cc6799662f573687ed4a46c978f9eaa">EMAC_O_MIIADDR</a>) &amp; <a class="code" href="hw__emac_8h.html#ab9f4725bb7c47f80af2216824966050d">EMAC_MIIADDR_MIIB</a>)
<a name="l02927"></a>02927     {
<a name="l02928"></a>02928     }
<a name="l02929"></a>02929 
<a name="l02930"></a>02930     <span class="comment">//</span>
<a name="l02931"></a>02931     <span class="comment">// Return the result.</span>
<a name="l02932"></a>02932     <span class="comment">//</span>
<a name="l02933"></a>02933     <span class="keywordflow">return</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#af66cf31de2e4be9b8cebce0f3f9524f4">EMAC_O_MIIDATA</a>) &amp; <a class="code" href="hw__emac_8h.html#af087923cd72d7b2c198c085cf401cc42">EMAC_MIIDATA_DATA_M</a>);
<a name="l02934"></a>02934 }
<a name="l02935"></a>02935 
<a name="l02936"></a>02936 <span class="comment">//*****************************************************************************</span>
<a name="l02937"></a>02937 <span class="comment">//</span>
<a name="l02950"></a>02950 <span class="comment"></span><span class="comment">//</span>
<a name="l02951"></a>02951 <span class="comment">//*****************************************************************************</span>
<a name="l02952"></a>02952 uint16_t
<a name="l02953"></a><a class="code" href="group__emac__api.html#ga6b3428f8d47bf7d0c802283bda1909e2">02953</a> <a class="code" href="group__emac__api.html#ga6b3428f8d47bf7d0c802283bda1909e2">EMACPHYExtendedRead</a>(uint32_t ui32Base, uint8_t ui8PhyAddr,
<a name="l02954"></a>02954                     uint16_t ui16RegAddr)
<a name="l02955"></a>02955 {
<a name="l02956"></a>02956     <span class="comment">//</span>
<a name="l02957"></a>02957     <span class="comment">// Parameter sanity check.</span>
<a name="l02958"></a>02958     <span class="comment">//</span>
<a name="l02959"></a>02959     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui8PhyAddr &lt; 32);
<a name="l02960"></a>02960     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l02961"></a>02961 
<a name="l02962"></a>02962     <span class="comment">//</span>
<a name="l02963"></a>02963     <span class="comment">// Set the address of the register we&#39;re about to read.</span>
<a name="l02964"></a>02964     <span class="comment">//</span>
<a name="l02965"></a>02965     <a class="code" href="group__emac__api.html#gaf5e2ab72bce5f10762100469dea4fd10">EMACPHYWrite</a>(<a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>, ui8PhyAddr, <a class="code" href="hw__emac_8h.html#aeb653f6035f29d87d982eafe2e751a6d">EPHY_REGCTL</a>, 0x001F);
<a name="l02966"></a>02966     <a class="code" href="group__emac__api.html#gaf5e2ab72bce5f10762100469dea4fd10">EMACPHYWrite</a>(<a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>, ui8PhyAddr, <a class="code" href="hw__emac_8h.html#aea7e15e371055887f958d69ca4e54be1">EPHY_ADDAR</a>, ui16RegAddr);
<a name="l02967"></a>02967 
<a name="l02968"></a>02968     <span class="comment">//</span>
<a name="l02969"></a>02969     <span class="comment">// Read the extended register value.</span>
<a name="l02970"></a>02970     <span class="comment">//</span>
<a name="l02971"></a>02971     <a class="code" href="group__emac__api.html#gaf5e2ab72bce5f10762100469dea4fd10">EMACPHYWrite</a>(<a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>, ui8PhyAddr, <a class="code" href="hw__emac_8h.html#aeb653f6035f29d87d982eafe2e751a6d">EPHY_REGCTL</a>, 0x401F);
<a name="l02972"></a>02972     <span class="keywordflow">return</span>(<a class="code" href="group__emac__api.html#ga759015cbf031b85118cd20775e5b7746">EMACPHYRead</a>(<a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>, ui8PhyAddr, <a class="code" href="hw__emac_8h.html#aea7e15e371055887f958d69ca4e54be1">EPHY_ADDAR</a>));
<a name="l02973"></a>02973 }
<a name="l02974"></a>02974 
<a name="l02975"></a>02975 <span class="comment">//*****************************************************************************</span>
<a name="l02976"></a>02976 <span class="comment">//</span>
<a name="l02990"></a>02990 <span class="comment"></span><span class="comment">//</span>
<a name="l02991"></a>02991 <span class="comment">//*****************************************************************************</span>
<a name="l02992"></a>02992 <span class="keywordtype">void</span>
<a name="l02993"></a><a class="code" href="group__emac__api.html#gae7c9b0907beeac02750a042f2317f5a1">02993</a> <a class="code" href="group__emac__api.html#gae7c9b0907beeac02750a042f2317f5a1">EMACPHYExtendedWrite</a>(uint32_t ui32Base, uint8_t ui8PhyAddr,
<a name="l02994"></a>02994                      uint16_t ui16RegAddr, uint16_t ui16Value)
<a name="l02995"></a>02995 {
<a name="l02996"></a>02996     <span class="comment">//</span>
<a name="l02997"></a>02997     <span class="comment">// Parameter sanity check.</span>
<a name="l02998"></a>02998     <span class="comment">//</span>
<a name="l02999"></a>02999     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui8PhyAddr &lt; 32);
<a name="l03000"></a>03000     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l03001"></a>03001 
<a name="l03002"></a>03002     <span class="comment">//</span>
<a name="l03003"></a>03003     <span class="comment">// Set the address of the register we&#39;re about to write.</span>
<a name="l03004"></a>03004     <span class="comment">//</span>
<a name="l03005"></a>03005     <a class="code" href="group__emac__api.html#gaf5e2ab72bce5f10762100469dea4fd10">EMACPHYWrite</a>(<a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>, ui8PhyAddr, <a class="code" href="hw__emac_8h.html#aeb653f6035f29d87d982eafe2e751a6d">EPHY_REGCTL</a>, 0x001F);
<a name="l03006"></a>03006     <a class="code" href="group__emac__api.html#gaf5e2ab72bce5f10762100469dea4fd10">EMACPHYWrite</a>(<a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>, ui8PhyAddr, <a class="code" href="hw__emac_8h.html#aea7e15e371055887f958d69ca4e54be1">EPHY_ADDAR</a>, ui16RegAddr);
<a name="l03007"></a>03007 
<a name="l03008"></a>03008     <span class="comment">//</span>
<a name="l03009"></a>03009     <span class="comment">// Write the extended register.</span>
<a name="l03010"></a>03010     <span class="comment">//</span>
<a name="l03011"></a>03011     <a class="code" href="group__emac__api.html#gaf5e2ab72bce5f10762100469dea4fd10">EMACPHYWrite</a>(<a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>, ui8PhyAddr, <a class="code" href="hw__emac_8h.html#aeb653f6035f29d87d982eafe2e751a6d">EPHY_REGCTL</a>, 0x401F);
<a name="l03012"></a>03012     <a class="code" href="group__emac__api.html#gaf5e2ab72bce5f10762100469dea4fd10">EMACPHYWrite</a>(<a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>, ui8PhyAddr, <a class="code" href="hw__emac_8h.html#aea7e15e371055887f958d69ca4e54be1">EPHY_ADDAR</a>, ui16Value);
<a name="l03013"></a>03013 }
<a name="l03014"></a>03014 
<a name="l03015"></a>03015 <span class="comment">//*****************************************************************************</span>
<a name="l03016"></a>03016 <span class="comment">//</span>
<a name="l03027"></a>03027 <span class="comment"></span><span class="comment">//</span>
<a name="l03028"></a>03028 <span class="comment">//*****************************************************************************</span>
<a name="l03029"></a>03029 <span class="keywordtype">void</span>
<a name="l03030"></a><a class="code" href="group__emac__api.html#ga0080e044c910d6b0ab48d22bc8a38846">03030</a> <a class="code" href="group__emac__api.html#ga0080e044c910d6b0ab48d22bc8a38846">EMACPHYPowerOff</a>(uint32_t ui32Base, uint8_t ui8PhyAddr)
<a name="l03031"></a>03031 {
<a name="l03032"></a>03032     <span class="comment">//</span>
<a name="l03033"></a>03033     <span class="comment">// Set the PWRDN bit and clear the ANEN bit in the PHY, putting it into</span>
<a name="l03034"></a>03034     <span class="comment">// its low power mode.</span>
<a name="l03035"></a>03035     <span class="comment">//</span>
<a name="l03036"></a>03036     <a class="code" href="group__emac__api.html#gaf5e2ab72bce5f10762100469dea4fd10">EMACPHYWrite</a>(ui32Base, ui8PhyAddr, <a class="code" href="hw__emac_8h.html#ac255171e2801e57a0d00c6a75af13c59">EPHY_BMCR</a>,
<a name="l03037"></a>03037                  (<a class="code" href="group__emac__api.html#ga759015cbf031b85118cd20775e5b7746">EMACPHYRead</a>(ui32Base, ui8PhyAddr, <a class="code" href="hw__emac_8h.html#ac255171e2801e57a0d00c6a75af13c59">EPHY_BMCR</a>) &amp;
<a name="l03038"></a>03038                   ~<a class="code" href="hw__emac_8h.html#a40e94f35e4d9c441fdb7622209a31675">EPHY_BMCR_ANEN</a>) | <a class="code" href="hw__emac_8h.html#a14da5ae310dfa418b66714c17c36912a">EPHY_BMCR_PWRDWN</a>);
<a name="l03039"></a>03039 }
<a name="l03040"></a>03040 
<a name="l03041"></a>03041 <span class="comment">//*****************************************************************************</span>
<a name="l03042"></a>03042 <span class="comment">//</span>
<a name="l03053"></a>03053 <span class="comment"></span><span class="comment">//</span>
<a name="l03054"></a>03054 <span class="comment">//*****************************************************************************</span>
<a name="l03055"></a>03055 <span class="keywordtype">void</span>
<a name="l03056"></a><a class="code" href="group__emac__api.html#gac0751c7cb2f7d7a3110c1df9fe365765">03056</a> <a class="code" href="group__emac__api.html#gac0751c7cb2f7d7a3110c1df9fe365765">EMACPHYPowerOn</a>(uint32_t ui32Base, uint8_t ui8PhyAddr)
<a name="l03057"></a>03057 {
<a name="l03058"></a>03058     <span class="comment">//</span>
<a name="l03059"></a>03059     <span class="comment">// Clear the PWRDN bit and set the ANEGEN bit in the PHY, putting it into</span>
<a name="l03060"></a>03060     <span class="comment">// normal operating mode.</span>
<a name="l03061"></a>03061     <span class="comment">//</span>
<a name="l03062"></a>03062     <a class="code" href="group__emac__api.html#gaf5e2ab72bce5f10762100469dea4fd10">EMACPHYWrite</a>(ui32Base, ui8PhyAddr, <a class="code" href="hw__emac_8h.html#ac255171e2801e57a0d00c6a75af13c59">EPHY_BMCR</a>,
<a name="l03063"></a>03063                  (<a class="code" href="group__emac__api.html#ga759015cbf031b85118cd20775e5b7746">EMACPHYRead</a>(ui32Base, ui8PhyAddr, <a class="code" href="hw__emac_8h.html#ac255171e2801e57a0d00c6a75af13c59">EPHY_BMCR</a>) &amp;
<a name="l03064"></a>03064                   ~<a class="code" href="hw__emac_8h.html#a14da5ae310dfa418b66714c17c36912a">EPHY_BMCR_PWRDWN</a>) | <a class="code" href="hw__emac_8h.html#a40e94f35e4d9c441fdb7622209a31675">EPHY_BMCR_ANEN</a>);
<a name="l03065"></a>03065 }
<a name="l03066"></a>03066 
<a name="l03067"></a>03067 <span class="comment">//*****************************************************************************</span>
<a name="l03068"></a>03068 <span class="comment">//</span>
<a name="l03187"></a>03187 <span class="comment"></span><span class="comment">//</span>
<a name="l03188"></a>03188 <span class="comment">//*****************************************************************************</span>
<a name="l03189"></a>03189 <span class="keywordtype">void</span>
<a name="l03190"></a><a class="code" href="group__emac__api.html#gaa1145b330c9da2d665730a51739a27d2">03190</a> <a class="code" href="group__emac__api.html#gaa1145b330c9da2d665730a51739a27d2">EMACTimestampConfigSet</a>(uint32_t ui32Base, uint32_t ui32Config,
<a name="l03191"></a>03191                        uint32_t ui32SubSecondInc)
<a name="l03192"></a>03192 {
<a name="l03193"></a>03193     <span class="comment">//</span>
<a name="l03194"></a>03194     <span class="comment">// Parameter sanity check.</span>
<a name="l03195"></a>03195     <span class="comment">//</span>
<a name="l03196"></a>03196     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l03197"></a>03197 
<a name="l03198"></a>03198     <span class="comment">//</span>
<a name="l03199"></a>03199     <span class="comment">// Ensure that the PTP module clock is enabled.</span>
<a name="l03200"></a>03200     <span class="comment">//</span>
<a name="l03201"></a>03201     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a14453f1eb729cc538aeceb94156a38a0">EMAC_O_CC</a>) |= <a class="code" href="hw__emac_8h.html#a0891b560c043ac00818bebf969f21d57">EMAC_CC_PTPCEN</a>;
<a name="l03202"></a>03202 
<a name="l03203"></a>03203     <span class="comment">//</span>
<a name="l03204"></a>03204     <span class="comment">// Write the subsecond increment value.</span>
<a name="l03205"></a>03205     <span class="comment">//</span>
<a name="l03206"></a>03206     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a1a180765640e3b07ed790d0969f512eb">EMAC_O_SUBSECINC</a>) = ((ui32SubSecondInc &lt;&lt;
<a name="l03207"></a>03207                                            <a class="code" href="hw__emac_8h.html#a9c4e687a795d0d01d8dd36ac93d7ac4e">EMAC_SUBSECINC_SSINC_S</a>) &amp;
<a name="l03208"></a>03208                                           <a class="code" href="hw__emac_8h.html#aeff1917f6e1797fc46801787a09b2ad1">EMAC_SUBSECINC_SSINC_M</a>);
<a name="l03209"></a>03209 
<a name="l03210"></a>03210     <span class="comment">//</span>
<a name="l03211"></a>03211     <span class="comment">// Set the timestamp configuration.</span>
<a name="l03212"></a>03212     <span class="comment">//</span>
<a name="l03213"></a>03213     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#ad90f4d80c14554b267adc47644e296af">EMAC_O_TIMSTCTRL</a>) = ui32Config;
<a name="l03214"></a>03214 }
<a name="l03215"></a>03215 
<a name="l03216"></a>03216 <span class="comment">//*****************************************************************************</span>
<a name="l03217"></a>03217 <span class="comment">//</span>
<a name="l03279"></a>03279 <span class="comment"></span><span class="comment">//</span>
<a name="l03280"></a>03280 <span class="comment">//*****************************************************************************</span>
<a name="l03281"></a>03281 uint32_t
<a name="l03282"></a><a class="code" href="group__emac__api.html#ga9de9c904c32b3f8a6515019ab6e66782">03282</a> <a class="code" href="group__emac__api.html#ga9de9c904c32b3f8a6515019ab6e66782">EMACTimestampConfigGet</a>(uint32_t ui32Base, uint32_t *pui32SubSecondInc)
<a name="l03283"></a>03283 {
<a name="l03284"></a>03284     <span class="comment">//</span>
<a name="l03285"></a>03285     <span class="comment">// Parameter sanity check.</span>
<a name="l03286"></a>03286     <span class="comment">//</span>
<a name="l03287"></a>03287     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l03288"></a>03288     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(pui32SubSecondInc);
<a name="l03289"></a>03289 
<a name="l03290"></a>03290     <span class="comment">//</span>
<a name="l03291"></a>03291     <span class="comment">// Read the current subsecond increment value.</span>
<a name="l03292"></a>03292     <span class="comment">//</span>
<a name="l03293"></a>03293     *pui32SubSecondInc = (<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a1a180765640e3b07ed790d0969f512eb">EMAC_O_SUBSECINC</a>) &amp;
<a name="l03294"></a>03294                           <a class="code" href="hw__emac_8h.html#aeff1917f6e1797fc46801787a09b2ad1">EMAC_SUBSECINC_SSINC_M</a>) &gt;&gt; <a class="code" href="hw__emac_8h.html#a9c4e687a795d0d01d8dd36ac93d7ac4e">EMAC_SUBSECINC_SSINC_S</a>;
<a name="l03295"></a>03295 
<a name="l03296"></a>03296     <span class="comment">//</span>
<a name="l03297"></a>03297     <span class="comment">// Return the current timestamp configuration.</span>
<a name="l03298"></a>03298     <span class="comment">//</span>
<a name="l03299"></a>03299     <span class="keywordflow">return</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#ad90f4d80c14554b267adc47644e296af">EMAC_O_TIMSTCTRL</a>));
<a name="l03300"></a>03300 }
<a name="l03301"></a>03301 
<a name="l03302"></a>03302 <span class="comment">//*****************************************************************************</span>
<a name="l03303"></a>03303 <span class="comment">//</span>
<a name="l03312"></a>03312 <span class="comment"></span><span class="comment">//</span>
<a name="l03313"></a>03313 <span class="comment">//*****************************************************************************</span>
<a name="l03314"></a>03314 <span class="keywordtype">void</span>
<a name="l03315"></a><a class="code" href="group__emac__api.html#ga76ce9b428b943c8d4cd93fc3e50dc130">03315</a> <a class="code" href="group__emac__api.html#ga76ce9b428b943c8d4cd93fc3e50dc130">EMACTimestampEnable</a>(uint32_t ui32Base)
<a name="l03316"></a>03316 {
<a name="l03317"></a>03317     <span class="comment">//</span>
<a name="l03318"></a>03318     <span class="comment">// Parameter sanity check.</span>
<a name="l03319"></a>03319     <span class="comment">//</span>
<a name="l03320"></a>03320     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l03321"></a>03321 
<a name="l03322"></a>03322     <span class="comment">//</span>
<a name="l03323"></a>03323     <span class="comment">// Enable IEEE 1588 timestamping.</span>
<a name="l03324"></a>03324     <span class="comment">//</span>
<a name="l03325"></a>03325     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#ad90f4d80c14554b267adc47644e296af">EMAC_O_TIMSTCTRL</a>) |= <a class="code" href="hw__emac_8h.html#a2089cae7f265ffc0385ee79d909d1887">EMAC_TIMSTCTRL_TSEN</a>;
<a name="l03326"></a>03326 
<a name="l03327"></a>03327     <span class="comment">//</span>
<a name="l03328"></a>03328     <span class="comment">// If necessary, initialize the timestamping system.  This bit self-clears</span>
<a name="l03329"></a>03329     <span class="comment">// once the system time is loaded.  Only do this if initialization is not</span>
<a name="l03330"></a>03330     <span class="comment">// currently ongoing.</span>
<a name="l03331"></a>03331     <span class="comment">//</span>
<a name="l03332"></a>03332     <span class="keywordflow">if</span>(!(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#ad90f4d80c14554b267adc47644e296af">EMAC_O_TIMSTCTRL</a>) &amp; <a class="code" href="hw__emac_8h.html#ac4160191bc4ee5e66822fc41c2ec93cf">EMAC_TIMSTCTRL_TSINIT</a>))
<a name="l03333"></a>03333     {
<a name="l03334"></a>03334         <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#ad90f4d80c14554b267adc47644e296af">EMAC_O_TIMSTCTRL</a>) |= <a class="code" href="hw__emac_8h.html#ac4160191bc4ee5e66822fc41c2ec93cf">EMAC_TIMSTCTRL_TSINIT</a>;
<a name="l03335"></a>03335     }
<a name="l03336"></a>03336 }
<a name="l03337"></a>03337 
<a name="l03338"></a>03338 <span class="comment">//*****************************************************************************</span>
<a name="l03339"></a>03339 <span class="comment">//</span>
<a name="l03348"></a>03348 <span class="comment"></span><span class="comment">//</span>
<a name="l03349"></a>03349 <span class="comment">//*****************************************************************************</span>
<a name="l03350"></a>03350 <span class="keywordtype">void</span>
<a name="l03351"></a><a class="code" href="group__emac__api.html#ga9fefae33d045eebc19ec0e9e7f1fcb63">03351</a> <a class="code" href="group__emac__api.html#ga9fefae33d045eebc19ec0e9e7f1fcb63">EMACTimestampDisable</a>(uint32_t ui32Base)
<a name="l03352"></a>03352 {
<a name="l03353"></a>03353     <span class="comment">//</span>
<a name="l03354"></a>03354     <span class="comment">// Parameter sanity check.</span>
<a name="l03355"></a>03355     <span class="comment">//</span>
<a name="l03356"></a>03356     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l03357"></a>03357 
<a name="l03358"></a>03358     <span class="comment">//</span>
<a name="l03359"></a>03359     <span class="comment">// Disable IEEE 1588 timestamping.</span>
<a name="l03360"></a>03360     <span class="comment">//</span>
<a name="l03361"></a>03361     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#ad90f4d80c14554b267adc47644e296af">EMAC_O_TIMSTCTRL</a>) &amp;= ~<a class="code" href="hw__emac_8h.html#a2089cae7f265ffc0385ee79d909d1887">EMAC_TIMSTCTRL_TSEN</a>;
<a name="l03362"></a>03362 }
<a name="l03363"></a>03363 
<a name="l03364"></a>03364 <span class="comment">//*****************************************************************************</span>
<a name="l03365"></a>03365 <span class="comment">//</span>
<a name="l03384"></a>03384 <span class="comment"></span><span class="comment">//</span>
<a name="l03385"></a>03385 <span class="comment">//*****************************************************************************</span>
<a name="l03386"></a>03386 <span class="keywordtype">void</span>
<a name="l03387"></a><a class="code" href="group__emac__api.html#ga19741d3f097a47771f92253167423926">03387</a> <a class="code" href="group__emac__api.html#ga19741d3f097a47771f92253167423926">EMACTimestampSysTimeSet</a>(uint32_t ui32Base, uint32_t ui32Seconds,
<a name="l03388"></a>03388                         uint32_t ui32SubSeconds)
<a name="l03389"></a>03389 {
<a name="l03390"></a>03390     <span class="comment">//</span>
<a name="l03391"></a>03391     <span class="comment">// Parameter sanity check.</span>
<a name="l03392"></a>03392     <span class="comment">//</span>
<a name="l03393"></a>03393     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l03394"></a>03394 
<a name="l03395"></a>03395     <span class="comment">//</span>
<a name="l03396"></a>03396     <span class="comment">// Write the new time to the system time update registers.</span>
<a name="l03397"></a>03397     <span class="comment">//</span>
<a name="l03398"></a>03398     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a4c8cf975c9b7c0cef9f7293ee1c0bcae">EMAC_O_TIMSECU</a>) = ui32Seconds;
<a name="l03399"></a>03399     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a1df8336a4452d2b7d9b846b202a2dd96">EMAC_O_TIMNANOU</a>) = ui32SubSeconds;
<a name="l03400"></a>03400 
<a name="l03401"></a>03401     <span class="comment">//</span>
<a name="l03402"></a>03402     <span class="comment">// Wait for any previous update to complete.</span>
<a name="l03403"></a>03403     <span class="comment">//</span>
<a name="l03404"></a>03404     <span class="keywordflow">while</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#ad90f4d80c14554b267adc47644e296af">EMAC_O_TIMSTCTRL</a>) &amp; <a class="code" href="hw__emac_8h.html#ac4160191bc4ee5e66822fc41c2ec93cf">EMAC_TIMSTCTRL_TSINIT</a>)
<a name="l03405"></a>03405     {
<a name="l03406"></a>03406         <span class="comment">//</span>
<a name="l03407"></a>03407         <span class="comment">// Spin for a while.</span>
<a name="l03408"></a>03408         <span class="comment">//</span>
<a name="l03409"></a>03409     }
<a name="l03410"></a>03410 
<a name="l03411"></a>03411     <span class="comment">//</span>
<a name="l03412"></a>03412     <span class="comment">// Force the system clock to reset.</span>
<a name="l03413"></a>03413     <span class="comment">//</span>
<a name="l03414"></a>03414     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#ad90f4d80c14554b267adc47644e296af">EMAC_O_TIMSTCTRL</a>) |= <a class="code" href="hw__emac_8h.html#ac4160191bc4ee5e66822fc41c2ec93cf">EMAC_TIMSTCTRL_TSINIT</a>;
<a name="l03415"></a>03415 }
<a name="l03416"></a>03416 
<a name="l03417"></a>03417 <span class="comment">//*****************************************************************************</span>
<a name="l03418"></a>03418 <span class="comment">//</span>
<a name="l03434"></a>03434 <span class="comment"></span><span class="comment">//</span>
<a name="l03435"></a>03435 <span class="comment">//*****************************************************************************</span>
<a name="l03436"></a>03436 <span class="keywordtype">void</span>
<a name="l03437"></a><a class="code" href="group__emac__api.html#gaf0990d59e2cbde1a18ec08df5fb1c49d">03437</a> <a class="code" href="group__emac__api.html#gaf0990d59e2cbde1a18ec08df5fb1c49d">EMACTimestampSysTimeGet</a>(uint32_t ui32Base, uint32_t *pui32Seconds,
<a name="l03438"></a>03438                         uint32_t *pui32SubSeconds)
<a name="l03439"></a>03439 {
<a name="l03440"></a>03440     <span class="comment">//</span>
<a name="l03441"></a>03441     <span class="comment">// Parameter sanity check.</span>
<a name="l03442"></a>03442     <span class="comment">//</span>
<a name="l03443"></a>03443     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l03444"></a>03444     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(pui32Seconds);
<a name="l03445"></a>03445     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(pui32SubSeconds);
<a name="l03446"></a>03446 
<a name="l03447"></a>03447     <span class="comment">//</span>
<a name="l03448"></a>03448     <span class="comment">// Read the two-part system time from the seconds and nanoseconds</span>
<a name="l03449"></a>03449     <span class="comment">// registers.  We do this in a way that should guard against us reading</span>
<a name="l03450"></a>03450     <span class="comment">// the registers across a nanosecond wrap.</span>
<a name="l03451"></a>03451     <span class="comment">//</span>
<a name="l03452"></a>03452     <span class="keywordflow">do</span>
<a name="l03453"></a>03453     {
<a name="l03454"></a>03454         *pui32Seconds = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a975c8ec3ad1c78bf7f7bdedf7357ff12">EMAC_O_TIMSEC</a>);
<a name="l03455"></a>03455         *pui32SubSeconds = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a3f69d0aab53bf92045c368d9ec65bccc">EMAC_O_TIMNANO</a>);
<a name="l03456"></a>03456     }
<a name="l03457"></a>03457     <span class="keywordflow">while</span>(*pui32SubSeconds &gt; <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a3f69d0aab53bf92045c368d9ec65bccc">EMAC_O_TIMNANO</a>));
<a name="l03458"></a>03458 }
<a name="l03459"></a>03459 
<a name="l03460"></a>03460 <span class="comment">//*****************************************************************************</span>
<a name="l03461"></a>03461 <span class="comment">//</span>
<a name="l03483"></a>03483 <span class="comment"></span><span class="comment">//</span>
<a name="l03484"></a>03484 <span class="comment">//*****************************************************************************</span>
<a name="l03485"></a>03485 <span class="keywordtype">void</span>
<a name="l03486"></a><a class="code" href="group__emac__api.html#ga1ab9a4c5f22d7a0be9552dd747cd2d75">03486</a> <a class="code" href="group__emac__api.html#ga1ab9a4c5f22d7a0be9552dd747cd2d75">EMACTimestampSysTimeUpdate</a>(uint32_t ui32Base, uint32_t ui32Seconds,
<a name="l03487"></a>03487                            uint32_t ui32SubSeconds, <span class="keywordtype">bool</span> bInc)
<a name="l03488"></a>03488 {
<a name="l03489"></a>03489     <span class="comment">//</span>
<a name="l03490"></a>03490     <span class="comment">// Parameter sanity check.</span>
<a name="l03491"></a>03491     <span class="comment">//</span>
<a name="l03492"></a>03492     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l03493"></a>03493 
<a name="l03494"></a>03494     <span class="comment">//</span>
<a name="l03495"></a>03495     <span class="comment">// Write the new time to the system time update registers.</span>
<a name="l03496"></a>03496     <span class="comment">//</span>
<a name="l03497"></a>03497     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a4c8cf975c9b7c0cef9f7293ee1c0bcae">EMAC_O_TIMSECU</a>) = ui32Seconds;
<a name="l03498"></a>03498     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a1df8336a4452d2b7d9b846b202a2dd96">EMAC_O_TIMNANOU</a>) = ui32SubSeconds |
<a name="l03499"></a>03499                                         (bInc ? 0 : <a class="code" href="hw__emac_8h.html#a86800d04746bbc4235c9eafd0a9dc1e5">EMAC_TIMNANOU_ADDSUB</a>);
<a name="l03500"></a>03500 
<a name="l03501"></a>03501     <span class="comment">//</span>
<a name="l03502"></a>03502     <span class="comment">// Wait for any previous update to complete.</span>
<a name="l03503"></a>03503     <span class="comment">//</span>
<a name="l03504"></a>03504     <span class="keywordflow">while</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#ad90f4d80c14554b267adc47644e296af">EMAC_O_TIMSTCTRL</a>) &amp; <a class="code" href="hw__emac_8h.html#a1f3a6c5668c261f1fb93b85ae9a03929">EMAC_TIMSTCTRL_TSUPDT</a>)
<a name="l03505"></a>03505     {
<a name="l03506"></a>03506         <span class="comment">//</span>
<a name="l03507"></a>03507         <span class="comment">// Spin for a while.</span>
<a name="l03508"></a>03508         <span class="comment">//</span>
<a name="l03509"></a>03509     }
<a name="l03510"></a>03510 
<a name="l03511"></a>03511     <span class="comment">//</span>
<a name="l03512"></a>03512     <span class="comment">// Force the system clock to update by the value provided.</span>
<a name="l03513"></a>03513     <span class="comment">//</span>
<a name="l03514"></a>03514     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#ad90f4d80c14554b267adc47644e296af">EMAC_O_TIMSTCTRL</a>) |= <a class="code" href="hw__emac_8h.html#a1f3a6c5668c261f1fb93b85ae9a03929">EMAC_TIMSTCTRL_TSUPDT</a>;
<a name="l03515"></a>03515 }
<a name="l03516"></a>03516 
<a name="l03517"></a>03517 <span class="comment">//*****************************************************************************</span>
<a name="l03518"></a>03518 <span class="comment">//</span>
<a name="l03552"></a>03552 <span class="comment"></span><span class="comment">//</span>
<a name="l03553"></a>03553 <span class="comment">//*****************************************************************************</span>
<a name="l03554"></a>03554 <span class="keywordtype">void</span>
<a name="l03555"></a><a class="code" href="group__emac__api.html#gaf58bcf48127a67c0eda8eb96319e8690">03555</a> <a class="code" href="group__emac__api.html#gaf58bcf48127a67c0eda8eb96319e8690">EMACTimestampAddendSet</a>(uint32_t ui32Base, uint32_t ui32Increment)
<a name="l03556"></a>03556 {
<a name="l03557"></a>03557     <span class="comment">//</span>
<a name="l03558"></a>03558     <span class="comment">// Parameter sanity check.</span>
<a name="l03559"></a>03559     <span class="comment">//</span>
<a name="l03560"></a>03560     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l03561"></a>03561 
<a name="l03562"></a>03562     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a61f354343d99d6fc55ebd557b5c90504">EMAC_O_TIMADD</a>) = ui32Increment;
<a name="l03563"></a>03563 
<a name="l03564"></a>03564     <span class="comment">//</span>
<a name="l03565"></a>03565     <span class="comment">// Wait for any previous update to complete.</span>
<a name="l03566"></a>03566     <span class="comment">//</span>
<a name="l03567"></a>03567     <span class="keywordflow">while</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#ad90f4d80c14554b267adc47644e296af">EMAC_O_TIMSTCTRL</a>) &amp; <a class="code" href="hw__emac_8h.html#a26699e8ca5b10396321bed7ad2484583">EMAC_TIMSTCTRL_ADDREGUP</a>)
<a name="l03568"></a>03568     {
<a name="l03569"></a>03569         <span class="comment">//</span>
<a name="l03570"></a>03570         <span class="comment">// Spin for a while.</span>
<a name="l03571"></a>03571         <span class="comment">//</span>
<a name="l03572"></a>03572     }
<a name="l03573"></a>03573 
<a name="l03574"></a>03574     <span class="comment">//</span>
<a name="l03575"></a>03575     <span class="comment">// Force the system clock to update by the value provided.</span>
<a name="l03576"></a>03576     <span class="comment">//</span>
<a name="l03577"></a>03577     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#ad90f4d80c14554b267adc47644e296af">EMAC_O_TIMSTCTRL</a>) |= <a class="code" href="hw__emac_8h.html#a26699e8ca5b10396321bed7ad2484583">EMAC_TIMSTCTRL_ADDREGUP</a>;
<a name="l03578"></a>03578 }
<a name="l03579"></a>03579 
<a name="l03580"></a>03580 <span class="comment">//*****************************************************************************</span>
<a name="l03581"></a>03581 <span class="comment">//</span>
<a name="l03603"></a>03603 <span class="comment"></span><span class="comment">//</span>
<a name="l03604"></a>03604 <span class="comment">//*****************************************************************************</span>
<a name="l03605"></a>03605 <span class="keywordtype">void</span>
<a name="l03606"></a><a class="code" href="group__emac__api.html#gaa1152f2b3931cbd7099733b31be3de75">03606</a> <a class="code" href="group__emac__api.html#gaa1152f2b3931cbd7099733b31be3de75">EMACTimestampTargetSet</a>(uint32_t ui32Base, uint32_t ui32Seconds,
<a name="l03607"></a>03607                        uint32_t ui32SubSeconds)
<a name="l03608"></a>03608 {
<a name="l03609"></a>03609     <span class="comment">//</span>
<a name="l03610"></a>03610     <span class="comment">// Parameter sanity check.</span>
<a name="l03611"></a>03611     <span class="comment">//</span>
<a name="l03612"></a>03612     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l03613"></a>03613 
<a name="l03614"></a>03614     <span class="comment">//</span>
<a name="l03615"></a>03615     <span class="comment">// Wait for any previous write to complete.</span>
<a name="l03616"></a>03616     <span class="comment">//</span>
<a name="l03617"></a>03617     <span class="keywordflow">while</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a270fd0915a869d5e2b0ac39b6f08c06b">EMAC_O_TARGNANO</a>) &amp; <a class="code" href="hw__emac_8h.html#a7f5845b8a0c0b37ca9c864dcd6d3fe27">EMAC_TARGNANO_TRGTBUSY</a>)
<a name="l03618"></a>03618     {
<a name="l03619"></a>03619     }
<a name="l03620"></a>03620 
<a name="l03621"></a>03621     <span class="comment">//</span>
<a name="l03622"></a>03622     <span class="comment">// Write the new target time.</span>
<a name="l03623"></a>03623     <span class="comment">//</span>
<a name="l03624"></a>03624     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#ab2dd33f12f8542d343adbead787d3376">EMAC_O_TARGSEC</a>) = ui32Seconds;
<a name="l03625"></a>03625     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a270fd0915a869d5e2b0ac39b6f08c06b">EMAC_O_TARGNANO</a>) = ui32SubSeconds;
<a name="l03626"></a>03626 }
<a name="l03627"></a>03627 
<a name="l03628"></a>03628 <span class="comment">//*****************************************************************************</span>
<a name="l03629"></a>03629 <span class="comment">//</span>
<a name="l03643"></a>03643 <span class="comment"></span><span class="comment">//</span>
<a name="l03644"></a>03644 <span class="comment">//*****************************************************************************</span>
<a name="l03645"></a>03645 <span class="keywordtype">void</span>
<a name="l03646"></a><a class="code" href="group__emac__api.html#gaf5fba26bb9e913012e907dd80a494096">03646</a> <a class="code" href="group__emac__api.html#gaf5fba26bb9e913012e907dd80a494096">EMACTimestampTargetIntEnable</a>(uint32_t ui32Base)
<a name="l03647"></a>03647 {
<a name="l03648"></a>03648     <span class="comment">//</span>
<a name="l03649"></a>03649     <span class="comment">// Parameter sanity check.</span>
<a name="l03650"></a>03650     <span class="comment">//</span>
<a name="l03651"></a>03651     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l03652"></a>03652 
<a name="l03653"></a>03653     <span class="comment">//</span>
<a name="l03654"></a>03654     <span class="comment">// Set the bit to enable the timestamp target interrupt.  This bit clears</span>
<a name="l03655"></a>03655     <span class="comment">// automatically when the interrupt fires after which point, you must</span>
<a name="l03656"></a>03656     <span class="comment">// set a new target time and re-enable the interrupts.</span>
<a name="l03657"></a>03657     <span class="comment">//</span>
<a name="l03658"></a>03658     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#ad90f4d80c14554b267adc47644e296af">EMAC_O_TIMSTCTRL</a>) |= <a class="code" href="hw__emac_8h.html#a19cf80e3a10a1382a73cceabe3826553">EMAC_TIMSTCTRL_INTTRIG</a>;
<a name="l03659"></a>03659 }
<a name="l03660"></a>03660 
<a name="l03661"></a>03661 <span class="comment">//*****************************************************************************</span>
<a name="l03662"></a>03662 <span class="comment">//</span>
<a name="l03672"></a>03672 <span class="comment"></span><span class="comment">//</span>
<a name="l03673"></a>03673 <span class="comment">//*****************************************************************************</span>
<a name="l03674"></a>03674 <span class="keywordtype">void</span>
<a name="l03675"></a><a class="code" href="group__emac__api.html#gabe48c7fd3199f749acabc2b83a012d35">03675</a> <a class="code" href="group__emac__api.html#gabe48c7fd3199f749acabc2b83a012d35">EMACTimestampTargetIntDisable</a>(uint32_t ui32Base)
<a name="l03676"></a>03676 {
<a name="l03677"></a>03677     <span class="comment">//</span>
<a name="l03678"></a>03678     <span class="comment">// Parameter sanity check.</span>
<a name="l03679"></a>03679     <span class="comment">//</span>
<a name="l03680"></a>03680     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l03681"></a>03681 
<a name="l03682"></a>03682     <span class="comment">//</span>
<a name="l03683"></a>03683     <span class="comment">// Clear the bit to disable the timestamp target interrupt.  This bit </span>
<a name="l03684"></a>03684     <span class="comment">// clears automatically when the interrupt fires, so it only must be</span>
<a name="l03685"></a>03685     <span class="comment">// disabled if you want to cancel a previously-set interrupt.</span>
<a name="l03686"></a>03686     <span class="comment">//</span>
<a name="l03687"></a>03687     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#ad90f4d80c14554b267adc47644e296af">EMAC_O_TIMSTCTRL</a>) &amp;= ~<a class="code" href="hw__emac_8h.html#a19cf80e3a10a1382a73cceabe3826553">EMAC_TIMSTCTRL_INTTRIG</a>;
<a name="l03688"></a>03688 }
<a name="l03689"></a>03689 
<a name="l03690"></a>03690 <span class="comment">//*****************************************************************************</span>
<a name="l03691"></a>03691 <span class="comment">//</span>
<a name="l03710"></a>03710 <span class="comment"></span><span class="comment">//</span>
<a name="l03711"></a>03711 <span class="comment">//*****************************************************************************</span>
<a name="l03712"></a>03712 uint32_t
<a name="l03713"></a><a class="code" href="group__emac__api.html#ga5e9b445e03590ddce6cd94141e1cb125">03713</a> <a class="code" href="group__emac__api.html#ga5e9b445e03590ddce6cd94141e1cb125">EMACTimestampIntStatus</a>(uint32_t ui32Base)
<a name="l03714"></a>03714 {
<a name="l03715"></a>03715     <span class="comment">//</span>
<a name="l03716"></a>03716     <span class="comment">// Parameter sanity check.</span>
<a name="l03717"></a>03717     <span class="comment">//</span>
<a name="l03718"></a>03718     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l03719"></a>03719 
<a name="l03720"></a>03720     <span class="comment">//</span>
<a name="l03721"></a>03721     <span class="comment">// Return the current interrupt status from the timestamp module.</span>
<a name="l03722"></a>03722     <span class="comment">//</span>
<a name="l03723"></a>03723     <span class="keywordflow">return</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a617301a9ca332f94605bfdba0b0a00bf">EMAC_O_TIMSTAT</a>));
<a name="l03724"></a>03724 }
<a name="l03725"></a>03725 
<a name="l03726"></a>03726 <span class="comment">//*****************************************************************************</span>
<a name="l03727"></a>03727 <span class="comment">//</span>
<a name="l03768"></a>03768 <span class="comment"></span><span class="comment">//</span>
<a name="l03769"></a>03769 <span class="comment">//*****************************************************************************</span>
<a name="l03770"></a>03770 <span class="keywordtype">void</span>
<a name="l03771"></a><a class="code" href="group__emac__api.html#gab22754779ba3d28d6e45ab35346ef1f7">03771</a> <a class="code" href="group__emac__api.html#gab22754779ba3d28d6e45ab35346ef1f7">EMACTimestampPPSSimpleModeSet</a>(uint32_t ui32Base, uint32_t ui32FreqConfig)
<a name="l03772"></a>03772 {
<a name="l03773"></a>03773     <span class="keywordtype">bool</span> bDigital;
<a name="l03774"></a>03774 
<a name="l03775"></a>03775     <span class="comment">//</span>
<a name="l03776"></a>03776     <span class="comment">// Parameter sanity check.</span>
<a name="l03777"></a>03777     <span class="comment">//</span>
<a name="l03778"></a>03778     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l03779"></a>03779 
<a name="l03780"></a>03780     <span class="comment">//</span>
<a name="l03781"></a>03781     <span class="comment">// Are we currently running the clock in digital or binary rollover mode?</span>
<a name="l03782"></a>03782     <span class="comment">//</span>
<a name="l03783"></a>03783     bDigital = (<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#ad90f4d80c14554b267adc47644e296af">EMAC_O_TIMSTCTRL</a>) &amp;
<a name="l03784"></a>03784                 <a class="code" href="group__emac__api.html#ga71f1e536e0b8c312cd6789d2236e62d0">EMAC_TS_DIGITAL_ROLLOVER</a>) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
<a name="l03785"></a>03785 
<a name="l03786"></a>03786     <span class="comment">//</span>
<a name="l03787"></a>03787     <span class="comment">// Weed out some unsupported frequencies.  The hardware can&#39;t produce a</span>
<a name="l03788"></a>03788     <span class="comment">// 1Hz output when we are in binary rollover mode and can&#39;t produce a</span>
<a name="l03789"></a>03789     <span class="comment">// 32KHz output when we are digital rollover mode.</span>
<a name="l03790"></a>03790     <span class="comment">//</span>
<a name="l03791"></a>03791     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(bDigital || (ui32FreqConfig != <a class="code" href="group__emac__api.html#ga4e20c4f31475fba5492d4a59fb51db0c">EMAC_PPS_1HZ</a>));
<a name="l03792"></a>03792     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(!bDigital || (ui32FreqConfig != <a class="code" href="group__emac__api.html#ga059f168c399c76ab7de508562e67d031">EMAC_PPS_32768HZ</a>));
<a name="l03793"></a>03793 
<a name="l03794"></a>03794     <span class="comment">//</span>
<a name="l03795"></a>03795     <span class="comment">// Adjust the supplied frequency if we are currently in binary update mode</span>
<a name="l03796"></a>03796     <span class="comment">// where the control value generates an output that is twice as fast as</span>
<a name="l03797"></a>03797     <span class="comment">// in digital mode.</span>
<a name="l03798"></a>03798     <span class="comment">//</span>
<a name="l03799"></a>03799     <span class="keywordflow">if</span>((ui32FreqConfig != <a class="code" href="group__emac__api.html#gaaee9da4bf184758f8be6926a2c650cc3">EMAC_PPS_SINGLE_PULSE</a>) &amp;&amp; !bDigital)
<a name="l03800"></a>03800     {
<a name="l03801"></a>03801         ui32FreqConfig--;
<a name="l03802"></a>03802     }
<a name="l03803"></a>03803 
<a name="l03804"></a>03804     <span class="comment">//</span>
<a name="l03805"></a>03805     <span class="comment">// Write the frequency control value to the PPS control register, clearing</span>
<a name="l03806"></a>03806     <span class="comment">// the PPSEN0 bit to ensure that the PPS engine is in simple mode and not</span>
<a name="l03807"></a>03807     <span class="comment">// waiting for a command.  We also clear the TRGMODS0 field to revert to</span>
<a name="l03808"></a>03808     <span class="comment">// the default operation of the target time registers.</span>
<a name="l03809"></a>03809     <span class="comment">//</span>
<a name="l03810"></a>03810     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a86b008bb620fa16fc1894d16c3ada456">EMAC_O_PPSCTRL</a>) = ui32FreqConfig;
<a name="l03811"></a>03811 }
<a name="l03812"></a>03812 
<a name="l03813"></a>03813 <span class="comment">//*****************************************************************************</span>
<a name="l03814"></a>03814 <span class="comment">//</span>
<a name="l03816"></a>03816 <span class="comment"></span>
<a name="l03851"></a>03851 <span class="comment">//</span>
<a name="l03852"></a>03852 <span class="comment">//*****************************************************************************</span>
<a name="l03853"></a>03853 <span class="keywordtype">void</span>
<a name="l03854"></a><a class="code" href="group__emac__api.html#gada1ddd9fe06cee8737805eca72b4a09e">03854</a> <a class="code" href="group__emac__api.html#gada1ddd9fe06cee8737805eca72b4a09e" title="Configures the Ethernet MAC PPS output in command mode.">EMACTimestampPPSCommandModeSet</a>(uint32_t ui32Base, uint32_t ui32Config)
<a name="l03855"></a>03855 {
<a name="l03856"></a>03856     <span class="comment">//</span>
<a name="l03857"></a>03857     <span class="comment">// Parameter sanity check.</span>
<a name="l03858"></a>03858     <span class="comment">//</span>
<a name="l03859"></a>03859     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l03860"></a>03860     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(!(ui32Config &amp; (<a class="code" href="group__emac__api.html#gaac9c04a4ffa23d2ab4765797b2d71ab3">EMAC_PPS_TARGET_INT</a> | <a class="code" href="group__emac__api.html#gac4185d611178dd82db02b055b5e5fab5">EMAC_PPS_TARGET_PPS</a> |
<a name="l03861"></a>03861                            <a class="code" href="group__emac__api.html#ga0d522c5d627e8e6ac0a5adc6846b3b1f">EMAC_PPS_TARGET_BOTH</a>)));
<a name="l03862"></a>03862 
<a name="l03863"></a>03863     <span class="comment">//</span>
<a name="l03864"></a>03864     <span class="comment">// Wait for any previous command write to complete.</span>
<a name="l03865"></a>03865     <span class="comment">//</span>
<a name="l03866"></a>03866     <span class="keywordflow">while</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a86b008bb620fa16fc1894d16c3ada456">EMAC_O_PPSCTRL</a>) &amp; <a class="code" href="hw__emac_8h.html#a8bb2d4dd0b895b5f1f7f3413c686ea24">EMAC_PPSCTRL_PPSCTRL_M</a>)
<a name="l03867"></a>03867     {
<a name="l03868"></a>03868         <span class="comment">//</span>
<a name="l03869"></a>03869         <span class="comment">// Wait a bit.</span>
<a name="l03870"></a>03870         <span class="comment">//</span>
<a name="l03871"></a>03871     }
<a name="l03872"></a>03872 
<a name="l03873"></a>03873     <span class="comment">//</span>
<a name="l03874"></a>03874     <span class="comment">// Write the configuration value to the PPS control register, setting the</span>
<a name="l03875"></a>03875     <span class="comment">// PPSEN0 bit to ensure that the PPS engine is in command mode and</span>
<a name="l03876"></a>03876     <span class="comment">// clearing the command in the PPSCTRL field.</span>
<a name="l03877"></a>03877     <span class="comment">//</span>
<a name="l03878"></a>03878     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a86b008bb620fa16fc1894d16c3ada456">EMAC_O_PPSCTRL</a>) = (<a class="code" href="hw__emac_8h.html#a8cfdd435f196f813254eb6708ab50dc6">EMAC_PPSCTRL_PPSEN0</a> | ui32Config);
<a name="l03879"></a>03879 }
<a name="l03880"></a>03880 
<a name="l03881"></a>03881 <span class="comment">//*****************************************************************************</span>
<a name="l03882"></a>03882 <span class="comment">//</span>
<a name="l03916"></a>03916 <span class="comment"></span><span class="comment">//</span>
<a name="l03917"></a>03917 <span class="comment">//*****************************************************************************</span>
<a name="l03918"></a>03918 <span class="keywordtype">void</span>
<a name="l03919"></a><a class="code" href="group__emac__api.html#ga97dcc4e449a9c148b2128d6e25d81bc9">03919</a> <a class="code" href="group__emac__api.html#ga97dcc4e449a9c148b2128d6e25d81bc9">EMACTimestampPPSCommand</a>(uint32_t ui32Base, uint8_t ui8Cmd)
<a name="l03920"></a>03920 {
<a name="l03921"></a>03921     <span class="comment">//</span>
<a name="l03922"></a>03922     <span class="comment">// Parameter sanity check.</span>
<a name="l03923"></a>03923     <span class="comment">//</span>
<a name="l03924"></a>03924     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l03925"></a>03925 
<a name="l03926"></a>03926     <span class="comment">//</span>
<a name="l03927"></a>03927     <span class="comment">// Wait for any previous command write to complete.</span>
<a name="l03928"></a>03928     <span class="comment">//</span>
<a name="l03929"></a>03929     <span class="keywordflow">while</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a86b008bb620fa16fc1894d16c3ada456">EMAC_O_PPSCTRL</a>) &amp; <a class="code" href="hw__emac_8h.html#a8bb2d4dd0b895b5f1f7f3413c686ea24">EMAC_PPSCTRL_PPSCTRL_M</a>)
<a name="l03930"></a>03930     {
<a name="l03931"></a>03931         <span class="comment">//</span>
<a name="l03932"></a>03932         <span class="comment">// Wait a bit.</span>
<a name="l03933"></a>03933         <span class="comment">//</span>
<a name="l03934"></a>03934     }
<a name="l03935"></a>03935 
<a name="l03936"></a>03936     <span class="comment">//</span>
<a name="l03937"></a>03937     <span class="comment">// Write the command to the PPS control register.</span>
<a name="l03938"></a>03938     <span class="comment">//</span>
<a name="l03939"></a>03939     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a86b008bb620fa16fc1894d16c3ada456">EMAC_O_PPSCTRL</a>) = (<a class="code" href="hw__emac_8h.html#a8cfdd435f196f813254eb6708ab50dc6">EMAC_PPSCTRL_PPSEN0</a> | ui8Cmd);
<a name="l03940"></a>03940 }
<a name="l03941"></a>03941 
<a name="l03942"></a>03942 <span class="comment">//*****************************************************************************</span>
<a name="l03943"></a>03943 <span class="comment">//</span>
<a name="l03972"></a>03972 <span class="comment"></span><span class="comment">//</span>
<a name="l03973"></a>03973 <span class="comment">//*****************************************************************************</span>
<a name="l03974"></a>03974 <span class="keywordtype">void</span>
<a name="l03975"></a><a class="code" href="group__emac__api.html#gaaa072b7f8a3d6888cc1114e5a99db5db">03975</a> <a class="code" href="group__emac__api.html#gaaa072b7f8a3d6888cc1114e5a99db5db">EMACTimestampPPSPeriodSet</a>(uint32_t ui32Base, uint32_t ui32Period,
<a name="l03976"></a>03976                           uint32_t ui32Width)
<a name="l03977"></a>03977 {
<a name="l03978"></a>03978     <span class="comment">//</span>
<a name="l03979"></a>03979     <span class="comment">// Parameter sanity check.</span>
<a name="l03980"></a>03980     <span class="comment">//</span>
<a name="l03981"></a>03981     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l03982"></a>03982 
<a name="l03983"></a>03983     <span class="comment">//</span>
<a name="l03984"></a>03984     <span class="comment">// Write the desired PPS period and pulse width.</span>
<a name="l03985"></a>03985     <span class="comment">//</span>
<a name="l03986"></a>03986     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#ab7e7e226d072d7238ece1eff6177a146">EMAC_O_PPS0INTVL</a>) = ui32Period;
<a name="l03987"></a>03987     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#ae4f326c43f262afb41718d11de80ae63">EMAC_O_PPS0WIDTH</a>) = ui32Width;
<a name="l03988"></a>03988 }
<a name="l03989"></a>03989 
<a name="l03990"></a>03990 <span class="comment">//*****************************************************************************</span>
<a name="l03991"></a>03991 <span class="comment">//</span>
<a name="l04035"></a>04035 <span class="comment"></span><span class="comment">//</span>
<a name="l04036"></a>04036 <span class="comment">//*****************************************************************************</span>
<a name="l04037"></a>04037 <span class="keywordtype">void</span>
<a name="l04038"></a><a class="code" href="group__emac__api.html#ga072e2967d87ec29d255e61f95ab4d8b0">04038</a> <a class="code" href="group__emac__api.html#ga072e2967d87ec29d255e61f95ab4d8b0">EMACVLANRxConfigSet</a>(uint32_t ui32Base, uint16_t ui16Tag, uint32_t ui32Config)
<a name="l04039"></a>04039 {
<a name="l04040"></a>04040     <span class="comment">//</span>
<a name="l04041"></a>04041     <span class="comment">// Parameter sanity check.</span>
<a name="l04042"></a>04042     <span class="comment">//</span>
<a name="l04043"></a>04043     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l04044"></a>04044 
<a name="l04045"></a>04045     <span class="comment">//</span>
<a name="l04046"></a>04046     <span class="comment">// Write the VLAN tag register.</span>
<a name="l04047"></a>04047     <span class="comment">//</span>
<a name="l04048"></a>04048     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a21c0616c7bf6ae0f81e90bf0e3f04ab3">EMAC_O_VLANTG</a>) =
<a name="l04049"></a>04049         ui32Config | (((uint32_t)ui16Tag) &lt;&lt; <a class="code" href="hw__emac_8h.html#ac620b68b3d6b6da7f1654376c76ed63e">EMAC_VLANTG_VL_S</a>);
<a name="l04050"></a>04050 }
<a name="l04051"></a>04051 
<a name="l04052"></a>04052 <span class="comment">//*****************************************************************************</span>
<a name="l04053"></a>04053 <span class="comment">//</span>
<a name="l04084"></a>04084 <span class="comment"></span><span class="comment">//</span>
<a name="l04085"></a>04085 <span class="comment">//*****************************************************************************</span>
<a name="l04086"></a>04086 uint32_t
<a name="l04087"></a><a class="code" href="group__emac__api.html#gaa7f104bad0ee98101e8088f1e6fc3af6">04087</a> <a class="code" href="group__emac__api.html#gaa7f104bad0ee98101e8088f1e6fc3af6">EMACVLANRxConfigGet</a>(uint32_t ui32Base, uint16_t *pui16Tag)
<a name="l04088"></a>04088 {
<a name="l04089"></a>04089     uint32_t ui32Value;
<a name="l04090"></a>04090 
<a name="l04091"></a>04091     <span class="comment">//</span>
<a name="l04092"></a>04092     <span class="comment">// Parameter sanity check.</span>
<a name="l04093"></a>04093     <span class="comment">//</span>
<a name="l04094"></a>04094     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l04095"></a>04095     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(pui16Tag);
<a name="l04096"></a>04096 
<a name="l04097"></a>04097     <span class="comment">//</span>
<a name="l04098"></a>04098     <span class="comment">// Read the VLAN tag register.</span>
<a name="l04099"></a>04099     <span class="comment">//</span>
<a name="l04100"></a>04100     ui32Value = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a21c0616c7bf6ae0f81e90bf0e3f04ab3">EMAC_O_VLANTG</a>);
<a name="l04101"></a>04101 
<a name="l04102"></a>04102     <span class="comment">//</span>
<a name="l04103"></a>04103     <span class="comment">// Extract the VLAN tag from the register.</span>
<a name="l04104"></a>04104     <span class="comment">//</span>
<a name="l04105"></a>04105     *pui16Tag = (ui32Value &amp; <a class="code" href="hw__emac_8h.html#afb210b2f351460cdfa38b830953b26c7">EMAC_VLANTG_VL_M</a>) &gt;&gt; <a class="code" href="hw__emac_8h.html#ac620b68b3d6b6da7f1654376c76ed63e">EMAC_VLANTG_VL_S</a>;
<a name="l04106"></a>04106 
<a name="l04107"></a>04107     <span class="comment">//</span>
<a name="l04108"></a>04108     <span class="comment">// Return the configuration flags.</span>
<a name="l04109"></a>04109     <span class="comment">//</span>
<a name="l04110"></a>04110     <span class="keywordflow">return</span>(ui32Value &amp; ~<a class="code" href="hw__emac_8h.html#afb210b2f351460cdfa38b830953b26c7">EMAC_VLANTG_VL_M</a>);
<a name="l04111"></a>04111 }
<a name="l04112"></a>04112 
<a name="l04113"></a>04113 <span class="comment">//*****************************************************************************</span>
<a name="l04114"></a>04114 <span class="comment">//</span>
<a name="l04155"></a>04155 <span class="comment"></span><span class="comment">//</span>
<a name="l04156"></a>04156 <span class="comment">//*****************************************************************************</span>
<a name="l04157"></a>04157 <span class="keywordtype">void</span>
<a name="l04158"></a><a class="code" href="group__emac__api.html#ga2b6dc1c136744b5e83b018f94f831f38">04158</a> <a class="code" href="group__emac__api.html#ga2b6dc1c136744b5e83b018f94f831f38">EMACVLANTxConfigSet</a>(uint32_t ui32Base, uint16_t ui16Tag, uint32_t ui32Config)
<a name="l04159"></a>04159 {
<a name="l04160"></a>04160     <span class="comment">//</span>
<a name="l04161"></a>04161     <span class="comment">// Parameter sanity check.</span>
<a name="l04162"></a>04162     <span class="comment">//</span>
<a name="l04163"></a>04163     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l04164"></a>04164 
<a name="l04165"></a>04165     <span class="comment">//</span>
<a name="l04166"></a>04166     <span class="comment">// Write the VLAN Tag Inclusion or Replacement register.</span>
<a name="l04167"></a>04167     <span class="comment">//</span>
<a name="l04168"></a>04168     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#ad8d0be054ea998f7a1839015805af89a">EMAC_O_VLNINCREP</a>) =
<a name="l04169"></a>04169         ui32Config | ((uint32_t)ui16Tag &lt;&lt; <a class="code" href="hw__emac_8h.html#a865568e105bc8e239b2587a3c505c7bf">EMAC_VLNINCREP_VLT_S</a>);
<a name="l04170"></a>04170 }
<a name="l04171"></a>04171 
<a name="l04172"></a>04172 <span class="comment">//*****************************************************************************</span>
<a name="l04173"></a>04173 <span class="comment">//</span>
<a name="l04213"></a>04213 <span class="comment"></span><span class="comment">//</span>
<a name="l04214"></a>04214 <span class="comment">//*****************************************************************************</span>
<a name="l04215"></a>04215 uint32_t
<a name="l04216"></a><a class="code" href="group__emac__api.html#gaaece59d6d129ea03ce46f7304b7841ef">04216</a> <a class="code" href="group__emac__api.html#gaaece59d6d129ea03ce46f7304b7841ef">EMACVLANTxConfigGet</a>(uint32_t ui32Base, uint16_t *pui16Tag)
<a name="l04217"></a>04217 {
<a name="l04218"></a>04218     uint32_t ui32Value;
<a name="l04219"></a>04219 
<a name="l04220"></a>04220     <span class="comment">//</span>
<a name="l04221"></a>04221     <span class="comment">// Parameter sanity check.</span>
<a name="l04222"></a>04222     <span class="comment">//</span>
<a name="l04223"></a>04223     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l04224"></a>04224     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(pui16Tag);
<a name="l04225"></a>04225 
<a name="l04226"></a>04226     <span class="comment">//</span>
<a name="l04227"></a>04227     <span class="comment">// Read the VLAN Tag Inclusion or Replacement register.</span>
<a name="l04228"></a>04228     <span class="comment">//</span>
<a name="l04229"></a>04229     ui32Value = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#ad8d0be054ea998f7a1839015805af89a">EMAC_O_VLNINCREP</a>);
<a name="l04230"></a>04230 
<a name="l04231"></a>04231     <span class="comment">//</span>
<a name="l04232"></a>04232     <span class="comment">// Extract the tag.</span>
<a name="l04233"></a>04233     <span class="comment">//</span>
<a name="l04234"></a>04234     *pui16Tag = (uint16_t)((ui32Value &amp; <a class="code" href="hw__emac_8h.html#ab44a1877ee04f051a9d216c2ce00c15b">EMAC_VLNINCREP_VLT_M</a>) &gt;&gt;
<a name="l04235"></a>04235                            <a class="code" href="hw__emac_8h.html#a865568e105bc8e239b2587a3c505c7bf">EMAC_VLNINCREP_VLT_S</a>);
<a name="l04236"></a>04236 
<a name="l04237"></a>04237     <span class="comment">//</span>
<a name="l04238"></a>04238     <span class="comment">// Return the configuration flags.</span>
<a name="l04239"></a>04239     <span class="comment">//</span>
<a name="l04240"></a>04240     <span class="keywordflow">return</span>(ui32Value &amp; ~EMAC_VLNINCREP_VLT_M);
<a name="l04241"></a>04241 }
<a name="l04242"></a>04242 
<a name="l04243"></a>04243 <span class="comment">//*****************************************************************************</span>
<a name="l04244"></a>04244 <span class="comment">//</span>
<a name="l04259"></a>04259 <span class="comment"></span><span class="comment">//</span>
<a name="l04260"></a>04260 <span class="comment">//*****************************************************************************</span>
<a name="l04261"></a>04261 uint32_t
<a name="l04262"></a><a class="code" href="group__emac__api.html#ga863edfd09a55c78f52a3f4f3815939fb">04262</a> <a class="code" href="group__emac__api.html#ga863edfd09a55c78f52a3f4f3815939fb">EMACVLANHashFilterBitCalculate</a>(uint16_t ui16Tag)
<a name="l04263"></a>04263 {
<a name="l04264"></a>04264     uint32_t ui32CRC, ui32Mask, ui32Loop;
<a name="l04265"></a>04265 
<a name="l04266"></a>04266     <span class="comment">//</span>
<a name="l04267"></a>04267     <span class="comment">// Calculate the CRC for the MAC address.</span>
<a name="l04268"></a>04268     <span class="comment">//</span>
<a name="l04269"></a>04269     ui32CRC = <a class="code" href="group__sw__crc__api.html#ga22bfc22485731f3448ff369784b86574">Crc32</a>(0xFFFFFFFF, (uint8_t *)&amp;ui16Tag, 2);
<a name="l04270"></a>04270     ui32CRC ^= 0xFFFFFFFF;
<a name="l04271"></a>04271 
<a name="l04272"></a>04272     <span class="comment">//</span>
<a name="l04273"></a>04273     <span class="comment">// Determine the hash bit to use from the calculated CRC.  This is the</span>
<a name="l04274"></a>04274     <span class="comment">// top 4 bits of the reversed CRC (or the bottom 4 bits of the calculated</span>
<a name="l04275"></a>04275     <span class="comment">// CRC with the bit order of those 4 bits reversed).</span>
<a name="l04276"></a>04276     <span class="comment">//</span>
<a name="l04277"></a>04277     ui32Mask = 0;
<a name="l04278"></a>04278 
<a name="l04279"></a>04279     <span class="comment">//</span>
<a name="l04280"></a>04280     <span class="comment">// Reverse the order of the bottom 4 bits of the calculated CRC.</span>
<a name="l04281"></a>04281     <span class="comment">//</span>
<a name="l04282"></a>04282     <span class="keywordflow">for</span>(ui32Loop = 0; ui32Loop &lt; 4; ui32Loop++)
<a name="l04283"></a>04283     {
<a name="l04284"></a>04284         ui32Mask &lt;&lt;= 1;
<a name="l04285"></a>04285         ui32Mask |= (ui32CRC &amp; 1);
<a name="l04286"></a>04286         ui32CRC &gt;&gt;= 1;
<a name="l04287"></a>04287     }
<a name="l04288"></a>04288 
<a name="l04289"></a>04289     <span class="comment">//</span>
<a name="l04290"></a>04290     <span class="comment">// Return the final hash filter bit index.</span>
<a name="l04291"></a>04291     <span class="comment">//</span>
<a name="l04292"></a>04292     <span class="keywordflow">return</span>(ui32Mask);
<a name="l04293"></a>04293 }
<a name="l04294"></a>04294 
<a name="l04295"></a>04295 <span class="comment">//*****************************************************************************</span>
<a name="l04296"></a>04296 <span class="comment">//</span>
<a name="l04314"></a>04314 <span class="comment"></span><span class="comment">//</span>
<a name="l04315"></a>04315 <span class="comment">//*****************************************************************************</span>
<a name="l04316"></a>04316 <span class="keywordtype">void</span>
<a name="l04317"></a><a class="code" href="group__emac__api.html#ga938f432d971b5380ac1d45972c78b77c">04317</a> <a class="code" href="group__emac__api.html#ga938f432d971b5380ac1d45972c78b77c">EMACVLANHashFilterSet</a>(uint32_t ui32Base, uint32_t ui32Hash)
<a name="l04318"></a>04318 {
<a name="l04319"></a>04319     <span class="comment">//</span>
<a name="l04320"></a>04320     <span class="comment">// Parameter sanity check.</span>
<a name="l04321"></a>04321     <span class="comment">//</span>
<a name="l04322"></a>04322     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l04323"></a>04323 
<a name="l04324"></a>04324     <span class="comment">//</span>
<a name="l04325"></a>04325     <span class="comment">// Write the VLAN Hash Table register.</span>
<a name="l04326"></a>04326     <span class="comment">//</span>
<a name="l04327"></a>04327     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a9101c73088f6e9b6a5b603cbb79d7692">EMAC_O_VLANHASH</a>) = ui32Hash;
<a name="l04328"></a>04328 }
<a name="l04329"></a>04329 
<a name="l04330"></a>04330 <span class="comment">//*****************************************************************************</span>
<a name="l04331"></a>04331 <span class="comment">//</span>
<a name="l04343"></a>04343 <span class="comment"></span><span class="comment">//</span>
<a name="l04344"></a>04344 <span class="comment">//*****************************************************************************</span>
<a name="l04345"></a>04345 uint32_t
<a name="l04346"></a><a class="code" href="group__emac__api.html#ga10688b212012eaf1a24fead506e6eb56">04346</a> <a class="code" href="group__emac__api.html#ga10688b212012eaf1a24fead506e6eb56">EMACVLANHashFilterGet</a>(uint32_t ui32Base)
<a name="l04347"></a>04347 {
<a name="l04348"></a>04348     <span class="comment">//</span>
<a name="l04349"></a>04349     <span class="comment">// Parameter sanity check.</span>
<a name="l04350"></a>04350     <span class="comment">//</span>
<a name="l04351"></a>04351     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l04352"></a>04352 
<a name="l04353"></a>04353     <span class="comment">//</span>
<a name="l04354"></a>04354     <span class="comment">// Return the VLAN Hash Table register.</span>
<a name="l04355"></a>04355     <span class="comment">//</span>
<a name="l04356"></a>04356     <span class="keywordflow">return</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#a9101c73088f6e9b6a5b603cbb79d7692">EMAC_O_VLANHASH</a>));
<a name="l04357"></a>04357 }
<a name="l04358"></a>04358 
<a name="l04359"></a>04359 <span class="comment">//*****************************************************************************</span>
<a name="l04360"></a>04360 <span class="comment">//</span>
<a name="l04408"></a>04408 <span class="comment"></span><span class="comment">//</span>
<a name="l04409"></a>04409 <span class="comment">//*****************************************************************************</span>
<a name="l04410"></a>04410 <span class="keywordtype">void</span>
<a name="l04411"></a><a class="code" href="group__emac__api.html#ga011f5a2a72640eea9a785fdc108f2784">04411</a> <a class="code" href="group__emac__api.html#ga011f5a2a72640eea9a785fdc108f2784">EMACRemoteWakeUpFrameFilterSet</a>(uint32_t ui32Base,
<a name="l04412"></a>04412                                <span class="keyword">const</span> <a class="code" href="structt_e_m_a_c_wake_up_frame_filter.html">tEMACWakeUpFrameFilter</a> *pFilter)
<a name="l04413"></a>04413 {
<a name="l04414"></a>04414     uint32_t *pui32Data;
<a name="l04415"></a>04415     uint32_t ui32Loop;
<a name="l04416"></a>04416 
<a name="l04417"></a>04417     <span class="comment">//</span>
<a name="l04418"></a>04418     <span class="comment">// Parameter sanity check.</span>
<a name="l04419"></a>04419     <span class="comment">//</span>
<a name="l04420"></a>04420     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l04421"></a>04421     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(pFilter);
<a name="l04422"></a>04422 
<a name="l04423"></a>04423     <span class="comment">//</span>
<a name="l04424"></a>04424     <span class="comment">// Make sure that the internal register counter for the frame filter</span>
<a name="l04425"></a>04425     <span class="comment">// is reset.  This bit automatically resets after 1 clock cycle.</span>
<a name="l04426"></a>04426     <span class="comment">//</span>
<a name="l04427"></a>04427     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#abc583c76fabf160df6608111f7574c69">EMAC_O_PMTCTLSTAT</a>) |= <a class="code" href="hw__emac_8h.html#a5b45f7517d0716bef5a305eaf4b1b65b">EMAC_PMTCTLSTAT_WUPFRRST</a>;
<a name="l04428"></a>04428 
<a name="l04429"></a>04429     <span class="comment">//</span>
<a name="l04430"></a>04430     <span class="comment">// Get a word pointer to the supplied structure.</span>
<a name="l04431"></a>04431     <span class="comment">//</span>
<a name="l04432"></a>04432     pui32Data = (uint32_t *)pFilter;
<a name="l04433"></a>04433 
<a name="l04434"></a>04434     <span class="comment">//</span>
<a name="l04435"></a>04435     <span class="comment">// Write the 8 words of the wake-up filter definition to the hardware.</span>
<a name="l04436"></a>04436     <span class="comment">//</span>
<a name="l04437"></a>04437     <span class="keywordflow">for</span>(ui32Loop = 0; ui32Loop &lt; 8; ui32Loop++)
<a name="l04438"></a>04438     {
<a name="l04439"></a>04439         <span class="comment">//</span>
<a name="l04440"></a>04440         <span class="comment">// Write a word of the filter definition.</span>
<a name="l04441"></a>04441         <span class="comment">//</span>
<a name="l04442"></a>04442         <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#aa7db79530deac8bfee314f081d6dc8f2">EMAC_O_RWUFF</a>) = pui32Data[ui32Loop];
<a name="l04443"></a>04443     }
<a name="l04444"></a>04444 }
<a name="l04445"></a>04445 
<a name="l04446"></a>04446 <span class="comment">//*****************************************************************************</span>
<a name="l04447"></a>04447 <span class="comment">//</span>
<a name="l04491"></a>04491 <span class="comment"></span><span class="comment">//</span>
<a name="l04492"></a>04492 <span class="comment">//*****************************************************************************</span>
<a name="l04493"></a>04493 <span class="keywordtype">void</span>
<a name="l04494"></a><a class="code" href="group__emac__api.html#ga50ad8fc16e031c90ced4f023b0692cbc">04494</a> <a class="code" href="group__emac__api.html#ga50ad8fc16e031c90ced4f023b0692cbc">EMACRemoteWakeUpFrameFilterGet</a>(uint32_t ui32Base,
<a name="l04495"></a>04495                                <a class="code" href="structt_e_m_a_c_wake_up_frame_filter.html">tEMACWakeUpFrameFilter</a> *pFilter)
<a name="l04496"></a>04496 {
<a name="l04497"></a>04497     uint32_t *pui32Data;
<a name="l04498"></a>04498     uint32_t ui32Loop;
<a name="l04499"></a>04499 
<a name="l04500"></a>04500     <span class="comment">//</span>
<a name="l04501"></a>04501     <span class="comment">// Parameter sanity check.</span>
<a name="l04502"></a>04502     <span class="comment">//</span>
<a name="l04503"></a>04503     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l04504"></a>04504     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(pFilter);
<a name="l04505"></a>04505 
<a name="l04506"></a>04506     <span class="comment">//</span>
<a name="l04507"></a>04507     <span class="comment">// Make sure that the internal register counter for the frame filter</span>
<a name="l04508"></a>04508     <span class="comment">// is reset.  This bit automatically resets after 1 clock cycle.</span>
<a name="l04509"></a>04509     <span class="comment">//</span>
<a name="l04510"></a>04510     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#abc583c76fabf160df6608111f7574c69">EMAC_O_PMTCTLSTAT</a>) |= <a class="code" href="hw__emac_8h.html#a5b45f7517d0716bef5a305eaf4b1b65b">EMAC_PMTCTLSTAT_WUPFRRST</a>;
<a name="l04511"></a>04511 
<a name="l04512"></a>04512     <span class="comment">//</span>
<a name="l04513"></a>04513     <span class="comment">// Get a word pointer to the supplied structure.</span>
<a name="l04514"></a>04514     <span class="comment">//</span>
<a name="l04515"></a>04515     pui32Data = (uint32_t *)pFilter;
<a name="l04516"></a>04516 
<a name="l04517"></a>04517     <span class="comment">//</span>
<a name="l04518"></a>04518     <span class="comment">// Read the 8 words of the wake-up filter definition from the hardware.</span>
<a name="l04519"></a>04519     <span class="comment">//</span>
<a name="l04520"></a>04520     <span class="keywordflow">for</span>(ui32Loop = 0; ui32Loop &lt; 8; ui32Loop++)
<a name="l04521"></a>04521     {
<a name="l04522"></a>04522         <span class="comment">//</span>
<a name="l04523"></a>04523         <span class="comment">// Read a word of the filter definition.</span>
<a name="l04524"></a>04524         <span class="comment">//</span>
<a name="l04525"></a>04525         pui32Data[ui32Loop] = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#aa7db79530deac8bfee314f081d6dc8f2">EMAC_O_RWUFF</a>);
<a name="l04526"></a>04526     }
<a name="l04527"></a>04527 }
<a name="l04528"></a>04528 
<a name="l04529"></a>04529 <span class="comment">//*****************************************************************************</span>
<a name="l04530"></a>04530 <span class="comment">//</span>
<a name="l04573"></a>04573 <span class="comment"></span><span class="comment">//</span>
<a name="l04574"></a>04574 <span class="comment">//*****************************************************************************</span>
<a name="l04575"></a>04575 <span class="keywordtype">void</span>
<a name="l04576"></a><a class="code" href="group__emac__api.html#ga447fd24e3ea71e1cca2e092b93aa5e90">04576</a> <a class="code" href="group__emac__api.html#ga447fd24e3ea71e1cca2e092b93aa5e90">EMACPowerManagementControlSet</a>(uint32_t ui32Base, uint32_t ui32Flags)
<a name="l04577"></a>04577 {
<a name="l04578"></a>04578     uint32_t ui32Value;
<a name="l04579"></a>04579 
<a name="l04580"></a>04580     <span class="comment">//</span>
<a name="l04581"></a>04581     <span class="comment">// Parameter sanity check.</span>
<a name="l04582"></a>04582     <span class="comment">//</span>
<a name="l04583"></a>04583     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l04584"></a>04584     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(~(ui32Flags &amp; ~(<a class="code" href="group__emac__api.html#ga02930957fc3c70a3513874c870410313">EMAC_PMT_GLOBAL_UNICAST_ENABLE</a> |
<a name="l04585"></a>04585                            <a class="code" href="group__emac__api.html#ga1eb233e20d6265974a02e6e567ad3478">EMAC_PMT_WAKEUP_PACKET_ENABLE</a> |
<a name="l04586"></a>04586                            <a class="code" href="group__emac__api.html#gaca622a9f05faaa9a454df4088fca8b20">EMAC_PMT_MAGIC_PACKET_ENABLE</a> |
<a name="l04587"></a>04587                            <a class="code" href="group__emac__api.html#gab7f0c5e969b8f74d4d141f152a7b27ba">EMAC_PMT_POWER_DOWN</a>)));
<a name="l04588"></a>04588 
<a name="l04589"></a>04589     <span class="comment">//</span>
<a name="l04590"></a>04590     <span class="comment">// Read the control/status register, clear all the bits we can set, mask</span>
<a name="l04591"></a>04591     <span class="comment">// in the new values then rewrite the new register value.</span>
<a name="l04592"></a>04592     <span class="comment">//</span>
<a name="l04593"></a>04593     ui32Value = <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#abc583c76fabf160df6608111f7574c69">EMAC_O_PMTCTLSTAT</a>);
<a name="l04594"></a>04594     ui32Value &amp;= ~(<a class="code" href="hw__emac_8h.html#a373855b06200ad5fb2343190eb8b8ee0">EMAC_PMTCTLSTAT_GLBLUCAST</a> | <a class="code" href="hw__emac_8h.html#a1d30e9500afad15fe97112a38c0b2dd4">EMAC_PMTCTLSTAT_WUPFREN</a> |
<a name="l04595"></a>04595                    <a class="code" href="hw__emac_8h.html#a24b5d83e7bff78f9d51b1ddeb94968bb">EMAC_PMTCTLSTAT_MGKPKTEN</a> | <a class="code" href="hw__emac_8h.html#acbdafdc16698bbe682983266a1e8d50d">EMAC_PMTCTLSTAT_PWRDWN</a>);
<a name="l04596"></a>04596     ui32Value |= ui32Flags;
<a name="l04597"></a>04597     <a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#abc583c76fabf160df6608111f7574c69">EMAC_O_PMTCTLSTAT</a>) = ui32Value;
<a name="l04598"></a>04598 }
<a name="l04599"></a>04599 
<a name="l04600"></a>04600 <span class="comment">//*****************************************************************************</span>
<a name="l04601"></a>04601 <span class="comment">//</span>
<a name="l04625"></a>04625 <span class="comment"></span><span class="comment">//</span>
<a name="l04626"></a>04626 <span class="comment">//*****************************************************************************</span>
<a name="l04627"></a>04627 uint32_t
<a name="l04628"></a><a class="code" href="group__emac__api.html#gac27058b7953b34c50adecbff26a380af">04628</a> <a class="code" href="group__emac__api.html#gac27058b7953b34c50adecbff26a380af">EMACPowerManagementControlGet</a>(uint32_t ui32Base)
<a name="l04629"></a>04629 {
<a name="l04630"></a>04630     <span class="comment">//</span>
<a name="l04631"></a>04631     <span class="comment">// Parameter sanity check.</span>
<a name="l04632"></a>04632     <span class="comment">//</span>
<a name="l04633"></a>04633     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l04634"></a>04634 
<a name="l04635"></a>04635     <span class="comment">//</span>
<a name="l04636"></a>04636     <span class="comment">// Read the control/status register and mask off the control bits to return</span>
<a name="l04637"></a>04637     <span class="comment">// them to the caller.</span>
<a name="l04638"></a>04638     <span class="comment">//</span>
<a name="l04639"></a>04639     <span class="keywordflow">return</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#abc583c76fabf160df6608111f7574c69">EMAC_O_PMTCTLSTAT</a>) &amp;
<a name="l04640"></a>04640            (<a class="code" href="hw__emac_8h.html#a373855b06200ad5fb2343190eb8b8ee0">EMAC_PMTCTLSTAT_GLBLUCAST</a> | <a class="code" href="hw__emac_8h.html#a1d30e9500afad15fe97112a38c0b2dd4">EMAC_PMTCTLSTAT_WUPFREN</a> |
<a name="l04641"></a>04641             <a class="code" href="hw__emac_8h.html#a24b5d83e7bff78f9d51b1ddeb94968bb">EMAC_PMTCTLSTAT_MGKPKTEN</a> | <a class="code" href="hw__emac_8h.html#acbdafdc16698bbe682983266a1e8d50d">EMAC_PMTCTLSTAT_PWRDWN</a>));
<a name="l04642"></a>04642 }
<a name="l04643"></a>04643 
<a name="l04644"></a>04644 <span class="comment">//*****************************************************************************</span>
<a name="l04645"></a>04645 <span class="comment">//</span>
<a name="l04665"></a>04665 <span class="comment"></span><span class="comment">//</span>
<a name="l04666"></a>04666 <span class="comment">//*****************************************************************************</span>
<a name="l04667"></a>04667 uint32_t
<a name="l04668"></a><a class="code" href="group__emac__api.html#gac8d1ba09e288c496262591692be94fe2">04668</a> <a class="code" href="group__emac__api.html#gac8d1ba09e288c496262591692be94fe2">EMACPowerManagementStatusGet</a>(uint32_t ui32Base)
<a name="l04669"></a>04669 {
<a name="l04670"></a>04670     <span class="comment">//</span>
<a name="l04671"></a>04671     <span class="comment">// Parameter sanity check.</span>
<a name="l04672"></a>04672     <span class="comment">//</span>
<a name="l04673"></a>04673     <a class="code" href="debug_8h.html#a28301f76c53b643912da7c538f74e2c6">ASSERT</a>(ui32Base == <a class="code" href="hw__memmap_8h.html#a1272d0cc4758d276f6368bc955bfb84f">EMAC0_BASE</a>);
<a name="l04674"></a>04674 
<a name="l04675"></a>04675     <span class="comment">//</span>
<a name="l04676"></a>04676     <span class="comment">// Read the control/status register and mask off the status bits to return</span>
<a name="l04677"></a>04677     <span class="comment">// them to the caller.</span>
<a name="l04678"></a>04678     <span class="comment">//</span>
<a name="l04679"></a>04679     <span class="keywordflow">return</span>(<a class="code" href="hw__types_8h.html#ac9660181819fceac0b5abcd67d76ca6e">HWREG</a>(ui32Base + <a class="code" href="hw__emac_8h.html#abc583c76fabf160df6608111f7574c69">EMAC_O_PMTCTLSTAT</a>) &amp;
<a name="l04680"></a>04680            (<a class="code" href="hw__emac_8h.html#a6cba1535ff3a9287835825924129b330">EMAC_PMTCTLSTAT_WUPRX</a> | <a class="code" href="hw__emac_8h.html#aad021b33e37dd24e392c4b251f64a88a">EMAC_PMTCTLSTAT_MGKPRX</a> |
<a name="l04681"></a>04681             <a class="code" href="hw__emac_8h.html#acbdafdc16698bbe682983266a1e8d50d">EMAC_PMTCTLSTAT_PWRDWN</a>));
<a name="l04682"></a>04682 }
<a name="l04683"></a>04683 
<a name="l04684"></a>04684 <span class="comment">//*****************************************************************************</span>
<a name="l04685"></a>04685 <span class="comment">//</span>
<a name="l04686"></a>04686 <span class="comment">// Close the Doxygen group.</span>
<a name="l04688"></a>04688 <span class="comment"></span><span class="comment">//</span>
<a name="l04689"></a>04689 <span class="comment">//*****************************************************************************</span>
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="emac_8c.html">emac.c</a>      </li>

    <li class="footer">Generated on Tue Jan 27 2015 21:45:30 for EE 445M by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
