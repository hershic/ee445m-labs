<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>EE445M RTOS: lib/libos/os.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">EE445M RTOS
   </div>
   <div id="projectbrief">Taken at the University of Texas Spring 2015</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('os_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">os.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="os_8h_source.html">os.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for os.c:</div>
<div class="dyncontent">
<div class="center"><img src="os_8c__incl.png" border="0" usemap="#lib_2libos_2os_8c" alt=""/></div>
<map name="lib_2libos_2os_8c" id="lib_2libos_2os_8c">
<area shape="rect" id="node2" href="os_8h.html" title="os.h" alt="" coords="169,80,218,107"/><area shape="rect" id="node3" href="nexus_8h.html" title="libstd/nexus.h" alt="" coords="19,155,130,181"/><area shape="rect" id="node7" href="hw__ints_8h.html" title="inc/hw_ints.h" alt="" coords="257,155,359,181"/><area shape="rect" id="node4" href="defines_8h.html" title="defines.h" alt="" coords="5,229,85,256"/></map>
</div>
</div>
<p><a href="os_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a21e9322255bb20b29229f675078d42b4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="os_8c.html#a21e9322255bb20b29229f675078d42b4">os_threading_init</a> ()</td></tr>
<tr class="separator:a21e9322255bb20b29229f675078d42b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2bb573a559f90989a49a4338d08203bd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="os_8h.html#a74f1cae5f9b08e029e1f7e40bc0add47">tcb_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="os_8c.html#a2bb573a559f90989a49a4338d08203bd">os_add_thread</a> (<a class="el" href="os_8h.html#a78a55c2ac757b7addb3150081812288b">task_t</a> task)</td></tr>
<tr class="separator:a2bb573a559f90989a49a4338d08203bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a911e62c4d8226477d0274c2416e47f9c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="os_8h.html#a74f1cae5f9b08e029e1f7e40bc0add47">tcb_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="os_8c.html#a911e62c4d8226477d0274c2416e47f9c">os_next_dead_thread</a> ()</td></tr>
<tr class="separator:a911e62c4d8226477d0274c2416e47f9c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afde304ef5313ffa073cea003547b33eb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="os_8c.html#afde304ef5313ffa073cea003547b33eb">os_launch</a> ()</td></tr>
<tr class="separator:afde304ef5313ffa073cea003547b33eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa82962ea069b6011927f9e2ef893128"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="os_8c.html#aaa82962ea069b6011927f9e2ef893128">os_reset_thread_stack</a> (<a class="el" href="os_8h.html#a74f1cae5f9b08e029e1f7e40bc0add47">tcb_t</a> *<a class="el" href="structtcb.html">tcb</a>, <a class="el" href="os_8h.html#a78a55c2ac757b7addb3150081812288b">task_t</a> task)</td></tr>
<tr class="separator:aaa82962ea069b6011927f9e2ef893128"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aafb8d3e0fd06464b1ee0ae1edbc3c7d6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="os_8c.html#aafb8d3e0fd06464b1ee0ae1edbc3c7d6">SysTick_Handler</a> ()</td></tr>
<tr class="separator:aafb8d3e0fd06464b1ee0ae1edbc3c7d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1ba32adb6ddf834e4938ba286a1f24a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="os_8c.html#aa1ba32adb6ddf834e4938ba286a1f24a">PendSV_Handler</a> ()</td></tr>
<tr class="separator:aa1ba32adb6ddf834e4938ba286a1f24a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a1b190933b985631f9a5a1f33afdd749e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="os_8h.html#a74f1cae5f9b08e029e1f7e40bc0add47">tcb_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="os_8c.html#a1b190933b985631f9a5a1f33afdd749e">OS_THREADS</a> [4]</td></tr>
<tr class="separator:a1b190933b985631f9a5a1f33afdd749e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c939f75fdcc34e027493b93efd6523d"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="os_8c.html#a9c939f75fdcc34e027493b93efd6523d">OS_PROGRAM_STACKS</a> [4][100]</td></tr>
<tr class="separator:a9c939f75fdcc34e027493b93efd6523d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae9949c077f4331066f07d5a0a89db0f5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="os_8h.html#a74f1cae5f9b08e029e1f7e40bc0add47">tcb_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="os_8c.html#ae9949c077f4331066f07d5a0a89db0f5">os_current_running_thread</a> = <a class="el" href="defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></td></tr>
<tr class="separator:ae9949c077f4331066f07d5a0a89db0f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a308367a2be95b095dc6ea1e9d4a825ff"><td class="memItemLeft" align="right" valign="top"><a class="el" href="os_8h.html#a74f1cae5f9b08e029e1f7e40bc0add47">tcb_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="os_8c.html#a308367a2be95b095dc6ea1e9d4a825ff">os_current_dead_thread</a> = <a class="el" href="defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></td></tr>
<tr class="separator:a308367a2be95b095dc6ea1e9d4a825ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a2bb573a559f90989a49a4338d08203bd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="os_8h.html#a74f1cae5f9b08e029e1f7e40bc0add47">tcb_t</a>* os_add_thread </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="os_8h.html#a78a55c2ac757b7addb3150081812288b">task_t</a>&#160;</td>
          <td class="paramname"><em>task</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="os_8c_source.html#l00041">41</a> of file <a class="el" href="os_8c_source.html">os.c</a>.</p>

<p>References <a class="el" href="nexus_8c_source.html#l00076">EndCritical()</a>, <a class="el" href="os_8h_source.html#l00039">tcb::next</a>, <a class="el" href="defines_8h_source.html#l00022">NULL</a>, <a class="el" href="os_8c_source.html#l00016">os_current_running_thread</a>, <a class="el" href="os_8c_source.html#l00086">os_next_dead_thread()</a>, <a class="el" href="os_8c_source.html#l00132">os_reset_thread_stack()</a>, <a class="el" href="os_8h_source.html#l00042">tcb::prev</a>, <a class="el" href="os_8h_source.html#l00052">tcb::sleep_timer</a>, <a class="el" href="nexus_8c_source.html#l00071">StartCritical()</a>, <a class="el" href="os_8h_source.html#l00049">tcb::status</a>, and <a class="el" href="os_8h_source.html#l00025">THREAD_RUNNING</a>.</p>

<p>Referenced by <a class="el" href="test-os_8c_source.html#l00040">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                                  {</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    int32_t status;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <a class="code" href="structtcb.html">tcb_t</a>* thread_to_add;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="comment">/* 1. Disable interrupts and save the priority mask */</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    status = <a class="code" href="nexus_8c.html#a025505fff239e04c19c67f2ff72e9a73">StartCritical</a>();</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="comment">/* 2. Add the task to the linked list of running threads. */</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="comment">/* 2a. If there is no more room for running threads, then return</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">       immediately. */</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="keywordflow">if</span> (!(thread_to_add = <a class="code" href="os_8c.html#a911e62c4d8226477d0274c2416e47f9c">os_next_dead_thread</a>())) {</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        <a class="code" href="nexus_8c.html#acac2b8577facf88812937428e6ab9bf8">EndCritical</a>(status);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    }</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="comment">/* 2b. If no thread is running, then create the initial running</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">       thread. */</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="os_8c.html#ae9949c077f4331066f07d5a0a89db0f5">os_current_running_thread</a>) {</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <a class="code" href="os_8c.html#ae9949c077f4331066f07d5a0a89db0f5">os_current_running_thread</a> = thread_to_add;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <a class="code" href="os_8c.html#ae9949c077f4331066f07d5a0a89db0f5">os_current_running_thread</a>-&gt;<a class="code" href="structtcb.html#aae1fd45a129bd299c55d9185fd701e3c">next</a> = <a class="code" href="os_8c.html#ae9949c077f4331066f07d5a0a89db0f5">os_current_running_thread</a>;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        <a class="code" href="os_8c.html#ae9949c077f4331066f07d5a0a89db0f5">os_current_running_thread</a>-&gt;<a class="code" href="structtcb.html#ae43b694dc3ba3934276a74c412120111">prev</a> = <a class="code" href="os_8c.html#ae9949c077f4331066f07d5a0a89db0f5">os_current_running_thread</a>;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    }</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="comment">/* 2c. If we don&#39;t have any problems with either thread circles,</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">       then remove a thread from the dead thread pool and add it to</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">       the running thread pool, relinking the linked list</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">       appropriately. This thread will run next. */</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <a class="code" href="os_8c.html#ae9949c077f4331066f07d5a0a89db0f5">os_current_running_thread</a>-&gt;<a class="code" href="structtcb.html#aae1fd45a129bd299c55d9185fd701e3c">next</a>-&gt;<a class="code" href="structtcb.html#ae43b694dc3ba3934276a74c412120111">prev</a> = thread_to_add;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        thread_to_add-&gt;<a class="code" href="structtcb.html#aae1fd45a129bd299c55d9185fd701e3c">next</a> = <a class="code" href="os_8c.html#ae9949c077f4331066f07d5a0a89db0f5">os_current_running_thread</a>-&gt;<a class="code" href="structtcb.html#aae1fd45a129bd299c55d9185fd701e3c">next</a>;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <a class="code" href="os_8c.html#ae9949c077f4331066f07d5a0a89db0f5">os_current_running_thread</a>-&gt;<a class="code" href="structtcb.html#aae1fd45a129bd299c55d9185fd701e3c">next</a> = thread_to_add;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        thread_to_add-&gt;<a class="code" href="structtcb.html#ae43b694dc3ba3934276a74c412120111">prev</a> = <a class="code" href="os_8c.html#ae9949c077f4331066f07d5a0a89db0f5">os_current_running_thread</a>;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    }</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="comment">/* 3. Set the initial stack contents for the new thread. */</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <a class="code" href="os_8c.html#aaa82962ea069b6011927f9e2ef893128">os_reset_thread_stack</a>(thread_to_add, task);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="comment">/* 4. Set other metadata for this thread&#39;s TCB. */</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    thread_to_add-&gt;<a class="code" href="structtcb.html#a5d36bab13f7b5105e639165a67e6b943">status</a> = <a class="code" href="os_8h.html#a5c80f9e973519c129c8a7dec80c71c2aaa5639ff4eff3f959406116db9e020c44">THREAD_RUNNING</a>;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    thread_to_add-&gt;<a class="code" href="structtcb.html#aeea97619a9957dd9773ad75d3cb242ea">sleep_timer</a> = 0;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="comment">/* 5. Return. */</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <a class="code" href="nexus_8c.html#acac2b8577facf88812937428e6ab9bf8">EndCritical</a>(status);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordflow">return</span> thread_to_add;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;}</div>
<div class="ttc" id="nexus_8c_html_acac2b8577facf88812937428e6ab9bf8"><div class="ttname"><a href="nexus_8c.html#acac2b8577facf88812937428e6ab9bf8">EndCritical</a></div><div class="ttdeci">void EndCritical(int32_t primask)</div><div class="ttdef"><b>Definition:</b> <a href="nexus_8c_source.html#l00076">nexus.c:76</a></div></div>
<div class="ttc" id="os_8c_html_a911e62c4d8226477d0274c2416e47f9c"><div class="ttname"><a href="os_8c.html#a911e62c4d8226477d0274c2416e47f9c">os_next_dead_thread</a></div><div class="ttdeci">tcb_t * os_next_dead_thread()</div><div class="ttdef"><b>Definition:</b> <a href="os_8c_source.html#l00086">os.c:86</a></div></div>
<div class="ttc" id="structtcb_html_aae1fd45a129bd299c55d9185fd701e3c"><div class="ttname"><a href="structtcb.html#aae1fd45a129bd299c55d9185fd701e3c">tcb::next</a></div><div class="ttdeci">struct tcb * next</div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00039">os.h:39</a></div></div>
<div class="ttc" id="nexus_8c_html_a025505fff239e04c19c67f2ff72e9a73"><div class="ttname"><a href="nexus_8c.html#a025505fff239e04c19c67f2ff72e9a73">StartCritical</a></div><div class="ttdeci">int32_t StartCritical()</div><div class="ttdef"><b>Definition:</b> <a href="nexus_8c_source.html#l00071">nexus.c:71</a></div></div>
<div class="ttc" id="os_8c_html_aaa82962ea069b6011927f9e2ef893128"><div class="ttname"><a href="os_8c.html#aaa82962ea069b6011927f9e2ef893128">os_reset_thread_stack</a></div><div class="ttdeci">void os_reset_thread_stack(tcb_t *tcb, task_t task)</div><div class="ttdef"><b>Definition:</b> <a href="os_8c_source.html#l00132">os.c:132</a></div></div>
<div class="ttc" id="os_8c_html_ae9949c077f4331066f07d5a0a89db0f5"><div class="ttname"><a href="os_8c.html#ae9949c077f4331066f07d5a0a89db0f5">os_current_running_thread</a></div><div class="ttdeci">tcb_t * os_current_running_thread</div><div class="ttdef"><b>Definition:</b> <a href="os_8c_source.html#l00016">os.c:16</a></div></div>
<div class="ttc" id="structtcb_html"><div class="ttname"><a href="structtcb.html">tcb</a></div><div class="ttdoc">Thread Control Block. </div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00034">os.h:34</a></div></div>
<div class="ttc" id="structtcb_html_a5d36bab13f7b5105e639165a67e6b943"><div class="ttname"><a href="structtcb.html#a5d36bab13f7b5105e639165a67e6b943">tcb::status</a></div><div class="ttdeci">tstate_t status</div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00049">os.h:49</a></div></div>
<div class="ttc" id="defines_8h_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="defines_8h_source.html#l00022">defines.h:22</a></div></div>
<div class="ttc" id="structtcb_html_aeea97619a9957dd9773ad75d3cb242ea"><div class="ttname"><a href="structtcb.html#aeea97619a9957dd9773ad75d3cb242ea">tcb::sleep_timer</a></div><div class="ttdeci">int32_t sleep_timer</div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00052">os.h:52</a></div></div>
<div class="ttc" id="structtcb_html_ae43b694dc3ba3934276a74c412120111"><div class="ttname"><a href="structtcb.html#ae43b694dc3ba3934276a74c412120111">tcb::prev</a></div><div class="ttdeci">struct tcb * prev</div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00042">os.h:42</a></div></div>
<div class="ttc" id="os_8h_html_a5c80f9e973519c129c8a7dec80c71c2aaa5639ff4eff3f959406116db9e020c44"><div class="ttname"><a href="os_8h.html#a5c80f9e973519c129c8a7dec80c71c2aaa5639ff4eff3f959406116db9e020c44">THREAD_RUNNING</a></div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00025">os.h:25</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="os_8c_a2bb573a559f90989a49a4338d08203bd_cgraph.png" border="0" usemap="#os_8c_a2bb573a559f90989a49a4338d08203bd_cgraph" alt=""/></div>
<map name="os_8c_a2bb573a559f90989a49a4338d08203bd_cgraph" id="os_8c_a2bb573a559f90989a49a4338d08203bd_cgraph">
<area shape="rect" id="node2" href="nexus_8c.html#acac2b8577facf88812937428e6ab9bf8" title="EndCritical" alt="" coords="209,5,299,32"/><area shape="rect" id="node3" href="os_8c.html#a911e62c4d8226477d0274c2416e47f9c" title="os_next_dead_thread" alt="" coords="174,56,334,83"/><area shape="rect" id="node4" href="os_8c.html#aaa82962ea069b6011927f9e2ef893128" title="os_reset_thread_stack" alt="" coords="171,107,337,133"/><area shape="rect" id="node5" href="nexus_8c.html#a025505fff239e04c19c67f2ff72e9a73" title="StartCritical" alt="" coords="205,157,303,184"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="os_8c_a2bb573a559f90989a49a4338d08203bd_icgraph.png" border="0" usemap="#os_8c_a2bb573a559f90989a49a4338d08203bd_icgraph" alt=""/></div>
<map name="os_8c_a2bb573a559f90989a49a4338d08203bd_icgraph" id="os_8c_a2bb573a559f90989a49a4338d08203bd_icgraph">
<area shape="rect" id="node2" href="test-os_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4" title="main" alt="" coords="171,5,225,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="afde304ef5313ffa073cea003547b33eb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void os_launch </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Launches the operating system. </p><dl class="section note"><dt>Note</dt><dd>This function drastically changes the execution paradigm of the machine; do not expect to call it and be able to return to the previous context. </dd></dl>

<p>Definition at line <a class="el" href="os_8c_source.html#l00105">105</a> of file <a class="el" href="os_8c_source.html">os.c</a>.</p>

<p>Referenced by <a class="el" href="test-os_8c_source.html#l00040">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                 {</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="comment">/* acquire the pointer to the stack pointer here */</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;LDR     R0, =os_current_running_thread&quot;</span>);</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="comment">/* acquire the current value of the stack pointer */</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;LDR R0, [R0]&quot;</span>);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;LDR R0, [R0]&quot;</span>);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="comment">/* set the process stack value */</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;MSR PSP, R0&quot;</span>);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="comment">/* change the active stack to use psp */</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;MRS R0, CONTROL&quot;</span>);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;ORR R0, R0, #2&quot;</span>);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;MSR CONTROL, R0&quot;</span>);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;POP     {R4-R11}&quot;</span>);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;POP     {LR}&quot;</span>);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;POP     {R0-R3}&quot;</span>);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;pop {r12, lr}&quot;</span>);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;pop {pc}&quot;</span>);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="comment">/* can&#39;t do anything about the PSR */</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="os_8c_afde304ef5313ffa073cea003547b33eb_icgraph.png" border="0" usemap="#os_8c_afde304ef5313ffa073cea003547b33eb_icgraph" alt=""/></div>
<map name="os_8c_afde304ef5313ffa073cea003547b33eb_icgraph" id="os_8c_afde304ef5313ffa073cea003547b33eb_icgraph">
<area shape="rect" id="node2" href="test-os_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4" title="main" alt="" coords="140,5,195,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a911e62c4d8226477d0274c2416e47f9c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="os_8h.html#a74f1cae5f9b08e029e1f7e40bc0add47">tcb_t</a>* os_next_dead_thread </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns the next dead thread in the dead thread circle. If the length of the dead thread circle is greater than 1, then the current dead thread is removed and the circle is relinked with the next dead thread. If the circle contains only one dead thread, then that thread is removed and the current dead thread is set to null. If there is no thread in the dead thread circle, then it retuns null. </p><dl class="section return"><dt>Returns</dt><dd>The first thread removed from the dead thread circle, or null if the dead thread circle is empty. </dd></dl>

<p>Definition at line <a class="el" href="os_8c_source.html#l00086">86</a> of file <a class="el" href="os_8c_source.html">os.c</a>.</p>

<p>References <a class="el" href="os_8h_source.html#l00039">tcb::next</a>, <a class="el" href="defines_8h_source.html#l00022">NULL</a>, <a class="el" href="os_8c_source.html#l00019">os_current_dead_thread</a>, and <a class="el" href="os_8h_source.html#l00042">tcb::prev</a>.</p>

<p>Referenced by <a class="el" href="os_8c_source.html#l00041">os_add_thread()</a>.</p>
<div class="fragment"><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                             {</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <a class="code" href="structtcb.html">tcb_t</a>* return_tcb = <a class="code" href="os_8c.html#a308367a2be95b095dc6ea1e9d4a825ff">os_current_dead_thread</a>;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keywordflow">if</span> (!return_tcb) { <span class="keywordflow">return</span> return_tcb; }</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="os_8c.html#a308367a2be95b095dc6ea1e9d4a825ff">os_current_dead_thread</a>-&gt;<a class="code" href="structtcb.html#aae1fd45a129bd299c55d9185fd701e3c">next</a> == <a class="code" href="os_8c.html#a308367a2be95b095dc6ea1e9d4a825ff">os_current_dead_thread</a>) &amp;&amp;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        (<a class="code" href="os_8c.html#a308367a2be95b095dc6ea1e9d4a825ff">os_current_dead_thread</a>-&gt;<a class="code" href="structtcb.html#ae43b694dc3ba3934276a74c412120111">prev</a> == <a class="code" href="os_8c.html#a308367a2be95b095dc6ea1e9d4a825ff">os_current_dead_thread</a>)) {</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        return_tcb = <a class="code" href="os_8c.html#a308367a2be95b095dc6ea1e9d4a825ff">os_current_dead_thread</a>;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <a class="code" href="os_8c.html#a308367a2be95b095dc6ea1e9d4a825ff">os_current_dead_thread</a> = <a class="code" href="defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        <span class="keywordflow">return</span> return_tcb;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    }</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <a class="code" href="os_8c.html#a308367a2be95b095dc6ea1e9d4a825ff">os_current_dead_thread</a>-&gt;<a class="code" href="structtcb.html#aae1fd45a129bd299c55d9185fd701e3c">next</a>-&gt;<a class="code" href="structtcb.html#ae43b694dc3ba3934276a74c412120111">prev</a> = <a class="code" href="os_8c.html#a308367a2be95b095dc6ea1e9d4a825ff">os_current_dead_thread</a>-&gt;<a class="code" href="structtcb.html#ae43b694dc3ba3934276a74c412120111">prev</a>;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <a class="code" href="os_8c.html#a308367a2be95b095dc6ea1e9d4a825ff">os_current_dead_thread</a>-&gt;<a class="code" href="structtcb.html#ae43b694dc3ba3934276a74c412120111">prev</a>-&gt;<a class="code" href="structtcb.html#aae1fd45a129bd299c55d9185fd701e3c">next</a> = <a class="code" href="os_8c.html#a308367a2be95b095dc6ea1e9d4a825ff">os_current_dead_thread</a>-&gt;<a class="code" href="structtcb.html#aae1fd45a129bd299c55d9185fd701e3c">next</a>;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <a class="code" href="os_8c.html#a308367a2be95b095dc6ea1e9d4a825ff">os_current_dead_thread</a> = <a class="code" href="os_8c.html#a308367a2be95b095dc6ea1e9d4a825ff">os_current_dead_thread</a>-&gt;<a class="code" href="structtcb.html#aae1fd45a129bd299c55d9185fd701e3c">next</a>;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="keywordflow">return</span> return_tcb;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;}</div>
<div class="ttc" id="structtcb_html_aae1fd45a129bd299c55d9185fd701e3c"><div class="ttname"><a href="structtcb.html#aae1fd45a129bd299c55d9185fd701e3c">tcb::next</a></div><div class="ttdeci">struct tcb * next</div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00039">os.h:39</a></div></div>
<div class="ttc" id="os_8c_html_a308367a2be95b095dc6ea1e9d4a825ff"><div class="ttname"><a href="os_8c.html#a308367a2be95b095dc6ea1e9d4a825ff">os_current_dead_thread</a></div><div class="ttdeci">tcb_t * os_current_dead_thread</div><div class="ttdef"><b>Definition:</b> <a href="os_8c_source.html#l00019">os.c:19</a></div></div>
<div class="ttc" id="structtcb_html"><div class="ttname"><a href="structtcb.html">tcb</a></div><div class="ttdoc">Thread Control Block. </div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00034">os.h:34</a></div></div>
<div class="ttc" id="defines_8h_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="defines_8h_source.html#l00022">defines.h:22</a></div></div>
<div class="ttc" id="structtcb_html_ae43b694dc3ba3934276a74c412120111"><div class="ttname"><a href="structtcb.html#ae43b694dc3ba3934276a74c412120111">tcb::prev</a></div><div class="ttdeci">struct tcb * prev</div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00042">os.h:42</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="os_8c_a911e62c4d8226477d0274c2416e47f9c_icgraph.png" border="0" usemap="#os_8c_a911e62c4d8226477d0274c2416e47f9c_icgraph" alt=""/></div>
<map name="os_8c_a911e62c4d8226477d0274c2416e47f9c_icgraph" id="os_8c_a911e62c4d8226477d0274c2416e47f9c_icgraph">
<area shape="rect" id="node2" href="os_8c.html#a2bb573a559f90989a49a4338d08203bd" title="os_add_thread" alt="" coords="213,5,331,32"/><area shape="rect" id="node3" href="test-os_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4" title="main" alt="" coords="379,5,433,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aaa82962ea069b6011927f9e2ef893128"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void os_reset_thread_stack </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="os_8h.html#a74f1cae5f9b08e029e1f7e40bc0add47">tcb_t</a> *&#160;</td>
          <td class="paramname"><em>tcb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="os_8h.html#a78a55c2ac757b7addb3150081812288b">task_t</a>&#160;</td>
          <td class="paramname"><em>task</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Resets the thread stack for a given tcb to run a given task. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">thread</td><td>the thread whose stack is to be reset </td></tr>
    <tr><td class="paramname">the</td><td>task for which the thread should run </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="os_8c_source.html#l00132">132</a> of file <a class="el" href="os_8c_source.html">os.c</a>.</p>

<p>References <a class="el" href="os_8h_source.html#l00046">tcb::id</a>, <a class="el" href="os_8h_source.html#l00080">swcontext::lr</a>, <a class="el" href="os_8c_source.html#l00013">OS_PROGRAM_STACKS</a>, <a class="el" href="os_8h_source.html#l00015">OS_STACK_SIZE</a>, <a class="el" href="os_8h_source.html#l00066">hwcontext::pc</a>, <a class="el" href="os_8h_source.html#l00067">hwcontext::psr</a>, <a class="el" href="os_8h_source.html#l00060">hwcontext::r0</a>, <a class="el" href="os_8h_source.html#l00061">hwcontext::r1</a>, <a class="el" href="os_8h_source.html#l00078">swcontext::r10</a>, <a class="el" href="os_8h_source.html#l00079">swcontext::r11</a>, <a class="el" href="os_8h_source.html#l00062">hwcontext::r2</a>, <a class="el" href="os_8h_source.html#l00063">hwcontext::r3</a>, <a class="el" href="os_8h_source.html#l00072">swcontext::r4</a>, <a class="el" href="os_8h_source.html#l00073">swcontext::r5</a>, <a class="el" href="os_8h_source.html#l00074">swcontext::r6</a>, <a class="el" href="os_8h_source.html#l00075">swcontext::r7</a>, <a class="el" href="os_8h_source.html#l00076">swcontext::r8</a>, <a class="el" href="os_8h_source.html#l00077">swcontext::r9</a>, and <a class="el" href="os_8h_source.html#l00036">tcb::sp</a>.</p>

<p>Referenced by <a class="el" href="os_8c_source.html#l00041">os_add_thread()</a>.</p>
<div class="fragment"><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                                                    {</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <a class="code" href="structhwcontext.html">hwcontext_t</a>* <a class="code" href="structhwcontext.html">hwcontext</a> = (<a class="code" href="structhwcontext.html">hwcontext_t</a>*)</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        (((uint32_t)<a class="code" href="os_8c.html#a9c939f75fdcc34e027493b93efd6523d">OS_PROGRAM_STACKS</a>[tcb-&gt;<a class="code" href="structtcb.html#ae673fba062360576eee9902d87c2dea8">id</a>]) +</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;         <span class="keyword">sizeof</span>(uint32_t)*<a class="code" href="os_8h.html#a9fdcaeee2ac8d68ac5fbbcd450fd08da">OS_STACK_SIZE</a> - <span class="keyword">sizeof</span>(<a class="code" href="structhwcontext.html">hwcontext_t</a>));</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <a class="code" href="structswcontext.html">swcontext_t</a>* <a class="code" href="structswcontext.html">swcontext</a> = (<a class="code" href="structswcontext.html">swcontext_t</a>*)</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        (((uint32_t)hwcontext) - <span class="keyword">sizeof</span>(<a class="code" href="structswcontext.html">swcontext_t</a>));</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    hwcontext-&gt;<a class="code" href="structhwcontext.html#a50f98f801ed417529e78e6f00f0a40d2">pc</a> = (uint32_t)(task);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    hwcontext-&gt;<a class="code" href="structhwcontext.html#ab8ef842b72d033b740bc5d7b63668a7f">psr</a> = 0x01000000;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    swcontext-&gt;<a class="code" href="structswcontext.html#aff003065cbe0c593e3d29631a47d7695">lr</a> = 0xfffffffd;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    hwcontext-&gt;<a class="code" href="structhwcontext.html#a65407fe41de053b48e9e826ed3c638e6">r0</a> = 0x00000000;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    hwcontext-&gt;<a class="code" href="structhwcontext.html#af5bf976e4a863698625aaf109b4f4922">r1</a> = 0x01010101;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    hwcontext-&gt;<a class="code" href="structhwcontext.html#ae7e9f9364072144b854b18188576baf5">r2</a> = 0x02020202;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    hwcontext-&gt;<a class="code" href="structhwcontext.html#aebbb22c13f9911fb942fb5fea9adb9ec">r3</a> = 0x03030303;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    swcontext-&gt;<a class="code" href="structswcontext.html#adca79d8d458b4c055463355a7295e2c5">r4</a> = 0x04040404;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    swcontext-&gt;<a class="code" href="structswcontext.html#a3d1731647adbe72b2cd79b112057d8c8">r5</a> = 0x05050505;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    swcontext-&gt;<a class="code" href="structswcontext.html#a5cf1f3ca2e14e1aa14deb100734e1c30">r6</a> = 0x06060606;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    swcontext-&gt;<a class="code" href="structswcontext.html#a9844679f105ad367c9f89f2811a38397">r7</a> = 0x07070707;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    swcontext-&gt;<a class="code" href="structswcontext.html#a6da50c233eaf9dc50cc65fc7ebabb68d">r8</a> = 0x08080808;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    swcontext-&gt;<a class="code" href="structswcontext.html#a2f4f0d3b6c09829e666bf45f39b942eb">r9</a> = 0x09090909;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    swcontext-&gt;<a class="code" href="structswcontext.html#a7347ef967115a508e699a2cc0f29fa34">r10</a> = 0x10101010;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    swcontext-&gt;<a class="code" href="structswcontext.html#ade09026c0a2d7a6409f192a7f2e9ccb9">r11</a> = 0x11111111;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    tcb-&gt;<a class="code" href="structtcb.html#a1b635a6f6a5f7f3c80665eb17b561b74">sp</a> = (uint32_t*)(((uint32_t)hwcontext) - <span class="keyword">sizeof</span>(<a class="code" href="structswcontext.html">swcontext_t</a>));</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span> (<span class="stringliteral">&quot;PUSH {R9, R10, R11, R12}&quot;</span>);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span> ( <span class="stringliteral">&quot;mrs     r12, psp&quot;</span> );</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span> ( <span class="stringliteral">&quot;mrs     r11, msp&quot;</span> );</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span> ( <span class="stringliteral">&quot;mrs     r10, control&quot;</span> );</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span> (<span class="stringliteral">&quot;POP {R9, R10, R11, R12}&quot;</span>);</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;}</div>
<div class="ttc" id="structtcb_html_ae673fba062360576eee9902d87c2dea8"><div class="ttname"><a href="structtcb.html#ae673fba062360576eee9902d87c2dea8">tcb::id</a></div><div class="ttdeci">immutable int32_t id</div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00046">os.h:46</a></div></div>
<div class="ttc" id="structswcontext_html_ade09026c0a2d7a6409f192a7f2e9ccb9"><div class="ttname"><a href="structswcontext.html#ade09026c0a2d7a6409f192a7f2e9ccb9">swcontext::r11</a></div><div class="ttdeci">uint32_t r11</div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00079">os.h:79</a></div></div>
<div class="ttc" id="structhwcontext_html_ae7e9f9364072144b854b18188576baf5"><div class="ttname"><a href="structhwcontext.html#ae7e9f9364072144b854b18188576baf5">hwcontext::r2</a></div><div class="ttdeci">uint32_t r2</div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00062">os.h:62</a></div></div>
<div class="ttc" id="os_8c_html_a9c939f75fdcc34e027493b93efd6523d"><div class="ttname"><a href="os_8c.html#a9c939f75fdcc34e027493b93efd6523d">OS_PROGRAM_STACKS</a></div><div class="ttdeci">int32_t OS_PROGRAM_STACKS[4][100]</div><div class="ttdef"><b>Definition:</b> <a href="os_8c_source.html#l00013">os.c:13</a></div></div>
<div class="ttc" id="structswcontext_html_a5cf1f3ca2e14e1aa14deb100734e1c30"><div class="ttname"><a href="structswcontext.html#a5cf1f3ca2e14e1aa14deb100734e1c30">swcontext::r6</a></div><div class="ttdeci">uint32_t r6</div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00074">os.h:74</a></div></div>
<div class="ttc" id="structswcontext_html_adca79d8d458b4c055463355a7295e2c5"><div class="ttname"><a href="structswcontext.html#adca79d8d458b4c055463355a7295e2c5">swcontext::r4</a></div><div class="ttdeci">uint32_t r4</div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00072">os.h:72</a></div></div>
<div class="ttc" id="structhwcontext_html_aebbb22c13f9911fb942fb5fea9adb9ec"><div class="ttname"><a href="structhwcontext.html#aebbb22c13f9911fb942fb5fea9adb9ec">hwcontext::r3</a></div><div class="ttdeci">uint32_t r3</div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00063">os.h:63</a></div></div>
<div class="ttc" id="structhwcontext_html_a50f98f801ed417529e78e6f00f0a40d2"><div class="ttname"><a href="structhwcontext.html#a50f98f801ed417529e78e6f00f0a40d2">hwcontext::pc</a></div><div class="ttdeci">uint32_t pc</div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00066">os.h:66</a></div></div>
<div class="ttc" id="structswcontext_html_a6da50c233eaf9dc50cc65fc7ebabb68d"><div class="ttname"><a href="structswcontext.html#a6da50c233eaf9dc50cc65fc7ebabb68d">swcontext::r8</a></div><div class="ttdeci">uint32_t r8</div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00076">os.h:76</a></div></div>
<div class="ttc" id="structhwcontext_html_af5bf976e4a863698625aaf109b4f4922"><div class="ttname"><a href="structhwcontext.html#af5bf976e4a863698625aaf109b4f4922">hwcontext::r1</a></div><div class="ttdeci">uint32_t r1</div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00061">os.h:61</a></div></div>
<div class="ttc" id="structswcontext_html_a3d1731647adbe72b2cd79b112057d8c8"><div class="ttname"><a href="structswcontext.html#a3d1731647adbe72b2cd79b112057d8c8">swcontext::r5</a></div><div class="ttdeci">uint32_t r5</div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00073">os.h:73</a></div></div>
<div class="ttc" id="structhwcontext_html_ab8ef842b72d033b740bc5d7b63668a7f"><div class="ttname"><a href="structhwcontext.html#ab8ef842b72d033b740bc5d7b63668a7f">hwcontext::psr</a></div><div class="ttdeci">uint32_t psr</div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00067">os.h:67</a></div></div>
<div class="ttc" id="structswcontext_html_aff003065cbe0c593e3d29631a47d7695"><div class="ttname"><a href="structswcontext.html#aff003065cbe0c593e3d29631a47d7695">swcontext::lr</a></div><div class="ttdeci">uint32_t lr</div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00080">os.h:80</a></div></div>
<div class="ttc" id="os_8h_html_a9fdcaeee2ac8d68ac5fbbcd450fd08da"><div class="ttname"><a href="os_8h.html#a9fdcaeee2ac8d68ac5fbbcd450fd08da">OS_STACK_SIZE</a></div><div class="ttdeci">#define OS_STACK_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00015">os.h:15</a></div></div>
<div class="ttc" id="structtcb_html_a1b635a6f6a5f7f3c80665eb17b561b74"><div class="ttname"><a href="structtcb.html#a1b635a6f6a5f7f3c80665eb17b561b74">tcb::sp</a></div><div class="ttdeci">int32_t * sp</div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00036">os.h:36</a></div></div>
<div class="ttc" id="structswcontext_html_a9844679f105ad367c9f89f2811a38397"><div class="ttname"><a href="structswcontext.html#a9844679f105ad367c9f89f2811a38397">swcontext::r7</a></div><div class="ttdeci">uint32_t r7</div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00075">os.h:75</a></div></div>
<div class="ttc" id="structswcontext_html"><div class="ttname"><a href="structswcontext.html">swcontext</a></div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00071">os.h:71</a></div></div>
<div class="ttc" id="structhwcontext_html"><div class="ttname"><a href="structhwcontext.html">hwcontext</a></div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00059">os.h:59</a></div></div>
<div class="ttc" id="structswcontext_html_a7347ef967115a508e699a2cc0f29fa34"><div class="ttname"><a href="structswcontext.html#a7347ef967115a508e699a2cc0f29fa34">swcontext::r10</a></div><div class="ttdeci">uint32_t r10</div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00078">os.h:78</a></div></div>
<div class="ttc" id="structswcontext_html_a2f4f0d3b6c09829e666bf45f39b942eb"><div class="ttname"><a href="structswcontext.html#a2f4f0d3b6c09829e666bf45f39b942eb">swcontext::r9</a></div><div class="ttdeci">uint32_t r9</div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00077">os.h:77</a></div></div>
<div class="ttc" id="structhwcontext_html_a65407fe41de053b48e9e826ed3c638e6"><div class="ttname"><a href="structhwcontext.html#a65407fe41de053b48e9e826ed3c638e6">hwcontext::r0</a></div><div class="ttdeci">uint32_t r0</div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00060">os.h:60</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="os_8c_aaa82962ea069b6011927f9e2ef893128_icgraph.png" border="0" usemap="#os_8c_aaa82962ea069b6011927f9e2ef893128_icgraph" alt=""/></div>
<map name="os_8c_aaa82962ea069b6011927f9e2ef893128_icgraph" id="os_8c_aaa82962ea069b6011927f9e2ef893128_icgraph">
<area shape="rect" id="node2" href="os_8c.html#a2bb573a559f90989a49a4338d08203bd" title="os_add_thread" alt="" coords="220,5,337,32"/><area shape="rect" id="node3" href="test-os_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4" title="main" alt="" coords="385,5,440,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a21e9322255bb20b29229f675078d42b4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void os_threading_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialize the threading engine, setting all threads to dead. This initializes the dead thread circle appropriately and sets the running thread circle to null. </p>

<p>Definition at line <a class="el" href="os_8c_source.html#l00021">21</a> of file <a class="el" href="os_8c_source.html">os.c</a>.</p>

<p>References <a class="el" href="os_8h_source.html#l00046">tcb::id</a>, <a class="el" href="os_8h_source.html#l00039">tcb::next</a>, <a class="el" href="defines_8h_source.html#l00022">NULL</a>, <a class="el" href="os_8h_source.html#l00012">OS_MAX_THREADS</a>, <a class="el" href="os_8c_source.html#l00013">OS_PROGRAM_STACKS</a>, <a class="el" href="os_8h_source.html#l00042">tcb::prev</a>, <a class="el" href="os_8h_source.html#l00052">tcb::sleep_timer</a>, <a class="el" href="os_8h_source.html#l00036">tcb::sp</a>, <a class="el" href="os_8h_source.html#l00049">tcb::status</a>, and <a class="el" href="os_8h_source.html#l00019">THREAD_DEAD</a>.</p>

<p>Referenced by <a class="el" href="test-os_8c_source.html#l00040">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;                         {</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    uint32_t i;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    <a class="code" href="os_8c.html#a308367a2be95b095dc6ea1e9d4a825ff">os_current_dead_thread</a> = &amp;<a class="code" href="os_8c.html#a1b190933b985631f9a5a1f33afdd749e">OS_THREADS</a>[0];</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="os_8h.html#a42d66a999c19e795c22714a54fc2b6b2">OS_MAX_THREADS</a>; ++i) {</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;        <a class="code" href="os_8c.html#a1b190933b985631f9a5a1f33afdd749e">OS_THREADS</a>[i].<a class="code" href="structtcb.html#a1b635a6f6a5f7f3c80665eb17b561b74">sp</a> = <a class="code" href="os_8c.html#a9c939f75fdcc34e027493b93efd6523d">OS_PROGRAM_STACKS</a>[i];</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;        <a class="code" href="os_8c.html#a1b190933b985631f9a5a1f33afdd749e">OS_THREADS</a>[i].<a class="code" href="structtcb.html#aae1fd45a129bd299c55d9185fd701e3c">next</a> = &amp;<a class="code" href="os_8c.html#a1b190933b985631f9a5a1f33afdd749e">OS_THREADS</a>[i+1];</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;        <a class="code" href="os_8c.html#a1b190933b985631f9a5a1f33afdd749e">OS_THREADS</a>[i].<a class="code" href="structtcb.html#ae43b694dc3ba3934276a74c412120111">prev</a> = &amp;<a class="code" href="os_8c.html#a1b190933b985631f9a5a1f33afdd749e">OS_THREADS</a>[i-1];</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;        <a class="code" href="os_8c.html#a1b190933b985631f9a5a1f33afdd749e">OS_THREADS</a>[i].<a class="code" href="structtcb.html#ae673fba062360576eee9902d87c2dea8">id</a> = i;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        <a class="code" href="os_8c.html#a1b190933b985631f9a5a1f33afdd749e">OS_THREADS</a>[i].<a class="code" href="structtcb.html#a5d36bab13f7b5105e639165a67e6b943">status</a> = <a class="code" href="os_8h.html#a5c80f9e973519c129c8a7dec80c71c2aa1235d852989cc3030fe53f81eaa8e5f4">THREAD_DEAD</a>;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;        <a class="code" href="os_8c.html#a1b190933b985631f9a5a1f33afdd749e">OS_THREADS</a>[i].<a class="code" href="structtcb.html#aeea97619a9957dd9773ad75d3cb242ea">sleep_timer</a> = 0;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    }</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <a class="code" href="os_8c.html#a1b190933b985631f9a5a1f33afdd749e">OS_THREADS</a>[0].<a class="code" href="structtcb.html#ae43b694dc3ba3934276a74c412120111">prev</a> = &amp;<a class="code" href="os_8c.html#a1b190933b985631f9a5a1f33afdd749e">OS_THREADS</a>[OS_MAX_THREADS-1];</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <a class="code" href="os_8c.html#a1b190933b985631f9a5a1f33afdd749e">OS_THREADS</a>[OS_MAX_THREADS-1].<a class="code" href="structtcb.html#aae1fd45a129bd299c55d9185fd701e3c">next</a> = &amp;<a class="code" href="os_8c.html#a1b190933b985631f9a5a1f33afdd749e">OS_THREADS</a>[0];</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <a class="code" href="os_8c.html#ae9949c077f4331066f07d5a0a89db0f5">os_current_running_thread</a> = <a class="code" href="defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;}</div>
<div class="ttc" id="structtcb_html_ae673fba062360576eee9902d87c2dea8"><div class="ttname"><a href="structtcb.html#ae673fba062360576eee9902d87c2dea8">tcb::id</a></div><div class="ttdeci">immutable int32_t id</div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00046">os.h:46</a></div></div>
<div class="ttc" id="os_8c_html_a9c939f75fdcc34e027493b93efd6523d"><div class="ttname"><a href="os_8c.html#a9c939f75fdcc34e027493b93efd6523d">OS_PROGRAM_STACKS</a></div><div class="ttdeci">int32_t OS_PROGRAM_STACKS[4][100]</div><div class="ttdef"><b>Definition:</b> <a href="os_8c_source.html#l00013">os.c:13</a></div></div>
<div class="ttc" id="structtcb_html_aae1fd45a129bd299c55d9185fd701e3c"><div class="ttname"><a href="structtcb.html#aae1fd45a129bd299c55d9185fd701e3c">tcb::next</a></div><div class="ttdeci">struct tcb * next</div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00039">os.h:39</a></div></div>
<div class="ttc" id="os_8c_html_a308367a2be95b095dc6ea1e9d4a825ff"><div class="ttname"><a href="os_8c.html#a308367a2be95b095dc6ea1e9d4a825ff">os_current_dead_thread</a></div><div class="ttdeci">tcb_t * os_current_dead_thread</div><div class="ttdef"><b>Definition:</b> <a href="os_8c_source.html#l00019">os.c:19</a></div></div>
<div class="ttc" id="os_8c_html_ae9949c077f4331066f07d5a0a89db0f5"><div class="ttname"><a href="os_8c.html#ae9949c077f4331066f07d5a0a89db0f5">os_current_running_thread</a></div><div class="ttdeci">tcb_t * os_current_running_thread</div><div class="ttdef"><b>Definition:</b> <a href="os_8c_source.html#l00016">os.c:16</a></div></div>
<div class="ttc" id="os_8c_html_a1b190933b985631f9a5a1f33afdd749e"><div class="ttname"><a href="os_8c.html#a1b190933b985631f9a5a1f33afdd749e">OS_THREADS</a></div><div class="ttdeci">tcb_t OS_THREADS[4]</div><div class="ttdef"><b>Definition:</b> <a href="os_8c_source.html#l00010">os.c:10</a></div></div>
<div class="ttc" id="os_8h_html_a42d66a999c19e795c22714a54fc2b6b2"><div class="ttname"><a href="os_8h.html#a42d66a999c19e795c22714a54fc2b6b2">OS_MAX_THREADS</a></div><div class="ttdeci">#define OS_MAX_THREADS</div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00012">os.h:12</a></div></div>
<div class="ttc" id="structtcb_html_a1b635a6f6a5f7f3c80665eb17b561b74"><div class="ttname"><a href="structtcb.html#a1b635a6f6a5f7f3c80665eb17b561b74">tcb::sp</a></div><div class="ttdeci">int32_t * sp</div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00036">os.h:36</a></div></div>
<div class="ttc" id="structtcb_html_a5d36bab13f7b5105e639165a67e6b943"><div class="ttname"><a href="structtcb.html#a5d36bab13f7b5105e639165a67e6b943">tcb::status</a></div><div class="ttdeci">tstate_t status</div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00049">os.h:49</a></div></div>
<div class="ttc" id="defines_8h_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="defines_8h_source.html#l00022">defines.h:22</a></div></div>
<div class="ttc" id="structtcb_html_aeea97619a9957dd9773ad75d3cb242ea"><div class="ttname"><a href="structtcb.html#aeea97619a9957dd9773ad75d3cb242ea">tcb::sleep_timer</a></div><div class="ttdeci">int32_t sleep_timer</div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00052">os.h:52</a></div></div>
<div class="ttc" id="structtcb_html_ae43b694dc3ba3934276a74c412120111"><div class="ttname"><a href="structtcb.html#ae43b694dc3ba3934276a74c412120111">tcb::prev</a></div><div class="ttdeci">struct tcb * prev</div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00042">os.h:42</a></div></div>
<div class="ttc" id="os_8h_html_a5c80f9e973519c129c8a7dec80c71c2aa1235d852989cc3030fe53f81eaa8e5f4"><div class="ttname"><a href="os_8h.html#a5c80f9e973519c129c8a7dec80c71c2aa1235d852989cc3030fe53f81eaa8e5f4">THREAD_DEAD</a></div><div class="ttdef"><b>Definition:</b> <a href="os_8h_source.html#l00019">os.h:19</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="os_8c_a21e9322255bb20b29229f675078d42b4_icgraph.png" border="0" usemap="#os_8c_a21e9322255bb20b29229f675078d42b4_icgraph" alt=""/></div>
<map name="os_8c_a21e9322255bb20b29229f675078d42b4_icgraph" id="os_8c_a21e9322255bb20b29229f675078d42b4_icgraph">
<area shape="rect" id="node2" href="test-os_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4" title="main" alt="" coords="184,5,239,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa1ba32adb6ddf834e4938ba286a1f24a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PendSV_Handler </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="os_8c_source.html#l00177">177</a> of file <a class="el" href="os_8c_source.html">os.c</a>.</p>

<p>Referenced by <a class="el" href="test-os_2startup__gcc_8c_source.html#l00049">__attribute__()</a>.</p>
<div class="fragment"><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                      {</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;CPSID  I            ;// mask all (except faults)\n&quot;</span>);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="comment">/* -------------------------------------------------- */</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="comment">/* phase 1: store context                             */</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="comment">/* -------------------------------------------------- */</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="comment">/* load the psp of thread A into r12 */</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;mrs     r12, psp&quot;</span> );</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="comment">/* save thread A&#39;s registers into the psp */</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;stmdb   r12!, {r4 - r11, lr}&quot;</span>);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="comment">/* -------------------------------------------------- */</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="comment">/* phase 2: os_current_running_thread manipulation    */</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="comment">/* -------------------------------------------------- */</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="comment">/* load the value of os_current_running_thread */</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;LDR     R2, =os_current_running_thread&quot;</span>);</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="comment">/* r3 = *os_current_running_thread, of thread A */</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;LDR     R3, [R2]&quot;</span>);</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="comment">/* load the value of os_current_running_thread-&gt;next into r1 */</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;LDR     R1, [R3,#4]&quot;</span>);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="comment">/* os_current_running_thread = os_current_running_thread-&gt;next */</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;STR     R1, [R2]&quot;</span>);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="comment">/* -------------------------------------------------- */</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="comment">/* phase 3: load context                              */</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="comment">/* -------------------------------------------------- */</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="comment">/* store the psp from thread A */</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;str     r12, [r3, #0]&quot;</span>);</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="comment">/* load thread B&#39;s psp */</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;ldr     r12, [r1, #0]&quot;</span>);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="comment">/* load thread B&#39;s context */</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;ldmia   r12!, {r4 - r11, lr}&quot;</span>);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="comment">/* put thread B&#39;s psp into the arch psp register */</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;msr     psp, r12&quot;</span>);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="comment">/* reenable interrupts */</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;CPSIE   I&quot;</span>);</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="comment">/* complete the thread switch */</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span> (<span class="stringliteral">&quot;bx lr&quot;</span>);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="os_8c_aa1ba32adb6ddf834e4938ba286a1f24a_icgraph.png" border="0" usemap="#os_8c_aa1ba32adb6ddf834e4938ba286a1f24a_icgraph" alt=""/></div>
<map name="os_8c_aa1ba32adb6ddf834e4938ba286a1f24a_icgraph" id="os_8c_aa1ba32adb6ddf834e4938ba286a1f24a_icgraph">
<area shape="rect" id="node2" href="test-os_2startup__gcc_8c.html#acebe980784c59c373626efbbf419bf05" title="__attribute__" alt="" coords="183,5,288,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aafb8d3e0fd06464b1ee0ae1edbc3c7d6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SysTick_Handler </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="os_8c_source.html#l00171">171</a> of file <a class="el" href="os_8c_source.html">os.c</a>.</p>

<p>References <a class="el" href="hw__ints_8h_source.html#l00056">FAULT_PENDSV</a>, and <a class="el" href="interrupt_8c_source.html#l00844">IntPendSet()</a>.</p>

<p>Referenced by <a class="el" href="test-os_2startup__gcc_8c_source.html#l00049">__attribute__()</a>.</p>
<div class="fragment"><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                       {</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <a class="code" href="group__interrupt__api.html#gafe17b56764bff1bcb95bd53acde4ac98">IntPendSet</a>(<a class="code" href="hw__ints_8h.html#ae25ed9ac134da15fc8622911d0ac1905">FAULT_PENDSV</a>);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;}</div>
<div class="ttc" id="group__interrupt__api_html_gafe17b56764bff1bcb95bd53acde4ac98"><div class="ttname"><a href="group__interrupt__api.html#gafe17b56764bff1bcb95bd53acde4ac98">IntPendSet</a></div><div class="ttdeci">void IntPendSet(uint32_t ui32Interrupt)</div><div class="ttdef"><b>Definition:</b> <a href="interrupt_8c_source.html#l00844">interrupt.c:844</a></div></div>
<div class="ttc" id="hw__ints_8h_html_ae25ed9ac134da15fc8622911d0ac1905"><div class="ttname"><a href="hw__ints_8h.html#ae25ed9ac134da15fc8622911d0ac1905">FAULT_PENDSV</a></div><div class="ttdeci">#define FAULT_PENDSV</div><div class="ttdef"><b>Definition:</b> <a href="hw__ints_8h_source.html#l00056">hw_ints.h:56</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="os_8c_aafb8d3e0fd06464b1ee0ae1edbc3c7d6_cgraph.png" border="0" usemap="#os_8c_aafb8d3e0fd06464b1ee0ae1edbc3c7d6_cgraph" alt=""/></div>
<map name="os_8c_aafb8d3e0fd06464b1ee0ae1edbc3c7d6_cgraph" id="os_8c_aafb8d3e0fd06464b1ee0ae1edbc3c7d6_cgraph">
<area shape="rect" id="node2" href="group__interrupt__api.html#gafe17b56764bff1bcb95bd53acde4ac98" title="IntPendSet" alt="" coords="180,5,272,32"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="os_8c_aafb8d3e0fd06464b1ee0ae1edbc3c7d6_icgraph.png" border="0" usemap="#os_8c_aafb8d3e0fd06464b1ee0ae1edbc3c7d6_icgraph" alt=""/></div>
<map name="os_8c_aafb8d3e0fd06464b1ee0ae1edbc3c7d6_icgraph" id="os_8c_aafb8d3e0fd06464b1ee0ae1edbc3c7d6_icgraph">
<area shape="rect" id="node2" href="test-os_2startup__gcc_8c.html#acebe980784c59c373626efbbf419bf05" title="__attribute__" alt="" coords="180,5,285,32"/></map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a308367a2be95b095dc6ea1e9d4a825ff"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="os_8h.html#a74f1cae5f9b08e029e1f7e40bc0add47">tcb_t</a>* os_current_dead_thread = <a class="el" href="defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>A circular doubly linked list of currently dead threads. </p>

<p>Definition at line <a class="el" href="os_8c_source.html#l00019">19</a> of file <a class="el" href="os_8c_source.html">os.c</a>.</p>

<p>Referenced by <a class="el" href="os_8c_source.html#l00086">os_next_dead_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="ae9949c077f4331066f07d5a0a89db0f5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="os_8h.html#a74f1cae5f9b08e029e1f7e40bc0add47">tcb_t</a>* os_current_running_thread = <a class="el" href="defines_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>A circular doubly linked list of currently running threads. </p>

<p>Definition at line <a class="el" href="os_8c_source.html#l00016">16</a> of file <a class="el" href="os_8c_source.html">os.c</a>.</p>

<p>Referenced by <a class="el" href="os_8c_source.html#l00041">os_add_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="a9c939f75fdcc34e027493b93efd6523d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t OS_PROGRAM_STACKS[4][100]</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>A block of memory for each thread's local stack. </p>

<p>Definition at line <a class="el" href="os_8c_source.html#l00013">13</a> of file <a class="el" href="os_8c_source.html">os.c</a>.</p>

<p>Referenced by <a class="el" href="os_8c_source.html#l00132">os_reset_thread_stack()</a>, and <a class="el" href="os_8c_source.html#l00021">os_threading_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a1b190933b985631f9a5a1f33afdd749e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="os_8h.html#a74f1cae5f9b08e029e1f7e40bc0add47">tcb_t</a> OS_THREADS[4]</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>An array of statically allocated threads. </p>

<p>Definition at line <a class="el" href="os_8c_source.html#l00010">10</a> of file <a class="el" href="os_8c_source.html">os.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_9e7e095887a2dd3b6af8e37d880530c8.html">libos</a></li><li class="navelem"><a class="el" href="os_8c.html">os.c</a></li>
    <li class="footer">Generated on Mon Feb 16 2015 10:10:11 for EE445M RTOS by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
